$.fn.or=function(selector){return(0==$(this).length)?$(selector):this;};var LBG=window.LBG||{};LBG.stopEventImmdtePropgtn={stopEvntImdPropFunc:function(event){event.stopImmediatePropagation();}};LBG.browserIdent={browserIdent:false,browserVersions:{ff2:"1.8",ff3:"1.9"},sniff:function(){if($.browser.mozilla){var currentBrowser=LBG.common.parseVersionString($.browser.version);var ff2=LBG.common.parseVersionString(this.browserVersions.ff2);var ff3=LBG.common.parseVersionString(this.browserVersions.ff3);if(currentBrowser.major===ff2.major&&currentBrowser.minor<=ff2.minor){this.browserIdent="ff2";}else{if(currentBrowser.major===ff3.major&&currentBrowser.minor>=ff3.minor&&currentBrowser.patch<=ff3.patch){this.browserIdent="ff3";}}}else{if($.browser.msie){this.browserIdent=($.browser.version>6)?"ie":"ie6";}else{if(navigator.platform.indexOf("iPad")!==-1){this.browserIdent="iPad";}else{if(navigator.platform.indexOf("iPhone")!==-1){this.browserIdent="iPhone";}}}}return this.browserIdent;}};LBG.numericInputSupport={init:function(){if(!$("body").hasClass("numericInput")){for(var els=document.getElementsByTagName("input"),i=els.length;i--;){if(els[i].type=="number"){els[i].type="text";}}}}};LBG.accordion={currentTriggerClass:".current",panePrefix:"accPane",paneCount:1,linkAddedClass:"linkPointer hasLink",partSelector:".part",selectedClass:"selected",triggerTitle:DI.lang.accordion.trigger,isChrome:/chrome/.test(navigator.userAgent.toLowerCase()),build:function(accordionSelector,triggerSelector){var $accordion=$(accordionSelector);if(!$accordion.length){return false;}var $trigger=$accordion.find(triggerSelector);if(!$trigger.length){return false;}var container=$(".secondary:eq(0)")[0];$trigger.addClass(LBG.accordion.linkAddedClass);LBG.accordion.tabIndexFocusFix($trigger);$accordion.accordion({header:triggerSelector,active:LBG.accordion.currentTriggerClass,collapsible:true,autoHeight:false,clearStyle:true,changestart:function(event,ui){if(ui.oldHeader.length>0){ui.oldHeader.next().attr("aria-hidden",true).attr("aria-live","off");}if(ui.newHeader.length>0&&ui.oldHeader.length===0){ui.newHeader.parents(".pane").attr("aria-live","off");}},change:function(event,ui){if(jQuery.browser.msie&&jQuery.browser.version<8){LBG.common.explorerRedrawFix(container,true);}if(ui.newHeader.length>0){ui.newHeader.parent(LBG.accordion.partSelector).toggleClass(LBG.accordion.selectedClass);ui.newHeader.attr({"aria-selected":true,"aria-expanded":true,"aria-controls":"collapsibleAccordion"}).next().attr("aria-hidden",false).attr("aria-live","polite").attr("id","collapsibleAccordion");}if(ui.oldHeader.length>0){ui.oldHeader.parent(LBG.accordion.partSelector).toggleClass(LBG.accordion.selectedClass);ui.oldHeader.attr({"aria-selected":false,"aria-expanded":false}).removeAttr("aria-controls").next().removeAttr("id");$trigger.attr("tabIndex","-1").attr("tabIndex","0");}LBG.accordion.tabIndexFocusFix($trigger);}});$trigger.not(".ui-state-active").attr({"aria-expanded":"false","aria-selected":"false"}).next().attr({"aria-hidden":"true"});$trigger.attr("tabIndex","-1").attr("tabIndex","0");$trigger.each(function(){this.title=$(this).text()+": "+LBG.accordion.triggerTitle;});},addOpenClass:function(){$(".accordion .current").parent().addClass("selected");},tabIndexFocusFix:function($trigger){if($.browser.safari===true||LBG.accordion.isChrome===true&&$.browser.version<=533){$trigger.parents(".part").each(function(){var i=($(this).hasClass(".selected")===true)?0:-1;$(this).find("a, .qfaqTrigger").attr("tabIndex",i);});$trigger.find("a:first").attr("tabIndex",0).bind("blur",function(){var anchor=this;var timer=window.setTimeout(function(){$(anchor).css("overflow","hidden");window.clearTimeout(timer);},10);});}},init:function(){this.build("ul.quickFAQs","h3.qfaqTrigger");this.build("div.accordion",".trigger");this.build("div.accordionLight","h2.trigger");this.build("ul.showHideAccordion",".trigger");this.build("div.tillReceipt.expandable","h3.trigger");this.build(".testingAccord",".testingTrigger");}};LBG.quickTransfer=(function(){var TRANSFER_SELECTOR=".quickTransfer",CLOSED_TEXT=DI.lang.quickTransfer.triggerClosedText,OPEN_TEXT=DI.lang.quickTransfer.triggerOpenText,HEADING_TEXT=DI.lang.quickTransfer.defaultHeadingText,TRANSFER_ID=DI.lang.quickTransfer.triggerID,OPEN_CLASS="close";function _processQuickTransferModule(){var $transfer=$(this),$trigger=$('<p class="transferTrigger"><a href="#" id="'+TRANSFER_ID+'">'+CLOSED_TEXT+"</a></p>"),$parent=$transfer.parent(),$anchor=$trigger.find("a:eq(0)");$parent.before($trigger);$trigger.find("a:eq(0)").click(function(){$parent.slideToggle(400,function(){if($anchor.html()===CLOSED_TEXT){$anchor.html(OPEN_TEXT);}else{$anchor.html(CLOSED_TEXT);}$anchor.toggleClass(OPEN_CLASS);$parent.find(".success").removeClass("success").html(HEADING_TEXT);$(this).stop();});return false;});if(!$transfer.hasClass("open")){$parent.hide();}else{var triggerLink=$("p.transferTrigger").children("a");triggerLink.html(OPEN_TEXT);triggerLink.toggleClass(OPEN_CLASS);if($transfer.find(".success").length>0){LBG.common.effects.highlightElement(".transferSlideOuter");}}}return{init:function(){$(TRANSFER_SELECTOR).each(_processQuickTransferModule);}};})();LBG.iban={triggerSelector:".viewIban > a",statementWrapperSelector:".ibanPlaceholder",slideHTML:'<div class="ibanSlide"></div>',triggerOpenText:DI.lang.iban.triggerOpenText,triggerOpenClass:"open",loadMsg:'<span class="loading">&nbsp;</span>',loadErrorMsg:DI.lang.iban.loadErrorMsgStub,init:function(){$(this.triggerSelector).each(function(i,trigger){var statementItem=$(trigger).parents()[2],requested=false;trigger.wrapper=$(statementItem).find(LBG.iban.statementWrapperSelector)[0];trigger.slide=$(LBG.iban.slideHTML);$(trigger.wrapper).append(trigger.slide);trigger.slide.hide();trigger.slide.loaded=false;trigger.savedText=$(trigger).text();$(trigger).click(function(){if(trigger.slide.is(":animated")){return false;}if(!this.slide.loaded&&requested===false){requested=true;$(this).parent().append(LBG.iban.loadMsg);$.ajax({url:LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(trigger)),success:function(response){trigger.slide.html(response);trigger.slide.loaded=true;$(trigger).parent().find("span").not("span.cxtHelp").remove();LBG.ajax.pageUpdated();if(typeof LBG.smartRewards!=="undefined"&&typeof LBG.smartRewards.statementCashbackOffers.init==="function"){LBG.smartRewards.statementCashbackOffers.init($(trigger.wrapper));}if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.ac","pages/p27_00_account_statement/properties.p2700lnk507a,pages/p27_00_account_statement/properties.p2700lnk510a,Show IBAN / BIC,Hide IBAN/BIC");}trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.iban.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);$(trigger.slide).find("li.close a").text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});$(trigger.slide).find("li.close a").click(function(){trigger.slide.loaded=false;trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.iban.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();});return false;});},error:function(){$.ajax({url:LBG.iban.loadErrorMsg,dataType:"html",success:function(data){trigger.slide.html(data);}});$(trigger).parent().find("span").remove();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.iban.triggerOpenClass);
if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}});}else{trigger.slide.slideToggle(500,function(){trigger.slide.loaded=false;$(trigger).toggleClass(LBG.iban.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}return false;});});}};LBG.miniStatement={triggerSelector:".viewMiniStatement a",statementWrapperSelector:".miniStatementPlaceholder",slideHTML:'<div class="miniStatementSlide"></div>',triggerOpenText:DI.lang.miniStatement.triggerOpenText,triggerOpenClass:"open",loadMsg:'<span class="loading">&nbsp;</span>',loadErrorMsg:DI.lang.miniStatement.loadErrorMsgStub,init:function(){$(this.triggerSelector).each(function(i,trigger){var statementItem=$(trigger).parents()[2],requested=false;trigger.wrapper=$(statementItem).find(LBG.miniStatement.statementWrapperSelector)[0];trigger.slide=$(LBG.miniStatement.slideHTML);$(trigger.wrapper).append(trigger.slide);trigger.slide.hide();trigger.slide.loaded=false;trigger.savedText=$(trigger).text();$(trigger).click(function(){if(trigger.slide.is(":animated")){return false;}if(!this.slide.loaded&&requested===false){requested=true;$(this).parent().append(LBG.miniStatement.loadMsg);$.ajax({url:LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(trigger)),success:function(response){trigger.slide.html(response);trigger.slide.loaded=true;$(trigger).parent().find("span").remove();LBG.ajax.pageUpdated();if(typeof LBG.smartRewards!=="undefined"&&typeof LBG.smartRewards.statementCashbackOffers.init==="function"){LBG.smartRewards.statementCashbackOffers.init($(trigger.wrapper));}trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);$(trigger.slide).find("li.close a").text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});$(trigger.slide).find("li.close a").click(function(){trigger.slide.loaded=false;trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();});return false;});},error:function(){$.ajax({url:LBG.miniStatement.loadErrorMsg,dataType:"html",success:function(data){trigger.slide.html(data);}});$(trigger).parent().find("span").remove();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}});}else{trigger.slide.slideToggle(500,function(){trigger.slide.loaded=false;$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}return false;});});}};LBG.scottishWidows={triggerSelector:".viewScottishWidowsAccounts a",listWrapperSelector:".scottishWidowsAccountsPlaceholder",slideHTML:'<div class="scottishWidowsAccountsSlide"></div>',triggerOpenClass:"open",loadMsg:'<span class="loading">&nbsp;</span>',loadErrorMsg:'<p class="asyncError">'+DI.lang.scottishWidows.loadErrorMsgText+"</p>",init:function(){$(this.triggerSelector).each(function(i,trigger){var accountListItem=$(trigger).parents()[2],requested=false;trigger.wrapper=$(accountListItem).find(LBG.scottishWidows.listWrapperSelector)[0];trigger.slide=$(LBG.scottishWidows.slideHTML);$(trigger.wrapper).append(trigger.slide);trigger.slide.hide();trigger.slide.loaded=false;$(trigger).click(function(){if(!this.slide.loaded&&requested===false){requested=true;$(this).parent().append(LBG.scottishWidows.loadMsg);$.ajax({url:LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(trigger)),success:function(response){trigger.slide.html(response);trigger.slide.loaded=true;$(trigger).parent().find("span").remove();LBG.ajax.pageUpdated();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.scottishWidows.triggerOpenClass);$(this).stop();return false;});},error:function(){trigger.slide.html(LBG.scottishWidows.loadErrorMsg);trigger.slide.loaded=true;$(trigger).parent().find("span").remove();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.scottishWidows.triggerOpenClass);$(this).stop();return false;});}});}else{if(!trigger.slide.is(":animated")){trigger.slide.slideToggle(500,function(){trigger.slide.loaded=false;$(trigger).toggleClass(LBG.scottishWidows.triggerOpenClass);$(this).stop();return false;});}}return false;});});}};LBG.showHide={toggleSelector:".showHide",toggleSelectorBind:".showHideBind",triggerSelector:".trigger",triggerContent:'<span class="toggle"></span>',paneSelector:"div.pane",tempIDPrefix:"show",closedClass:"closed",showSingle:false,triggerTitleDesktop:DI.lang.showHide.triggerDesktop,triggerTitle:DI.lang.showHide.trigger,triggerTitleOpen:DI.lang.showHide.triggerTitleOpen,formFixClass:"safariFormFix",hasNestedClass:"hasNested",updateTriggerTitle:function($trigger,expand){$trigger.each(function(){if(mobileType==="Android"){var title="";if(expand==false){$(this).attr("aria-label",$(this).text()+" : "+LBG.showHide.triggerTitle);}else{$(this).attr("aria-label",$(this).text()+" : "+LBG.showHide.triggerTitleOpen);}}else{if(expand==false){$(this).attr("aria-expanded","false").attr("role","tab");}else{$(this).attr("aria-expanded","true").attr("role","tab");}if(mobileType==="iOS"){this.title=$.trim(LBG.showHide.triggerTitleDesktop);}else{this.title=$.trim($(this).text())+": "+$.trim(LBG.showHide.triggerTitleDesktop);}}});},init:function(){$(this.toggleSelector).find(this.triggerSelector).each(function(i,trigger){var thePane=$(trigger).siblings(LBG.showHide.paneSelector)[0]||null;var $pane=$(thePane);var meta=$(trigger).parents(LBG.showHide.toggleSelector).metadata();var allowMultipleAjaxRequests=meta&&meta.allowMultipleAjaxRequests?true:false;var triggerID="";if(meta&&meta.target){thePane=$(meta.target)[0];}if(!thePane){return;}var tmpID=LBG.showHide.tempIDPrefix+i;if(thePane.id){tmpID=thePane.id;}else{thePane.id=tmpID;}$(trigger).prepend(LBG.showHide.triggerContent).data("thePaneId",thePane.id);if($(trigger)[0].tagName.toLowerCase()!=="a"&&!meta.triggerNoLink){$(trigger).wrapInner('<a href="#'+tmpID+'" class="triggerChild"></a>');if(trigger.id){$("a:first",trigger).attr("id",trigger.id);$(trigger).removeAttr("id");}}else{$(trigger).wrapInner('<span class="triggerChild"></span>');}if($(trigger).closest(LBG.showHide.toggleSelector).hasClass("resets")){trigger.resets=thePane.innerHTML;}if(($(trigger).parent().next().hasClass("clearer"))===false&&document.body.style.maxHeight!==undefined){$(trigger).parent().after('<div class="clearer"></div>');}if($(trigger).parents(LBG.showHide.toggleSelector).hasClass(LBG.showHide.closedClass)){$(thePane).hide();}if(trigger.tagName.toLowerCase()==="a"){$(trigger).click(function(event){event.preventDefault();});}$(".triggerChild",trigger).each(function(){$(this).bind("keydown",function(event){var keyCode=$.ui.keyCode;if(event.keyCode==keyCode.SPACE){event.preventDefault();$(this).click();}});$(this).click(function(){if($(this).attr("id")==="frmMakeMortgagePayment:accordionHead"){var subAccountsAvailable=[],counter=0;
$("input:radio[name=frmMakeMortgagePayment:subAccount]").each(function(){if(counter<$("input:radio[name=frmMakeMortgagePayment:subAccount]").length-1){var rateSelected,accountSelected="Sub-account "+("0"+$(this).val()).slice(-2);if($(this).siblings().text().toLowerCase().indexOf("rate: ")>-1){rateSelected=$(this).siblings().text().toLowerCase().split("rate: ")[1].slice(0,-2);subAccountsAvailable[counter++]=accountSelected+"/"+rateSelected;}else{subAccountsAvailable[counter++]=accountSelected;}}});var subAccountsAvailableList=subAccountsAvailable.join("; ");LBG.track({"WT.si_n":"AdditionalMortgagePayment","WT.si_x":"1","WT.tx_e":"14","WT.pn_sku":"Standard; Targeted","WT.ad":"Sub-account 00; "+subAccountsAvailableList});var subAccountsList=$(this).closest("div.showHide").find(".radioGroup").eq(0).children().find("input:radio[name=frmMakeMortgagePayment:subAccount]");$(subAccountsList).click(function(){var accountSelected="Sub-account "+("0"+$(this).val()).slice(-2);var rateSelected=null;if($("(this):checked").val()!=0&&($(this).parent().find("label").text().toLowerCase().indexOf("rate: ")>-1)){rateSelected=$(this).parent().find("label").text().toLowerCase().split("rate: ")[1].slice(0,-2);}else{rateSelected=null;}var mortgagePaymentMode=($("(this):checked").val()==0?"Standard":"Targeted");if(mortgagePaymentMode=="Standard"){subAccountName="Sub-account 00";}else{if(rateSelected!=null){subAccountName=accountSelected+"/"+rateSelected;}else{subAccountName=accountSelected;}}LBG.track({"WT.si_n":"AdditionalMortgagePayment","WT.si_x":"1","WT.tx_e":"14","WT.pn_sku":mortgagePaymentMode,"WT.ac":subAccountName,"DCSext.mortgage.part":subAccountName});});}if(LBG.showHide.showSingle){var closeTrigger=$(LBG.showHide.paneSelector+":visible").parent().find(LBG.showHide.triggerSelector);if(closeTrigger.length>0&&closeTrigger.find(".triggerChild").get(0).hash!==this.hash){LBG.showHide.toggleDisplay(closeTrigger);}}if($(trigger).parent().hasClass(LBG.showHide.toggleSelectorBind)){var $collection=$(LBG.showHide.toggleSelectorBind).find(LBG.showHide.triggerSelector);$collection.each(function(){LBG.showHide.toggleDisplay($(this)[0]);});}else{LBG.showHide.toggleDisplay($(trigger)[0]);}if(trigger.actionFlag&&!LBG.common.isEmpty($(trigger).metadata().async)){if(!$pane.hasClass("show-hide-async-loaded")){$pane.addClass("async-loading").html('<div class="async-loading-message">loading...</div>');$.ajax({url:$(trigger).metadata().async.url,cache:false,dataType:"html",success:function(data){$pane.html(data);$pane.removeClass("async-loading");if(!allowMultipleAjaxRequests){$pane.addClass("show-hide-async-loaded");}}});}}return false;});if(this.tagName.toLowerCase()!=="a"){$(this).attr("tabIndex",0).keydown(function(e){if(e.keyCode===32||e.keyCode===13){$(this).click();return false;}});if($.browser.msie&&$.browser.version<7){$(this).hover(function(){$(this).addClass("hover");},function(){$(this).removeClass("hover");});}}});$(".loanCompletion .showHide").bind("click keypress",function(e){if(e.type=="keypress"){if(e.which!=13){return;}}$(this).find(".triggerChild").trigger("click",e);$(this).attr("tabindex",0).focus();e.preventDefault();});if($(this).parent().hasClass("sp-pat-310")){$(".toggle",this).text(DI.lang.scsp.loyaltyRateLink.textOpen);}if(!$(trigger).parents(LBG.showHide.toggleSelector).hasClass(LBG.showHide.closedClass)){LBG.showHide.updateTriggerTitle($(this).find(".triggerChild"),true);}else{LBG.showHide.updateTriggerTitle($(this).find(".triggerChild"),false);}});if($(this.toggleSelector+":first").parent().hasClass("show_single")){this.showSingle=true;}$(".showHide .part.closed .pane").css("display","none");},toggleDisplay:function(trigger){var $closeAppliedTo=$(trigger).parent();var $thePane=$(trigger).siblings(LBG.showHide.paneSelector);if(!$thePane.length){$thePane=$("#"+$(trigger).data("thePaneId"));}if(!trigger.busyFlag){trigger.busyFlag=true;if(jQuery.browser.safari){$(trigger).parents("form").toggleClass(LBG.showHide.formFixClass);}if($closeAppliedTo.hasClass(LBG.showHide.closedClass)){$closeAppliedTo.toggleClass(LBG.showHide.closedClass);if(($closeAppliedTo).hasClass("icc-expand-collapse")){$closeAppliedTo.attr("role","tablist");$thePane.attr("role","tabpanel");$thePane.attr("area-live","polite");}trigger.actionFlag=true;}$thePane.slideToggle("slow",function(){var meta=$(trigger).metadata().label;if(trigger.actionFlag){trigger.actionFlag=false;$(trigger).find(".triggerChild").attr("aria-expanded",true);if(typeof(LBG.ommDetect)!=="undefined"){LBG.ommDetect.revealLoader(trigger);}if(meta){$(trigger).find(".triggerChild")[0].firstChild.nodeValue=meta.open;}}else{$closeAppliedTo.toggleClass(LBG.showHide.closedClass);if(($closeAppliedTo).hasClass("icc-expand-collapse")){$closeAppliedTo.removeAttr("role");$thePane.removeAttr("role");$thePane.removeAttr("area-live");}trigger.actionFlag=true;$(trigger).find(".triggerChild").attr("aria-expanded",false);if(trigger.resets){$(this).html(trigger.resets);LBG.Forms.Validation.init(this);}if(meta){$(trigger).find(".triggerChild")[0].firstChild.nodeValue=meta.closed;}}if($(this).parent().hasClass("sp-pat-310")){if($(this).parent().hasClass("closed")){$(this).parent().find(".toggle").text(DI.lang.scsp.loyaltyRateLink.textOpen);}else{$(this).parent().find(".toggle").text(DI.lang.scsp.loyaltyRateLink.textClose);var $parentItem=$(this).parent(".sp-pat-310"),productTagName=$parentItem.prevAll(".osrTableData").children("li").eq(0).find("h3").text(),productTagRate=$(this).parent().find(".toggleHeader dd").text().slice(0,-1),productTag="COMPARE/"+productTagName+"/"+productTagRate;LBG.track({"WT.ac":productTag,"WT.si_n":"ApplySavings","WT.si_x":"1","WT.tx_e":"h2","WT.tx_n":"ExplainRate","WT.pn_sku":productTagName,"WT.dl":"99"});}}if(!$(trigger).parents(LBG.showHide.toggleSelector).hasClass(LBG.showHide.closedClass)){LBG.showHide.updateTriggerTitle($(trigger).find(".triggerChild"),true);}else{LBG.showHide.updateTriggerTitle($(trigger).find(".triggerChild"),false);}trigger.busyFlag=false;});}}};LBG.tableSorter={tableSelector:"table.sortable",zeroPaddingSize:30,init:function(){var months={"JAN":"01","FEB":"02","MAR":"03","APR":"04","MAY":"05","JUN":"06","JUL":"07","AUG":"08","SEP":"09","OCT":"10","NOV":"11","DEC":"12"};$.tablesorter.addParser({id:"LBGShortDate",is:function(s){return(/(\d{2}) ([A-Za-z]{3}) (\d{2})/.test(s));},format:function(s,table){var c=table.config,y;var dateParts=s.match(/(\d{2}) ([A-Za-z]{3}) (\d{2})/);if(dateParts&&dateParts.length===4){y=(parseFloat(dateParts[3])<2000)?parseFloat(dateParts[3])+2000:parseFloat(dateParts[3]);return $.tablesorter.formatFloat(new Date(y,months[dateParts[2].toUpperCase()],dateParts[1]).getTime());}},type:"numeric"});$.tablesorter.addParser({id:"LBGDateDDMMMYY",is:function(s){return false;},format:function(s){s=$.trim(s);var regEx="^[\\d]{2}[/|\\s]{1}[A-Za-z]{3}[/|\\s]{1}[\\d]{2}";var date=s.match(regEx);if(date!==null){date=date[0];date=date.replace(/\s/g,"/");date=date.split("/");date[1]=months[date[1].toUpperCase()];return date.reverse().join("");}else{return"999999";}},type:"numeric"});$.tablesorter.addParser({id:"LBGAlphaNumeric",is:function(s){return false;},format:function(s){var numCheck=new RegExp("^[\d{1}]");var stripHTML=new RegExp("<(?:.|s)*?>","g");s=$.trim(s.replace(stripHTML,"").toLowerCase());return(numCheck.test(s)===false)?"0"+s:LBG.common.zeroPadding(s,LBG.tableSorter.zeroPaddingSize);},type:"text"});$(LBG.tableSorter.tableSelector).tablesorter({dateFormat:"uk"});$(LBG.tableSorter.tableSelector).find(".header").makeTabbable(0);
}};LBG.textAlerts={registerSelector:".registerTextAlerts",textAlertsTableSelector:".textAlerts",tableWithInputsSelector:".textAlertInputs",validationClass:"validate:(required)",formFieldClass:".formField",init:function(){$(LBG.textAlerts.textAlertsTableSelector+" input:checkbox").each(function(){var hasSiblingInputs;if($.browser.msie===true&&$.browser.version<8){var $checkbox=$(this),$oldLabel=$checkbox.prev("label.postit"),$newLabel=$oldLabel.clone().removeClass("postit"),$formField=$checkbox.parents(LBG.textAlerts.formFieldClass),$spanLabel=$("<span />");$formField.addClass("checkbox");$spanLabel.addClass("postit").html($newLabel.html());$spanLabel.insertBefore($checkbox);$oldLabel.remove();$newLabel.html("");$spanLabel.add($checkbox).wrapAll($newLabel);}hasSiblingInputs=$(this).parents(LBG.textAlerts.tableWithInputsSelector).length;if(hasSiblingInputs>0){if(!this.checked){LBG.textAlerts.updateRowInputs(this,this.checked,true);}}$(this).click(function(){if(hasSiblingInputs){LBG.textAlerts.updateRowInputs(this,this.checked);}if($(this).parents(LBG.textAlerts.registerSelector).length>0){LBG.textAlerts.updateSiblingCheckboxes(this);}});});},updateRowInputs:function(input,checked,init){var that=this;this.$inputAdjacentCells=$(input).parents("tr").find("div.formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$inputAdjacentCells);if(checked){this.$inputAdjacentCells.find(':input[type!="checkbox"]').attr("disabled","").removeClass("isDisabled");this.validationHandler.isValid=false;this.validationHandler.findChildren($(input).parents("tr"));}else{if(!init){this.validationHandler.hideError();}$(input).parents("td").siblings("td").each(function(){that.validationHandler.removeChildren($(this));});this.$inputAdjacentCells.find(':input[type!="checkbox"]').val("-");this.$inputAdjacentCells.find(':input[type="text"]').val("");this.$inputAdjacentCells.find(':input[type!="checkbox"]').attr("disabled","disabled").addClass("isDisabled");}LBG.ajax.pageUpdated();},updateSiblingCheckboxes:function(input){var $siblingCheckboxes=$(input).parents(LBG.textAlerts.textAlertsTableSelector).find("input:checkbox");var checkedElements=0;var i,len,disableCheckboxes=false;if($siblingCheckboxes.length>5){for(i=0,len=$siblingCheckboxes.length;i<len;i++){if($siblingCheckboxes[i].checked){checkedElements++;}}if(checkedElements===5){disableCheckboxes=true;}for(i=0;i<len;i++){if(!$siblingCheckboxes[i].checked){$siblingCheckboxes[i].disabled=disableCheckboxes;}}}LBG.ajax.pageUpdated();}};LBG.autoTotal={init:function(){if($("div.total").parent("form.balanceTransfer").length){$("fieldset.balanceTransfer").each(function(){var $amounts=$("input.amount");$("input.calculate").remove();$("span.totalAmount").autoTotal($amounts);});}else{if($("fieldset.balanceTransfer").length){$("fieldset.balanceTransfer").each(function(){$("input.calculate",this).remove();if($(".total",this).length){var $amounts=$("input.amount",this);$("span.totalAmount",this).autoTotal($amounts);}});}}var modifiers=DI.lang.autoTotalModifiers.bulkPaymentCalculator;$("div.bulkPaymentCalculator").each(function(){var $amounts=$("input.amount",this);$("input.calculate",this).remove();$(".subtotal span.value",this).autoTotal($amounts);$(".contingency span.value",this).autoTotal($amounts,modifiers.contingency);$(".grandTotal span.value",this).autoTotal($amounts,modifiers.grandTotal);});LBG.autoTotal.batchLimit();$(".loanRequirements").each(function(){var $amounts=$(".amount",this);$("input.calculate",this).remove();$(".totalAmount",this).autoTotal($amounts);});},batchLimit:function(){var limit,$amounts,total;$("form.amendBulkPayments").each(function(){$amounts=$("input.amount",this);$("input.calculate",this).remove();$("span.batchTotal, th.totalLimit",this).autoTotal($amounts);$("span.remainingLimit, th.remainingLimit",this).autoTotal($amounts,function(x){if(limit===undefined){limit=0;}total=(limit||0)-x;return Math.round(total*100)/100;});});$("select.payDate").change(function(){if(this.value==="-"){$(".batchAmount p.off").show();$(".batchAmount p.on").hide();}else{$(".batchAmount p.off").hide();$(".batchAmount p.on").show();}limit=$(":selected",this).metadata().limit;if(limit===undefined){limit=0;}if($amounts.length>0){$amounts.blur();}else{$("span.batchTotal, th.totalLimit").text(LBG.common.formatCurrencyString(0));$("span.remainingLimit, th.remainingLimit").text(LBG.common.formatCurrencyString(limit));}}).change();}};LBG.datePicker={constants:{datePickerSelector:"input.datePicker",parentSelector:"div.inputGroup",parentFormFieldSelector:"div.formField",daySelector:"select.slctDay",monthSelector:"select.slctMonth",yearSelector:"select.slctYear",calendarIconSelector:"img.ui-datepicker-trigger"},tools:{convertDetailsToDate:function(details){details=details.split("-");var yyyy=details[0];var mm=details[1];var dd=details[2];return new Date(yyyy,mm-1,dd);},checkLinkedInputDays:function(hiddenDatePickerTextInput){var daysInMonth=32-new Date(hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(),hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val()-1,32).getDate();if(hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()>daysInMonth){hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(daysInMonth);}},transferDateRangeRestrictionRulesToDatepicker:function(validationRoutineDetails,defaultOptions){if(validationRoutineDetails.minDate!==undefined){defaultOptions.minDate=LBG.datePicker.tools.convertDetailsToDate(validationRoutineDetails.minDate);}if(validationRoutineDetails.maxDate!==undefined){defaultOptions.maxDate=LBG.datePicker.tools.convertDetailsToDate(validationRoutineDetails.maxDate);}return defaultOptions;},findOtherDatePickerInRangePair:function(datePicker){var $formField=$(datePicker).parents(".formField"),datePickerType=datePicker.typeOfDatePicker,datePickerPairName=datePicker.datePickerGroupName,otherDatePickers,otherDatePickerInRangePair;if(datePickerType==="to"){otherDatePickers=$formField.find("input.datePicker.from");}else{if(datePickerType==="from"){otherDatePickers=$formField.find("input.datePicker.to");}}for(var i=0,len=otherDatePickers.length;i<len;i++){if(otherDatePickers[i].datePickerGroupName!==datePickerPairName){otherDatePickerInRangePair=otherDatePickers[i];break;}}return otherDatePickerInRangePair;}},defaultOptions:{showButtonPanel:true,closeText:" ",buttonText:DI.lang.datePicker.buttonText,buttonImage:DI.lang.datePicker.buttonImage,dayNamesLong:DI.lang.datePicker.dayNamesLong,dayNamesMin:DI.lang.datePicker.dayNamesMin,monthNames:DI.lang.datePicker.monthNames,dateFormat:"dd/mm/yyyy",minDate:null,maxDate:null,beforeShowDay:function(date){var isValidDateToSelect=true;var dayOfMonth=date.getDate();var monthOfYear=date.getMonth();var year=date.getFullYear();var daysOfWeekNames=["sun","mon","tue","wed","thu","fri","sat"];var dayOfWeekEntered=daysOfWeekNames[date.getDay()];var weekends=["sat","sun"];var ukHolidays=["2017-05-29","2017-08-28","2017-12-25","2017-12-26","2018-01-1","2018-03-30","2018-04-2","2018-05-7","2018-05-28","2018-08-27","2018-12-25","2018-12-26","2019-01-1","2019-04-19","2019-04-22","2019-05-6","2019-05-27","2019-08-26","2019-12-25","2019-12-26","2020-01-1","2020-04-10","2020-04-13","2020-05-04","2020-05-25","2020-08-31","2020-12-25","2020-12-26"];var monthsOfYearNames=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];
var monthOfYearEnteredName=monthsOfYearNames[monthOfYear],j,len;if($(".gfCustomTermDepositCalendar").length>0){var dateString=$.datepicker.formatDate("yy-mm-dd",date);var dayString=date.getDay();return[ukHolidays.indexOf(dateString)==-1&&dayString!=0&&dayString!=6,""];}var validationRoutineDetails=this.validationRoutines.validateDateRestriction;if($(".gformsDatePicker").length>0){validationRoutineDetails.invalidDays=ukHolidays;}if(validationRoutineDetails!==undefined){if(validationRoutineDetails.invalidDays!==undefined){if(typeof validationRoutineDetails.invalidDays==="string"){validationRoutineDetails.invalidDays=[validationRoutineDetails.invalidDays];}for(j=0,len=validationRoutineDetails.invalidDays.length;j<len;j++){var validationRoutineDetailsSplit=validationRoutineDetails.invalidDays[j].split("-");if(year===parseInt(validationRoutineDetailsSplit[0],10)&&monthOfYear===parseInt(validationRoutineDetailsSplit[1]-1,10)&&dayOfMonth===parseInt(validationRoutineDetailsSplit[2],10)){isValidDateToSelect=false;}}}if(validationRoutineDetails.invalidDaysOfWeek!==undefined){if(typeof validationRoutineDetails.invalidDaysOfWeek==="string"){validationRoutineDetails.invalidDaysOfWeek=[validationRoutineDetails.invalidDaysOfWeek];}if(validationRoutineDetails.invalidDaysOfWeek=="weekends"){validationRoutineDetails.invalidDaysOfWeek=weekends;}for(j=0,len=validationRoutineDetails.invalidDaysOfWeek.length;j<len;j++){if(dayOfWeekEntered===validationRoutineDetails.invalidDaysOfWeek[j]){isValidDateToSelect=false;}}}if(validationRoutineDetails.invalidMonths!==undefined){if(typeof validationRoutineDetails.invalidMonths==="string"){validationRoutineDetails.invalidMonths=[validationRoutineDetails.invalidMonths];}for(j=0,len=validationRoutineDetails.invalidMonths.length;j<len;j++){if(monthOfYearEnteredName===validationRoutineDetails.invalidMonths[j]){isValidDateToSelect=false;}}}}return[isValidDateToSelect,""];},showOn:"both",hideIfNoPrevNext:true,buttonImageOnly:true,changeMonth:false,changeYear:false,beforeShow:function(){if(LBG.Forms.Validation.Routines.validDate(this.parentWrapperElement)){var year=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(),10),month=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val(),10)-1,day=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(),10);this.$hiddenDatePickerTextInput.val(day+"/"+(month+1)+"/"+year);return{defaultDate:new Date(year,month,day)};}else{return{defaultDate:null};}},onClose:function(){$(this).next().focus();},onSelect:function(date){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(date.slice(0,2));this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val(date.slice(3,5));this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(date.slice(6,10));this.datePickerRMDateValidation=LBG.Forms.Validation.Tools.convertClassDetailsToDataSingleDate(this,"datePickerRMDateValidation");if($(".gformsDatePicker").length>0){var datepickerDropdownDay=this.parentWrapperElement.find(".slctDay"),datepickerDropdownMonth=this.parentWrapperElement.find(".slctMonth"),datepickerDropdownYear=this.parentWrapperElement.find(".slctYear"),datePicker=this.parentWrapperElement.find(".concatDatePicker"),concatDate="",consentSwitchDay=this.parentWrapperElement.parent().parent().next().find(".datepickerDay"),consentSwitchMonth=this.parentWrapperElement.parent().parent().next().find(".datepickerMonth"),consentSwitchYear=this.parentWrapperElement.parent().parent().next().find(".datepickerYear"),accountClosureDay=this.parentWrapperElement.parent().parent().next().next().next().find(".datepickerDay"),accountClosureMonth=this.parentWrapperElement.parent().parent().next().next().next().find(".datepickerMonth"),accountClosureYear=this.parentWrapperElement.parent().parent().next().next().next().find(".datepickerYear");consentSwitchDay.text(datepickerDropdownDay.val());consentSwitchMonth.text(datepickerDropdownMonth.val());consentSwitchYear.text(datepickerDropdownYear.val());accountClosureDay.text(datepickerDropdownDay.val());accountClosureMonth.text(datepickerDropdownMonth.val());accountClosureYear.text(datepickerDropdownYear.val());datepickerDropdownDay.change(function(){consentSwitchDay.text($(this).val());accountClosureDay.text($(this).val());});datepickerDropdownMonth.change(function(){consentSwitchMonth.text($(this).val());accountClosureMonth.text($(this).val());});datepickerDropdownYear.change(function(){consentSwitchYear.text($(this).val());accountClosureYear.text($(this).val());});concatDate=datepickerDropdownDay.val()+"/"+datepickerDropdownMonth.val()+"/"+datepickerDropdownYear.val().substr(0,4);datePicker.val(concatDate);}if(this.parentWrapperElement.parents(".radioGroup").length>0){this.parentWrapperElement.prevAll("input:radio").get(0).checked=true;}if(this.parentWrapperElement.parents(".ftdCustomDateDiv").length>0){LBG.gformsCalculateFixedTermDeposit.fixedDepositMaturedAmountCalculation();}this.parentWrapperElement.find(LBG.datePicker.constants.datePickerSelector).blur();if(this.datePickerRMDateValidation!=undefined&&this.datePickerRMDateValidation[0]!=undefined&&this.datePickerRMDateValidation[0].length!==0&&this.typeOfDatePicker==="single"){this.redumptioMaturityValidationIdentifier=LBG.Forms.Validation.Routines.validateGFormRedumptionMaturityDateDatePicker(date);if(this.redumptioMaturityValidationIdentifier==false){var details={minDate:"$gfMinDate",maxDate:"$gfMaxDate"};LBG.datePicker.showErrorDatepicker(this.datePickerRMDateValidation[0],details,this);}else{$("#RedumptionMaturityDate").removeClass("error");$("#repayDateSelectorRMD").removeClass("error");if($("#errorMessageRMD").length>0){$("#errorMessageRMD").remove();}}}else{if(this.typeOfDatePicker==="single"){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).blur();}else{if(this.typeOfDatePicker==="to"||this.typeOfDatePicker==="from"){var otherDatePickerInRangePair=LBG.datePicker.tools.findOtherDatePickerInRangePair(this);if(typeof otherDatePickerInRangePair!=="undefined"){if(otherDatePickerInRangePair.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""&&this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).blur();this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).blur();this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).blur();}}if(this.maxRangeInMonths!==undefined){if(typeof otherDatePickerInRangePair!=="undefined"){otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker("destroy");}var defaultOptions=LBG.datePicker.defaultOptions;if(this.typeOfDatePicker==="to"){var toDate=this.$hiddenDatePickerTextInput.datepicker("getDate");var newFromDate=new Date(toDate);newFromDate.setMonth(parseInt(newFromDate.getMonth(),10)-parseInt(this.maxRangeInMonths,10));if(this.originalMinDate!==null&&newFromDate<this.originalMinDate){newFromDate=this.originalMinDate;}defaultOptions.minDate=newFromDate;defaultOptions.maxDate=toDate;}else{if(this.typeOfDatePicker==="from"){var fromDate=this.$hiddenDatePickerTextInput.datepicker("getDate");
var newToDate=new Date(fromDate);newToDate.setMonth(parseInt(newToDate.getMonth(),10)+parseInt(this.maxRangeInMonths,10));if(this.originalMaxDate!==null&&newToDate>this.originalMaxDate){newToDate=this.originalMaxDate;}defaultOptions.minDate=fromDate;defaultOptions.maxDate=newToDate;}}if(typeof otherDatePickerInRangePair!=="undefined"){otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker(defaultOptions);}}if($(otherDatePickerInRangePair).next("a").find(LBG.datePicker.constants.calendarIconSelector).length===0){$(otherDatePickerInRangePair).siblings("a").remove();LBG.datePicker.selectableCalendarIcon(otherDatePickerInRangePair);}}}}}},init:function(){$(LBG.datePicker.constants.datePickerSelector).each(function(){var that=this;if($.browser.msie&&$.browser.version<7){this.parentFormField=$(this).parents(LBG.datePicker.constants.parentFormFieldSelector+":first");}else{LBG.datePicker.createDatePicker.call(this,this,LBG.datePicker.defaultOptions);var preWrapWidth=$(this).parent().width();LBG.datePicker.selectableCalendarIcon(this);var isChromeBrowser=/chrome/.test(navigator.userAgent.toLowerCase());if($.browser.safari&&!isChromeBrowser){$(this).parent().width(preWrapWidth+20);}if(isChromeBrowser){if(preWrapWidth==0){$(this).parent().width(268);}else{$(this).parent().width(preWrapWidth+62);}}}$(this).parents(LBG.datePicker.constants.parentSelector).find(".date select").change(function(){LBG.datePicker.updateRangeDatePickers.call(that);});$(this).attr("tabIndex",-1);});},selectableCalendarIcon:function(input){$(input).siblings(LBG.datePicker.constants.calendarIconSelector).wrap("<a href='#'></a>").parent().css({"float":"left","display":"block","overflow":"hidden"}).click(function(e){e.preventDefault();$(this).find(LBG.datePicker.constants.calendarIconSelector).click();});},showErrorDatepicker:function(validationRoutineName,validationRoutineDetails,element){validationRoutineDetails=validationRoutineDetails||{};var classToInterrogate=element.parentElement.parentElement.parentElement.className;var $formFieldRow=document.getElementsByClassName("validate:(required_validateGFormRedumptionMaturityDate[minDate:$gfMinDate,maxDate:$gfMaxDate])");var $formFieldInput=document.getElementById("repayDateSelectorRMD");var $formFieldTable=document.getElementById("repayDate");var errorMessage='<span class="error" id="errorMessageRMD" aria-live="polite" aria-atomic="true" role="alert">You can only select a date after 7 days and up to the end of next month. Alternatively, statements required within a 7 day period and up to the end of next month can be requested by phone.</span>';$("#RedumptionMaturityDate").addClass("error");$("#repayDateSelectorRMD").addClass("error");if($("#errorMessageRMD").length==0){$("#RedumptionMaturityDate").append(errorMessage);}},createDatePicker:function(hiddenDatePickerTextInput,defaultOptions){var that=this;this.$hiddenDatePickerTextInput=$(hiddenDatePickerTextInput);this.parentFormField=this.$hiddenDatePickerTextInput.parents(LBG.datePicker.constants.parentFormFieldSelector+":first");this.parentWrapperElement=this.$hiddenDatePickerTextInput.parents(LBG.datePicker.constants.parentSelector+":first");this.typeOfDatePicker="single";if(this.$hiddenDatePickerTextInput.hasClass("to")){this.typeOfDatePicker="to";}else{if(this.$hiddenDatePickerTextInput.hasClass("from")){this.typeOfDatePicker="from";}}this.datePickerGroupName=LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"datePickerGroupName:")[0];this.validationRoutines=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.parentFormField.get(0),"validate:");var formFieldGroupValidationRoutines=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.parentFormField.get(0),"formFieldGroup:");for(var i=0,len=formFieldGroupValidationRoutines.length;i<len;i++){this.validationRoutines.push(formFieldGroupValidationRoutines[i]);this.validationRoutines[formFieldGroupValidationRoutines[i]]=formFieldGroupValidationRoutines[formFieldGroupValidationRoutines[i]];}this.originalMaxDate=null;this.originalMinDate=null;this.validateDateRestriction=false;for(i=0,len=this.validationRoutines.length;i<len;i++){var validationRoutineName=this.validationRoutines[i];var validationRoutineDetails=this.validationRoutines[validationRoutineName];if(validationRoutineName==="validateDateTimeRange"||validationRoutineName==="specificDateWithRadio"||validationRoutineName==="validateDateRangeIsInRange"||validationRoutineName==="validateDatesAreInRange"){defaultOptions.minDate=null;defaultOptions.maxDate=null;defaultOptions=LBG.datePicker.tools.transferDateRangeRestrictionRulesToDatepicker(validationRoutineDetails,defaultOptions);this.originalMinDate=defaultOptions.minDate;this.originalMaxDate=defaultOptions.maxDate;}if(validationRoutineName==="validateDateRange"||validationRoutineName==="validateDatesRelativeRange"){this.maxRangeInMonths=validationRoutineDetails.maxRangeInMonths;}if(validationRoutineName==="validateDateRestriction"){this.validateDateRestriction=true;}}this.$hiddenDatePickerTextInput.datepicker(defaultOptions);$(this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector)).bind("change",function(){LBG.datePicker.tools.checkLinkedInputDays(that);});$(this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector)).bind("change",function(){LBG.datePicker.tools.checkLinkedInputDays(that);});},updateRangeDatePickers:function(){if(this.parentFormField.parents(".radioGroup").length>0){this.parentFormField.find("input:radio").get(0).checked=true;}if($.browser.msie&&$.browser.version<7){return;}if(LBG.Forms.Validation.Routines.validDate(this.parentWrapperElement)){var year=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(),10),month=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val(),10)-1,day=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(),10);this.$hiddenDatePickerTextInput.val(day+"/"+(month+1)+"/"+year);if(this.typeOfDatePicker==="to"||this.typeOfDatePicker==="from"){var otherDatePickerInRangePair=LBG.datePicker.tools.findOtherDatePickerInRangePair(this);if(otherDatePickerInRangePair.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""&&this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).blur();}if(this.maxRangeInMonths!==undefined){otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker("destroy");var defaultOptions=LBG.datePicker.defaultOptions;if(this.typeOfDatePicker==="to"){var toDate=new Date();toDate.setFullYear(year,month,day);var newFromDate=new Date(toDate);newFromDate.setMonth(parseInt(newFromDate.getMonth(),10)-parseInt(this.maxRangeInMonths,10));if(this.originalMinDate!==null&&newFromDate<this.originalMinDate){newFromDate=this.originalMinDate;}defaultOptions.minDate=newFromDate;defaultOptions.maxDate=toDate;}else{if(this.typeOfDatePicker==="from"){var fromDate=new Date();fromDate.setFullYear(year,month,day);var newToDate=new Date(fromDate);newToDate.setMonth(parseInt(newToDate.getMonth(),10)+parseInt(this.maxRangeInMonths,10));if(this.originalMaxDate!==null&&newToDate>this.originalMaxDate){newToDate=this.originalMaxDate;}defaultOptions.minDate=fromDate;defaultOptions.maxDate=newToDate;}}otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker(defaultOptions);}}}}};LBG.help={triggerSelector:".cxtHelp",wrapperSelector:".refPoint",contextualHTML:'<div class="refPoint"><div class="contextual"></div></div>',pointerHTML:'<div class="pointer"></div>',closeHTML:'<p class="close"><a href="#" title="'+DI.lang.help.closeHTMLTitle+'">'+DI.lang.help.closeHTMLTitle+"</a></p>",activeClass:"active",helpWidth:320,helpContentHeight:200,contentInnerHTML:'<div class="contentInner" />',contentInnerSelector:".contentInner",init:function(){function showHelp(){var helpLink=this,$ff3=$("div.primary.ff3");
if(LBG.common.urlGetAnchor(helpLink)){if($(helpLink).hasClass(LBG.help.activeClass)){LBG.help.closeHelp();}else{LBG.help.closeHelp();var viewPortWidth=self.innerWidth||(document.documentElement&&document.documentElement.clientWidth)||document.body.clientWidth;var hasArea=viewPortWidth-LBG.common.getAbsoluteLeft(helpLink);var contextualHTML=$(LBG.help.contextualHTML);if(((hasArea<LBG.help.helpWidth)&&(LBG.common.getAbsoluteLeft(helpLink)>=LBG.help.helpWidth))||($(helpLink).parents(".secondary").length>0)){contextualHTML.find(".contextual").addClass("left");}if($ff3.length>0){var secondaryWidth=$(".secondary").width(),ff3left=LBG.common.getAbsoluteLeft($ff3[0]),minusArea=(secondaryWidth+ff3left);hasArea=(viewPortWidth-minusArea)-LBG.common.getAbsoluteLeft(helpLink);if(((hasArea<LBG.help.helpWidth)&&(LBG.common.getAbsoluteLeft(helpLink)>=LBG.help.helpWidth))||($(helpLink).parents(".secondary").length>0)){contextualHTML.find(".contextual").addClass("left");}}var helpContentID=LBG.common.escapeSpecialCharsInId(LBG.common.urlGetAnchor(helpLink));var helpContent=$(helpContentID).clone(true);helpContent.id="";helpContent.appendTo($(helpLink).parent()[0]);helpContent.wrap(contextualHTML);helpContent.wrapInner(LBG.help.contentInnerHTML).find("h3").remove().clone().insertBefore(helpContent.find(LBG.help.contentInnerSelector));if(mobileType!="Android"||mobileType!="iOS"){helpContent.find(LBG.help.contentInnerSelector).attr("tabIndex",0).focus();}if(helpContent.find(LBG.help.contentInnerSelector).height()>LBG.help.helpContentHeight){helpContent.find(LBG.help.contentInnerSelector).height(LBG.help.helpContentHeight);helpContent.find(LBG.help.contentInnerSelector).css("margin","20px 0 0 0");}if(helpContent.get(0).clientHeight>LBG.common.getAbsoluteTop(helpLink)){helpContent.closest(".refPoint").addClass("bottom");}if(!$(this).hasClass(".onHover")){var closeHelpLink=$(LBG.help.closeHTML);if(mobileType==="Android"||mobileType==="iOS"){closeHelpLink.find("a").html("");}closeHelpLink.find("a").click(function(){LBG.help.closeHelp();return false;});helpContent.after(closeHelpLink);}helpContent.after(LBG.help.pointerHTML);helpContent.focus();if($.browser.msie&&$.browser.version<7){helpContent.parent().bgiframe();}$(helpLink).addClass(LBG.help.activeClass);if($.browser.msie&&$.browser.version<7){$(LBG.help.triggerSelector).not($(this).parent()).css("position","static");}LBG.iOS.scrollGestureMessage(helpContent.find(".contentInner")[0]);if($.browser.msie&&$.browser.version<8&&!$("#olMask:visible").length){setTimeout(function(){LBG.ieZindexFix.apply(true,helpContent);},0);}if($(helpLink).parents(".secondary").length>0){$(helpLink).parents(".secondary").css("z-index","11");}$(".cxtHelp .close a").bind("keydown",function(e){var keyCode=e.keyCode||e.which;if(keyCode==9&&!event.shiftKey){e.preventDefault();$(this).parents(".cxtHelp").find(".cxtTrigger").focus();}});}}return false;}$(LBG.help.triggerSelector+" a.cxtTrigger:not(.onHover)").live("click",showHelp);$(LBG.help.triggerSelector+" a.cxtTrigger.onHover").bind("mouseover",showHelp);$(LBG.help.triggerSelector+" a.cxtTrigger.onHover").bind("mouseleave",LBG.help.closeHelp);},closeHelp:function(){$(LBG.help.triggerSelector+" ."+LBG.help.activeClass).removeClass(LBG.help.activeClass).focus();$(LBG.help.wrapperSelector).remove();if($.browser.msie&&$.browser.version<8&&$("div.rewardOfferBlock").length>0){setTimeout(function(){LBG.ieZindexFix.apply(true);},0);}if($.browser.msie&&$.browser.version<7){$(LBG.help.triggerSelector).css("position","relative");}}};LBG.overlay={pageSelector:"#wrapper",outerSelector:"body",triggerSelector:".overlay, .overlayContainer a",loadedCloseSelector:".closeOverlay",loadedCancelSelector:".cancelOverlay",datePickerSelector:"input.datePicker",overlayCloseButton:"#overlay p.close a",overlayCancelButton:"#overlay li.cancel a",maskID:"olMask",overlayWrapperID:"overlayWrapper",overlayLoadedClass:"loaded",overlayID:"overlay",overlayClass:"content",overlayInnerID:"overlayInner",overlayContID:"overlayCont",closeClass:"close",overlayFlagClass:"overlayOpen",overlayFocusHandler:"overlay-focus-handler",spinnerHTML:'<div class="spinner"></div>',closeTriggerTitleCopy:DI.lang.overlay.closeTriggerTitle,openTriggerTitleCopy:DI.lang.overlay.openTriggerTitle,closeLinkCopy:DI.lang.overlay.closeLink,loadErrorCopy:DI.lang.overlay.loadError,fromDomElement:false,$previousParent:null,$storedOverlayInners:null,$modifiedStoredInners:null,hasLaunchOverlay:false,init:function(){$(LBG.overlay.triggerSelector).bind("click",function(e){e.preventDefault();var metadata=$(this).metadata();var $domElement=metadata.domElement?$(metadata.domElement).eq(0):undefined;if($domElement){LBG.overlay.fromDomElement=true;LBG.overlay.open($domElement,this,true);}else{if(($(this).parents().hasClass(".osrAccountDetailsTable"))&&($(this).parent().find("#slctType").length>0)){var termSelected=$(this).parent().find("#slctType option:selected").text().split("months")[0].trim();var banners=$(this).parents(".osrTableData").nextAll(".showHide");var segmented=false;for(var key=0;key<banners.length;key++){if(banners.eq(key).find("p:first").text().split("months")[0].trim().slice(-2)==termSelected){segmented=true;break;}}if(segmented){LBG.overlay.open(LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(this)),this,true);}}else{LBG.overlay.open(LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(this)),this,true);}}return false;}).each(function(){var $trigger=$(this).find("img").length?$(this).find("img:first"):$(this);var tagName=$trigger[0].tagName.toLowerCase();var message=LBG.overlay.openTriggerTitleCopy;if(tagName==="img"){if($trigger.attr("alt")){message=$trigger.attr("alt")+": "+message;}$trigger.attr({alt:message,title:message});}else{if($trigger.attr("title")){message=$trigger.attr("title")+": "+message;}else{if(tagName==="a"){message=$trigger.text()+": "+message;}}$trigger.attr("title",message);}if(!LBG.overlay.hasLaunchOverlay){LBG.overlay.hasLaunchOverlay=true;var meta=$trigger.metadata();if(meta.launchOverlay){$trigger.click();}}});if(!LBG.overlay.hasLaunchOverlay&&typeof LBG.launchOverlayData!=="undefined"&&typeof LBG.launchOverlayData.ajaxURL!=="undefined"){LBG.overlay.hasLaunchOverlay=true;LBG.overlay.open(LBG.launchOverlayData.ajaxURL,null,typeof LBG.launchOverlayData.canClose==="boolean"?LBG.launchOverlayData.canClose:true);}var kill_primary_overlay=$(".altOverlayContainer.firstTimeSRContainer").length;var i_can_see_the_alt_overlay=$(".altOverlayContainer.firstTimeSRContainer").is(":visible");if((kill_primary_overlay>0)&&(i_can_see_the_alt_overlay)){$("#olMask").hide();$("#overlayWrapper").hide();}$(document).bind("keyup",function(e){var code=e.keyCode||e.which;if($("body").hasClass(LBG.overlay.overlayFlagClass)&&code=="9"&&$(e.target).hasClass(LBG.overlay.overlayFocusHandler)){$(LBG.overlay.overlayCloseButton).focus();}if($("body").hasClass(LBG.mobile.overlayFlagClass)&&code=="9"&&$(e.target).hasClass(LBG.overlay.overlayFocusHandler)){$(LBG.mobile.overlayBrandlogoFocus).focus();}}).bind("keydown",function(e){var code=e.keyCode||e.which;if($("body").hasClass(LBG.overlay.overlayFlagClass)&&code=="9"&&e.shiftKey){if($("a[href]",$("#"+LBG.overlay.overlayID)).index(e.target)==0){e.preventDefault();}}if($("body").hasClass(LBG.mobile.overlayFlagClass)&&code=="9"&&e.shiftKey){if($("a[href]",$("#"+LBG.overlay.overlayID)).index(e.target)==0){e.preventDefault();}}});},open:function(path,trigger,canClose,timeout){if(!path){return false;}LBG.overlay.close();$(LBG.overlay.datePickerSelector).datepicker("hide");
var $outerSelector=$(LBG.overlay.outerSelector);$outerSelector.addClass(LBG.overlay.overlayFlagClass);$("#showMeMask").removeClass("show");$("#showMeOrientation").css("display","none");LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);var meta=$(trigger).metadata();var $mask=$("<div />").attr("id",LBG.overlay.maskID).appendTo($outerSelector);var $overlayWrapper=$("<div />").attr({"id":LBG.overlay.overlayWrapperID,"role":"dialog"}).appendTo($outerSelector);var $overlay=$("<div />").attr("id",LBG.overlay.overlayID).attr("class",LBG.overlay.overlayClass).attr("tabindex",-1).appendTo($overlayWrapper);var $overlayInner=$("<div />").attr("id",LBG.overlay.overlayInnerID).appendTo($overlay);var $overlayCont=$("<div />").attr("id",LBG.overlay.overlayContID).html(LBG.overlay.spinnerHTML).appendTo($overlayInner);if(meta.overlayWidth){$overlay.width(parseInt(meta.overlayWidth,10));}if(trigger){$overlay[0].storedTrigger=trigger;}if(canClose===true){$mask.click(function(){LBG.overlay.close();return false;});$('<a href="#" />').html(LBG.overlay.closeLinkCopy).attr("title",LBG.overlay.closeLinkCopy+LBG.overlay.closeTriggerTitleCopy).click(function(){LBG.overlay.close();return false;}).appendTo($("<p />").attr("class",LBG.overlay.closeClass).prependTo($overlay));}LBG.overlay.adjustMaskDimensions(true);LBG.overlay.position();if(typeof path==="string"){$.ajax({url:path,success:function(response){LBG.overlay.config({content:response,callback:true,timeout:timeout});},error:function(){LBG.overlay.config({content:"<p><strong>"+LBG.overlay.loadErrorCopy+"</strong></p>",callback:false,timeout:timeout});}});}else{if(typeof path==="object"){try{LBG.overlay.config({content:path,callback:true,timeout:false});}catch(err){LBG.overlay.config({content:"<p><strong>"+LBG.overlay.loadErrorCopy+"</strong></p>",callback:true,timeout:false});}}}},config:function(opts){var $overlay=$("#"+LBG.overlay.overlayID);var $overlayCont=$overlay.find("#"+LBG.overlay.overlayContID);if(opts.content&&LBG.overlay.fromDomElement){if(!$("#tempOverlayParent").length){$(opts.content).wrap('<div id="tempOverlayParent" />');LBG.overlay.$previousParent=$(opts.content).parent();}LBG.overlay.$storedOverlayInners=opts.content;LBG.overlay.$modifiedStoredInners=$(opts.content).clone().removeClass("hideJS");$(opts.content).remove();$overlayCont.html(LBG.overlay.$modifiedStoredInners);LBG.overlay.position();}else{if(opts.content){$overlayCont.html(opts.content);LBG.overlay.position();}}if($overlayCont.find("form").length>0){LBG.Forms.Validation.init($overlayCont[0]);$(LBG.overlay.loadedCloseSelector).attr("onKeyPress","event.stopPropagation();");$(document).bind("keydown",function(event){if($(event.target).hasClass(LBG.overlay.loadedCloseSelector)&&event.which===13){event.preventDefault();LBG.overlay.close();return false;}});if($(".submitAction").attr("disabled")){$(".submitAction").attr("disabled","");}if($overlay[0].storedTrigger&&$overlay[0].storedTrigger.tagName.toLowerCase()!=="a"){$($overlay[0].storedTrigger).parents("form").find(':input:not([type="image"])').each(function(){$overlayCont.find("form").prepend($("<input />").val(this.value).attr({type:"hidden",name:this.name,id:this.id}));});}}if($overlayCont.find(".js-tabs").length>0){LBG.tabs.init();}$overlay.find(LBG.overlay.loadedCloseSelector).click(function(){LBG.overlay.close();return false;});LBG.ajax.pageUpdated($overlay,opts.timeout);$('<a href="#" class="'+LBG.overlay.overlayFocusHandler+'" style="position: absolute; opacity: 0;"></a>').appendTo($overlayCont);if(opts.callback){LBG.overlay.callback();}},onClose:function(fn){if(!LBG.overlay.handlers){LBG.overlay.handlers=[];}LBG.overlay.handlers.push(fn);},fireCloseEvents:function(){if(LBG.overlay.handlers){for(var i=0;i<LBG.overlay.handlers.length;i++){LBG.overlay.handlers[i]();}}},position:function(){if($(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID))){var overlay=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID));var overlayWrapper=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayWrapperID));var pageWrapper=$(LBG.overlay.pageSelector);var windowH=$(window).height();var overlayH=overlay.outerHeight();var pageH=pageWrapper.outerHeight();overlayWrapper.addClass(LBG.overlay.overlayLoadedClass);overlay.css("margin-top",0);var scrollPosition=$(window).scrollTop();if(overlayH>=pageH){pageWrapper.css("min-height",overlayH+20);overlay.css("top",10+"px");}else{if((overlayH/2+scrollPosition)<pageH){var horiz=scrollPosition+windowH/2;var top=overlayH/2;if(horiz>top){overlay.css("top",horiz+"px");overlay.css("margin-top","-"+top+"px");}else{pageWrapper.css("min-height",overlayH+20);overlay.css("top",10+"px");}}else{pageWrapper.css("min-height",overlayH+20);overlay.css("top",10+"px");}}overlay.css("margin-left","-"+overlay.outerWidth()/2+"px");}},adjustMaskDimensions:function(setOnResize){if($.browser.msie&&$.browser.version<7||LBG.browserIdent.browserIdent==="iPad"||LBG.browserIdent.browserIdent==="iPhone"){var mask=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID));var pageWrapper=$(LBG.overlay.pageSelector);mask.width(pageWrapper.outerWidth(true));mask.height(pageWrapper.outerHeight(true));if(setOnResize&&setOnResize===true){$(window).resize(function(){LBG.overlay.adjustMaskDimensions();});}}},close:function(){if(document.getElementById(LBG.overlay.overlayID)){var overlay=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID));var storedTrigger=false;if(overlay[0].storedTrigger){storedTrigger=overlay[0].storedTrigger;}$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID)).remove();$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayWrapperID)).remove();$(LBG.overlay.pageSelector).css("min-height","100%");if(storedTrigger){LBG.ajax.pageUpdated(overlay[0].storedTrigger,false);}else{LBG.ajax.pageUpdated(null,false);}if(LBG.overlay.fromDomElement){LBG.overlay.$previousParent.html(LBG.overlay.$storedOverlayInners);LBG.overlay.fromDomElement=false;}LBG.overlay.fireCloseEvents();LBG.overlay.handlers=[];$("body").removeClass(LBG.overlay.overlayFlagClass);if($("body").hasClass(LBG.mobile.overlayFlagClass)){$("body").removeClass(LBG.mobile.overlayFlagClass);$(LBG.mobile.overlayBox).css("display","none");$(LBG.mobile.pageBackground)[0].setAttribute("aria-hidden","false");}}},callback:function(){LBG.Forms.DatePickerConverter.init();LBG.datePicker.init();LBG.employmentShowHide.init();LBG.selectAccount.init();LBG.beneficiariesChooser.init();LBG.contentScrollerTabIndex();var $overlayCont=$("#"+LBG.overlay.overlayContID);if($("#omm").length){if(LBG.ommSelectImageOverlay&&typeof LBG.ommSelectImageOverlay.init==="function"){LBG.ommSelectImageOverlay.init();}if(LBG.ommDetect&&typeof LBG.ommDetect.init==="function"){LBG.ommDetect.init($("#overlayWrapper"));}if(LBG.arrangementsDateDropdown&&typeof LBG.arrangementsDateDropdown.init==="function"){if($overlayCont.find(".viewFilterOverlay").length){LBG.arrangementsDateDropdown.init();}}}$overlayCont.find("form:eq(0)").bind("submit",function(e){e.preventDefault();this.submit();});$overlayCont.find(".exitOverlay-temp .Quotecontinue").click(function(e){e.preventDefault();$(".ops-calculator .opsMliCrOverlayButton").click();});$overlayCont.find(".ops-lowterm-overlay-temp .Quotecontinue").click(function(e){e.preventDefault();$(".ops-calculator .opsMliCrOverlayButton").click();});$overlayCont.find("form:eq(0)").find(".primaryAction>a.overlayTriggerButton").bind("click",function(e){var checkbox=$overlayCont.find("form:eq(0)").find("input[type=checkbox]");
if(checkbox.length>0){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler(checkbox);if(!(checkbox.is(":checked"))){e.preventDefault();validationHandler.showError(validationHandler.validationRoutines[0]);}}});$(".exportStatement:eq(0)").parent().unbind("submit").bind("submit",function(e){e.preventDefault();setTimeout(function(){LBG.overlay.close();},DI.exportStatement.closeOverlayInterval);this.submit();});if($(LBG.overlay.overlayCancelButton).length){$(LBG.overlay.overlayCancelButton).bind("click",function(){LBG.overlay.close();});}$(document).one("keypress",function(e){if(e.keyCode===27){LBG.overlay.close();}});$overlayCont.find(LBG.overlay.loadedCloseSelector).each(function(){this.title=(this.alt||this.title||$(this).text())+LBG.overlay.closeTriggerTitleCopy;});$(LBG.overlay.overlayCloseButton).focus();LBG.iOS.scrollGestureMessage($overlayCont.find(".legals")[0]);}};LBG.mobile={outerSelector:"body",overlayFlagClass:"outerOverlay",overlayBox:".overlayBox",overlayCloseLink:"#overlay .overlayBox li.cancel a",overlayBrandlogoFocus:"#overlay .overlayBox .overlayContent a.overlayfocus",pageBackground:"div#wrapper",overlayFocusHandler:"overlay-focus-handler",init:function(){var $anchor=$(".mobileStandard");var userAgent=navigator.userAgent;if(((userAgent.match(/iPad/i)!==null)||((userAgent.match(/Android/i)!==null)&&(userAgent.match(/\bSilk/i)==null)))&&$anchor.length){var metadata=$anchor.metadata();var $domElement=metadata.domElement?$(metadata.domElement).eq(0):undefined;if($domElement){$(LBG.mobile.overlayBox).css("display","block");$(LBG.mobile.pageBackground)[0].setAttribute("aria-hidden","true");$(LBG.mobile.outerSelector).addClass(LBG.mobile.overlayFlagClass);LBG.overlay.fromDomElement=true;LBG.overlay.open($domElement,null,false,false);$(LBG.mobile.overlayFocusHandler).focus();}}}};LBG.session={isUnauthenticated:false,sessionActive:false,logoutClass:"logoutWarning",msgClass:"logoutMsg",actionsClass:"actions",loggedOutOverlayClass:"dark",alternateLinkData:{},allow:function(isUnauthenticated,alternateLinkData){if(isUnauthenticated){this.isUnauthenticated=true;}this.sessionActive=true;this.alternateLinkData=alternateLinkData;this.init();},preloadImg:function(src){var img=new Image();img.src=src;return img;},init:function(){LBG.session.duration=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.duration:DI.session.duration;LBG.session.gracePeriod=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.gracePeriod:DI.session.gracePeriod;LBG.session.URLRedirect=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.URLRedirect:DI.session.URLRedirect;LBG.session.URLRedirect_Marker=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.URLRedirect_Marker:DI.session.URLRedirect_Marker;LBG.session.hideLogoutButton=DI.session.hideLogoutButton||false;LBG.session.hideLogonButton=DI.session.hideLogonButton||false;if(LBG.session.isUnauthenticated){LBG.session.warnTitle=DI.lang.sessionUnauthenticated.warningTitle;LBG.session.warnMsg=DI.lang.sessionUnauthenticated.warningMsg;LBG.session.warnSecondaryBtnSrc=DI.lang.sessionUnauthenticated.resetButton;LBG.session.warnSecondaryBtnAlt=DI.lang.sessionUnauthenticated.resetAlt;LBG.session.warnPrimaryBtnSrc=DI.lang.sessionUnauthenticated.continueButton;LBG.session.warnPrimaryBtnAlt=DI.lang.sessionUnauthenticated.continueAlt;LBG.session.warnPrimaryBtnLink=DI.lang.sessionUnauthenticated.continueLink;LBG.session.exitTitle=DI.lang.sessionUnauthenticated.timedOutTitle;LBG.session.exitMsg=DI.lang.sessionUnauthenticated.timedOutMsg;LBG.session.exitPrimaryBtnSrc=DI.lang.sessionUnauthenticated.startAgainButton;LBG.session.exitPrimaryBtnAlt=DI.lang.sessionUnauthenticated.startAgainAlt;LBG.session.warnSecondaryBtnLink=typeof LBG.session.alternateLinkData.resetLink!=="undefined"?LBG.session.alternateLinkData.resetLink:DI.lang.sessionUnauthenticated.resetLink;LBG.session.exitPrimaryBtnLink=typeof LBG.session.alternateLinkData.startAgainLink!=="undefined"?LBG.session.alternateLinkData.startAgainLink:DI.lang.sessionUnauthenticated.startAgainLink;}else{LBG.session.warnTitle=DI.lang.session.warningTitle;LBG.session.warnMsg=DI.lang.session.warningMsg;LBG.session.warnSecondaryBtnSrc=DI.lang.session.logoutButton;LBG.session.warnSecondaryBtnAlt=DI.lang.session.logoutAlt;LBG.session.warnSecondaryBtnLink=DI.lang.session.logoutLink;LBG.session.warnPrimaryBtnSrc=DI.lang.session.continueButton;LBG.session.warnPrimaryBtnAlt=DI.lang.session.continueAlt;LBG.session.warnPrimaryBtnLink=DI.lang.session.continueLink;LBG.session.exitTitle=DI.lang.session.loggedOutTitle;LBG.session.exitMsg=DI.lang.session.loggedOutMsgText;LBG.session.exitPrimaryBtnSrc=DI.lang.session.loggedOutButton;LBG.session.exitPrimaryBtnAlt=DI.lang.session.loggedOutAlt;LBG.session.exitPrimaryBtnLink=DI.lang.session.loggedOutLink;}LBG.session.warnMsg=LBG.common.formatPlaceholder.call(LBG.session.warnMsg,Math.floor(LBG.session.duration/60000));LBG.session.exitMsg=LBG.common.formatPlaceholder.call(LBG.session.exitMsg,Math.ceil((LBG.session.duration+LBG.session.gracePeriod)/60000));if(LBG.session.sessionActive){LBG.sessionTerminate.init();LBG.session.warnSecondaryBtnImg=LBG.session.preloadImg(LBG.session.warnSecondaryBtnSrc);LBG.session.warnPrimaryBtnImg=LBG.session.preloadImg(LBG.session.warnPrimaryBtnSrc);LBG.session.exitPrimaryBtnImg=LBG.session.preloadImg(LBG.session.exitPrimaryBtnSrc);window.clearTimeout(LBG.session.timeOut);LBG.session.timeOut=window.setTimeout(function(){if($("#inTNGA").length==0){LBG.overlay.open(LBG.session.buildMsg(),null,false,false);$(".logoutWarning").focus();if($.browser.msie&&$.browser.version<=8||navigator.userAgent.match(/Trident\/7\./)){setTimeout(function(){$(".logoutWarning").focus();});}LBG.common.tabbingInsideElem("#overlay");}$(".logoutWarning img").removeAttr("width").removeAttr("height");window.clearTimeout(LBG.session.timeOut);try{window.focus();}catch(e){}LBG.session.timeOut=window.setTimeout(function(){var currentURL=document.URL;var newURL=currentURL.split(LBG.session.URLRedirect_Marker);var autoLogOff=$("#autoLogOff").val();if(autoLogOff!==undefined){autoLogOff=autoLogOff.toLowerCase();}else{LBG.sessionTerminate.isEnabled=true;LBG.session.loggedOutMsg();LBG.sessionTerminate.sendTerminate();window.clearTimeout(LBG.session.timeOut);}if(autoLogOff=="autologoff"){window.location.href=newURL[0]+LBG.session.URLRedirect;}else{LBG.sessionTerminate.isEnabled=true;LBG.session.loggedOutMsg();LBG.sessionTerminate.sendTerminate();window.clearTimeout(LBG.session.timeOut);}},LBG.session.gracePeriod);},LBG.session.duration);}},buildMsg:function(){var $wrapper=$('<div tabindex="0"></div>').attr("class",LBG.session.logoutClass);var $title=$("<h2>"+LBG.session.warnTitle+"</h2>");var $message=$("<div></div>").attr("class",LBG.session.msgClass).append($("<p><strong>"+LBG.session.warnMsg+"</strong></p>"));var $actions=$("<ul></ul>").attr("class",LBG.session.actionsClass);if(!LBG.session.hideLogoutButton){var $secondary=$("<li></li>").appendTo($actions);var $secondaryLink=$("<a></a>").attr("href",LBG.session.warnSecondaryBtnLink).addClass("m-action-button-logout").appendTo($secondary);var $secondaryImg=$(LBG.session.warnSecondaryBtnImg).attr("alt",LBG.session.warnSecondaryBtnAlt).appendTo($secondaryLink);var $buttontext=$("<span></span>").append(LBG.session.warnSecondaryBtnAlt).appendTo($secondaryLink);}var $primary=$("<li></li>").addClass("primaryAction").appendTo($actions);var $primaryLink=$("<a></a>").attr("href",LBG.session.warnPrimaryBtnLink).addClass("m-action-button-logout").appendTo($primary);
var $primaryImg=$(LBG.session.warnPrimaryBtnImg).attr("alt",LBG.session.warnPrimaryBtnAlt).appendTo($primaryLink);var $buttontext=$("<span></span>").append(LBG.session.warnPrimaryBtnAlt).appendTo($primaryLink);$primaryLink.click(function(){LBG.session.ping(LBG.session.warnPrimaryBtnLink);return false;});$wrapper.append($title,$message,$actions);return $wrapper;},loggedOutMsg:function(){var $wrapper=$("."+LBG.session.logoutClass);var $actions=$wrapper.find("."+LBG.session.actionsClass);$actions.empty();$wrapper.find("h2").html(LBG.session.exitTitle);$wrapper.find("."+LBG.session.msgClass+" strong").html(LBG.session.exitMsg);if(!LBG.session.hideLogonButton){var $primary=$("<li></li>").addClass("primaryAction").appendTo($actions);var $primaryLink=$("<a></a>").attr("href",LBG.session.exitPrimaryBtnLink).addClass("m-action-button-logout").appendTo($primary);var $primaryImg=$(LBG.session.exitPrimaryBtnImg).attr("alt",LBG.session.exitPrimaryBtnAlt).removeAttr("width").removeAttr("height").appendTo($primaryLink);var $buttontext=$("<span></span>").append(LBG.session.exitPrimaryBtnAlt).appendTo($primaryLink);}else{$actions.css("display","none");}LBG.ajax.pageUpdated($(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID)),false);$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID)).addClass(LBG.session.loggedOutOverlayClass);},ping:function(path){if(!path){return false;}$.ajax({url:path,dataType:"json",success:function(response){if(response.isActive===true){LBG.overlay.close();LBG.session.init();}else{LBG.session.loggedOutMsg();window.clearTimeout(LBG.session.timeOut);}},error:function(){LBG.session.loggedOutMsg();window.clearTimeout(LBG.session.timeOut);}});}};LBG.sessionNotLoggedIn={sessionActive:false,duration:DI.sessionNotLoggedIn.duration,logoutClass:"logoutWarning",msgClass:"logoutMsg",actionsClass:"actions",loggedOutOverlayClass:"dark",loggedOutTitle:DI.lang.sessionNotLoggedIn.loggedOutTitle,loggedOutMsgText:LBG.common.formatPlaceholder.call(DI.lang.sessionNotLoggedIn.loggedOutMsgText,Math.floor(DI.sessionNotLoggedIn.duration/60000)),loggedOutButtonSrc:DI.lang.sessionNotLoggedIn.loggedOutButton,loggedOutButtonAlt:DI.lang.sessionNotLoggedIn.loggedOutAlt,loggedOutLinkPath:DI.lang.sessionNotLoggedIn.loggedOutLink,allow:function(){this.sessionActive=true;this.init();},preloadImg:function(src){var img=new Image();img.src=src;return img;},init:function(){if(LBG.sessionNotLoggedIn.sessionActive){LBG.sessionNotLoggedIn.loggedOutImg=LBG.sessionNotLoggedIn.preloadImg(LBG.sessionNotLoggedIn.loggedOutButtonSrc);window.clearTimeout(LBG.sessionNotLoggedIn.timeOut);LBG.sessionNotLoggedIn.timeOut=window.setTimeout(function(){LBG.overlay.open(LBG.sessionNotLoggedIn.buildMsg(),null,false,false);$(".logoutWarning img").removeAttr("width").removeAttr("height");window.clearTimeout(LBG.sessionNotLoggedIn.timeOut);try{window.focus();}catch(e){}},LBG.sessionNotLoggedIn.duration);}},buildMsg:function(){var logoutSession=$("<div></div>").attr("class",LBG.sessionNotLoggedIn.logoutClass);$("<h2>"+LBG.sessionNotLoggedIn.loggedOutTitle+"</h2>").appendTo(logoutSession);var msg=$("<div></div>").attr("class",LBG.sessionNotLoggedIn.msgClass);$("<p><strong>"+LBG.sessionNotLoggedIn.loggedOutMsgText+"</strong></p>").appendTo(msg);msg.appendTo(logoutSession);var actions=$("<ul></ul>").attr("class",LBG.sessionNotLoggedIn.actionsClass);var logoutLink=$("<a></a>").attr("href",LBG.sessionNotLoggedIn.loggedOutLinkPath).addClass("m-action-button-logout");var logoutImg=$(LBG.sessionNotLoggedIn.loggedOutImg).attr("alt",LBG.sessionNotLoggedIn.loggedOutButtonAlt).appendTo(logoutLink);var logoutbtntext=$("<span></span>").append(LBG.sessionNotLoggedIn.loggedOutButtonAlt).appendTo(logoutLink);$("<li></li>").append(logoutLink).appendTo(actions);actions.appendTo(logoutSession);return logoutSession;}};LBG.miniSession={sessionActive:false,duration:DI.session.miniDuration,logoutClass:"logoutWarning",msgClass:"logoutMsg",actionsClass:"actions",loggedOutOverlayClass:"dark",loginButtonSrc:DI.lang.session.loginButton,loginButtonAlt:DI.lang.session.loginAlt,loginLinkPath:DI.lang.session.loginLink,loggedOutTitle:DI.lang.session.loggedOutTitle,loggedOutMsgText:LBG.common.formatPlaceholder.call(DI.lang.session.loggedOutMsgText,Math.ceil((DI.session.miniDuration)/60000)),allow:function(){this.sessionActive=true;this.init();},preloadImg:function(src){var img=new Image();img.src=src;return img;},init:function(){if(LBG.miniSession.sessionActive){LBG.sessionTerminate.init();LBG.miniSession.loginImg=LBG.sessionNotLoggedIn.preloadImg(LBG.miniSession.loginButtonSrc);window.clearTimeout(LBG.miniSession.timeOut);LBG.miniSession.timeOut=window.setTimeout(function(){LBG.overlay.open(LBG.miniSession.buildMsg(),null,false,false);LBG.miniSession.loggedOutMsg();$();window.clearTimeout(LBG.miniSession.timeOut);try{window.focus();}catch(e){}},LBG.miniSession.duration);}},buildMsg:function(){var logout=$("<div></div>").attr("class",LBG.miniSession.logoutClass);$("<h2>"+LBG.miniSession.loggedOutTitle+"</h2>").appendTo(logout);var msg=$("<div></div>").attr("class",LBG.miniSession.msgClass);$("<p><strong>"+LBG.miniSession.loggedOutMsgText+"</strong></p>").appendTo(msg);msg.appendTo(logout);var actions=$("<ul></ul>").attr("class",LBG.miniSession.actionsClass);var loginImg=$(LBG.miniSession.loginImg).attr("alt",LBG.miniSession.loginButtonAlt);var loginLink=$("<a></a>").attr("href",LBG.miniSession.loginLinkPath).addClass("m-action-button-logout").append(loginImg);var logoutbtntext=$("<span></span>").append(LBG.miniSession.loginButtonAlt).appendTo(loginLink);$("<li></li>").addClass("primaryAction").append(loginLink).appendTo(actions);actions.appendTo(logout);return logout;},loggedOutMsg:function(){LBG.ajax.pageUpdated($(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID)),false);$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID)).addClass(LBG.miniSession.loggedOutOverlayClass);}};LBG.sessionTerminate={terminateUrl:DI.sessionTerminate.url,dataSelector:"input:hidden.sessionTerminate",isEnabled:false,isReload:false,allowSend:false,sendTerminate:function(){if(LBG.sessionTerminate.isEnabled===true){LBG.sessionTerminate.isEnabled=false;$.ajax({type:"GET",async:false,url:LBG.sessionTerminate.terminateUrl,data:$(LBG.sessionTerminate.dataSelector).serialize()});}},init:function(){var nav=navigator.appVersion.toLowerCase();var os={win:(nav.indexOf("win")!==-1)?true:false,mac:(nav.indexOf("mac")!==-1)?true:false};var $data=$(LBG.sessionTerminate.dataSelector);if($data.length>0&&$data.val()!==""){LBG.sessionTerminate.isEnabled=true;$(document).bind("keydown",function(event){var SHIFT=event.shiftKey,CTRL=event.ctrlKey,ALT=event.altKey,KEY=(event.keyCode?event.keyCode:event.which);if(event.clientY<0){var F5=!CTRL&&!SHIFT&&KEY===116,CTRLR=CTRL&&!SHIFT&&KEY===82,CTRLF5=CTRL&&!SHIFT&&KEY===116,SHIFTF5=!CTRL&&SHIFT&&KEY===116,CTRLSHIFTR=CTRL&&SHIFT&&KEY===82;LBG.sessionTerminate.isReload=(F5||CTRLR||CTRLF5||SHIFTF5||CTRLSHIFTR);}var allowMozilla=$.browser.mozilla&&$.browser.version>="1.9.1",allowIE=$.browser.msie&&$.browser.version>="7";var ALTF4=os.win&&ALT&&KEY===115,CTRLW=CTRL&&!SHIFT&&KEY===87,CTRLF4=($.browser.safari||allowIE||allowMozilla)&&!SHIFT&&CTRL&&!ALT&&KEY===115,CTRLSHIFTW=!$.browser.msie&&CTRL&&SHIFT&&KEY===87;LBG.sessionTerminate.allowSend=(ALTF4||CTRLW||CTRLF4||CTRLSHIFTW);});$(window).bind("beforeunload",function(event){var x=0;var y=0;if(event.pageX||event.pageY){x=event.pageX;y=event.pageY;}else{if(event.clientX||event.clientY){x=event.clientX;
y=event.clientY;}}var cursorAtCloseButton=(y<0)?x>$(document).width()-60&&y<0:false;if(LBG.sessionTerminate.allowSend===true||(y<0&&LBG.sessionTerminate.isReload===false&&cursorAtCloseButton===true)){LBG.sessionTerminate.sendTerminate();}});}}};LBG.ajax={pageUpdated:function(focusEL,timeout){LBG.common.ajax.updateBuffer();if(focusEL){if($.isArray(focusEL)||(focusEL.length>0)){focusEL[0].focus();}else{focusEL.focus();}}if(timeout!==false){LBG.session.init();}}};LBG.submitOnChange=(function(){var submitSelector="select.submitOnChange";var hiddenInputSelector="input[type=image], input[type=submit]";function handleChange(){$(this).parents("form:first").find(hiddenInputSelector).eq(0).click(function(e){LBG.Forms.Validation._submitManagement(e);}).click();}function setup(){$(this).change(handleChange);$(this).parents("form:first").find(hiddenInputSelector).eq(0).hide();}return{init:function(){$(submitSelector).each(setup);}};}());LBG.compareSelection=(function(){var PANEL="ul.comparisonSelectList",CHECKBOXES=".addToCompare input:checkbox",BUTTONS=".comparisonSelectAction input",DISABLED_SUFFIX="_disabled",MIN=2,MAX=3;return{init:function(){var $panel=$(PANEL);if(!$panel.length){return;}var $buttons=$(BUTTONS),$checkboxes=$(CHECKBOXES);$buttons.each(function(){this.state_hi=this.src;this.state_lo=this.src.replace(/(?=\.[^.]+$)/,DISABLED_SUFFIX);});var handleChangeEvent=function(){var count=$checkboxes.filter(":checked").length;if(count<MIN){$buttons.each(function(){this.disabled=true;this.src=this.state_lo;});}else{if(count>=MAX){$checkboxes.not(":checked").each(function(){this.disabled=true;});}else{$buttons.each(function(){this.disabled=false;this.src=this.state_hi;});$checkboxes.each(function(){this.disabled=false;});}}};$panel.bind("click",handleChangeEvent);handleChangeEvent();}};})();LBG.ajaxLink={ajaxLinkSel:".ajaxLink",placeHolderSel:".ajaxPlaceholder",maximumTraverse:7,init:function(){var $el=$(LBG.ajaxLink.ajaxLinkSel);$el.bind("click",LBG.ajaxLink.onClick);},onClick:function(e){e.preventDefault();var o,k;var $el=$(this);$el[0].callback=$el[0].callback||function(){};function loader(k,$link){var url=($link.metadata().async)?$link.metadata().async.url:$link.attr("href");$(k).load(url,function(e){LBG.Forms.Validation.init($(k));$link[0].callback($(this),e);$(k).find(".btnCancel").click(function(e){e.preventDefault();$(k).html("");});});}for(o=0;o<LBG.ajaxLink.maximumTraverse;o++){k=LBG.ajaxLink.travCheck($el);if(k.length){loader(k,$(this));break;}else{$el=$el.parent();}}},travCheck:function($el){return $el.find(LBG.ajaxLink.placeHolderSel).eq(0);}};LBG.addressFinder={handlers:[],addressDataStub:DI.lang.addressFinder.addressPickerStubData,isNumeric:function(value){return LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,value);},finder:function(wrapper,uniqueID){this.uniqueID=uniqueID;this.$wrapper=$(wrapper);this.$header=$(wrapper).find(".addressHeader");this.formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$wrapper);this.isPreviousAddress=this.$wrapper.hasClass("previousAddress");this.panels=[];this.panels.push(this.$panelSelectedAddress=this.$wrapper.find("div.selectedAddress"));this.panels.push(this.$panelFindAddress=this.$wrapper.find("div.findAddress"));this.panels.push(this.$panelyearsAtCurrent=this.$wrapper.find("div.timeYearsMonths"));this.panels.push(this.$panelSelectAddress=this.$wrapper.find("div.selectAddress"));this.panels.push(this.$panelManualAddress=this.$wrapper.find("div.manualAddress"));this.panels.push(this.$panelBFPOAddress=this.$wrapper.find("div.BFPOAddress"));if(this.isPreviousAddress){this.$currentTimeAtAddress=this.$wrapper.prev("div.timeYearsMonths");this.panels.push(this.$previousTimeAtAddress=this.$wrapper.find("div.timeYearsMonths"));}this.postcode="";this.addressData={};if(this.$panelFindAddress.find("input:submit,input:image")[0]){this.btnFindAddressSrcEnabled=this.$panelFindAddress.find("input:submit,input:image")[0].src;this.btnFindAddressSrcDisabled=this.$panelFindAddress.find("input:submit,input:image")[0].className.split("disabledSrc:")[1];}this.$wrapper.parents("form").find(".hideJS").find("input, select").attr("tabIndex",-1);this.setup();},init:function(){$("fieldset.addressFinder").each(function(i){LBG.addressFinder.handlers.push(new LBG.addressFinder.finder(this,i));});}};LBG.multiLevelAddressPanel=function(){var myArr=new Array();var fieldName;$("div.timeYearsMonths input.field").each(function(i){$(this).blur(function(){if($(this).val()!==""){myArr[i]=parseInt($(this).val());fieldName=$(this).attr("id");if(fieldName=="personalDetails:txtYearsAtCurrentAddress"){var currentYearCount=myArr[0];if(currentYearCount>=3){$(".previousAddress").find("input:text").each(function(){this.value="";});$(".previousAddress").find(".findAddress").removeClass("hideAddressPanel");$(".previousAddress").find(".selectedAddress,.selectAddress,.manualAddress").each(function(){$(this).addClass("hideAddressPanel");});$(".previousAddress").addClass("hideAddressPanel");}}else{if((fieldName=="personalDetails:txtYearsAtPreviousAddress0")||(fieldName=="personalDetails:txtMonthsAtPreviousAddress0")){var yearCount1=myArr[0]*12;var monthCount1=myArr[1];var yearCount2=myArr[2]*12;var monthCount2=myArr[3];var totalNumberOfMonths=yearCount1+monthCount1+yearCount2+monthCount2;if((totalNumberOfMonths<36)&&(!$(this).closest(".formField").hasClass("error"))){$(".thirdPanel").find("input:text").each(function(){this.value="";});$(".thirdPanel").find(".findAddress").removeClass("hideAddressPanel");$(".thirdPanel").find(".selectedAddress,.selectAddress,.manualAddress").each(function(y){$(this).addClass("hideAddressPanel");});$(".thirdPanel").removeClass("hideAddressPanel");}else{$(".thirdPanel").addClass("hideAddressPanel");$(".fourthPanel").addClass("hideAddressPanel");}}else{if((fieldName=="personalDetails:txtYearsAtPreviousAddress1")||(fieldName=="personalDetails:txtMonthsAtPreviousAddress1")){var yearCount1=myArr[0]*12;var monthCount1=myArr[1];var yearCount2=myArr[2]*12;var monthCount2=myArr[3];var yearCount3=myArr[4]*12;var monthCount3=myArr[5];var totalNumberOfMonths=yearCount1+monthCount1+yearCount2+monthCount2+yearCount3+monthCount3;if(totalNumberOfMonths<36){$(".fourthPanel").find(".selectedAddress,.selectAddress,.manualAddress").each(function(y){$(this).addClass("hideAddressPanel");});$(".fourthPanel").find(".findAddress").removeClass("hideAddressPanel");$(".fourthPanel").find("input:text").each(function(){this.value="";});$(".fourthPanel").removeClass("hideAddressPanel");}else{$(".fourthPanel").addClass("hideAddressPanel");}}else{}}}}});});},LBG.addressFinder.finder.prototype={getValidationName:function($formField){return LBG.Forms.Validation.Tools.convertClassDetailsToData($formField[0],"validationName:")[0];},getValidationHandler:function($formField){return this.formValidationHandler.getChild(this.getValidationName($formField));},hideErrors:function($panel){var self=this;var $errorFormFields=$panel.is("div.formField.error")?$panel:$panel.find("div.formField.error");var validationHandler;$errorFormFields.each(function(){validationHandler=self.getValidationHandler($(this));validationHandler.isShowingError=true;if($.browser.msie&&$.browser.version<7){window.setTimeout(function(){validationHandler.hideError();},30);}else{validationHandler.hideError();}});},showPanel:function($panel){var self=this;var arrayRemove=function(arr,$panel){return $.grep(arr,function(value){return value!==$panel;
});};var show=function($element){$element.removeClass("hideAddressPanel");if($.browser.msie&&$.browser.version<7){$element.css("display","none").css("display","block");}};var hide=function($element){$element.addClass("hideAddressPanel");if($.browser.msie&&$.browser.version<7){$element.css("display","block").css("display","none");}};for(var i=0;i<this.panels.length;i++){if(this.panels[i]===$panel||(this.panels[i]===this.$previousTimeAtAddress&&this.isPreviousAddress)){show(this.panels[i]);}else{hide(this.panels[i]);}this.hideErrors(this.panels[i]);}if($panel===this.$panelFindAddress){this.resetFields();}if(this.$panelManualAddress.is(":visible")){this.$wrapper.find("p.useAddressFinder").removeClass("hideAddressPanel");}else{this.$wrapper.find("p.useAddressFinder").addClass("hideAddressPanel");}if(this.$panelBFPOAddress.is(":not(.hideAddressPanel)")){this.resetFields();show(this.$panelFindAddress);this.$panelFindAddress.find("input:image:first").attr("src",this.btnFindAddressSrcDisabled);this.$panelFindAddress.addClass("isDisabled").find(":input").attr("disabled","disabled");this.$header.addClass("isDisabled");}else{this.$panelFindAddress.removeClass("isDisabled").find(":input").removeAttr("disabled");this.$panelFindAddress.find("input:image:first").attr("src",this.btnFindAddressSrcEnabled);this.$header.removeClass("isDisabled");}if($panel===this.$panelFindAddress||$panel===this.$panelManualAddress||$panel===this.$panelBFPOAddress){$panel.find("input:text:first").focus();}},resetFields:function(){this.postcode="";this.addressData={};for(var i=0;i<this.panels.length;i++){this.panels[i].find("input:text").val("");}this.$panelSelectAddress.find("select").empty();},updateAddressList:function($panel){var self=this;var text="";var data={};var $postcodeFinder=$panel.find("div.postcodeFinder");var postcodeVal=$postcodeFinder.find("input:text").val();var $addressList=this.$panelSelectAddress.find("div.addressList select");var validationHandler=this.getValidationHandler($postcodeFinder);validationHandler.validate();if(!validationHandler.isValid||postcodeVal===this.postcode){if($(".unsecuredLoan").length<0){if($.trim(postcodeVal)===""){validationHandler.showError("required");}}return false;}this.postcode=postcodeVal;this.addressData={};$addressList.empty();validationHandler=this.getValidationHandler(this.$panelSelectAddress.find("div.addressList"));validationHandler.hideError();function onFail(errType){$postcodeFinder.find("span.error").remove();errType=LBG.common.isNull(errType)?"default":errType;var errMsg=errType=="network_error"?Messages.networkFailure:self.isGformPage?Messages.noAddressesFoundGforms:Messages.noAddressesFound;$postcodeFinder.addClass("error").append($("<span />").addClass("error").html(errMsg));var postcodeInput=$(".formField.wtError input:text");if($(".formField.wtError.postCodeFindAddress").hasClass(".error")){LBG.track({"WT.ti":postcodeInput.attr("id"),"DCSext.CurrentPostcode":postcodeInput.attr("value"),"DCSext.CurrentPostcodeValid":"noaddress"});}if(errType!="network_error"&&self.$panelFindAddress.is(":visible")){self.$panelFindAddress.find(".cantFindAddress").removeClass("hideAddressPanel");}}self.isGformPage=$panel.hasClass("gformsPostcodeFinder")?true:false;var url;if(self.isGformPage){var callType="POST";var postCodeData={"postcode":self.postcode};url=DI.lang.addressFinder.gformsAddressPickerURL;$.ajax({url:url,dataType:"json",type:callType,accept:"application/JSON",contentType:"application/json; charset=UTF-8",data:JSON.stringify(postCodeData),cache:false,error:function(data){onFail("network_error");},success:function(data){self.addressData=data;var populatedAddress;if(self.isGformPage){populatedAddress=self.addressData;}else{populatedAddress=self.addressData.addresses;}var testResponse=(typeof(populatedAddress)!=="undefined")?populatedAddress.length===0:true;if(testResponse){onFail();}else{var labelOption=0;var label=$addressList.prev("label");if($addressList[0].size<=1){$addressList[0].options[0]=new Option(label.text(),"-");labelOption=1;label.addClass("postit");}var existingOptions=$addressList[0].options.length;if(self.isGformPage){for(var i=0,len=populatedAddress.length;i<len;i++){text="";data=populatedAddress[i];if(!LBG.common.isNull(data.organisationName)){text+=data.organisationName;}if(!LBG.common.isNull(data.subBuildingName)){text+=(text!=="")?", "+data.subBuildingName:data.subBuildingName;}if(!LBG.common.isNull(data.buildingName)){text+=(text!=="")?", "+data.buildingName:data.buildingName;}if(!LBG.common.isNull(data.buildingNumber)){text+=(text!=="")?", "+data.buildingNumber:data.buildingNumber;}if(data.addressLines.length>0){for(var j=0;j<data.addressLines.length;j++){text+=(text!=="")?", "+data.addressLines[j]:data.addressLines[j];}}if(!LBG.common.isNull(data.district)){text+=(text!=="")?", "+data.district:data.district;}if(!LBG.common.isNull(data.town)){text+=(text!=="")?", "+data.town:data.town;}$addressList[0].options[i+labelOption]=new Option(text,i);}}else{for(var i=0,len=populatedAddress.length;i<len;i++){text="";data=populatedAddress[i];if(!LBG.common.isNull(data.numberOrName)){text+=data.numberOrName;}if(!LBG.common.isNull(data.streetName)){text+=(text!=="")?" "+data.streetName:data.streetName;}if(!LBG.common.isNull(data.district)){text+=(text!=="")?", "+data.district:data.district;}if(!LBG.common.isNull(data.townOrCity)){text+=(text!=="")?", "+data.townOrCity:data.townOrCity;}if(!LBG.common.isNull(data.county)){text+=(text!=="")?", "+data.county:data.county;}$addressList[0].options[i+labelOption]=new Option(text,i);}}self.$panelSelectAddress.find("div.postcodeFinder input:text").val(self.postcode);self.showPanel(self.$panelSelectAddress);self.$panelSelectAddress.find("a:first").focus();self.$panelSelectAddress.find("select:not(.single)").focus();}}});}else{url=LBG.addressFinder.addressDataStub;$.ajax({url:url,cache:false,dataType:"json",type:"GET",data:{"addressFinderUniqueID":self.uniqueID,"postalCode":self.postcode},error:function(data){onFail("network_error");},success:function(data){self.addressData=data;var populatedAddress;if(self.isGformPage){populatedAddress=self.addressData;}else{populatedAddress=self.addressData.addresses;}var testResponse=(typeof(populatedAddress)!=="undefined")?populatedAddress.length===0:true;if(testResponse){onFail();}else{var labelOption=0;var label=$addressList.prev("label");if($addressList[0].size<=1){$addressList[0].options[0]=new Option(label.text(),"-");labelOption=1;label.addClass("postit");}var existingOptions=$addressList[0].options.length;if(self.isGformPage){for(var i=0,len=populatedAddress.length;i<len;i++){text="";data=populatedAddress[i];if(!LBG.common.isNull(data.organisationName)){text+=data.organisationName;}if(!LBG.common.isNull(data.subBuildingName)){text+=(text!=="")?", "+data.subBuildingName:data.subBuildingName;}if(!LBG.common.isNull(data.buildingName)){text+=(text!=="")?", "+data.buildingName:data.buildingName;}if(!LBG.common.isNull(data.buildingNumber)){text+=(text!=="")?", "+data.buildingNumber:data.buildingNumber;}if(data.addressLines.length>0){for(var j=0;j<data.addressLines.length;j++){text+=(text!=="")?", "+data.addressLines[j]:data.addressLines[j];}}if(!LBG.common.isNull(data.district)){text+=(text!=="")?", "+data.district:data.district;}if(!LBG.common.isNull(data.town)){text+=(text!=="")?", "+data.town:data.town;}$addressList[0].options[i+labelOption]=new Option(text,i);}}else{for(var i=0,len=populatedAddress.length;i<len;i++){text="";data=populatedAddress[i];
if(!LBG.common.isNull(data.numberOrName)){text+=data.numberOrName;}if(!LBG.common.isNull(data.streetName)){text+=(text!=="")?" "+data.streetName:data.streetName;}if(!LBG.common.isNull(data.district)){text+=(text!=="")?", "+data.district:data.district;}if(!LBG.common.isNull(data.townOrCity)){text+=(text!=="")?", "+data.townOrCity:data.townOrCity;}if(!LBG.common.isNull(data.county)){text+=(text!=="")?", "+data.county:data.county;}$addressList[0].options[i+labelOption]=new Option(text,i);}}self.$panelSelectAddress.find("div.postcodeFinder input:text").val(self.postcode);self.showPanel(self.$panelSelectAddress);self.$panelSelectAddress.find("a:first").focus();self.$panelSelectAddress.find("select:not(.single)").focus();}}});}},updateSelectedAddress:function(){var self=this;var data={};var html="";var $postcodeFinder=this.$panelSelectAddress.find("div.postcodeFinder");var $addressList=this.$panelSelectAddress.find("div.addressList");var $addressParagraph=this.$panelSelectedAddress.find("div.adr");var $btnChangeAddress=this.$panelSelectedAddress.find("ul.linkList a.changeAddress");var validationHandlerAddressList=this.getValidationHandler($addressList);var validationHandlerPostcode=this.getValidationHandler($postcodeFinder);validationHandlerAddressList.validate();validationHandlerPostcode.validate();if(!validationHandlerPostcode.isValid){$postcodeFinder.find("input:text").val(this.postcode);validationHandlerPostcode.hideError();}if(!validationHandlerAddressList.isValid){return false;}if(self.isGformPage){data=self.addressData[$addressList.find("select").val()];html+='<div class="street-address">';if(!LBG.common.isNull(data.organisationName)){html+="<span>"+data.organisationName+"</span>";html+=!LBG.common.isNull(data.buildingName)?"<span>"+data.buildingName+"</span>":"";}else{html+="<span>";html+=!LBG.common.isNull(data.subBuildingName)?data.subBuildingName+" ":"";html+=!LBG.common.isNull(data.buildingName)?data.buildingName:"";html+="</span>";}if(!LBG.common.isNull(data.buildingNumber)||data.addressLines.length>0){html+="<span>";html+=!LBG.common.isNull(data.buildingNumber)?data.buildingNumber+" ":"";for(var j=0;j<data.addressLines.length;j++){html+=data.addressLines[j]+" ";}html+="</span>";}html+=!LBG.common.isNull(data.district)?'<span class="district">'+data.district+"</span>":"";html+=!LBG.common.isNull(data.town)?'<span class="town">'+data.town+"</span>":"";html+=!LBG.common.isNull(data.postcode)?'<span class="postcode">'+data.postcode+"</span>":"";self.populateHiddenAddressFlds(data);}else{data=self.addressData.addresses[$addressList.find("select").val()];if(!LBG.common.isNull(data.numberOrName)||!LBG.common.isNull(data.streetName)){html+='<span class="street-address">';html+=!LBG.common.isNull(data.numberOrName)?data.numberOrName:"";html+=!LBG.common.isNull(data.streetName)&&!LBG.common.isNull(data.numberOrName)?" ":"";html+=!LBG.common.isNull(data.streetName)?data.streetName:"";html+="</span>";}html+=!LBG.common.isNull(data.district)?'<span class="district">'+data.district+"</span>":"";html+=!LBG.common.isNull(data.townOrCity)?'<span class="town">'+data.townOrCity+"</span>":"";html+=!LBG.common.isNull(data.county)?'<span class="county">'+data.county+"</span>":"";html+=!LBG.common.isNull(data.postcode)?'<span class="postcode">'+data.postcode+"</span>":"";}if($(".gformsBusinessAddressControl").length){LBG.gformsBusinessAddressControl.selectedBusinessAddressUsingFinder(data);}$addressParagraph.html(html);this.showPanel(this.$panelSelectedAddress);$(".currentAddress .addressHeader .useAddressFinder").next().hide();$btnChangeAddress.focus();},populateHiddenAddressFlds:function(data){var self=this;var $addr_1=$("#Addr_1");var $addr_2=$("#Addr_2");var $town=$("#Town");var $postcode=$("#Post_Code");var $county=$("#County");self.resetHiddenAddressFeilds();if(!LBG.common.isNull(data.organisationName)){$addr_1.val(data.organisationName+" "+data.buildingName);}else{$addr_1.val(data.subBuildingName+" "+data.buildingName);}if(!LBG.common.isNull(data.buildingNumber)||data.addressLines.length>0||!LBG.common.isNull(data.district)){$addr_2.val(data.buildingNumber+" "+data.addressLines+" "+data.district);}if(!LBG.common.isNull(data.town)){$town.val(data.town);}if(!LBG.common.isNull(data.postcode)){$postcode.val(data.postcode);}$county.val(data.county);if(!LBG.common.isNull(data.county)){$county.val(data.county);}else{$county.val("");}},resetHiddenAddressFeilds:function(){$("#Addr_1").val("");$("#Addr_2").val("");$("#Town").val("");$("#Post_Code").val("");$("#County").val("");},getTimeAtAddress:function($target){var $inputs=this.$currentTimeAtAddress.find(".field");var years=$inputs.eq(0).val();var months=$inputs.eq(1).val();if($target===$inputs.eq(0)&&$target.val()===""||months===""){months=0;}if(parseInt(months,10)===12){return false;}if(LBG.addressFinder.isNumeric(years)&&LBG.addressFinder.isNumeric(months)){years=parseInt(years,10)+parseInt(months/12,10);if(years<3){if(this.$wrapper.is(":hidden")){this.showPanel(this.$panelFindAddress);this.$wrapper.removeClass("hideAddressPanel").show();}}else{this.resetFields();this.$wrapper.hide();}}},removeTextBFPO:function($element){if($element.text().indexOf("BFPO")!==-1){$element.text($element.text().replace("BFPO ",""));}},setup:function(){var self=this;if(this.$panelBFPOAddress.is(":hidden")){this.$panelFindAddress.removeClass("isDisabled").find(":input").removeAttr("disabled");this.$header.removeClass("isDisabled");}self.$wrapper.nextAll(".hideUntilAddress:first").hide();var handlerSelectedAddress=function(event){event.preventDefault();if($(this).hasClass("BFPOAddress")){self.showPanel(self.$panelBFPOAddress);}else{self.showPanel(self.$panelFindAddress);if(self.$panelFindAddress.parent().hasClass("currentAddress")){$(".currentAddress .addressHeader .useAddressFinder").next().show();}self.removeTextBFPO(self.$wrapper.find("div.selectedAddress a.changeAddress"));self.removeTextBFPO(self.$wrapper.find("div.addressHeader h3"));}};var handlerFindAddress=function(event){if(event.type==="click"||(event.type==="keypress"&&event.keyCode===13)){self.updateAddressList(self.$panelFindAddress);}};var handlerChangeAddress=function(event){if(event.type==="click"||(event.type==="keypress"&&event.keyCode===13)){self.updateAddressList(self.$panelSelectAddress);event.stopImmediatePropagation();}};var handlerSingleSelectAddress=function(event){if($(this).val()!=="-"){self.$wrapper.nextAll(".hideUntilAddress:first").show();}else{self.$wrapper.nextAll(".hideUntilAddress:first").hide();}};var handlerSelectAddress=function(event){if(event.type==="click"||event.type==="dblclick"||(event.type==="keypress"&&event.keyCode===13)){self.updateSelectedAddress();return false;}};var handlerCantFindAddress=function(event){if($(this).attr("href")){event.preventDefault();}if(event.type==="click"||(event.type==="keypress"&&event.keyCode===13)){self.showPanel(self.$panelManualAddress);}};var handlerUseAddressFinder=function(event){event.preventDefault();self.showPanel(self.$panelFindAddress);self.removeTextBFPO(self.$wrapper.find("div.selectedAddress a.changeAddress"));self.removeTextBFPO(self.$wrapper.find("div.addressHeader h3"));self.$wrapper.nextAll(".hideUntilAddress:first").hide();};var handlerBFPOAddress=function(event){event.preventDefault();self.showPanel(self.$panelBFPOAddress);};this.$panelSelectedAddress.find("a.changeAddress").click(handlerSelectedAddress);this.$panelFindAddress.find("div.postcodeFinder input:text").live("keypress",handlerFindAddress);this.$panelFindAddress.find("div.postcodeFinder input:image,div.postcodeFinder input:submit").live("keypress",handlerFindAddress).live("click",handlerFindAddress);
this.$panelFindAddress.find(".cantFindAddress input:image,.cantFindAddress input:submit").live("keypress",handlerCantFindAddress).live("click",handlerCantFindAddress);this.$panelFindAddress.find(".cantFindAddress input:submit").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$panelFindAddress.find(".cantFindAddress a:not(.cxtTrigger)").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$panelSelectAddress.find("div.postcodeFinder input:text").keypress(handlerChangeAddress);this.$panelSelectAddress.find("div.postcodeFinder input:image").keypress(handlerChangeAddress).click(handlerChangeAddress);this.$panelSelectAddress.find("div.postcodeFinder input:submit").keypress(handlerChangeAddress).click(handlerChangeAddress);this.$panelSelectAddress.find("div.addressList select").keypress(handlerSelectAddress).dblclick(handlerSelectAddress);this.$panelSelectAddress.find("div.addressList select.single").change(handlerSingleSelectAddress);this.$panelSelectAddress.find("div.addressList input:image").keypress(handlerSelectAddress).click(handlerSelectAddress);this.$panelSelectAddress.find("div.addressList input:submit").keypress(handlerSelectAddress).click(handlerSelectAddress);this.$panelSelectAddress.find(".cantFindAddress input:image").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$panelSelectAddress.find(".cantFindAddress a:not(.cxtTrigger)").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$panelSelectAddress.find(".cantFindAddress input:submit").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$wrapper.find("p.useAddressFinder a").click(handlerUseAddressFinder);this.$panelManualAddress.find("input:text").keypress(function(e){if(e.keyCode===13){$(this).parents("form").find(".submitAction").click();}});this.$panelFindAddress.find("a.manualAddress").live("keypress",handlerCantFindAddress).live("click",handlerCantFindAddress);this.$panelManualAddress.find("a.backToAddressFinder").live("click",handlerUseAddressFinder);this.$wrapper.find("div.applyBFPO:not(div.BFPOAddress div.applyBFPO) a:not(.cxtTrigger)").click(handlerBFPOAddress);this.$wrapper.find("div.BFPOAddress div.applyBFPO a:not(.cxtTrigger)").click(handlerUseAddressFinder);if(this.isPreviousAddress){this.$currentTimeAtAddress.find("input:text").blur(function(){self.getTimeAtAddress($(this));});this.$currentTimeAtAddress.find("select").change(function(){self.getTimeAtAddress($(this));});}}};LBG.ajaxPoweredAddressFinder={init:function(){var $elementsForAjaxResponseInjection=$("div.ajaxPoweredAddressFinder");if($elementsForAjaxResponseInjection.length===0){return false;}var ajaxPoweredAddressFinders=[];var $manualAddressFieldset=$("fieldset.enterAddressManually");var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($manualAddressFieldset);for(var i=0,len=$elementsForAjaxResponseInjection.length;i<len;i++){ajaxPoweredAddressFinders.push(new LBG.ajaxPoweredAddressFinder.ajaxPoweredAddressFinder($($elementsForAjaxResponseInjection[i]),i));}var formID=$elementsForAjaxResponseInjection.parents("form").attr("id"),$yearsAtCurrentAddress=$(LBG.common.escapeSpecialCharsInId(formID+":txtYearsAtCurrentAddress")),$monthsAtCurrentAddress=$(LBG.common.escapeSpecialCharsInId(formID+":txtMonthsAtCurrentAddress"));if($(".personalDetails").length>0){ajaxPoweredAddressFinders[0].isPersonalDetailsPostcodeFinder=true;}if($yearsAtCurrentAddress.get(0)!==undefined&&$monthsAtCurrentAddress.get(0)!==undefined){var $parentFormField=$yearsAtCurrentAddress.parents("div.formField");var years,months;var focusAndBlurEventCapturing=function(e){var evt=e||window.event;var tgt=evt.target||evt.srcElement;if(tgt===$yearsAtCurrentAddress.get(0)||tgt===$monthsAtCurrentAddress.get(0)){years=$yearsAtCurrentAddress.val();months=$monthsAtCurrentAddress.val();if(tgt===$monthsAtCurrentAddress.get(0)&&tgt.value===""||months===""){months=0;}if(LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,years)&&LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,months)){if(parseInt(years,10)<3&&parseInt(months,10)<12&&jQuery($elementsForAjaxResponseInjection[0]).html().length===0&&$manualAddressFieldset.get(0).style.display!=="block"){$.ajax({url:ajaxPoweredAddressFinders[0].isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.postCodeFinderStub:DI.lang.addressFinder.postCodeFinderStub,dataType:"html",success:function(data){ajaxPoweredAddressFinders[0].injectNewFormFields(data);ajaxPoweredAddressFinders[0].processPostcodeFinder();}});}else{if(parseInt(years,10)>=3&&parseInt(months,10)<12&&$($elementsForAjaxResponseInjection[0]).html().length>0){ajaxPoweredAddressFinders[0].injectNewFormFields(null);$manualAddressFieldset.hide();LBG.ajax.pageUpdated();}else{if(parseInt(years,10)>=3&&$($elementsForAjaxResponseInjection[0]).html().length===0){$manualAddressFieldset.hide();LBG.ajax.pageUpdated();}}}}}};if($.browser.msie){$parentFormField.get(0).onfocusout=focusAndBlurEventCapturing;}else{$parentFormField.get(0).addEventListener("blur",focusAndBlurEventCapturing,true);}}else{for(i=0,len=ajaxPoweredAddressFinders.length;i<len;i++){ajaxPoweredAddressFinders[i].processPostcodeFinder();}}$manualAddressFieldset.hide();validationHandler.removeChildren($manualAddressFieldset);}};LBG.ajaxPoweredAddressFinder.ajaxPoweredAddressFinder=function($elementForAjaxResponseInjection,addressFinderUniqueID){var that=this;this.$elementForAjaxResponseInjection=$elementForAjaxResponseInjection;this.addressFinderUniqueID=addressFinderUniqueID;this.isPersonalDetailsPostcodeFinder=false;this.$enterAddressManuallyFieldset=$("fieldset.enterAddressManually");this.parentValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$elementForAjaxResponseInjection);};LBG.ajaxPoweredAddressFinder.ajaxPoweredAddressFinder.prototype={injectNewFormFields:function(htmlStubToInject){this.parentValidationHandler.removeChildren(this.$elementForAjaxResponseInjection);if(htmlStubToInject===null){this.$elementForAjaxResponseInjection.empty();}else{this.$elementForAjaxResponseInjection.html(htmlStubToInject);if($.browser.msie&&$.browser.version>=8){$("input:visible,select:visible,textarea:visible",this.$elementForAjaxResponseInjection).eq(0).focus();}}this.parentValidationHandler.isValid=false;LBG.common.explorerRedrawFix();LBG.ajax.pageUpdated();LBG.Forms.Validation.Tools.setMultipleFieldValidation(this.$elementForAjaxResponseInjection);this.parentValidationHandler.findChildren(this.$elementForAjaxResponseInjection);},processPostcodeFinder:function(){var that=this,$enterAddressManuallyLink=this.$elementForAjaxResponseInjection.find("a"),postCodeFinderFormfieldElement=this.$elementForAjaxResponseInjection.find("div.formField")[0],postCodeFinderFormfieldName;if(!postCodeFinderFormfieldElement){return;}postCodeFinderFormfieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData(postCodeFinderFormfieldElement,"validationName:")[0];function loadManualAddressForm(event){event.preventDefault();that.parentValidationHandler.remove(postCodeFinderFormfieldName);that.$elementForAjaxResponseInjection.empty();that.$enterAddressManuallyFieldset.show();that.$enterAddressManuallyFieldset.find("input:text").each(function(){this.ready=false;});that.parentValidationHandler.findChildren(that.$enterAddressManuallyFieldset);that.processManualAddressForm(that.$enterAddressManuallyFieldset);LBG.ajax.pageUpdated();}$enterAddressManuallyLink.bind("click",loadManualAddressForm);
var $findAddressInput=this.$elementForAjaxResponseInjection.find("input:image");if(postCodeFinderFormfieldElement!==undefined){var loadAddressSelector=function(event){var addressData;if(that.parentValidationHandler.getChild(postCodeFinderFormfieldName).isValid===true){var integrateAddressData=function(addressData){var option,data,text;for(var i=0,len=addressData.addresses.length;i<len;i++){text="";data=addressData.addresses[i];option=document.createElement("option");option.setAttribute("value",i);if(!LBG.common.isNull(data.numberOrName)){text+=data.numberOrName;}if(!LBG.common.isNull(data.streetName)){text+=(text!=="")?" "+data.streetName:data.streetName;}if(!LBG.common.isNull(data.district)){text+=(text!=="")?", "+data.district:data.district;}if(!LBG.common.isNull(data.townOrCity)){text+=(text!=="")?", "+data.townOrCity:data.townOrCity;}if(!LBG.common.isNull(data.county)){text+=(text!=="")?", "+data.county:data.county;}option.innerHTML=text;jQuery(that.$elementForAjaxResponseInjection.find("select")[0]).append(option);}};var insertAddressSelector=function(addressData){if(addressData.addresses.length===0){var error=document.createElement("span");error.className="error";error.innerHTML=Messages.noAddressesFound;var oldError=$(postCodeFinderFormfieldElement).find(".error");if(oldError.length>0){oldError.remove();}$(postCodeFinderFormfieldElement).append(error);$(postCodeFinderFormfieldElement).addClass("error");}else{var stubUrl=that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.addressPickerStub:DI.lang.addressFinder.addressPickerStub;$.get(stubUrl,{"addressFinderUniqueID":that.addressFinderUniqueID},function(data){that.injectNewFormFields(data);integrateAddressData(addressData);that.processAddressSelector(addressData);},"html");}};$.get(DI.lang.addressFinder.addressPickerStubData+"?postalCode="+$(postCodeFinderFormfieldElement).find("input:text").val(),{"addressFinderUniqueID":that.addressFinderUniqueID},function named(data){addressData=data;insertAddressSelector(data);},"json");}};$findAddressInput.bind("click",loadAddressSelector);var keyPressEventDelegation=function(event){if(event.keyCode===13){loadAddressSelector(event);}};$findAddressInput.bind("keypress",keyPressEventDelegation);}},processManualAddressForm:function($fieldset){var that=this,$enterAddressManuallyLink=$("div.previousAddress").find("a.linkBullet");function handleChangePostcode(event){event.preventDefault();$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.postCodeFinderStub:DI.lang.addressFinder.postCodeFinderStub,data:{"addressFinderUniqueID":that.addressFinderUniqueID},dataType:"html",type:"GET",success:function(data){that.parentValidationHandler.removeChildren($fieldset);$fieldset.find("input:text").each(function(){this.value="";});$fieldset.hide();that.injectNewFormFields(data);that.processPostcodeFinder();}});}$enterAddressManuallyLink.bind("click",handleChangePostcode);},processAddressSelector:function(addressData){var that=this,$changePostcodeLinks=this.$elementForAjaxResponseInjection.find("a"),$useAddressInput=this.$elementForAjaxResponseInjection.find("input:image");var handleChangePostcode=function(){$("div.ajaxPoweredAddressFinder .timeYearsMonths:eq(0) input").val("");$(".enterAddressManually:eq(0)").append($(".ajaxPoweredAddressFinder .timeYearsMonths:eq(0)"));$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.postCodeFinderStub:DI.lang.addressFinder.postCodeFinderStub,data:{"addressFinderUniqueID":that.addressFinderUniqueID},dataType:"html",type:"GET",success:function(data){that.injectNewFormFields(data);that.processPostcodeFinder();}});};var loadManualAddressForm=function(){$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.enterAddressManuallyStub:DI.lang.addressFinder.enterAddressManuallyStub,data:{"addressFinderUniqueID":that.addressFinderUniqueID},dataType:"html",type:"GET",success:function(data){that.injectNewFormFields(data);that.processManualAddressForm(that.$enterAddressManuallyFieldset);}});};var handleUseAddress=function(){var selectedAddressValue=jQuery(that.$elementForAjaxResponseInjection.find("select")[0]).val();var injectAddressData=function(){var addressParagraph=jQuery(that.$elementForAjaxResponseInjection.find("div.adr"));var data=addressData.addresses[selectedAddressValue];var html="";if(!LBG.common.isNull(data.numberOrName)||!LBG.common.isNull(data.streetName)){html+='<span class="street-address">';html+=!LBG.common.isNull(data.numberOrName)?data.numberOrName:"";html+=!LBG.common.isNull(data.streetName)&&!LBG.common.isNull(data.numberOrName)?" "+data.streetName:data.streetName;html+="</span>";}html+=!LBG.common.isNull(data.district)?'<span class="district">'+data.district+"</span>":"";html+=!LBG.common.isNull(data.townOrCity)?'<span class="town">'+data.townOrCity+"</span>":"";html+=!LBG.common.isNull(data.county)?'<span class="county">'+data.county+"</span>":"";html+=!LBG.common.isNull(data.postcode)?'<span class="postcode">'+data.postcode+"</span>":"";addressParagraph.html(html);};$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.addressPickerCompletedStub:DI.lang.addressFinder.addressPickerCompletedStub,data:{"addressFinderUniqueID":+that.addressFinderUniqueID,"selectedAddressValue":selectedAddressValue},dataType:"html",type:"GET",success:function(data){that.injectNewFormFields(data);injectAddressData();$(that.$elementForAjaxResponseInjection.find("a")[0]).bind("click",handleChangePostcode);that.$elementForAjaxResponseInjection.append($(".enterAddressManually .timeYearsMonths:eq(0)"));that.parentValidationHandler.findChildren(that.$elementForAjaxResponseInjection);LBG.Forms.Validation.Tools.setMultipleFieldValidation(that.$elementForAjaxResponseInjection);}});};var clickHandler=function(event){event.preventDefault();if(event.target===$useAddressInput.get(0)){var selectAddressFormfieldElement=that.$elementForAjaxResponseInjection.find("div.formField")[0];var selectAddressFormfieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData(selectAddressFormfieldElement,"validationName:")[0];if(that.parentValidationHandler.getChild(selectAddressFormfieldName).isValid===true){handleUseAddress();}}else{if(event.target===$changePostcodeLinks[0]||event.target===$($changePostcodeLinks[0]).children("img")[0]){handleChangePostcode();}else{if(event.target===$changePostcodeLinks[1]||event.target===$($changePostcodeLinks[1]).children("img")[0]){loadManualAddressForm();}}}};this.$elementForAjaxResponseInjection.bind("click",clickHandler);var keyPressEventDelegation=function(event){if(event.keyCode===13){clickHandler(event);}};$useAddressInput.bind("keypress",keyPressEventDelegation);}};LBG.selectHybrid={componentSelector:"div.selectHybrid",detailsSelector:".furtherDetails",balanceSelector:".accountBalance",fundsSelector:".availableFunds",businessSelector:".businessName",helpSelector:".cxtHelp",detailsHTML:'<div class="furtherDetails"><p><span class="accountBalance"></span><span class="availableFunds"></span></p><p class="businessName"></p></div>',cxtHelpHTML:'<span class="cxtHelp"><a class="cxtTrigger" aria-label="Tooltip">[?]</a></span>',setFocusOnTab:false,hasCurrYearFundedISA:false,remainingBalance:"",init:function(){var $selectHybridComponents=$(LBG.selectHybrid.componentSelector);if($selectHybridComponents.length===0){return false;}else{var selectHybrids=[];$.each($selectHybridComponents,function(i){selectHybrids[i]=$(this);
selectHybrids[i].uniqueID=this.id||null;if(selectHybrids[i].uniqueID!==null){selectHybrids[i].accountData=LBG[this.id].accountData;var $selectInput=selectHybrids[i].find("select");$selectInput.change(function(){LBG.selectHybrid.updateAccountData(selectHybrids[i]);});if($.browser.safari===true||$.browser.mozilla===true){$selectInput.keydown(function(event){LBG.selectHybrid.setFocusOnTab=event.shiftKey===false&&event.keyCode===9;});}var $elm=($selectInput.next().hasClass("submitAction")===true)?$selectInput.next():$selectInput;$elm.after(LBG.selectHybrid.detailsHTML);LBG.selectHybrid.updateAccountData(selectHybrids[i]);}});}},hideError:function($selectHybrid,$field){var $formFields=($field.hasClass("formField"))?$field:$field.find("div.formField");var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($selectHybrid.find("input, select").eq(0));$formFields.each(function(){var data=LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:");var field=validationHandler.getChild(data[0]);if(field.hideError){field.hideError();}});},updateAccountData:function($selectHybrid){var selectInput=$selectHybrid.find("select").get(0),selectedAccountValue,selectedAccountText,newBalance,newAvailableFunds,newBusinessName;if(selectInput.selectedIndex!==-1&&selectInput.options[selectInput.selectedIndex]){selectedAccountValue=selectInput.options[selectInput.selectedIndex].value;selectedAccountText=selectInput.options[selectInput.selectedIndex].text;}var $nextFocusable=$selectHybrid.next(".formField").find("input, select, a").eq(0);if(selectedAccountValue!==undefined&&$selectHybrid.accountData!==undefined&&$selectHybrid.accountData[selectedAccountValue]!==undefined){newBalance=$selectHybrid.accountData[selectedAccountValue].accountBalance;newAvailableFunds=$selectHybrid.accountData[selectedAccountValue].availableFunds;newBusinessName=$selectHybrid.accountData[selectedAccountValue].businessName;remainingBalance=$selectHybrid.accountData[selectedAccountValue].remainingBalance;if(remainingBalance!==""&&remainingBalance!==undefined){var arr=remainingBalance.split("GBP");remainingBalance=arr.pop();remainingBalance=remainingBalance.replace(/,/g,"");remainingBalance=parseFloat(remainingBalance);}if(newBalance!==""&&newBalance!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.balanceSelector).html(newBalance);}else{$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.balanceSelector).empty();}if(newAvailableFunds!==""&&newAvailableFunds!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).html(newAvailableFunds);}else{$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).empty();}if(newBusinessName!==""&&newBusinessName!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.businessSelector).html(newBusinessName);}else{$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.businessSelector).empty();}$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.helpSelector).remove();if($selectHybrid.accountData[selectedAccountValue].cxtHelpText!==""&&$selectHybrid.accountData[selectedAccountValue].cxtHelpText!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).after(LBG.selectHybrid.buildContextualHelp($selectHybrid,selectedAccountValue));}$selectHybrid.find(LBG.selectHybrid.detailsSelector).show();LBG.selectHybrid.hideError($selectHybrid,$selectHybrid.find(".formField"));if(($.browser.safari===true||$.browser.mozilla===true)&&LBG.selectHybrid.setFocusOnTab===true){var $focus=$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.helpSelector).find("a.cxtTrigger");if($focus.length>0){var $next=$focus.parents(".selectHybrid").next(".formField");setTimeout(function(){$focus.focus();LBG.selectHybrid.hideError($selectHybrid,$next);},5);}else{$nextFocusable.focus();}}}else{LBG.selectHybrid.clearDetails($selectHybrid);$selectHybrid.find(LBG.selectHybrid.detailsSelector).hide();if(($.browser.safari===true||$.browser.mozilla===true)&&LBG.selectHybrid.setFocusOnTab===true){$nextFocusable.focus();}}},adjustDetailsWidth:function($selectHybrid){$selectHybrid.find(LBG.selectHybrid.detailsSelector).width(0).width($selectHybrid.find(".formFieldInner").width());},buildContextualHelp:function($selectHybrid,selectedAccountValue){var $cxtHelpHTML=$(LBG.selectHybrid.cxtHelpHTML);var $anchorLink=$cxtHelpHTML.find("a");var anchorURL="#cxtHelp_"+$selectHybrid.uniqueID;$anchorLink.attr("title",$selectHybrid.accountData[selectedAccountValue].cxtHelpText);$cxtHelpHTML.find("a").attr("href",anchorURL);return $cxtHelpHTML.get(0);},clearDetails:function($selectHybrid){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.balanceSelector).empty();$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).empty();$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.helpSelector).remove();}};LBG.ISASelectRef=(function(initSelector,textSelector,dropDownSelector){var setup=function($formField){if(!LBG.selectHybrid.hasCurrYearFundedISA){$("option",dropDownSelector).each(function(i){var tmpOpt=$("option:nth-child("+(i+1)+")",$(".slctAccountFrom"));var metaRef=tmpOpt.metadata().reference;if(metaRef=="ISA_Current"){LBG.selectHybrid.hasCurrYearFundedISA=true;return false;}});}$(dropDownSelector,$formField).change(function(){var $option=$("option:selected",this),metadata=$option.metadata();var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($option);$(".ISAInfoMessage").hide();$(".NonISAInfoMessage").hide();validationHandler.hideError();var selectInput=this;var selectedAccountRef=metadata.reference;var $fromOption=$("option:selected",$(".slctAccountFrom"));var fromSelectedText=$fromOption.text().toLowerCase();var fromRef=$fromOption.metadata().reference;var $toOption=$("option:selected",$(".slctAccountTo"));var toSelectedText=$toOption.text().toLowerCase();var toRef=$toOption.metadata().reference;var fisaSwitch=$("form#frmMakeTransfer select.slctAccountTo").hasClass("fisaSwitchON");$("input."+validationHandler.submitInputSelector).attr("disabled",false);$("input."+validationHandler.submitInputSelector).css({"filter":"","opacity":""});if(selectInput.className.indexOf("slctAccountFrom")>0){var fromSelVal=$(".slctAccountFrom").val();$(".slctAccountFrom").html(LBG.manageTransfers.initialFromAccounts);$(".slctAccountFrom>option[value="+fromSelVal+"]").attr("selected",true);$(".slctAccountTo>option:eq(0)").attr("selected",true);$(".slctAccountTo").siblings(".furtherDetails").hide();$("input."+validationHandler.submitInputSelector).attr("disabled",false);$("input."+validationHandler.submitInputSelector).css({"filter":"","opacity":""});}else{if(selectedAccountRef=="ISA_Previous"&&LBG.selectHybrid.hasCurrYearFundedISA&&!fisaSwitch){if(!validationHandler.validationRoutines.customMessage){validationHandler.validationRoutines.push("customMessage");validationHandler.validationRoutines.customMessage={msg:"msg256"};}if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","E");}validationHandler.showError();$("input."+validationHandler.submitInputSelector).attr("disabled","disabled");$("input."+validationHandler.submitInputSelector).css({"filter":"alpha(opacity=40)","opacity":"0.4"});validationHandler.validationRoutines.customMessage=undefined;
}else{if(fromRef=="ISA_Previous"&&toRef=="ISA_Previous"&&!LBG.selectHybrid.hasCurrYearFundedISA&&!fisaSwitch){$(".ISAInfoMessage").show();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","W3");}}else{if(fromRef=="ISA_Previous"&&toRef=="ISA_Current"&&LBG.selectHybrid.hasCurrYearFundedISA&&!fisaSwitch){$(".ISAInfoMessage").show();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","W3");}}else{if((fromRef=="ISA_Previous"||fromRef=="ISA_Current")&&toRef=="Non_ISA_Acc"){$(".NonISAInfoMessage").show();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","W3");}}else{if((fromRef=="ISA_Previous"||fromRef=="ISA_Current")&&(toRef=="ISA_Previous"||toRef=="ISA_Current")&&fisaSwitch){if(remainingBalance!==""&&remainingBalance!==undefined){if(remainingBalance>0){$(".ISAInfoMessage").show();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","W3");}}else{if(remainingBalance==0){if(!validationHandler.validationRoutines.customMessage){validationHandler.validationRoutines.push("customMessage");validationHandler.validationRoutines.customMessage={msg:"msg256"};}if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","E");}validationHandler.showError();$("input."+validationHandler.submitInputSelector).attr("disabled","disabled");$("input."+validationHandler.submitInputSelector).css({"filter":"alpha(opacity=40)","opacity":"0.4"});validationHandler.validationRoutines.customMessage=undefined;}}}}else{if((typeof toRef!="undefined")&&($(".formSubmitError").length==0)&&$(".ISAInfoMessage:hidden")){if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","T");}}}}}}}}});};return{init:function(){$(initSelector).each(function(){setup($(this));$(dropDownSelector,this).trigger("change");});}};});LBG.isaOvelay1Ref=(function(){return LBG.ISASelectRef(".formField.isaOvelay1Ref","","select.fromAccount");})();LBG.isaOvelay2Ref=(function(){return LBG.ISASelectRef(".formField.isaOvelay2Ref","","select.toAccount");})();LBG.employmentShowHide={employmentSelector:".employmentStatus",infoSelector:"div.employmentInfo",employmentStatusSelector:"select.slctEmploymentStatus",occupationTypeSelector:"select.slctOccupationType",occupationSelector:"select.slctOccupation",validIdentifier:DI.lang.employmentShowHide.validIdentifier,isEligible:true,data:null,init:function(){var $infoElements=$(LBG.employmentShowHide.infoSelector),$employmentWrapper=$(LBG.employmentShowHide.employmentSelector),$employmentStatus=[],$occupationType=[],$occupation=[],$occupationOptions=[];if($infoElements.length>0){$infoElements.each(function(){var that=this;that.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($(that));var employmentShowHideHelper=function(emplSelect,that){if(LBG.employmentShowHide.isEligible){LBG.employmentShowHide.updateInfoVisibility(emplSelect,that);}else{$(that).hide();}};var $employSelect=$(that).parents("fieldset").find(LBG.employmentShowHide.employmentSelector).find(":input");$employSelect.change(function(){if(LBG.employmentShowHide.isEligible){LBG.employmentShowHide.updateInfoVisibility(this,that);}});$employSelect.keyup(function(e){if((e.keyCode===38)||(e.keyCode===40)){if(LBG.employmentShowHide.isEligible){LBG.employmentShowHide.updateInfoVisibility(this,that);}}});LBG.employmentShowHide.data=$(that).parents("form:eq(0)").metadata();if(("age" in LBG.employmentShowHide.data)&&("maxlimit" in LBG.employmentShowHide.data)){LBG.employmentShowHide.isEligible=LBG.employmentShowHide.testEligiblity($(that).closest("form").find("input:eq(1)"));$(that).closest("form").find("input:eq(1)").change(function(){LBG.employmentShowHide.isEligible=LBG.employmentShowHide.testEligiblity($(this));employmentShowHideHelper($employSelect[0],that);});}employmentShowHideHelper($employSelect[0],that);});}if($employmentWrapper.length){$employmentStatus=$employmentWrapper.find(LBG.employmentShowHide.employmentStatusSelector);$occupationType=$employmentWrapper.parent().find(LBG.employmentShowHide.occupationTypeSelector);$occupation=$employmentWrapper.parent().find(LBG.employmentShowHide.occupationSelector);var employmentStatusIndex=$employmentStatus.attr("selectedIndex");var occupationSelectedVal="";if($occupationType.length){var tabDirection="";var getTabDirection=function(e){if(e.keyCode!==9){tabDirection="";}else{tabDirection=(e.shiftKey)?"prev":"next";}};$occupationOptions=$occupation.find("option");occupationSelectedVal=$occupationOptions.filter(":selected").val();$occupationType.keyup(function(e){if((e.keyCode===38)||(e.keyCode===40)){if(LBG.employmentShowHide.isEligible){$occupationType.change();}}});var handlerEmploymentStatus=function(e){if(e.type==="change"&&$(this).attr("selectedIndex")!==employmentStatusIndex){occupationSelectedVal="";}if(e.type==="blur"&&tabDirection==="next"){var timer=window.setTimeout(function(){$occupationType.focus();tabDirection="";window.clearTimeout(timer);},1);}if(e.type==="blur"){var scrollHeight=$(".slctEmploymentStatus").offset().top;window.scrollTo(0,scrollHeight-50);}};var handlerOccupationType=function(e){var selectedClass="relation-"+this.value;var curIndex=0;if(e.type==="change"){if(this.value!=="-"){$occupation.empty();$occupation[0].options[curIndex]=new Option($occupationOptions[0].text,$occupationOptions[0].value,true);$occupationOptions.each(function(i){if($(this).hasClass(selectedClass)){curIndex=$occupation[0].options.length;$occupation[0].options[curIndex]=new Option(this.text,this.value,this.value===occupationSelectedVal);if(this.value===occupationSelectedVal){$occupation.attr("selectedIndex",curIndex);}}});}else{$occupation.attr("selectedIndex",0);}}if(e.type==="blur"&&tabDirection!==""){var timer=window.setTimeout(function(){if(tabDirection==="next"){$occupation.focus();}else{$employmentStatus.focus();}tabDirection="";window.clearTimeout(timer);},1);}};$employmentStatus.blur(handlerEmploymentStatus).change(handlerEmploymentStatus).keydown(getTabDirection);if($occupation.length){$occupationType.blur(handlerOccupationType).change(handlerOccupationType).keydown(getTabDirection);}}}},testEligiblity:function(input){return((this.data.age+parseInt($(input).val(),10))/12)<this.data.maxlimit;},updateInfoVisibility:function(input,info){var showInfo=input.value.match(LBG.employmentShowHide.validIdentifier);var lpiCheckbox=$(info).find("input:checkbox").get(0);var meta=$(input).find(":selected").metadata();if(showInfo&&meta.enable===true){$(info).show();if(lpiCheckbox!==undefined){lpiCheckbox.disabled=false;}if(info.validationHandler){info.validationHandler.findChildren($(info));}}else{$(info).hide();if(lpiCheckbox!==undefined){lpiCheckbox.checked=false;lpiCheckbox.disabled=true;}if(info.validationHandler){info.validationHandler.removeChildren($(info));}}LBG.common.explorerRedrawFix();}};LBG.manageTransfers={fromAccountSelector:"select.fromAccount",toAccountSelector:"select.toAccount",detailsSelector:".furtherDetails",hybridSelector:".selectHybrid",fromText:DI.lang.manageTransfers.fromText,toText:DI.lang.manageTransfers.toText,initTo:true,init:function(){this.$fromInput=$(LBG.manageTransfers.fromAccountSelector);if(!this.$fromInput.length){return;}this.$toInput=$(LBG.manageTransfers.toAccountSelector);if(!this.$toInput.length){return;}this.$parentSelectHybrid=$(LBG.manageTransfers.toAccountSelector).parents(LBG.manageTransfers.hybridSelector);this.initialToAccounts=$(LBG.manageTransfers.toAccountSelector).html();this.initialFromAccounts=$(LBG.manageTransfers.fromAccountSelector).html();this.$fromInput.change(function(){LBG.manageTransfers.updateToAccount(this);
}).change();this.$toInput.change(function(){LBG.manageTransfers.updateFromAccount(this);}).change();},updateToAccount:function(fromAccountInput){if(fromAccountInput.selectedIndex<0){fromAccountInput.selectedIndex=0;}var selectedAccountValue=fromAccountInput.options[fromAccountInput.selectedIndex].value;var selectedAccountIndexValue=(this.$toInput.get(0).selectedIndex>=0)?this.$toInput.get(0).options[this.$toInput.get(0).selectedIndex].value:null;if(LBG.manageTransfers.initTo===false){this.$toInput.html(this.initialToAccounts);}var toCount=0;var removedIndex;var sIndex;this.$toInput.find("option").each(function(){if(this.value===selectedAccountValue&&this.value!=="-"&&this.value!==null){$(this).remove();removedIndex=toCount;}toCount++;});toCount=0;this.$toInput.find("option").each(function(){if(this.value===selectedAccountIndexValue){sIndex=toCount;}toCount++;});this.$toInput.get(0).selectedIndex=sIndex;if(LBG.manageTransfers.initTo===false&&this.$toInput.get(0).selectedIndex===0){this.$parentSelectHybrid.find(LBG.manageTransfers.detailsSelector).hide();}LBG.manageTransfers.initTo=false;},updateFromAccount:function(toAccountInput){if(toAccountInput.selectedIndex<0){toAccountInput.selectedIndex=0;}var selectedAccountValue=toAccountInput.options[toAccountInput.selectedIndex].value;var selectedAccountIndexValue=this.$fromInput.get(0).options[this.$fromInput.get(0).selectedIndex].value;if(LBG.manageTransfers.initTo===false){this.$fromInput.html(this.initialFromAccounts);}var fromCount=0;var removedIndex;var sIndex;this.$fromInput.find("option").each(function(){if(this.value===selectedAccountValue&&this.value!=="-"){$(this).remove();removedIndex=fromCount;}fromCount++;});fromCount=0;this.$fromInput.find("option").each(function(){if(this.value===selectedAccountIndexValue){sIndex=fromCount;}fromCount++;});this.$fromInput.get(0).selectedIndex=sIndex;if(LBG.manageTransfers.initTo===false&&this.$fromInput.get(0).selectedIndex===0){this.$parentSelectHybrid.find(LBG.manageTransfers.detailsSelector).hide();}LBG.manageTransfers.initTo=false;}};LBG.linkedRadioAndTextFields=(function(){var WRAPPER=".linkedRadioAndTextFields",RADIO_BUTTONS=".linkedRadio",FORM_FIELDS=".linkedTextField",TEXT_ENABLED="enabledTextField",SELECTED_VALUE=DI.lang.validation.yesRegexValue,clickTrigger=false;function updateTextInput(input){var $linkedTextField=$(input).parents(WRAPPER).find(FORM_FIELDS),$formFieldElement=$linkedTextField.parents(".formField"),validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($formFieldElement),validationName=LBG.Forms.Validation.Tools.convertClassDetailsToData($formFieldElement.get(0),"validationName:")[0],validationElement;if($linkedTextField.hasClass(TEXT_ENABLED)===false&&!$linkedTextField.data("skip")){$linkedTextField.attr("disabled","disabled");$linkedTextField.addClass("isDisabled");}for(var i=0,len=validationHandler.children.length;i<len;i++){if(validationHandler.children[i].name===validationName){validationElement=validationHandler.children[i];}}if(input.checked){if(SELECTED_VALUE.test(input.value)&&$linkedTextField.hasClass(TEXT_ENABLED)===false){$linkedTextField.attr("disabled","");$linkedTextField.removeClass("isDisabled");$linkedTextField.data("skip",true);}else{if(clickTrigger===true&&$linkedTextField.hasClass(TEXT_ENABLED)===false){$linkedTextField.val("");}validationElement.hideError();validationElement.isValid=false;if($linkedTextField.hasClass(TEXT_ENABLED)===false){$linkedTextField.attr("disabled","disabled");$linkedTextField.addClass("isDisabled");}}}LBG.ajax.pageUpdated();}function setup(){updateTextInput(this);$(this).click(function(){clickTrigger=true;updateTextInput(this);});}return{init:function(){$(WRAPPER).find(RADIO_BUTTONS).each(setup);}};}());LBG.linkedSelectAndTextFields={wrapperSelector:".linkedSelectAndTextFields",selectSelector:".linkedSelect",textSelector:".linkedTextField",otherValue:DI.lang.validation.otherValue,init:function(){$(LBG.linkedSelectAndTextFields.wrapperSelector).find(LBG.linkedSelectAndTextFields.selectSelector).each(function(){LBG.linkedSelectAndTextFields.updateTextInput(this);$(this).change(function(){LBG.linkedSelectAndTextFields.updateTextInput(this);});});},updateTextInput:function(input){this.$linkedTextField=$(input).parents(LBG.linkedSelectAndTextFields.wrapperSelector).find(LBG.linkedSelectAndTextFields.textSelector);this.$formFieldElement=this.$linkedTextField.parents(".formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$formFieldElement);this.validationName=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.$formFieldElement.get(0),"validationName:")[0];var value=input.options[input.selectedIndex].value;for(var i=0,len=this.validationHandler.children.length;i<len;i++){if(this.validationHandler.children[i].name===this.validationName){this.validationElement=this.validationHandler.children[i];}}if(value===LBG.linkedSelectAndTextFields.otherValue){this.$formFieldElement.show();$("input:visible",this.$formFieldElement).eq(0).focus();LBG.common.explorerRedrawFix();}else{this.$linkedTextField.val("");this.validationElement.hideError();this.validationElement.isValid=false;this.$formFieldElement.hide();LBG.common.explorerRedrawFix();}LBG.ajax.pageUpdated();}};LBG.linkedCheckBoxAndTextFields={wrapperSelector:".linkedCheckBoxAndTextFields",checkboxSelector:".linkedCheckBox",textSelector:".linkedTextField",checkedValue:DI.lang.validation.checkedValue,init:function(){$(LBG.linkedCheckBoxAndTextFields.wrapperSelector).find(LBG.linkedCheckBoxAndTextFields.checkboxSelector).each(function(){LBG.linkedCheckBoxAndTextFields.updateTextInput(this);$(this).click(function(){LBG.linkedCheckBoxAndTextFields.updateTextInput(this);});});},updateTextInput:function(input){this.$linkedTextField=$(input).parents(LBG.linkedCheckBoxAndTextFields.wrapperSelector).find(LBG.linkedCheckBoxAndTextFields.textSelector);this.$formFieldElement=this.$linkedTextField.parents(".formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$formFieldElement);this.validationName=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.$formFieldElement.get(0),"validationName:")[0];for(var i=0,len=this.validationHandler.children.length;i<len;i++){if(this.validationHandler.children[i].name===this.validationName){this.validationElement=this.validationHandler.children[i];}}if(input.checked===LBG.linkedCheckBoxAndTextFields.checkedValue){this.$linkedTextField.attr("disabled","");this.$linkedTextField.removeClass("isDisabled");}else{this.$linkedTextField.val("");this.validationElement.isShowingError=this.$formFieldElement.hasClass("error");this.validationElement.hideError();this.validationElement.isValid=false;this.$linkedTextField.attr("disabled","disabled");this.$linkedTextField.addClass("isDisabled");}LBG.ajax.pageUpdated();}};LBG.linkedTextFieldAndCheckBox={wrapperSelector:".linkedTextFieldAndCheckBox",checkboxSelector:".linkedCheckBox",textSelector:".linkedTextField",setFocusOnTab:false,init:function(){$(LBG.linkedTextFieldAndCheckBox.checkboxSelector,$(LBG.linkedTextFieldAndCheckBox.wrapperSelector)).attr("disabled","disabled");$(LBG.linkedTextFieldAndCheckBox.wrapperSelector).find(LBG.linkedTextFieldAndCheckBox.textSelector).each(function(){$(this).change(function(){LBG.linkedTextFieldAndCheckBox.updateTextInput(this);}).keydown(function(event){LBG.linkedTextFieldAndCheckBox.setFocusOnTab=event.shiftKey===false&&event.keyCode===9;});});},updateTextInput:function(input){this.$linkedCheckBox=$(input).parents(LBG.linkedTextFieldAndCheckBox.wrapperSelector).find(LBG.linkedTextFieldAndCheckBox.checkboxSelector);
this.$linkedTextField=$(input).parents(LBG.linkedTextFieldAndCheckBox.wrapperSelector).find(LBG.linkedTextFieldAndCheckBox.textSelector);this.$formFieldElement=this.$linkedCheckBox.parents(".formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$formFieldElement);if(this.$linkedTextField.val()!==""){this.$linkedCheckBox.attr("disabled","");if(LBG.linkedTextFieldAndCheckBox.setFocusOnTab===true){var $linkedInput=this.$linkedCheckBox;setTimeout(function(){$linkedInput.focus();},5);}}else{this.$linkedTextField.val("");this.$linkedCheckBox.attr("checked","");this.$linkedCheckBox.attr("disabled","disabled");}LBG.ajax.pageUpdated();}};LBG.autoFillDecimals={amountFormFieldSelector:".amountField",addDecimals:function($formField){var $inputElements=$formField.find("input:text");var inputsToUpdate=[],i,len;if($inputElements.length>1){if($formField.parents(".radioGroup").length>0){for(i=0,len=$inputElements.length;i<len;i++){inputsToUpdate.push($inputElements[i]);}}}else{inputsToUpdate.push($inputElements[0]);}for(i=0,len=inputsToUpdate.length;i<len;i++){if(inputsToUpdate[i].value.length>0){LBG.autoFillDecimals.updateAmountWithDecimalPlaces(inputsToUpdate[i]);}}},updateAmountWithDecimalPlaces:function(input){var isNegative=parseInt(input.value,10)<0||input.value.indexOf("-")!==-1;if(!LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.currencyCharacters,input.value)){return false;}if(isNegative){input.value=input.value.replace(/-/g,"");}input.value=input.value.replace(/^0+/,"");if(input.value<1){input.value="0"+input.value;}if(input.value.indexOf(".")<0){if(LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,parseInt(input.value.replace(/,/g,""),10))){input.value+=".00";}}else{var splitDecimal=input.value.split("."),decimalPlaces="";for(var i=1;i<splitDecimal.length;i++){if(splitDecimal[i]!==""){decimalPlaces=splitDecimal[i];}}if(decimalPlaces.length<2){input.value+="0";this.updateAmountWithDecimalPlaces(input);}}if(isNegative){input.value="-"+input.value;}}};LBG.converter=(function(){var setup_run=false,$con;function updateInputs(){if(setup_run){$con.find("input[type=text]").val("");}var meta=$(this).find(":selected").metadata();$("input.dynCurrencyValueDomestic")[0].rate=meta.rate;$("input.dynCurrencyValueForeign")[0].rate=1/meta.rate||undefined;var $copy=$("div.dynconSelectionCopy");if(this.value==="-"){$copy.hide();}else{$copy.show();$copy.find("p.dynconSelectionCopyCurrency").text(meta.abbr+": "+meta.name);$copy.find("span").text(meta.rate+" "+meta.abbr);$copy.find("p.dynconSelectionCopyInfo").text(meta.info||"");$("label.dynconValueForeignLabel").text(meta.name);}}function updateDropdown(){var $this=$(this);if(setup_run){LBG.Forms.Validation.Tools.getValidationHandlerObject($this).hideError();}$("div.country_cash, div.country_cheque").hide();var dropdown=$($this.metadata().target).show().find("select");updateInputs.call(dropdown[0]);}function convert(){if(!this.rate){return;}$($(this).metadata().target).val((LBG.converter.tidyCurrency(this.value)*this.rate).toFixed(2));}function reverse(str){return str.split("").reverse().join("");}return{tidyCurrency:function(strIn){var val=strIn,reRplc=new RegExp("[-+,\\u00A3]","g");val=val.replace("&pound;","");val=val.replace(reRplc,"");return val;},formatCurrency:function(value){var val=value,spl=[],len=0,dol=0,cen=0;val=val.replace(/,/g,"");spl=val.split(".");len=spl.length;if(len>2){val=spl.slice(0,len-1);val=val.join("")+"."+spl[len-1];spl=val.split(".");}dol=reverse(spl[0]);cen=spl[1]?"."+spl[1]:"";spl=[];for(var i=0;i<dol.length;i+=3){spl.push(dol.substr(i,3));}dol=reverse(spl.join());return dol+cen;},init:function(){$con=$("div.dynamicConverter");if(!$con.length){return;}$("div.staticConverter").hide();$con.show();$con.find("input[type=text]").keyup(convert).keydown(function(){$con.find("input.dynconValueFlag").val(this.id);});$con.find("select").change(updateInputs);$con.find("input[type=radio]").click(updateDropdown).filter(":checked").click();setup_run=true;}};})();LBG.enhanceOverdraftDetails=(function(){var MODULE_SELECTOR="fieldset.overdraftDetails",OPTION_VALUES={termValue:"ongoing_term",overdraftPurposeValue:"ongoing_od_purpose",overdraftRepayValue:"ongoing_od_repay"},selectElementHash={},validationHandler;function _getSelectElements(){$.each(OPTION_VALUES,function(key,value){selectElementHash[key]=$('option[value="'+value+'"]').closest("select")[0];});return selectElementHash;}function _onChangeHandler(key,value){if(OPTION_VALUES[key]===value){if(validationHandler!==undefined){$.each(validationHandler.children,function(){this.hideError();});}$.each(selectElementHash,function(_key){if(this.value!==value){this.value=OPTION_VALUES[_key];}});}}return{init:function overdraftDetailController(){var overdraftFormEl=$(MODULE_SELECTOR)[0]||null;if(overdraftFormEl!==null){validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($(overdraftFormEl));$.each(_getSelectElements(),function(key){$(this).change(function(){_onChangeHandler(key,this.value);});});}}};})();LBG.autoSelectRadioButton=(function(){var RADIO_GROUP_SELECTOR="div.amountGroup",ELEMENT_SELECTORS="input:text";function _updateRadiobutton(){var $this=$(this),currentValue=$this.val();this.parentFormField=this.parentFormField||$this.closest("div.formField");if(currentValue!==this.previousValue){this.parentFormField.find("input:radio").get(0).checked=true;this.previousValue=currentValue;this.parentFormObject=this.parentFormObject||LBG.Forms.Validation.Tools.getValidationHandlerObject($this);this.formFieldName=this.formFieldName||LBG.Forms.Validation.Tools.convertClassDetailsToData(this.parentFormField[0],"validationName:")[0]||null;for(var i=0,len=this.parentFormObject.children.length,childField;i<len;i++){childField=this.parentFormObject.children[i];if(childField.name!==this.formFieldName&&childField.isShowingError===true){childField.hideError();}}}}return{init:function autoSelectRadiobuttonController(){$(RADIO_GROUP_SELECTOR).find(ELEMENT_SELECTORS).each(function(){var $this=$(this);this.previousValue=$this.val();$(this).blur(_updateRadiobutton);});}};})();LBG.beneficiariesChooser=(function(){var FORM="form.beneficiariesChooser",OVERLAY="#overlay",INPUT_TABLE="table.beneficiaries",INPUT_FIELDSET="fieldset.selectBeneficiaryAccount",MESSAGE_CONTAINER="p.selectionMsg",SELECTION_LIMIT=DI.lang.beneficiariesChooser.selectionCountValue,X_REMAINING_MSG=DI.lang.beneficiariesChooser.selectionRemainingMsg,MAX_REACHED_MSG=DI.lang.beneficiariesChooser.selectionMaxReachedMsg,PAGE_FORM="#page form",HIDDEN_COUNT_VAL="input.selectBeneficiaryCountValue:hidden";function updateSiblingCheckboxes(){var $inputsParent=($(OVERLAY).length>0)?$(this).parents(FORM).find(INPUT_FIELDSET):$(this).parents(FORM).find(INPUT_TABLE);var $siblingCheckboxes=$inputsParent.find("input:checkbox");var checkedElements=0;var i,len,disableCheckboxes=false;if($siblingCheckboxes.length>SELECTION_LIMIT){for(i=0,len=$siblingCheckboxes.length;i<len;i++){if($siblingCheckboxes[i].checked){checkedElements++;}}if(checkedElements===SELECTION_LIMIT){disableCheckboxes=true;}for(i=0;i<len;i++){if(!$siblingCheckboxes[i].checked){$siblingCheckboxes[i].disabled=disableCheckboxes;}}var html=((SELECTION_LIMIT-checkedElements)===0)?MAX_REACHED_MSG:X_REMAINING_MSG.replace("{0}",SELECTION_LIMIT-checkedElements);$(this).parents(FORM).find(MESSAGE_CONTAINER).html(html);}}return{init:function(){var $inputsParent=($(OVERLAY).length>0)?$(OVERLAY).find(FORM).find(INPUT_FIELDSET):$(FORM).find(INPUT_TABLE);
if($(OVERLAY).length){var $inputHiddenCount=$(PAGE_FORM).find(HIDDEN_COUNT_VAL);if($inputHiddenCount.length&&$inputHiddenCount.val()!==""){SELECTION_LIMIT=parseInt($inputHiddenCount.val(),10);}}var checkedElements=$inputsParent.find("input:checkbox:checked").length;$inputsParent.parents(FORM).find(MESSAGE_CONTAINER).html(X_REMAINING_MSG.replace("{0}",SELECTION_LIMIT-checkedElements));$inputsParent.find("input:checkbox").bind("click",updateSiblingCheckboxes);}};})();LBG.previousAddressRepeater=(function(){var previousAddressSelector="fieldset.previousAddress",additionalPreviousAddressSelector="fieldset.additionalPreviousAddress",mainSelector="fieldset.repeatableAddress",yearsSelector="div.timeYearsMonths input.years",monthsSelector="div.timeYearsMonths input.months";function calculateTimeAtAddress(container){var years=parseInt($(yearsSelector,container).val(),10)||0,months=parseInt($(monthsSelector,container).val(),10)||0;if(isNaN(years)||years<0||isNaN(months)||months<0){return undefined;}else{return years*12+months;}}function hideAddress(selector){var inputCollection=$(selector).find("input:text"),hideThisAddress=true;for(var i=0;i<inputCollection.length;i++){if(inputCollection[i].value!==""){hideThisAddress=false;break;}}if(hideThisAddress===true){$(selector).hide();}}function timeFieldHasValue(addressSelector){var isValid=false,tTime;$(addressSelector).find("input:text").each(function(){if($(this).hasClass("years")||$(this).hasClass("months")){tTime=parseInt($(this).val(),10)||0;if(tTime>0){isValid=true;return false;}}});return isValid;}function setup(){hideAddress(previousAddressSelector);hideAddress(additionalPreviousAddressSelector);var addresses=[this];var handleChange=function handleChange(){};var insertNewAddress=function insertNewAddress(addressSelector){var block=$(addressSelector)[0];$(addressSelector).show();addresses.push(block);$(yearsSelector,block).change(handleChange);$(monthsSelector,block).change(handleChange);LBG.Forms.Validation.init();LBG.initAddressRepeaters.init();};handleChange=function handleChange(){var total=0;for(var i=0;i<addresses.length;i++){var time=calculateTimeAtAddress(addresses[i]);if(time===undefined||time===0){return;}total+=time;if(total>=36){while(addresses.length>i+1){$(addresses.pop()).hide();}return;}}if(addresses.length<=2){if(addresses.length===1){insertNewAddress(previousAddressSelector);if(timeFieldHasValue(previousAddressSelector)){insertNewAddress(additionalPreviousAddressSelector);}}else{insertNewAddress(additionalPreviousAddressSelector);}}};$(yearsSelector,this).change(handleChange).change().blur();$(monthsSelector,this).change(handleChange).change().blur();}return{init:function(){$(mainSelector).each(setup);}};})();LBG.initAddressRepeaters=(function(){var mainSelector="div.addressField";function setup(){$(this).find("input:text").each(function(){if(($(this).hasClass(".first")||$(this).hasClass(".second"))){$(this).focus(function(){$(this).find("input:text").each(function(){if(!($(this).hasClass(".first")||$(this).hasClass(".second"))){this.ready=true;}});});}else{this.ready=true;}});}return{init:function(){$(mainSelector).each(setup);}};})();LBG.paymentCalculator={selectorForm:"form.internationalPaymentsCalculator",selectorCurrency:"select.internationalPaymentsCurrency",selectorCurrencyTypeForeign:".currencyType .currencyTypeForeign",selectorCurrencyAmount:".amountField",init:function(){var $form=$(LBG.paymentCalculator.selectorForm);$form.find(LBG.paymentCalculator.selectorCurrency).bind("change",function(){if(!this.disabled){LBG.currencyCode.init();var $warningMessage=$("<p class='warning'>"+DI.lang.allowDecimalsForCurrency.warningMessage+"</p>"),$amountWrapper=$(LBG.paymentCalculator.selectorCurrencyAmount).find(".formFieldInner");if($(":selected",this).metadata().allowDecimal===false){$warningMessage.prependTo($amountWrapper);}else{$amountWrapper.find("p.warning").remove();}var $selectedCurrencyLabel=$form.find(LBG.paymentCalculator.selectorCurrencyTypeForeign).find("label");if($selectedCurrencyLabel[0].defaultLabel===undefined){$selectedCurrencyLabel[0].defaultLabel=$selectedCurrencyLabel.html();}var currencyText=($(this).val()==="-")?$selectedCurrencyLabel[0].defaultLabel:$(this).find("option:selected").text();$selectedCurrencyLabel.html(currencyText);}}).change();}};LBG.internationalPayment={init:function(){var currencyWarning="span.warning",currencySelect="select.internationalPaymentCurrency",domesticInput="input.domesticAmountInput",foreignInput="input.foreignAmountInput",$allowDecimalMessage;$(currencySelect).bind("change",function(){var metadata=$(":selected",this).metadata();LBG.currencyCode.init();if(metadata.disabledSterlingEquivalent===true){$(foreignInput).attr("checked","checked");$(domesticInput).attr("disabled","disabled").next("label").addClass("disabled");}else{$(domesticInput).removeAttr("disabled").next("label").removeClass("disabled");}if(metadata.showCurrencyWarning===true){$(currencyWarning).add($(currencyWarning).next(".cxtHelp")).show();}else{$(currencyWarning).add($(currencyWarning).next(".cxtHelp")).hide();}if(metadata.allowDecimal!==undefined){if($allowDecimalMessage===undefined){$allowDecimalMessage=$('<span class="inlineHelp">'+DI.lang.allowDecimalsForCurrency.warningMessage+"</span>").hide();$(foreignInput).parents(".formFieldInner").find("span.label").append($allowDecimalMessage);}if(metadata.allowDecimal===false){$allowDecimalMessage.show();}else{$allowDecimalMessage.hide();}}else{if($allowDecimalMessage){$allowDecimalMessage.hide();}}}).change();LBG.internationalPayment.international_payments_email_preferences();},international_payments_email_preferences:function(){if(!$("input.ngb-ip-email-prefs").is(":checked")){$(".ngb-ip-email-details").hide();}$("input.ngb-ip-email-prefs").bind($.browser.msie?"propertychange":"change",function(){$(".ngb-ip-email-details").toggle();});}};LBG.currencyCode={init:function(){var currencyCode=$("select.currencyCodeSelect").val();if(currencyCode=="-"){if($(".domesticAmountInput").is(":checked")){$(".currencyCodeLabel").text("GBP");}else{$(".currencyCodeLabel").text("");}}else{if($(".domesticAmountInput").is(":checked")){$(".currencyCodeLabel").text("GBP");}else{$(".currencyCodeLabel").text(currencyCode);}}$(".currencyCodeSwitch input").click(function(){if($(".domesticAmountInput").is(":checked")){if(currencyCode=="-"){$(".currencyCodeLabel").text("");}else{$(".currencyCodeLabel").text("GBP");}}else{if(currencyCode=="-"){$(".currencyCodeLabel").text("");}else{$(".currencyCodeLabel").text(currencyCode);}}});$("select.currencyCodeSelect").change(function(){if($(this).val()=="-"){$(".currencyCodeLabel").text("");}});}};LBG.accountSwitcher=(function(){var ACCOUNT_SELECTOR=".accountSwitcher",ACCOUNT_FIELDS=".accountDetailsGroup";function updateAccountFields(input){var value=input.options[input.selectedIndex].value.toString(),ajaxUrl,validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($(input).parents(".formField"));switch(value){case"1":ajaxUrl=DI.lang.accountSwitcher.currentAccountStub;break;case"2":ajaxUrl=DI.lang.accountSwitcher.creditCardStub;break;case"3":ajaxUrl=DI.lang.accountSwitcher.loanAccountStub;break;case"4":ajaxUrl=DI.lang.accountSwitcher.mortgageAccountStub;break;case"5":ajaxUrl=DI.lang.accountSwitcher.creditCardCardOnlyStub;break;}function injectNewFormFields(data){validationHandler.removeChildren($(ACCOUNT_FIELDS));$(ACCOUNT_FIELDS).html(data);validationHandler.hideError();validationHandler.isValid=false;if($.browser.msie){LBG.common.explorerRedrawFix();
}LBG.ajax.pageUpdated();validationHandler.findChildren($(ACCOUNT_FIELDS));}$.ajax({url:ajaxUrl,dataType:"html",success:function(data){injectNewFormFields(data);}});}function setup(){$(ACCOUNT_SELECTOR).change(function(){updateAccountFields(this);});}return{init:function(){$(ACCOUNT_SELECTOR).each(setup);}};})();LBG.balanceTransfer=(function(){var selectorFieldset="fieldset.balanceTransfer",selectorAddButton=".validateBalanceTransfer .actions input:image,input:submit",selectorFieldRow=".formFieldRow",selectorAccDetails=".accountDetails",selectorAmountInput="input.amount";var classExpiry="expiryDate",classAccount="account";var max=10;function removeNoTransferOption($fieldset){$fieldset.find("select option.hideJS").remove();}function setupAccountDropDown($fieldRows){$fieldRows.each(function(){$(this).find(".formField:first select").change(function(){var $row=$(this).parents(selectorFieldRow);var $inputs=$row.next(selectorAccDetails).find("input:text(not:"+selectorAmountInput+")");var $amount=$row.find(selectorAmountInput);$inputs.val("");if(this.value==="-"){$amount.val("");}LBG.Forms.Validation.Tools.getFieldHandler($amount).hideError();LBG.autoTotal.init();}).blur(function(){LBG.autoTotal.init();});});}function setup(){$(selectorFieldset).each(function(){var $fieldset=$(this);var $fieldRows=$fieldset.find(selectorFieldRow);removeNoTransferOption($fieldset);if($fieldRows.length>=max){$(selectorAddButton,$fieldset).attr("disabled","disabled").css({"opacity":"0.5","cursor":"default"});}setupAccountDropDown($fieldRows);});}return{init:function(){setup();}};})();LBG.enrichedSelects=function(){$("select.enriched").change(function(){var meta=$("option:selected",this).metadata().enriched;if(!meta){return;}$.each(meta,function(target,text){$(target).each(function(){var $this=$(this);if($this.is("input, select")){$this.val(text.substring(0,18));}else{$this.text(text);}});});});if($.browser.mozilla===true){$("select.enriched").trigger("change");}};LBG.businessOverdraft=function(){var target=$(".businessNameToggle"),defaultName=$(target).text();$("select.businessGroup").change(function(){var $busName=$("option:selected",this).parent().attr("label");if(!$busName){$(target).text(defaultName);}else{$(target).text($busName);}});};LBG.disableQuoteTabsOnLoad=(function(event){function DisableTabClick(){var $tab=$("ul.opsCalculatorTabs li");$tab.bind("click",LBG.stopEventImmdtePropgtn.stopEvntImdPropFunc).find("a").css({"background-color":"#e6e6e6","color":"#c0c0c0","cursor":"not-allowed"});$tab.find(".tabInner").css("border-top-color","#c0c0c0");$("ul.opsCalculatorTabs li.current").trigger("click");}return{init:function(){DisableTabClick();}};})();LBG.enableQuoteTabsMli=function(){var $tab=$("ul.opsCalculatorTabs li");$tab.unbind("click",LBG.stopEventImmdtePropgtn.stopEvntImdPropFunc).find("a").css({"background-color":"","color":"","cursor":""});$tab.find(".tabInner").css("border-top-color","");};LBG.statusToggle=(function(){var setFocusOnTab=false,scrollToThis=false;function hideErrors($element,$this){var $formFields=null;var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($this);if($element.hasClass("formField")){$formFields=$element;}else{$formFields=$element.is("input, select")?$element.parents("div.formField"):$element.find("div.formField");}$formFields.each(function(){var data=LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:");var field=validationHandler.getChild(data[0]);if(field.hideError){field.hideError();}});}function setDisabled($element,isDisabled,clearDisabled){if(!$element.is("input, select")){$element=$element.find("input, select");}$element.each(function(){var $this=$(this);$this[0].disabled=isDisabled;if(isDisabled){$this.addClass("isDisabled");if(clearDisabled||$this.parents().hasClass("otherTitle")){if(!$(".transferBalances .balanceTransferTo").length){$this.val("");}else{$this.filter("input").val("");}}}else{$this.removeClass("isDisabled").val($(this).defaultText);}if($.browser.safari){$this.css("-webkit-transform","scale(0.9)");setTimeout(function(){$this.css("-webkit-transform","none");},1);}});}function isId(str){return str.substring(1,0)==="#";}function escapeId(id){return id.replace(/:/g,"\\:");}function handleToggle(event){var $this=$(this),meta=($this.is("select"))?$this.find(":selected").metadata():$this.metadata(),$disable,$enable,$hide,$show,$reset,clearDisabled=false;if($this.hasClass(".scrollToThis")){scrollToThis=true;}if(meta.disable){$disable=isId(meta.disable)?$(escapeId(meta.disable)):$(meta.disable);}if(meta.enable){$enable=isId(meta.enable)?$(escapeId(meta.enable)):$(meta.enable);}if(meta.hide){$hide=isId(meta.hide)?$(escapeId(meta.hide)):$(meta.hide);}if(meta.show){$show=isId(meta.show)?$(escapeId(meta.show)):$(meta.show);}if(meta.clearDisabled&&typeof clearDisabled==="boolean"){clearDisabled=meta.clearDisabled;}if(meta.reset){$reset=isId(meta.reset)?$(escapeId(meta.reset)):$(meta.reset);}if(meta.toggleShowHide){var elem=isId(meta.toggleShowHide)?$(escapeId(meta.toggleShowHide)):$(meta.toggleShowHide);var show=$this.is(":checked");if(!elem.is(".statusToggleHide")){show=!show;}if(show){$show=elem;}else{$hide=elem;}}if(meta.toggleAtleastOne&&meta.checkFields){var elem=isId(meta.toggleAtleastOne)?$(escapeId(meta.toggleAtleastOne)):$(meta.toggleAtleastOne);if(meta.secondaryToggle){var secElem=isId(meta.secondaryToggle)?$(escapeId(meta.secondaryToggle)):$(meta.secondaryToggle);}var show=$this.is(":checked");if(!elem.is(".secondaryToggle")){show=!show;}if($(meta.checkFields).find(":checkbox").is(":checked")){$show=elem;if(meta.secondaryToggle){$(secElem).show();$(secElem).find(":checkbox").each(function(){$(this).attr("checked",false);});}if(meta.secondaryToggle&&$this.is(":checked")){$(secElem).show();}else{if(meta.secondaryToggle&&!$this.is(":checked")){$(secElem).hide();}}}else{$hide=elem;if(meta.secondaryToggle){$(secElem).hide();}}}if($this.is(":checkbox, :radio")&&!this.checked){var $temp=$disable;$disable=$enable;$enable=$temp;}if($this.is(":checkbox, :radio, select")||($this.is(":text")&&$this.val()!=="")){if($disable){hideErrors($disable,$this);setDisabled($disable,true,clearDisabled);}if($enable){setDisabled($enable,false,clearDisabled);}}if($this.is(":text")&&$this.val()===""){if($disable){setDisabled($disable,false,clearDisabled);}if($enable){hideErrors($enable,$this);setDisabled($enable,true,clearDisabled);}}if($hide){hideErrors($hide,$this);$hide.hide();if(!$(this).parents(".opsCalculatorTabs").length){$hide.find(":text").val("");}}if($show){var $showHiddenOnly=$show.not(":visible");if($showHiddenOnly.length){$showHiddenOnly.show();}if($reset){hideErrors($reset,$this);if(event){$reset.find("input:radio,input:checkbox").removeAttr("checked");$reset.find("input:text").val("");$reset.find("select").attr("selectedIndex",0);$reset.find(":input").each(function(){this.ready=false;});}}}if($show&&$show.length){function prepopulateDropdown(){var serverTime=LBG.gFormsSetWorkingDay.nextSevenWorkingDays(),year=serverTime.getFullYear(),month=("0"+(serverTime.getMonth()+1)).slice(-2),day=serverTime.getDate();$show.find(".gformsDatePicker .slctDay option").each(function(){if($(this).val()==day){$(this).attr("selected","selected");}});$show.find(".gformsDatePicker .slctMonth option").each(function(){if($(this).val()==month){$(this).attr("selected","selected");}});$show.find(".gformsDatePicker .slctYear option").each(function(){if($(this).val()==year){$(this).attr("selected","selected");}});}function prepopulateConsentToSwitch(){var datepickerDropdownDay=$show.find(".gformsDatePicker .slctDay"),datepickerDropdownMonth=$show.find(".gformsDatePicker .slctMonth"),datepickerDropdownYear=$show.find(".gformsDatePicker .slctYear"),datePicker=$show.find(".concatDatePicker"),concatDate="",consentSwitchDay=$show.find(".datepickerDay"),consentSwitchMonth=$show.find(".datepickerMonth"),consentSwitchYear=$show.find(".datepickerYear");
consentSwitchDay.text(datepickerDropdownDay.val());consentSwitchMonth.text(datepickerDropdownMonth.val());consentSwitchYear.text(datepickerDropdownYear.val());datepickerDropdownDay.change(function(){consentSwitchDay.text($(this).val());});datepickerDropdownMonth.change(function(){consentSwitchMonth.text($(this).val());});datepickerDropdownYear.change(function(){consentSwitchYear.text($(this).val());});concatDate=datepickerDropdownDay.val()+"/"+datepickerDropdownMonth.val()+"/"+datepickerDropdownYear.val().substr(0,4);datePicker.val(concatDate);$(".concatDatePickerExpiry").val("");}function prepopulateSubLabelMessage(){var serverTime=LBG.gFormsSetWorkingDay.nextSevenWorkingDays(),today=LBG.gFormsServerTime.todaysDate(),sevenDayFromToday=serverTime.getFullYear()+"-"+("0"+(serverTime.getMonth()+1))+"-"+serverTime.getDate(),subLabelMessage=$(".subLabelMessage"),subLabelMinDate=$show.find(".subLabelMinDate"),subLabelMaxDate=$show.find(".subLabelMaxDate");today.setDate(today.getDate()+29);var thirtyDaysFromToday=today.getFullYear()+"-"+("0"+(today.getMonth()+1))+"-"+today.getDate();if(subLabelMessage.length>0){subLabelMinDate.text(sevenDayFromToday);subLabelMaxDate.text(thirtyDaysFromToday);}}if($(".gformContentWrapper").length>0){if($(".gformsDatePicker").length>0){prepopulateDropdown();prepopulateConsentToSwitch();prepopulateSubLabelMessage();}}}if($hide&&$hide.length){if($(".gformContentWrapper").length>0){$hide.find(".sortCode").next(".sortCodeConcatenated").val("");$hide.find(".gformsExpiryDate .concatDatePicker").val("");$hide.find(".gformsDatePicker .concatDatePicker").val("");}}if($show&&$show.length){if($show.hasClass("fasterPaymentFree")){$hide.find(":radio").removeAttr("checked");$show.find(":radio").eq(0).attr("checked","checked");}else{if($show.hasClass("fasterPaymentCharged")){$hide.find(":radio").removeAttr("checked");$show.find(":radio").eq(1).attr("checked","checked");}else{if($show.hasClass("paymentASAP")){$hide.find(":radio").removeAttr("checked");$show.find(":radio").eq(0).attr("checked","checked");}}}if($show.parent().find(".ops-calculator")){if($show.hasClass("disabledDiv")){$show.find("input").removeAttr("disabled");$show.removeClass("disabledDiv");if($show.find(":table").hasClass("tblOPSQuote")){$show.find(":table").removeClass("tblOPSQuote");$show.find(":table").find("tbody").addClass("tblOPSQuoteEnabled");}if($show.parent().find(".footnote").hasClass("hide-ops-footnote")){$show.parent().find(".footnote").removeClass("hide-ops-footnote");$show.parent().find(".footnote").addClass("show-ops-footnote");}}if($show.hasClass(".ops-calculator-monthly")){$("input:hidden[name$=opsPanelUsedHiddenInfo]").val(false);}else{if($show.hasClass(".ops-calculator-total")){$("input:hidden[name$=opsPanelUsedHiddenInfo]").val(true);}}}if($show.parent().hasClass(".secondaryauthcommercial")){if($show.parent().find(".option0.statusToggleHide").is(":visible")){if($show.parent().find(".option1.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option1.statusToggleHide .primaryAction input").removeClass("submitAction");}if($show.parent().find(".option2.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option2.statusToggleHide .primaryAction input").removeClass("submitAction");}if(!$show.parent().find(".option0.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option0.statusToggleHide .primaryAction input").addClass("submitAction");}}else{if($show.parent().find(".option1.statusToggleHide").is(":visible")){if($show.parent().find(".option0.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option0.statusToggleHide .primaryAction input").removeClass("submitAction");}if($show.parent().find(".option2.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option2.statusToggleHide .primaryAction input").removeClass("submitAction");}if(!$show.parent().find(".option1.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option1.statusToggleHide .primaryAction input").addClass("submitAction");}}else{if($show.parent().find(".option2.statusToggleHide").is(":visible")){if($show.parent().find(".option0.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option0.statusToggleHide .primaryAction input").removeClass("submitAction");}if($show.parent().find(".option1.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option1.statusToggleHide .primaryAction input").removeClass("submitAction");}if(!$show.parent().find(".option2.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option2.statusToggleHide .primaryAction input").addClass("submitAction");}}}}}if($show.parents("fieldset").hasClass("eiaAuth")){var $eiaAuth=$show.parents("fieldset"),$input0=$(".eiaAuth .option0.statusToggleHide .actions input"),$input1=$(".eiaAuth .option1.statusToggleHide .actions input");if($eiaAuth.find(".option0.statusToggleHide").is(":visible")){if($input1.hasClass("submitAction")){$input1.removeClass("submitAction");}if(!$input0.hasClass("submitAction")){$input0.addClass("submitAction");}}else{if($eiaAuth.find(".option1.statusToggleHide").is(":visible")){if($input0.hasClass("submitAction")){$input0.removeClass("submitAction");}if(!$input1.hasClass("submitAction")){$input1.addClass("submitAction");}}}}}if(($.browser.safari===true||$.browser.mozilla===true)&&setFocusOnTab===true){var $allFields=$(".formField");var $index=$allFields.index($this.parents(".formField"));var $nextFormField=$allFields.eq($index+1);var $focus=$nextFormField.find("input, select").eq(0);var $next=$allFields.eq($allFields.index($focus)+1);if($focus.length){if($focus[0].disabled){$next.find("input, select").eq(0).focus();}else{setTimeout(function(){$focus.focus();hideErrors($next,$this);},5);}}}if(scrollToThis){setTimeout(function(){var moveTo=$this.closest(".radioGroup").offset();$(document).scrollTop(moveTo.top-30);},5);}}function setup(){var $this=$(this);if($this.is(":text")){$this.bind("change keydown keyup",handleToggle).change();}if($this.is("select")){$this.change(handleToggle).change();}else{if($this.is("a")){$this.click(function(e){e.preventDefault();handleToggle.call(this,e);return false;});}else{$this.click(handleToggle);}if(this.checked||$this.is(":checkbox")){handleToggle.call(this);}}if($.browser.safari===true||$.browser.mozilla===true){$this.keydown(function(event){setFocusOnTab=event.shiftKey===false&&event.keyCode===9;});}}return{init:function($context){if(typeof $context==="undefined"||!$context.length){$context=$("body");}$(".statusToggle",$context).each(setup);}};})();LBG.selectAccount=(function(){var $overlay,$businesses,$form,$formField,$dropDown,$introCopy;var selectorScroller="fieldset.businessAccountList .formField",selectorJumpToList="ul.beneficiariesList",selectorIntroCopy=".beneficiariesListIntro";var dropDownID=DI.lang.selectAccount.dropDown.id,dropDownDefault=DI.lang.selectAccount.dropDown.defaultText,dropDownValidate=DI.lang.selectAccount.formField.validateClass,dropDownValidationName=DI.lang.selectAccount.formField.validationName;function showBusiness(){var selectedIndex=$dropDown.attr("selectedIndex")-1;$introCopy.find(selectorJumpToList).remove();if(selectedIndex>=0){$introCopy.find("p").hide();$businesses.hide().eq(selectedIndex).show().each(function(){$(this).find(selectorJumpToList).clone().appendTo($introCopy).show().find("a:eq(0)").focus();
$form.find(selectorScroller).scrollTop(0);});}else{$overlay.find(selectorIntroCopy).find("p").show();$businesses.hide().find("input:checked").removeAttr("checked");}}function build(){$overlay=$("#overlay .businessBulkPayments");$businesses=$overlay.find(".selectBusinessAccount");$form=$overlay.find("form");$introCopy=$overlay.find(selectorIntroCopy);if($businesses.length>0){$formField=$('<div class="formField validate:('+dropDownValidate+") validationName:("+dropDownValidationName+') clearfix"><div class="formFieldInner"></div></div>');$dropDown=$('<select id="'+dropDownID+'" class="selectBusiness"><option value="-">'+dropDownDefault+"</option></select>");$businesses.each(function(i){var index=i+1;var businessName=$(this).find("h3").text();$dropDown.append('<option value="'+index+'">'+businessName+"</option>");});$dropDown.attr("selectedIndex",0).change(showBusiness).appendTo($formField.find(".formFieldInner"));if($businesses.length===1){$dropDown.addClass("isDisabled").attr({selectedIndex:1,disabled:"disabled"}).change().hide();var $businessName=$("<div><p>"+$businesses.eq(0).find("h3").text()+"</p></div>");$businessName.appendTo($formField.find(".formFieldInner"));}$businesses.find("h3").parent(".inner").remove();$formField.prependTo($form);var parentValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($formField);parentValidationHandler.isValid=false;parentValidationHandler.add(new LBG.Forms.Validation.FormField($formField[0]));}}return{init:function(){build();}};})();LBG.scrollable=(function(){var SCROLL_CONTROL=".scroller";function setup(){$(SCROLL_CONTROL).find("a").live("click",function(){var data=$(this).parents(SCROLL_CONTROL).metadata(),$target=$($(this).attr("href").replace(/^.*(#.*)$/,"$1")),$pane=$(data.pane);$pane.scrollTo($target,400,function(){$target.next("ul").find("li:first-child input:radio").focus();});return false;});}return{init:function(){setup();}};})();LBG.setupPasscode=(function(){var selector="div.formField.passCode";var maxLength=4;function getCursorPosition(input){var pos=null;if(document.selection){var range=document.selection.createRange();var rangeLength=range.text.length;range.moveStart("character",-input.value.length);pos=range.text.length-rangeLength;}else{if(input.selectionStart){pos=input.selectionStart;}}return pos;}function setup(){$(selector).each(function(){$(this).find("input:text:first").keyup(function(event){var val=$(this).val();var pos=getCursorPosition(this);var elm=$(this).siblings("input:text");var key=event.keyCode;if(key<37||key>41){if(pos===maxLength&&val.length===maxLength&&this.prevLength>=(maxLength-1)){$(elm).unbind("focus").focus();}else{this.prevLength=val.length;}}});});}return{init:setup};})();LBG.setupTextAlertsDailyFrequency=function(){var defaultValue=DI.lang.textAlertsDailyFrequency.defaultValue,dailyValue=DI.lang.textAlertsDailyFrequency.dailyValue,notApplicableValue=DI.lang.textAlertsDailyFrequency.notApplicableValue,notApplicableSelector="option[value="+notApplicableValue+"]";$("table.textAlertsDailyFrequency select.slctFrequency").each(function(){var select=$(this).parents("tr").find("select.slctReceiveOn");this.notApplicableOption=$(select).find(notApplicableSelector).clone();$(this).bind("change",function(){var slctReceiveOn=$(this).parents("tr").find("select.slctReceiveOn");if(this.value===dailyValue){$(slctReceiveOn).append(this.notApplicableOption).attr("disabled","disabled");try{$(slctReceiveOn).val(notApplicableValue);}catch(e){}LBG.Forms.Validation.Tools.getFieldHandler($(slctReceiveOn).parents(".formField")).hideError();}else{if($(slctReceiveOn).val()===notApplicableValue){$(slctReceiveOn).val(defaultValue);}$(slctReceiveOn).removeAttr("disabled");$(slctReceiveOn).find(notApplicableSelector).remove();}});if($(this).parents("tr").find("input:checkbox").is(":checked")){$(this).change();}});};LBG.toggleFrequencyTerm={selectorDepositTerm:"select.toggleFrequencyTerm",selectorInterestPaidOptions:".interestPaidOptions",selectorFrequencyTerm:"select.slctFrequencyTerm",toggle:function($this){var meta=$this.find(":selected").metadata();var $show=meta.target?$(meta.target):undefined;var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($this);$(LBG.toggleFrequencyTerm.selectorInterestPaidOptions).each(function(){var field=validationHandler.getChild(LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:")[0]);if(field.hideError){field.hideError();}});var $slctFrequencyTerm=$(LBG.toggleFrequencyTerm.selectorFrequencyTerm);if($show!==undefined){$slctFrequencyTerm.removeAttr("disabled").removeClass("isDisabled");if($.browser.mozilla===false){if($slctFrequencyTerm[0].optionElements===undefined){$slctFrequencyTerm[0].optionElements=$slctFrequencyTerm.html();}$slctFrequencyTerm.html($slctFrequencyTerm[0].optionElements);$show=$(meta.target);}$slctFrequencyTerm.find("option").hide().attr("disabled","disabled");$show.show().attr("disabled","");var selectedIndex=$slctFrequencyTerm.attr("selectedIndex");$slctFrequencyTerm.attr("selectedIndex",selectedIndex).removeAttr("disabled").removeClass("isDisabled").show();if($.browser.mozilla===false){$slctFrequencyTerm.find("option").each(function(){if($(this).css("display")==="none"){$(this).remove();}});}}else{$slctFrequencyTerm.attr("disabled","disabled").addClass("isDisabled");}},init:function(){$(LBG.toggleFrequencyTerm.selectorDepositTerm).change(function(){LBG.toggleFrequencyTerm.toggle($(this));}).change();}};LBG.fraudDetection={screenResolution:"input.screenRes",timeZone:"input.timeZone",init:function(){var screenWidth=window.screen.width;var screenHeight=window.screen.height;var screenResolution=screenWidth+"x"+screenHeight;$(LBG.fraudDetection.screenResolution).attr("value",screenResolution);var visitortime=new Date();var offsettime=-1*visitortime.getTimezoneOffset()/60;var offsethour=parseInt(Math.abs(visitortime.getTimezoneOffset()/60),10);var offsetmin=Math.abs(visitortime.getTimezoneOffset())%60;var formattedtime="";if(offsettime!==0){var offsettimeSymb=(offsettime>0)?"+":"-";var offsethourSymb=(offsethour<10)?"0":"";var offsetminSymb=(offsetmin<10)?"0":"";formattedtime="GMT "+offsettimeSymb+offsethourSymb+offsethour+offsetminSymb+offsetmin;}else{formattedtime="GMT 0000";}if(visitortime){$(LBG.fraudDetection.timeZone).attr("value",formattedtime);}else{$(LBG.fraudDetection.timeZone).attr("value","JavaScript Date() not enabled");}}};LBG.previousYearMaxDate=(function(dateGroup){var thisYear=parseInt(new Date().getFullYear());var isPrevYear=$("."+dateGroup+" .year option[value="+(thisYear-1)+"]").length==1?true:false;if(isPrevYear){$("."+dateGroup+" .month").change(function(){selectedMonth=$(this).val();selectedYear=parseInt($("."+dateGroup+" .year").val());if(selectedYear==thisYear&&(selectedMonth=="12"||selectedMonth=="11")){$("."+dateGroup+" .year option[value="+(thisYear-1)+"]").attr("selected","selected");}else{if(selectedYear==thisYear-1&&(selectedMonth=="01"||selectedMonth=="02")){$("."+dateGroup+" .year option[value="+thisYear+"]").attr("selected","selected");}}});}});LBG.leapYearDayAdjust=(function(){var selector={dateGroup:".formField.dateRange .inputGroup, .formField .date.inputGroup",inputGroup:".inputGroup",day:"select.day",month:"select.month",year:"select.year"};var defaultValue={month:"-",year:"-"};var $focusedSelect=null;function isLeapYear(year){return((year%4===0)&&(year%100!==0||year%400===0));}function getDaysInMonth(month,year){if(month==="02"&&isLeapYear(year)===true){return 29;
}else{var days=31;switch(month){case"01":case"03":case"05":case"07":case"08":case"10":case"12":days=31;break;case"04":case"06":case"09":case"11":days=30;break;case"02":days=28;break;default:break;}return days;}}function setDaysInMonth(inputGroup,trigger){var $slctDay=$(inputGroup).find(selector.day),month=$(inputGroup).find(selector.month).val(),year=$(inputGroup).find(selector.year).val();if(month===defaultValue.month&&year===defaultValue.year){return;}var displayDays=(month!==defaultValue.month&&year!==defaultValue.year)?getDaysInMonth(month,year)+1:inputGroup.optionsElements.length;var optionLength=$slctDay.find("option").length;var selectedIndex=$slctDay.attr("selectedIndex");var i;if($.browser.safari===false){if(optionLength>=displayDays){for(i=optionLength;i>=displayDays;i--){$slctDay.find("option").eq(i).remove();}}else{for(i=optionLength;i<displayDays;i++){$slctDay.append(inputGroup.optionsElements[i]);}}}else{var $newSlctDay=$($("<select></select>").attr({id:$slctDay.attr("id"),name:$slctDay.attr("name"),className:$slctDay.attr("class")}));for(i=0;i<displayDays;i++){$newSlctDay.append(inputGroup.optionsElements[i]);}$slctDay.html($newSlctDay[0].innerHTML);}$slctDay=$(inputGroup).find(selector.day);optionLength=$slctDay.find("option").length-1;if(selectedIndex>optionLength){$slctDay.attr("selectedIndex",optionLength);}else{$slctDay.attr("selectedIndex",selectedIndex);}if($.browser.msie===true&&$focusedSelect!==null){$focusedSelect.focus();}}function setup(){var $dateGroup=$(selector.dateGroup);$dateGroup.each(function(){if(this.optionsElements===undefined){this.optionsElements=$(this).find(selector.day+" option").clone();}$(this).find(selector.month+", "+selector.year).bind("change.leapYearDayAdjust",function(){if($.browser.msie===true){$focusedSelect=$(this);}setDaysInMonth($(this).parents(selector.inputGroup)[0],this);});$(this).find(selector.day).bind("focus.leapYearDayAdjust",function(){$focusedSelect=null;setDaysInMonth($(this).parents(selector.inputGroup)[0],this);});if($.browser.msie===true){$(this).find(selector.day).bind("change.leapYearDayAdjust",function(){$(this).focus();});}});}return{init:function(){setup();}};})();LBG.successFadeOutDelay=(function(){return{init:function(color,delay){color=(!color)?"#FFFFCC":color;delay=(!delay)?10000:delay;$(".successInfoMessage h2.success").each(function(){var successInfoMessage=$(this).parents(".successInfoMessage").css("background-color",color);setTimeout(function(){$(successInfoMessage).css("background-color","transparent");LBG.common.effects.highlightElement(successInfoMessage,color);},delay);});}};})();LBG.warningFadeOutDelay=(function(){return{init:function(color,delay){color=(!color)?"#FFFFCC":color;delay=(!delay)?10000:delay;$(".warningInfoMessage h2.warning").each(function(){var warningInfoMessage=$(this).parents(".warningInfoMessage").css("background-color",color);setTimeout(function(){$(warningInfoMessage).css("background-color","transparent");LBG.common.effects.highlightElement(warningInfoMessage,color);},delay);});}};})();LBG.setFocus={focusFieldSelector:".setFocus",init:function(){$(LBG.setFocus.focusFieldSelector).each(function(){$(LBG.setFocus.focusFieldSelector).focus();});}};LBG.rememberMe=(function(){var selector="form.rememberUserID";var parameters=DI.cookieRememberUserID;return{init:function(){$(selector).each(function(){var $checkbox=$(this).find("input:checkbox");if($checkbox.length>0){var cookie=$.cookie(parameters.name);var $username=$(this).find("input:text");if(cookie!==null){$checkbox.attr("checked","checked");$username.val(cookie);}$(this).bind("submit",function(){if($checkbox.is(":checked")){$.cookie(parameters.name,$username.val(),{expires:parameters.expires,path:parameters.path,domain:parameters.domain,secure:parameters.secure});}else{$.cookie(parameters.name,null);}});}});}};})();LBG.toggleRecipientAccount={selectorCountry:"select.toggleRecipientAccount",selectorCountryOptions:"select.toggleRecipientAccount > option",selectorRecipientAccount:".recipientAccountOption",toggle:function($this){var $selectedCountryID=$this.val();var $recipientAccountOptions=$(LBG.toggleRecipientAccount.selectorRecipientAccount);if($selectedCountryID!="-"){var panelLength=$recipientAccountOptions.length;for(var i=0;i<panelLength;i++){var iteration=$recipientAccountOptions[i];if(!$(iteration).hasClass("statusToggleHide")){$(iteration).toggleClass("statusToggleHide");}}var panelClass=$(LBG.toggleRecipientAccount.selectorCountryOptions).filter('[value="'+$selectedCountryID+'"]').metadata().CRAT;if(panelClass===undefined){return;}else{switch(panelClass){case"IBAN":$recipientAccountOptions.filter(".recipientAccountIBAN").toggleClass("statusToggleHide");break;case"ACC":$recipientAccountOptions.filter(".recipientAccountOnly").toggleClass("statusToggleHide");break;case"CLABE":$recipientAccountOptions.filter(".recipientAccountOther").toggleClass("statusToggleHide");break;}}}else{$recipientAccountOptions.filter(".recipientAccountInstructions").toggleClass("statusToggleHide");}},init:function(){$(LBG.toggleRecipientAccount.selectorCountry).change(function(){LBG.toggleRecipientAccount.toggle($(this));}).change();}};LBG.toggleBankRouting={selectorCountry:"select.toggleBankRouting",selectorRouting:".bankInfoSelector",selectorRoutingType:"select.bankRoutingType",toggle:function($this){var meta=$this.find(":selected").metadata();var $show=meta.target?$(meta.target):undefined;var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($this);$(LBG.toggleBankRouting.selectorRouting).each(function(){var field=validationHandler.getChild(LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:")[0]);if(field.hideError){field.hideError();}});$("input:text.bankRoutingType").remove();if($show!==undefined){$(LBG.toggleBankRouting.selectorRouting).show();var $slctRoutingType=$(LBG.toggleBankRouting.selectorRoutingType);if($.browser.mozilla===false){if($slctRoutingType[0].optionElements===undefined){$slctRoutingType[0].optionElements=$slctRoutingType.html();}$slctRoutingType.html($slctRoutingType[0].optionElements);$show=$(meta.target);}$slctRoutingType.find("option").hide();$show.show();if($show.length>1){$slctRoutingType.attr("selectedIndex",0).removeAttr("disabled").show();}else{var $option=$slctRoutingType.find("option[value="+$show.val()+"]");$slctRoutingType.attr({"selectedIndex":$slctRoutingType.find("option").index($option)}).hide();$("<input />").attr({"type":"text","readonly":"readonly","class":$($slctRoutingType).attr("class"),"name":$($slctRoutingType).attr("name")+"_readonly","id":$($slctRoutingType).attr("id")+"_readonly","value":$option.text()}).insertAfter($slctRoutingType);}if($.browser.mozilla===false){$slctRoutingType.find("option").each(function(){if($(this).css("display")==="none"){$(this).remove();}});}}else{$(LBG.toggleBankRouting.selectorRouting).hide();}},init:function(){$(LBG.toggleBankRouting.selectorCountry).change(function(){LBG.toggleBankRouting.toggle($(this));}).change();}};LBG.contentScrollerTabIndex=function(){$(".legals, .scrollable").attr("tabIndex",0);};LBG.iOS={scrollGestureMessage:function(element){if(LBG.browserIdent.browserIdent==="iPad"||LBG.browserIdent.browserIdent==="iPhone"){var message='<div class="infoMessage alert scrollGesture clearfix"><div class="infoMessageInner clearfix"><p>'+DI.lang.iOS.scrollGestureMessage+"</p></div></div>";if(element&&element.scrollHeight>$(element).innerHeight()){$(element).addClass("scrollGesture");$(message).insertBefore(element);
}}}};LBG.timedLogout={duration:0,interval:null,selectorContainer:".logoutTimer",selectorMessage:".logoutTimer .timer",selectorButtons:".logoutButton",selectorLogoutLink:".movingOn a",selectorDuration:".logoutTimerDurationMS",enabledClassName:"jsTimedLogout",messageHtml:"",buttonUrl:"",buttonAlt:"",init:function(){if($(LBG.timedLogout.selectorContainer).length===1){LBG.timedLogout.duration=$(LBG.timedLogout.selectorDuration).val();LBG.timedLogout.messageHtml=DI.lang.timedLogout.logoutMsg;LBG.timedLogout.buttonUrl=DI.lang.timedLogout.logoutButton;LBG.timedLogout.buttonAlt=DI.lang.timedLogout.logoutAlt;$(LBG.timedLogout.selectorContainer).addClass(LBG.timedLogout.enabledClassName);$(LBG.timedLogout.selectorButtons).attr({"src":LBG.timedLogout.buttonUrl,"alt":LBG.timedLogout.buttonAlt});var timerImg=new Image();$(LBG.timedLogout.selectorMessage).before($(timerImg).addClass("clock").attr("alt",DI.timedLogout.timerImgAlt).attr("src",DI.timedLogout.timerImg));LBG.timedLogout.refreshMessage();LBG.timedLogout.start();}},start:function(){LBG.timedLogout.timer=window.setInterval(LBG.timedLogout.countdown,1000);},stop:function(){window.clearInterval(LBG.timedLogout.timer);},refreshMessage:function(){var message=LBG.timedLogout.messageHtml+" <strong>"+LBG.timedLogout.formatMs(LBG.timedLogout.duration)+"</strong>";$(LBG.timedLogout.selectorMessage).html(message);},formatMs:function(ms){var formattedTime=parseInt(ms%60000/1000,10)+" seconds.";if(ms/60000>=1){formattedTime=parseInt(Math.floor(ms/60000),10)+" minutes and "+formattedTime;}return formattedTime;},logout:function(){window.location.href=$(LBG.timedLogout.selectorLogoutLink).attr("href");},countdown:function(){LBG.timedLogout.duration=LBG.timedLogout.duration-1000;if(LBG.timedLogout.duration>=0){LBG.timedLogout.refreshMessage();}else{LBG.timedLogout.stop();LBG.timedLogout.logout();}}};LBG.clickActionLinkOnce={init:function(){$('a[href*="&al="]:not(.allow-multiple-clicks, .removeSplit a, a.newwin, a.newhelpwin, a.newfaqwin, a.overlay, a.printwin, a.statementLink, a.pdfLink, a.tabBrowse, a.tabSearch, a.oabAddToCalLink), a[href*="link"]:not(.swipey-launch, [data-wt-ac])').bind("click",function(){$(this).unbind().bind("click",function(){return false;});});}};LBG.expandSelect={selector:".expandSelect select, select.expandSelect, .navBar select",current:null,cloneCSS:{position:"absolute",top:"-100px",left:"-10000px",width:"auto",maxWidth:"none",visibility:"hidden"},defaultCSS:{width:"auto",maxWidth:"none","z-index":2,position:"relative"},resetWidth:function(element){$(element).css("width",$(element).data("origWidth"));},doMouseover:function(event){var target=event.target;if(LBG.expandSelect.current!==null&&LBG.expandSelect.current!==event.target){LBG.expandSelect.resetWidth(LBG.expandSelect.current);}var cloneSelect=$(target).clone().css(LBG.expandSelect.cloneCSS).insertAfter(target);var cloneWidth=cloneSelect[0].offsetWidth;if(cloneWidth===0){cloneWidth=cloneSelect.width();}cloneSelect.remove();if(cloneWidth>=$(target).data("origWidth")){$(target).css(LBG.expandSelect.defaultCSS);}LBG.expandSelect.current=target;},doMouseout:function(event){LBG.expandSelect.resetWidth(event.target);},doFocus:function(event){$(event.target).unbind("mouseout").bind("blur",function(){LBG.expandSelect.resetWidth(this);$(this).bind("mouseout",LBG.expandSelect.doMouseout);});},init:function(){if($.browser.msie&&$.browser.version<9){$(LBG.expandSelect.selector).each(function(){$(this).data("origWidth",this.offsetWidth);}).bind("mouseover",LBG.expandSelect.doMouseover).bind("mouseout",LBG.expandSelect.doMouseout).bind("focus",LBG.expandSelect.doFocus);}}};LBG.equalisePanelHeights={isResizing:false,panels:[],resetPanels:function(){$(LBG.equalisePanelHeights.panels).css("height","auto");},equaliseHeights:function(){LBG.equalisePanelHeights.panels=[];function doEqualise(selWrapper,selPanel){var curHeight=0;var maxHeight=0;$(selWrapper).each(function(){$(this).find(selPanel).each(function(){curHeight=$(this).height();if(curHeight>maxHeight){maxHeight=curHeight;}LBG.equalisePanelHeights.panels.push(this);}).height(maxHeight);});}function doEqualiseParent(selWrapper,selPanel){var curHeight=0;var maxHeight=0;$(selWrapper).each(function(){$(this).find(selPanel).each(function(){curHeight=$(this).parent($(selWrapper)).height();if(curHeight>maxHeight){maxHeight=curHeight;}LBG.equalisePanelHeights.panels.push(this);}).height(maxHeight);});}doEqualise(".equalPanelHeights",".subPanel");doEqualise(".yourOffersMultiBox ul.offerList","> li");doEqualise(".yourOffersSingleBox ul.offerList","> li");doEqualise("div.optionPanel","div.subPanel");doEqualise("div.summaryPanels div.colLayout","div.subPanel");doEqualiseParent("div.summaryPanels","div.subPanel");doEqualise("div.sp-pat-023-body-50-50","div.sp-custom-eq-height");$(".sp-pat-032 ").each(function(){var $this=$(this);if(($(".spRateDesc p",this).length==1)&&($(".spRateDesc p.spApplyOnline ",this).length==1)){$(".spRateDesc",this).css({"padding-top":"0px","padding-bottom":"0px"});doEqualise($this,"> div");var thisHeight=$this.height();$(".spRateDesc p.spApplyOnline ",this).css({"margin-top":((thisHeight/2)-22.5)+"px"});}});if($.browser.msie){LBG.equalisePanelHeights.isResizing=false;}},init:function(doResetHeights){if(doResetHeights){LBG.equalisePanelHeights.resetPanels();}LBG.equalisePanelHeights.equaliseHeights();if(!$.browser.msie||$.browser.msie&&$.browser.version>=7){$(window).resize(function(){if($.browser.msie&&!LBG.equalisePanelHeights.isResizing||!$.browser.msie){if($.browser.msie){LBG.equalisePanelHeights.isResizing=true;}LBG.equalisePanelHeights.resetPanels();LBG.equalisePanelHeights.equaliseHeights();}});}}};LBG.investmentsExpandingTable={selectorTable:"table.expandingTable, table.table-expanding-row",selectorTrigger:"tr.trigger, more-info a",selectorDetail:"tr.detail",selectorReveal:"div.reveal",expand:function($trigger){var $detail=$trigger.next(this.selectorDetail),$reveal=$detail.find(this.selectorReveal);if($.browser.msie&&$.browser.version<7){$("tr.trigger, more-info").removeClass("expanded");$(this.selectorDetail).each(function(e){$(this)[0].style.display="none";});$detail[0].style.display="block";$reveal[0].style.display="block";$trigger.addClass("expanded");}else{if($trigger.data("isRevealSingle")){$trigger.parents(this.selectorTable).find("tbody tr.expanded").each(function(){LBG.investmentsExpandingTable.collapse($(this));});}$trigger.addClass("expanded");$detail.show().trigger("expand");$reveal.slideDown();}$trigger.addClass("expanded");$detail.show();$reveal.slideDown();$trigger.trigger("row_expanded");},collapse:function($trigger){var $detail=$trigger.next(this.selectorDetail),$reveal=$detail.find(this.selectorReveal);if($.browser.msie&&$.browser.version<7){$reveal[0].style.display="none";$detail[0].style.display="none";$trigger.removeClass("expanded");}else{$reveal.slideUp(function(){$detail.hide().trigger("collapse");$trigger.removeClass("expanded");});}$trigger.trigger("row_collapsed");},triggerText:function(trigger){$(trigger).find(".more-info a").toggleClass("hide");},init:function(){$(this.selectorTable).each(function(){var $table=$(this),$triggers=$table.find("tr.trigger",".more-info a");$triggers.data("isRevealSingle",$table.hasClass("revealSingle"));$triggers.click(function(e){if(e.target.tagName.toLowerCase()=="tr"||e.target.tagName.toLowerCase()=="th"||e.target.tagName.toLowerCase()=="td"||e.target.tagName.toLowerCase()=="input"||e.target.tagName.toLowerCase()=="a"){if(e.target.className=="more-info","more-info a"){if($(this).hasClass("expanded")){LBG.investmentsExpandingTable.collapse($(this));
LBG.investmentsExpandingTable.triggerText(this);return false;}else{LBG.investmentsExpandingTable.expand($(this));LBG.investmentsExpandingTable.triggerText(this);return false;}}}else{if($(this).hasClass("expanded")){LBG.investmentsExpandingTable.collapse($(this));}else{LBG.investmentsExpandingTable.expand($(this));}}});$triggers.filter("tr").find(".first").attr("tabIndex","0").keyup(function(event){if(event.keyCode===13){$(this).parent("tr").click();}});});$(this.selectorDetail).each(function(e){if($(this).find(".error").length>0){LBG.investmentsExpandingTable.expand($(this).prev());}});if($.browser.msie&&$.browser.version<7){$("select").change(function(e){$(this).parents("table").find("div.reveal").each(function(){if(this.style.display){this.style.display="none";this.style.display="block";e.target.blur();}});});}}};LBG.expandingTableByLink={expand:function($trigger){var $detail=$trigger.next(this.options.selectorDetail),$reveal=$detail.find(this.options.selectorReveal);if($trigger.data("isRevealSingle")){$trigger.parents(this.options.selectorTable).find("tbody tr.expanded").each(function(){LBG.expandingTableByLink.collapse($(this));});}$trigger.addClass("expanded");$detail.show();$reveal.slideDown();},collapse:function($trigger){var $detail=$trigger.next(this.options.selectorDetail),$reveal=$detail.find(this.options.selectorReveal);$reveal.slideUp(function(){$detail.hide();$trigger.removeClass("expanded");});},triggerText:function(trigger){$(trigger).find(this.options.selectorText).toggleClass("hide");},init:function(options){this.options=$.extend({},this.options,options);var triggerTr=this.options.triggerExpand,triggerBtn=this.options.selectorTrigger;$(this.options.selectorTable).each(function(){var $table=$(this),$triggers=$table.find(triggerBtn);$triggers.click(function(e){if($(this).closest(triggerTr).hasClass("expanded")){LBG.expandingTableByLink.collapse($(this).closest(triggerTr));LBG.expandingTableByLink.triggerText($(this).closest(triggerTr));return false;}else{LBG.expandingTableByLink.expand($(this).closest(triggerTr));LBG.expandingTableByLink.triggerText($(this).closest(triggerTr));return false;}});});},options:{selectorTable:"table.table-expanding-row-link",selectorTrigger:".more-info",selectorText:"a.more, a.less",triggerExpand:"tr.trigger",selectorDetail:"tr.detail",selectorReveal:"div.reveal"}};LBG.loanExpandingTable={init:function(){var $loansTable=$(".loanSelectionTable"),$revealRow=$loansTable.find("tr.detail"),$triggerRow=$loansTable.find("tr.trigger");var updateTriggerTitle=function($trigger){$trigger.each(function(){this.title=$(this).text()+": "+LBG.showHide.triggerTitle;});};$revealRow.hide();$triggerRow.addClass("collapsed").hover(function(){$(this).addClass("hover");},function(){$(this).removeClass("hover");});$triggerRow.find("a.loanSelectionOptions").click(function(e){e.preventDefault();});$triggerRow.click(function(){var $trigger=$(this),meta=$(this).find("a.trigger").metadata().label;var getRevealGroup=function($row){var $group=$([]);$row.nextAll().each(function(){if(!$(this).hasClass("detail")){return false;}$group=$group.add($(this));});return $group;};var expand=function($row){$row.removeClass("collapsed").addClass("expanded");if(typeof meta.open==="string"){$row.find("p").text(meta.open);}getRevealGroup($row).show();updateTriggerTitle($row.find("a.trigger"));};var collapse=function($row){$row.removeClass("expanded").addClass("collapsed");if(typeof meta.closed==="string"){$row.find("p").text(meta.closed);}getRevealGroup($row).hide();updateTriggerTitle($row.find("a.trigger"));};$triggerRow.not($trigger).each(function(){collapse($(this));});if($trigger.hasClass("collapsed")){expand($trigger);}else{collapse($trigger);}});updateTriggerTitle($triggerRow.find("a.trigger"));}};LBG.accountStatementTableExpandPolicy={init:function(){var $loansTable=$(".accountStatementTableExpandPolicy"),$revealRow=$loansTable.find("tr.detail"),$triggerRow=$loansTable.find("tr.trigger");$revealRow.hide();$triggerRow.addClass("collapsed");$triggerRow.find("a.loanSelectionOptions").click(function(e){e.preventDefault();});$triggerRow.click(function(){var $trigger=$(this);var getRevealGroup=function($row){var $group=$([]);$row.nextAll().each(function(){if(!$(this).hasClass("detail")){return false;}$group=$group.add($(this));});return $group;};var expand=function($row){$row.removeClass("collapsed").addClass("expanded");getRevealGroup($row).show();};var collapse=function($row){$row.removeClass("expanded").addClass("collapsed");getRevealGroup($row).hide();};$triggerRow.not($trigger).each(function(){collapse($(this));});if($trigger.hasClass("collapsed")){expand($trigger);}else{collapse($trigger);}$triggerRow.removeClass("expanded_alt");if($(this).hasClass("alt")){if($(this).hasClass("expanded")){$(this).addClass("expanded_alt");}}});}};LBG.olympicCountdown={animationInterval:5000,animationDuration:300,countdown:null,panels:null,css3DEnabled:function(){if(this._css3D===undefined){var perspective=this.countdown.css("Perspective")||this.countdown.css("WebkitPerspective");this._css3D=!(perspective===undefined||perspective===null||perspective===""||perspective==="none");}return this._css3D;},squeeze:function(){var self=this;$(this.panels[0]).animate({marginLeft:"50%",width:0},{duration:self.animationDuration,complete:function(){self.panels.reverse();self.expand();}});},expand:function(){var self=this;$(this.panels[0]).animate({marginLeft:0,width:"100%"},{duration:this.animationDuration});},init:function(countdown){var self=this;this.countdown=$(countdown);this.panels=this.countdown.find("div").get();try{document.execCommand("BackgroundImageCache",false,true);}catch(e){}window.setInterval(function(){if(self.css3DEnabled()){self.countdown.toggleClass("flip");}else{self.squeeze();}},self.animationInterval);}};LBG.iOS={scrollGestureMessage:function(element){if(LBG.browserIdent.browserIdent==="iPad"||LBG.browserIdent.browserIdent==="iPhone"){var message=!LBG.isTabletInBranch?'<div class="infoMessage alert scrollGesture clearfix"><div class="infoMessageInner clearfix"><p>'+DI.lang.iOS.scrollGestureMessage+"</p></div></div>":'<p class="isTabletInBranch-scrollGestureMessage">'+DI.lang.iOS.scrollGestureMessageTabletInBranch+"</p>";if(element&&element.scrollHeight>$(element).innerHeight()){$(element).addClass("scrollGesture");$(message).insertBefore(element);}}}};LBG.ticker={isResizing:false,messages:[],total:0,defaultState:"play",currentState:"play",currIndex:0,nextIndex:0,prevIndex:0,interval:null,intervalDelay:40,increment:2,timer:null,timerDelay:2000,indent:15,playBtn:null,prevBtn:null,nextBtn:null,pauseBtn:null,init:function(){LBG.ticker.messages=$(".content .ticker li");if(!LBG.ticker.messages.length){return;}LBG.ticker.total=LBG.ticker.messages.length;LBG.ticker.defaultState=($(".content .ticker").hasClass("play")?"play":"pause");LBG.ticker.currentState=LBG.ticker.defaultState;LBG.ticker.currIndex=0;LBG.ticker.nextIndex=LBG.ticker.currIndex+1;LBG.ticker.prevIndex=LBG.ticker.total-1;LBG.ticker.messages.each(function(){LBG.ticker.startPosition($(this));});LBG.ticker.attachFadeEnds();LBG.ticker.attachButtons();LBG.ticker.bindResize();if(LBG.ticker.total<=1){$(".content .ticker").addClass("single");}LBG.ticker.setDefaultState();$(".content .ticker ul").hover(function(){LBG.ticker.pause();},function(){if(LBG.ticker.currentState==="play"){LBG.ticker.start();}});},setDefaultState:function(){if(LBG.ticker.defaultState==="play"){LBG.ticker.start();}else{var curr=LBG.ticker.messages.eq(LBG.ticker.currIndex);
var next=LBG.ticker.messages.eq(LBG.ticker.nextIndex);if(LBG.ticker.messages.length>1){next.css("left",LBG.ticker.indent).show();LBG.ticker.startPosition(curr);LBG.ticker.updateIndex(false);}else{LBG.ticker.messages.css("left",LBG.ticker.indent);$(".prev, .next").hide();}LBG.ticker.pause();}},bindResize:function(){if(!$.browser.msie||$.browser.msie&&$.browser.version>=7){$(window).resize(function(){if(!$.browser.msie||$.browser.msie&&!LBG.equalisePanelHeights.isResizing){if($.browser.msie){LBG.ticker.isResizing=true;}var scrollerWidth=$(".content .ticker .scrollContainer").width();LBG.ticker.messages.each(function(i){var curr=$(this);var left=parseInt(curr.css("left"),10);if(left>scrollerWidth||!curr.data("isScrolling")){LBG.ticker.startPosition(curr);}});}});}},startPosition:function(elm){elm.css("left",$(".content .ticker .scrollContainer").width()).show();},updateIndex:function(isDecrement){LBG.ticker.currIndex=isDecrement?LBG.ticker.currIndex-1:LBG.ticker.currIndex+1;if(LBG.ticker.currIndex>=LBG.ticker.total){LBG.ticker.currIndex=0;}if(LBG.ticker.currIndex<0){LBG.ticker.currIndex=LBG.ticker.total-1;}LBG.ticker.nextIndex=LBG.ticker.currIndex+1;if(LBG.ticker.nextIndex===LBG.ticker.total){LBG.ticker.nextIndex=0;}LBG.ticker.prevIndex=LBG.ticker.currIndex-1;if(LBG.ticker.prevIndex<0){LBG.ticker.prevIndex=LBG.ticker.total-1;}},attachFadeEnds:function(){if(!$.browser.msie||$.browser.msie&&$.browser.version>=7){var fadeL=$("<div />").addClass("fadeEdge fadeLeft");var fadeR=$("<div />").addClass("fadeEdge fadeRight");fadeL.add(fadeR).appendTo($(".content .ticker .scrollContainer"));LBG.ticker.indent=fadeL.width()-10;}},attachButtons:function(){var buttonHolder=$('<span class="buttons" />');LBG.ticker.playBtn=$("<img/>").attr("src",DI.ticker.playButtonURL).addClass("play").appendTo(buttonHolder);LBG.ticker.pauseBtn=$("<img/>").attr("src",DI.ticker.pauseButtonURL).addClass("pause").appendTo(buttonHolder);if(LBG.ticker.total>1){LBG.ticker.prevBtn=$("<img/>").attr("src",DI.ticker.previousButtonURL).addClass("prev").appendTo(buttonHolder);LBG.ticker.nextBtn=$("<img/>").attr("src",DI.ticker.nextButtonURL).addClass("next").appendTo(buttonHolder);}buttonHolder.unbind().bind("click",function(e){var targetElement=$(e.originalTarget||e.srcElement);if(targetElement&&targetElement.hasClass("play")){LBG.ticker.start();LBG.ticker.updateCurrentState("play");}if(targetElement&&targetElement.hasClass("pause")){LBG.ticker.pause();LBG.ticker.updateCurrentState("pause");}if(targetElement&&targetElement.hasClass("next")){LBG.ticker.pause();LBG.ticker.skip();}if(targetElement&&targetElement.hasClass("prev")){LBG.ticker.pause();LBG.ticker.skip(true);}});$(".content .ticker").append(buttonHolder);},updateCurrentState:function(state){LBG.ticker.updateDefaultState(state);LBG.ticker.currentState=state;if(state==="play"){$(".content .ticker").removeClass("pause").addClass("play");}else{$(".content .ticker").removeClass("play").addClass("pause");}},updateDefaultState:function(state){var actionURL=(state==="play")?DI.ticker.setDefaultActionPlayURL:DI.ticker.setDefaultActionPauseURL;$.ajax({url:actionURL,type:"GET",dataType:"html"});},start:function(){if(LBG.ticker.timer){LBG.ticker.clearTimer();}LBG.ticker.interval=window.setInterval(LBG.ticker.scroll,LBG.ticker.intervalDelay);$(".content .ticker .play").css("display","none");$(".content .ticker .pause").css("display","inline");},pause:function(){window.clearInterval(LBG.ticker.interval);LBG.ticker.interval=null;$(".content .ticker .play").css("display","inline");$(".content .ticker .pause").css("display","none");},clearTimer:function(){window.clearTimeout(LBG.ticker.timer);LBG.ticker.timer=null;},skip:function(isPrevious){LBG.ticker.pause();if(LBG.ticker.timer){LBG.ticker.clearTimer();}if(LBG.ticker.messages.is(":animated")){return false;}var curr=LBG.ticker.messages.eq(LBG.ticker.currIndex);var next=isPrevious?LBG.ticker.messages.eq(LBG.ticker.prevIndex):LBG.ticker.messages.eq(LBG.ticker.nextIndex);curr.fadeOut("fast",function(){next.css("left",LBG.ticker.indent).fadeIn("fast",function(){if(LBG.ticker.currentState==="play"){LBG.ticker.timer=window.setTimeout(function(){LBG.ticker.start();LBG.ticker.clearTimer();},LBG.ticker.timerDelay);}LBG.ticker.startPosition(curr);LBG.ticker.updateIndex(isPrevious);});});},scroll:function(){var curr=LBG.ticker.messages.eq(LBG.ticker.currIndex).data("isScrolling",true);var left=parseInt(curr.css("left"),10);if(left+curr.width()<0){curr.data("isScrolling",false).css("left",$(".content .ticker .scrollContainer").width());LBG.ticker.updateIndex();}else{curr.css("left",left-LBG.ticker.increment);}}};LBG.investmentsFund={selectorOptions:".investmentsFundOptions",selectorTable:".investmentsFundTable",errorHTML:'<div class="investmentsFundTable inner clearfix"><p>'+DI.lang.investmentsFund.ajaxErrorText+"</p></div>",selectedValue:null,init:function(){$(LBG.investmentsFund.selectorOptions).find(":radio").click(function(){if(LBG.investmentsFund.selectedValue===this.value){return;}var meta=$(this).metadata();if(meta&&meta.ajaxURI){$.ajax({url:LBG.common.ajax.tagUrl(meta.ajaxURI),success:function(response){$(LBG.investmentsFund.selectorTable).remove();$(response).insertAfter(LBG.investmentsFund.selectorOptions);LBG.investmentsFund.selectedValue=this.value;LBG.ajax.pageUpdated();},error:function(){$(LBG.investmentsFund.selectorTable).remove();$(LBG.investmentsFund.errorHTML).insertAfter(LBG.investmentsFund.selectorOptions);LBG.investmentsFund.selectedValue=null;}});}});$(LBG.investmentsFund.selectorOptions).find(":radio:checked").change();}};LBG.ajaxFormContentLoader={selectorOptions:".ajaxFormContent",selectorContent:".ajaxResult",errorHTML:'<div class="ajaxResult inner clearfix"><p>'+DI.lang.ajaxFormContent.ajaxErrorText+"</p></div>",init:function(){$(LBG.ajaxFormContentLoader.selectorOptions).find("input").click(function(){var $fieldset=$(this).parents("fieldset");var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($fieldset);if(LBG.ajaxFormContentLoader.selectedValue===this.value){return;}var meta=$(this).metadata();var imgSrcStore;var $spinner=$fieldset.find(".spinner");$spinner.attr("style","display: block");if(meta&&meta.ajaxURI){$.ajax({url:LBG.common.ajax.tagUrl(meta.ajaxURI),success:function(response){formValidationHandler.removeChildren($fieldset);$fieldset.find(LBG.ajaxFormContentLoader.selectorContent).remove();$(response).insertAfter($fieldset.find(LBG.ajaxFormContentLoader.selectorOptions));var submitButton=$fieldset.find("submitAction").context;submitButton.disabled=true;imgSrcStore=submitButton.src;var disabledImageSrc=submitButton.className.split("disabledSrc:")[1];if(disabledImageSrc.length>0){submitButton.src=disabledImageSrc;}LBG.ajaxFormContentLoader.selectedValue=this.value;formValidationHandler.findChildren($fieldset);LBG.ajax.pageUpdated();},error:function(){var submitButton=$fieldset.find("submitAction").context;submitButton.disabled=false;submitButton.src=imgSrcStore;$(LBG.ajaxFormContentLoader.selectorContent).remove();$(LBG.ajaxFormContentLoader.errorHTML).insertAfter(LBG.ajaxFormContentLoader.selectorOptions);LBG.ajaxFormContentLoader.selectedValue=null;}});}$spinner.attr("style","display: none");});}};LBG.dbtSetupModules={init:function(){$(".dbtSetupConfirmation input").css("display","none");$(".setupRadioCheckedNoJS").attr("checked",false);$(".dbtSetupConfirmation").attr("style","display:none");$(".dbtSetup").each(function(){var $setupModuleRadios=$(this).find("input.setupRadio");
var $setupModuleConfirmBox=$(this).find(".dbtSetupConfirmation");$setupModuleRadios.each(function(){if($(this).is(":checked")){if($(this).val()===DI.lang.validation.yesValue){$setupModuleConfirmBox.show("slow",function(){});$setupModuleConfirmBox.find("input").css("display","block");}}});});LBG.dbtSetupModules.check_valid_modules();$(".dbtSetup .yesplease").click(function(e){e.preventDefault();var $toggleWrapper=$(this).parents(".dbtSetup");var $toggleContent=$toggleWrapper.find(".dbtSetupConfirmation");$(this).attr("src","../assets/theme/lang/images/buttons/yes_please_disabled.png");$toggleContent.show("slow",function(){});$toggleContent.find("input").css("display","block");});$(".dbtSetup a.cancel").click(function(e){e.preventDefault();var $toggleWrapper=$(this).parents(".dbtSetup");var $toggleContent=$toggleWrapper.find(".dbtSetupConfirmation");var $yespleaseButton=$toggleWrapper.find(".yesplease");$yespleaseButton.attr("src","../assets/theme/lang/images/buttons/yes_please.png");$toggleContent.hide("slow",function(){});$toggleContent.find("input").css("display","none");});$(".dbtSetup input.setupRadio").click(function(){var selected_radio=$(this).val();var $toggleWrapper=$(this).parents(".dbtSetup");var $toggleContent=$toggleWrapper.find(".dbtSetupConfirmation");if(selected_radio===DI.lang.validation.yesValue){$toggleContent.show("slow",function(){});$toggleContent.find("input").css("display","block");}if(selected_radio==="no"){$toggleContent.hide("slow",function(){});$toggleContent.find("input").css("display","none");}LBG.dbtSetupModules.check_valid_modules();});if(!$(".dbtSetup").hasClass("dbtSetupComm")){$(".dbtSetup input.confirmButton").click(function(e){var $wrapper=$(this).parents(".dbtSetup");var $disableRadios=$wrapper.find("input.setupRadio");$("form").submit(function(e){$disableRadios.attr("disabled","disabled");});});}$(".dbtSetupComm .primaryAction input").click(function(){var selected_radio=$(".dbtSetupComm input.setupRadio:checked").val();if(selected_radio==="no"){$(".dbtSetupComm input.mobileNumberMatch").val("");}});},check_valid_modules:function(){$("ul.dbtSetup .submitAction").attr("src",DI.themePath+"en-gb/images/buttons/continue.png");$("ul.dbtSetup .submitAction").removeAttr("disabled");if($(".dbtSetup .controls .radioGroup").length>0){var valid=true;$(".dbtSetup .controls .radioGroup").each(function(){var no_checks=true;var $theseRadios=$(this).find("input.setupRadio");$theseRadios.each(function(){if($(this).is(":checked")){no_checks=false;if($(this).val()!=="no"){valid=false;}}});if(no_checks===true){valid=false;}});if(valid===false){$("ul.dbtSetup .submitAction").attr("src",DI.themePath+"en-gb/images/buttons/continue_disabled.png");$("ul.dbtSetup .submitAction").attr("disabled","disabled");}else{$("ul.dbtSetup .submitAction").attr("src",DI.themePath+"en-gb/images/buttons/continue.png");$("ul.dbtSetup .submitAction").removeAttr("disabled");}}}};LBG.jumpList={init:function(){var $list=$("ul.jumpList"),$table=$("table.jumpListData"),$links=$list.find("a"),$headings=$table.find("thead th"),curIndex=null;if(!$links.length){return;}$headings.each(function(){if($(this).metadata().sorter!==false){$(this).click(function(){curIndex=$headings.index(this);});}});$links.click(function(event){var id=$(this)[0].hash,meta=$table.metadata(),$sort=null;if($table.hasClass("sortable")){if(typeof meta.targetColumn==="number"&&$headings.eq(meta.targetColumn).metadata().sorter!==false){$sort=$headings.eq(meta.targetColumn);}else{$sort=$headings.eq(0);}if($headings.index($sort)!==curIndex){if($sort[0].count%2!==0){$sort[0].count++;}$sort.click();}}if(id&&id!==""){setTimeout(function(){$($.browser.safari?"body":"html").animate({scrollTop:$(id).offset().top},"slow");},100);}event.preventDefault();});}};LBG.tabs={selectorTabs:"ul.js-tabs",selectorCurr:"current",setCurrent:function(elm){var $curr=$(elm).parents("li"),$tabs=$curr.parents(this.selectorTabs).find("li").not($curr);if($curr.hasClass()){return;}$tabs.removeClass(this.selectorCurr).find("a").each(function(){$(this.hash).hide();});$curr.addClass(this.selectorCurr).find("a").each(function(){$(this.hash).show();});},init:function(){$(this.selectorTabs).each(function(){var $links=$(this).find("a"),meta=$(this).metadata(),index=0,i=0,isMPA=false;if(meta&&meta.showTab&&meta.showTab>0&&meta.showTab<=$links.length){index=meta.showTab-1;}$links.click(function(event){LBG.tabs.setCurrent(this);event.preventDefault();});LBG.tabs.setCurrent($links[index]);$links.each(function(){var bg=$(this).metadata(),img=$("<img />"),imgWidth,tabWidth,tabPadding;if(bg.bgURI&&bg.bgURI.length>0){isMPA=true;img.hide();img.bind("load",function(){imgWidth=$(this).width();tabWidth=120-imgWidth;tabPadding=12+imgWidth;$(this).closest("a").css({"background-image":'url("'+bg.bgURI+'")',"background-position":"7px 9px","width":tabWidth+"px","max-width":tabWidth+"px","padding-left":tabPadding+"px"});});$(this).append(img);img.attr("src",bg.bgURI);}});if(isMPA){$("#overlay").css("width","auto");}});}};LBG.calculateFundAllocations=function(){if($("table.fundAllocationDetails").length){$(".amount_percent_total").autoTotal(".amount_percent");}};LBG.lineWrap={init:function(){var $heading=$(".tile h2 span, .tile h3 span, .banner h2 span, .banner h3 span, .bigBanner h2 span, .bigBanner h3 span, .bigPrompt h2 span, .bigPrompt h3 span, .IBMediumPanel h3 span");$heading.each(function(){var $headingParent=$(this).parent(),headingText=$(this).text(),headingWidth=$headingParent.width();$headingParent.append("<span style=>T</span>");var $spanInit=$headingParent.find("span"),singleTextWidth=$headingParent.find("span").eq($spanInit.length-1).width();$headingParent.find("span").eq($spanInit.length-1).remove();headingWidth=headingWidth-parseInt($(this).css("padding-left"),10)-parseInt($(this).css("padding-right"),10);var noChars=Math.floor(headingWidth/singleTextWidth);$headingParent.html("");var lines=[""];var max_chars_per_line=noChars;var segments=headingText.split(" ");var j=0,i=0;for(i=0;i<segments.length;i++){if(lines[j].length+segments[i].length>max_chars_per_line){j++;}if(typeof lines[j]==="undefined"){lines[j]="";}lines[j]+=segments[i]+" ";}for(i=0;i<lines.length;i++){$headingParent.append("<span>"+lines[i]+"</span>");}});}};LBG.flashEmbed={embedflash:function($this,configOptions){swfobject.embedSWF(configOptions.swfFile,$this.attr("id"),configOptions.width,configOptions.height,configOptions.version,false,configOptions.customParams,configOptions.player,configOptions.attributes);},init:function(){var $flashAttr=$(".flashMovie"),meta=[],flashNum=0;var defaultObj={version:"10",attributes:{styleclass:"flashMovie"},player:{play:"true",loop:"true",wmode:"window",allowFullScreen:"false",allowscriptaccess:"sameDomain"}};$flashAttr.each(function(){var $this=$(this);meta=$this.metadata();var $objLink=$this.find(".flashLinkWrapper").remove();$this.closest(".flashContainer").append($objLink);if(!($this.attr("id"))){flashNum++;var classToID="flashMovie"+flashNum;$this.attr("id",classToID);}for(var parent in defaultObj){if(parent in meta){if(typeof defaultObj[parent]==="object"){for(var subKey in defaultObj[parent]){if(!(subKey in meta[parent])||meta[parent][subKey]===""){meta[parent][subKey]=defaultObj[parent][subKey];}}}}else{meta[parent]=defaultObj[parent];}}LBG.flashEmbed.embedflash($this,meta);});}};LBG.flashLink={init:function(){var $flashAttr=$(".flashMovie");$flashAttr.each(function(){var $this=$(this);var $thisLink=$this.next(".flashLinkWrapper");var altText=$thisLink.find("a").text();
$thisLink.find("a").empty().attr("title",altText);var flashGif=new Image();$(flashGif).attr("src",DI.flashObj.flashObjImg).attr("alt","");$thisLink.find("a").append($(flashGif));var objWidth=$this.width();var objHeight=$this.height();$this.closest(".flashContainer").css({"width":objWidth,"height":objHeight});$thisLink.css({"width":objWidth,"height":objHeight});$thisLink.mouseover(function(){$thisLink.css("cursor","pointer");});});}};LBG.doNotUpdateEmail={init:function(){$(function(){if(($(".txtEmail1")&&$(".txtEmail2"))&&$(".showHide")){$(".donotupdate").click(function(){$("input.txtEmail").each(function(){$(this).val("");});$(".pane .formField").each(function(){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler($(this));validationHandler.hideError();});LBG.showHide.toggleDisplay($(".emailPreference .trigger"));return false;});}});}};LBG.clearValuesOnHide={init:function(){if($(".triggerChild").length&&$(".showHide").length&&$(".typesAndAmounts").length&&$(".amountGroup").length){var wrapperValues=$(".pane .amountGroup .formField");var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(wrapperValues);var triggered=0;$(".searchTransactions .showHide .triggerChild").click(function(){if(triggered>0){formValidationHandler.removeChildren(wrapperValues);formValidationHandler.isValid=false;LBG.Forms.Validation.Tools.setMultipleFieldValidation(wrapperValues);formValidationHandler.hideError();$(".pane .amountGroup input:text").val("");$(".pane .amountGroup .formField input:radio").eq(0).attr("checked",true);}triggered++;});}}};LBG.fixedHeadingHeight={init:function(){$(function(){var sizes=[];if($(".content table.fiveCol thead th strong.autoHeighStrong")){$(".content table.fiveCol thead th strong.autoHeighStrong").each(function(){sizes.push($(this).height());}).css("height",(Math.max.apply(null,sizes)+4)+"px");}sizes=[];if($(".content table.fiveCol thead th p.autoHeightDescription")){$(".content table.fiveCol thead th p.autoHeightDescription").each(function(){sizes.push($(this).height());}).css("height",Math.max.apply(null,sizes)+"px");}sizes=[];if($(".content table.fiveCol thead th a.autoHeightLink")){$(".content table.fiveCol thead th a.autoHeightLink").each(function(){sizes.push($(this).height());}).css("height",Math.max.apply(null,sizes)+"px");$(".content table.fiveCol thead th a.autoHeightLink").each(function(){if($(this).height<Math.max.apply(null,sizes)){$(this).css("line-height",(Math.max.apply(null,sizes)/2+4)+"px");}});}});}};LBG.formAutoSubmit={init:function(){if($("form.samlAutoSubmit").length){$("form.samlAutoSubmit").submit();}}};LBG.managePaperStatements=function(){$("table.preferences.paperstatements").each(function(){var strInputName=DI.lang.managePaperStatements.selectAll.inputName,strLabelText=DI.lang.managePaperStatements.selectAll.labelText;var $table=$(this),$tbody=$table.find("tbody"),$checkboxes=$tbody.find("input:checkbox").not(":disabled"),$rows=$tbody.find("tr"),$cells=null;var $toggleCell=null,$toggleRow=$("<tr />").addClass("selectAll"),$toggleLabel=$("<label />").attr("for",strInputName).html(strLabelText),$toggleInput=$("<input />").attr({type:"checkbox",id:strInputName,name:strInputName});var isSetup=false;if($checkboxes.length<=1){return;}function enableSelectAll(isEnabled){if(isEnabled){$toggleRow.find("label").removeClass("isDisabled");$toggleRow.find("input:checkbox").attr({"disabled":"","checked":""});}else{$toggleRow.find("label").addClass("isDisabled");$toggleRow.find("input:checkbox").attr({"disabled":"disabled","checked":"checked"});}}for(var i=0;i<$rows.length;i++){if(!isSetup&&$rows.eq(i).find("input:checkbox").length){$cells=$rows.eq(i).find("td");for(var j=0;j<$cells.length;j++){$toggleCell=$("<td />");if(j===0){$toggleCell.addClass("first");}if($cells.eq(j).find(":checkbox").length){$toggleLabel.append($toggleInput).appendTo($toggleCell.addClass("selectAll"));}$toggleCell.appendTo($toggleRow);}isSetup=true;break;}}if(!$toggleRow.find("td").length){return;}$tbody.prepend($toggleRow);$tbody.find("tr:odd").removeClass("alt");$tbody.find("tr:even").addClass("alt");if($checkboxes.filter(":checked").length===$checkboxes.length){enableSelectAll(false);}$toggleRow.find("input:checkbox").click(function(){if(this.checked){enableSelectAll(false);$checkboxes.attr("checked","checked");}});$checkboxes.click(function(){if(this.checked&&$checkboxes.filter(":checked").length===$checkboxes.length){enableSelectAll(false);}else{enableSelectAll(true);}});});};LBG.alternateImageSrc=function(){var isID=function(str){return str.substring(1,0)==="#";};var escapeID=function(id){return id.replace(/:/g,"\\:");};var clickHandler=function(event){var meta=$(this).metadata();var $target=$(this);if(meta.target){if(meta.parent){$target=$target.parents(meta.parent).find(meta.target);}else{$target=isID(meta.target)?$(escapeID(meta.target)):$(meta.target);}}$target.each(function(){$(this).attr("src",$(this).metadata().alternateSrc);});};$(".alternateImageSrc").each(function(){var meta=$(this).metadata();if(meta&&(meta.alternateSrc||meta.target)){$(this).one("click",clickHandler);}});};LBG.ajaxLoader=(function(){var wrapperSelector="div.ajaxLoaderPlaceholder";var contentSelector="div.ajaxContent";var contentWrapper='<div class="ajaxContent" />';var errorClassName="ajaxLoaderError";var successClassName="ajaxLoaderSuccess";var errorMessage='<div class="inner"><p>'+DI.lang.ajaxLoader.errorMessage+"</p></div>";return{init:function(){$(wrapperSelector).each(function(i){var $wrapper=$(this);var meta=$(this).metadata();if(meta&&meta.ajaxURI){$.ajax({url:meta.ajaxURI,cache:false,type:"GET",error:function(){$wrapper.addClass(errorClassName).html(errorMessage);},success:function(data){$wrapper.css("height",$wrapper.height()).animate({opacity:0},function(){$wrapper.wrapInner(contentWrapper);var animHeight=$(contentSelector,$wrapper).html(data).height();$wrapper.animate({opacity:1,height:animHeight},function(){$wrapper.addClass(successClassName);});});}});}});}};})();LBG.stpLoanCalculatorSlider={init:function(){var trigger=$(".stpLoanCalculator input"),sliderWrapper='<div class="sliderWrapper"><div class="sliderInnerWrapper"><div class="slider"/></div></div>',btnAmountMore='<span class="sliderIncrease"><a href="#" title="'+DI.stpLoanCalculatorButton.amount.increase+'">'+DI.stpLoanCalculatorButton.amount.increase+"</a></span>",btnAmountLess='<span class="sliderDecrease"><a href="#" title="'+DI.stpLoanCalculatorButton.amount.decrease+'">'+DI.stpLoanCalculatorButton.amount.decrease+"</a></span>",btnMonthMore='<span class="sliderIncrease"><a href="#" title="'+DI.stpLoanCalculatorButton.months.increase+'">'+DI.stpLoanCalculatorButton.months.increase+"</a></span>",btnMonthLess='<span class="sliderDecrease"><a href="#" title="'+DI.stpLoanCalculatorButton.months.decrease+'">'+DI.stpLoanCalculatorButton.months.decrease+"</a></span>";if(!trigger.length){return;}var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(trigger);trigger.each(function(i){var input=$(this),params=input.metadata(),sliderMin=parseInt(input.closest(".formFieldInner").find(".minVal").text().replace(/,/,""),10),sliderMax=parseInt(input.closest(".formFieldInner").find(".maxVal").text().replace(/,/,""),10),interval=(params.sliderInterval)?parseInt(params.sliderInterval,10):1,startOverlay=parseInt(input.closest(".formFieldInner").find(".startBestRate").text().replace(/,/,""),10),endOverlay=parseInt(input.closest(".formFieldInner").find(".endBestRate").text().replace(/,/,""),10),positionOverlay,widthOverlay,slider,oValue,labelUnit;
var formFieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData($(this).closest(".formField")[0],"validationName:")[0];var formFieldValidationHandler=formValidationHandler.getChild(formFieldName);input.closest(".inputWrapper").after(sliderWrapper);slider=input.closest(".inputWrapper").next(".sliderWrapper").find(".slider");slider.slider({min:sliderMin,max:sliderMax,value:input.val().replace(/,/,"")||sliderMin,step:interval,slide:function(event,ui){input.val(ui.value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));},start:function(event,ui){input.val(ui.value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));if(formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;}}});input.focus(function(){if(!(formFieldValidationHandler.isShowingError)){oValue=$(this).val().replace(/,/,"");}});input.blur(function(){var typedVal=$(this).val().replace(/,/,"");if(formFieldValidationHandler.isShowingError&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}});input.bind("keypress",function(e){var typedVal=$(this).val().replace(/,/,"");if(e.keyCode===13&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}});input.change(function(){var typedVal=$(this).val().replace(/,/,""),roundedVal,i;if(typedVal.indexOf(".")!==-1){typedVal=typedVal.substr(0,typedVal.indexOf("."));}if(!isNaN(Math.abs(typedVal))){if(typedVal%interval!==0){roundedVal=Math.round(typedVal/interval)*interval;slider.slider("value",roundedVal);}else{slider.slider("value",typedVal);}}$(this).val(typedVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));});if(i===0){slider.parent().before(btnAmountLess).after(btnAmountMore);}else{slider.parent().before(btnMonthLess).after(btnMonthMore);}$(input.closest(".formFieldInner").find(".sliderDecrease,.sliderIncrease")).bind("click",function(e){var oldVal=parseInt(input.val().replace(/,/,""),10),newVal;if(isNaN(oldVal)){oldVal=sliderMin;}e.preventDefault();if($(this).hasClass("sliderDecrease")){newVal=((oldVal-interval)<sliderMin)?sliderMin:(oldVal-interval);}else{newVal=((oldVal+interval)>sliderMax)?sliderMax:(oldVal+interval);}slider.slider("option","value",newVal);if(newVal>=sliderMin&&newVal<=sliderMax&&formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;}newVal=newVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");input.val(newVal);});if(startOverlay<endOverlay&&startOverlay>=sliderMin&&endOverlay<=sliderMax){positionOverlay=((startOverlay-sliderMin)/(sliderMax-sliderMin))*100;widthOverlay=(((endOverlay-startOverlay)/(sliderMax-sliderMin))*100);input.closest(".formFieldInner").find(".slider").append('<div class="overlayLoanCalculator" style="left:'+positionOverlay+"%; width:"+widthOverlay+'%;"/>');}if(input.prev("span").hasClass("currency")){labelUnit=input.prev("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").prepend(labelUnit);}if(input.next("span").hasClass("durationUnit")){labelUnit=" "+input.next("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").append(labelUnit);}});}};LBG.filterBy={instances:[],selectorInit:"select.filterBy",classTrigger:"filterByTrigger",classMenu:"filterByMenu",classSelected:"selected",classActive:"active",classHover:"hover",classFocus:"focus",classLast:"last",prefixMenuId:"filterById",dataKeyId:"dataFilterById",dataKeyIndex:"dataFilterByIndex",dataKeyValue:"dataFilterByValue",fadeSpeed:100,getInstanceObject:function(menuId){var self;for(var i=0;i<LBG.filterBy.instances.length;i++){if(LBG.filterBy.instances[i].menuId===menuId){self=LBG.filterBy.instances[i];break;}}return self;},getMenuId:function($target){var menuId;if($target[0].tagName.toLowerCase()==="span"&&$target.parent("."+LBG.filterBy.classTrigger).length){$target=$target.parents("."+LBG.filterBy.classTrigger);}if($target.hasClass(LBG.filterBy.classTrigger)){menuId=$target.data(LBG.filterBy.dataKeyId);}else{menuId=$target.parents("ul."+LBG.filterBy.classMenu).attr("id");}return menuId;},init:function(){$(LBG.filterBy.selectorInit).each(function(){var uniqueId=LBG.filterBy.instances.length;var select=this;if(select.options.length){LBG.filterBy.instances.push(new LBG.filterBy.dropDown(select,uniqueId));}});}};LBG.filterBy.dropDown=function(select,uniqueId){this.form=$(select).parents("form");this.$select=$(select).hide();this.$options=$(select).find("option");this.uniqueId=uniqueId;this.menuId=LBG.filterBy.prefixMenuId+uniqueId;this.focusIndex=0;this.$trigger=[];this.$menu=[];this.$menuItems=[];this.setup();};LBG.filterBy.dropDown.prototype={setFocus:function(e){var menuId=LBG.filterBy.getMenuId($(e.target));var isUp=e.keyCode===38;var isDown=e.keyCode===40;var len=0;var self;if(menuId&&(isUp||isDown)){e.preventDefault();e.stopPropagation();self=LBG.filterBy.getInstanceObject(menuId);if(self){len=self.$menuItems.length-1;if(isUp){self.focusIndex=self.focusIndex===0?len:self.focusIndex-1;}if(isDown){self.focusIndex=self.focusIndex===len?0:self.focusIndex+1;}self.$menuItems.eq(self.focusIndex).find("a:first").focus();}}},showMenu:function(){var position={};var height=0;for(var i=0;i<LBG.filterBy.instances.length;i++){if(LBG.filterBy.instances[i].$menu!==this.$menu){LBG.filterBy.instances[i].hideMenu();}}position=this.$trigger.position();height=this.$trigger.outerHeight();this.$menu.css({"top":position.top+height+"px","left":position.left+"px","width":(this.$menu.width()<195)?this.$menu.width():195+"px"}).fadeIn(LBG.filterBy.fadeSpeed);this.$trigger.addClass(LBG.filterBy.classActive);this.focusIndex=this.$menuItems.filter("."+LBG.filterBy.classSelected).find("a:eq(0)").data(LBG.filterBy.dataKeyIndex);$(document).bind("keydown",this.setFocus);},hideMenu:function(){this.$menu.fadeOut(LBG.filterBy.fadeSpeed);this.$trigger.removeClass(LBG.filterBy.classActive);$(document).unbind("keydown",this.setFocus);},toggleMenu:function(e){e.preventDefault();e.stopPropagation();if(this.$menu.is(":hidden")){this.showMenu();}else{this.hideMenu();}return false;},trackFocus:function(e){this.focusIndex=$(e.target).data(LBG.filterBy.dataKeyIndex);},setSelected:function(e){var self=this;var $target=$(e.target);var value=$target.data(LBG.filterBy.dataKeyValue);this.$menuItems.filter("."+LBG.filterBy.classSelected).removeClass(LBG.filterBy.classSelected);$target.parent("li").addClass(LBG.filterBy.classSelected);self.hideMenu();this.$options.each(function(i){if(this.value===value){self.$select.attr("selectedIndex",i);}});self.form.submit();},setup:function(){var self=this;self.$trigger=$("<a />");self.$menu=$("<ul />");self.$trigger.html(self.$select.find("option:eq(0)").html()).attr("tabIndex",0).data(LBG.filterBy.dataKeyId,self.menuId).keydown(function(e){if(e.keyCode===32||e.keyCode===13){$(this).click();return false;}}).addClass(LBG.filterBy.classTrigger).insertBefore(self.$select);self.$trigger.wrapInner($("<span />"));self.$trigger.add(self.$trigger.find("span")).click(function(e){self.toggleMenu(e);});self.$menu.attr("id",self.menuId).addClass(LBG.filterBy.classMenu).insertAfter(self.$trigger);self.$options.each(function(i){if(i>0){var $item=$("<li />");var $link=$("<a />");if(this.selected){$item.addClass(LBG.filterBy.classSelected);
}$link.html(this.text).attr("tabIndex",0).data(LBG.filterBy.dataKeyIndex,i).data(LBG.filterBy.dataKeyValue,this.value).click(function(e){self.setSelected(e);}).focus(function(e){self.trackFocus(e);}).keydown(function(e){if(e.keyCode===32||e.keyCode===13){$(this).click();return false;}}).mouseover(function(e){self.trackFocus(e);}).appendTo($item);$item.appendTo(self.$menu);}});self.$menuItems=self.$menu.find("li");if($.browser.msie&&$.browser.version<7){self.$menuItems.find("a").focus(function(){$(this).parent("li").addClass(LBG.filterBy.classFocus);}).blur(function(){$(this).parent("li").removeClass(LBG.filterBy.classFocus);});self.$menuItems.hover(function(){$(this).addClass(LBG.filterBy.classHover);},function(){$(this).removeClass(LBG.filterBy.classHover);});}if($.browser.msie&&$.browser.version<9){self.$menuItems.filter(":last").addClass(LBG.filterBy.classLast);}$(document).click(function(e){var $target=$(e.target);var isVisible=self.$menu.is(":visible");var isTrigger=$target.hasClass(LBG.filterBy.classTrigger);var isMenu=$target.parents("ul."+LBG.filterBy.classMenu).length;if(isVisible&&!isTrigger&&!isMenu){self.hideMenu();}});}};LBG.radioButtonPanel={init:function(){var $panelSelect=$(".content .optionPanel input:radio.statusToggle");$panelSelect.click(function(){$panelSelect.each(function(){$(this).closest(".subPanel").removeClass("panelSelected");});$(this).closest(".subPanel").addClass("panelSelected");var $panelGroup=$(".content .optionPanel .subPanel");$panelGroup.each(function(){if(!$(this).hasClass(".panelSelected")){$(this).find("input:text").val("");}});});}};LBG.optionPanelDisable={init:function(){var $getDisabled=$(".content .optionPanel .isDisabled");$getDisabled.attr("disabled","disabled");}};LBG.yourInbox={toggleRow:function($rowTrigger){var $rowDetail=$rowTrigger.next("tr.detail");var $checkbox=$rowTrigger.find(":checkbox:eq(0)");if($rowTrigger.hasClass("expanded")){$rowTrigger.removeClass("expanded");$rowDetail.hide();}else{$("tr").removeClass("expanded");$("tr.detail").hide();$rowTrigger.addClass("expanded");$rowDetail.show();}},toggleMainActions:function(isEnable){var $messageTable=$("table.inboxMessageTable");var yourInboxDI=DI.paperlessCorrespondence.yourInbox;var $archive=$("th.selectAll",$messageTable).find("li.archive input");var $delete=$("th.selectAll",$messageTable).find("li.delete input");var isRead=$("td.first input:enabled",$messageTable).length;if(isEnable&&isRead){$archive.removeAttr("disabled").removeClass("isDisabled").attr("src",yourInboxDI.archiveImage.enabled);$delete.removeAttr("disabled").removeClass("isDisabled").attr("src",yourInboxDI.deleteImage.enabled);}else{$archive.addClass("isDisabled").attr({"disabled":true,"src":yourInboxDI.archiveImage.disabled});$delete.addClass("isDisabled").attr({"disabled":true,"src":yourInboxDI.deleteImage.disabled});}},init:function(){var $inboxTable=$("table.inboxMessageTable");LBG.yourInbox.toggleMainActions();$(".messageAction .isDisabled").attr("tabindex","-1");$(".inboxData .infoMessage p.buttonLink a").click(function(){$(this).parents(".infoMessage").slideUp({opacity:"hide"},"slow");});$(".secondary .inboxPanel").click(function(e){var location=$("a:eq(0)",this).attr("href");if(typeof location==="string"&&location!==""){document.location.href=location;}e.preventDefault();});$(".inboxMessageTable .selectAll input").click(function(e){if(this.checked){$(".inboxMessageTable tr.messageRead").addClass("highlight");}else{$(".inboxMessageTable tr.messageRead").removeClass("highlight");}});$(".inboxMessageTable input.msgcheckbox").click(function(e){if(this.checked){$(this).parents("tr").addClass("highlight");}else{$(this).parents("tr").removeClass("highlight");}});$(".inboxMessageTable input.msgcheckbox").click(function(e){e.stopImmediatePropagation();});if(!$inboxTable.length){return;}$inboxTable.find("tr").each(function(){if($(this).hasClass("trigger")){$(this).click(function(event){var tagName=event.target.tagName.toLowerCase();if(tagName!=="input"){event.preventDefault();event.stopPropagation();LBG.yourInbox.toggleRow($(this));}});}if($(this).hasClass("detail")){$(this).hide();}});$inboxTable.find("tr.detail .messageAction").find("li.archive a, li.delete a").click(function(event){var checkbox=$(this).parents("tr.detail").prev().find("td.select input:checkbox")[0];if(checkbox.disabled){event.preventDefault();return false;}return true;});$inboxTable.find("thead th.selectAll").find("li.archive input, li.delete input").click(function(event){var checkbox=$(this).parents("th").find("input:checkbox")[0];if(!checkbox.checked){event.preventDefault();return false;}return true;});$inboxTable.find("thead th.selectAll input:checkbox").click(function(){$(this).parents("table").find("tbody td.select input:checkbox:not(:disabled)").attr("checked",this.checked);LBG.yourInbox.toggleMainActions(this.checked);});$inboxTable.find("tbody td.select input:checkbox").click(function(){var $selectAll=$inboxTable.find("thead th.selectAll");var $rowCheckboxes=$inboxTable.find("tbody td input:checked").length,$rowCheckboxesAll=$inboxTable.find("tbody td.select input:checkbox:not(:disabled)").length;if($rowCheckboxes>=1){LBG.yourInbox.toggleMainActions(true);}else{$inboxTable.find("thead th.selectAll input:checkbox").attr("checked",false);LBG.yourInbox.toggleMainActions(false);}if($rowCheckboxes<$rowCheckboxesAll){$inboxTable.find("thead th input:checkbox:not(:disabled)").attr("checked",false);}else{$inboxTable.find("thead th input:checkbox:not(:disabled)").attr("checked",true);}});$inboxTable.find(".statementLink").one("click",function(){var $rowTrigger=$(this).parents("tr.detail").prev("tr");var $rowDetail=$(this).parents("tr.detail");var $checkbox=$rowTrigger.find(":checkbox:eq(0)");$rowTrigger.removeClass("messageUnread").addClass("messageRead");$rowDetail.removeClass("messageUnread").addClass("messageRead");$checkbox.removeAttr("disabled");$rowDetail.find(".isDisabled").removeClass("isDisabled");});var stopHref=false;var outsideHref=false;$(".inboxMessageTable .messageinfo .overlay").closest(".trigger").click(function(){if($(this).hasClass("expanded")){stopHref=true;$(this).find(".messageinfo a.overlay").keydown();}});$(".inboxMessageTable .messageinfo a").keydown(function(e){if(!stopHref){e.preventDefault();e.stopImmediatePropagation();}else{outsideHref=true;LBG.overlay.open($(this).attr("href"),this,true);stopHref=false;}});$(".inboxMessageTable .messageinfo a").click(function(e){if(!$(this).closest(".trigger").hasClass("expanded")){$(this).closest(".trigger").trigger("click");}else{if(stopHref){if(!outsideHref){e.preventDefault();e.stopImmediatePropagation();}}else{stopHref=true;$(this).closest(".trigger").trigger("click");e.preventDefault();e.stopImmediatePropagation();}}stopHref=false;outsideHref=false;});}};LBG.checkboxSelectAll=(function(){var initSelector=".checkboxSelectAll";var isId=function(str){return str.substring(1,0)==="#";};var escapeId=function(id){return id.replace(/:/g,"\\:");};var getCheckboxes=function(metadata){var $checkboxes=$([]);if(metadata.columns&&metadata.columns.length){for(var i=0;i<metadata.columns.length;i++){$checkboxes=$checkboxes.add(metadata.$target.find("tbody th:nth-child("+metadata.columns[i]+"), tbody td:nth-child("+metadata.columns[i]+")").find("input:checkbox:not(:disabled)"));}}else{$checkboxes=$checkboxes.add(metadata.$target.find("tbody input:checkbox:not(:disabled)"));}return $checkboxes;};var checkStatus=function(event,$trigger){$trigger=$trigger||$(event.target);
var metadata=$trigger.data("metadata"),$checkboxes=getCheckboxes(metadata),isChecked,allChecked;$checkboxes.each(function(){allChecked=true;if($(this).is(":checked")===false){allChecked=false;return allChecked;}return allChecked;});if(allChecked&&$trigger[0]===metadata.$trigger[0]){isChecked=allChecked;metadata.$trigger.attr("checked",isChecked).attr("disabled",isChecked);}else{if($trigger[0]===metadata.$trigger[0]){isChecked=metadata.$trigger.is(":checked");$checkboxes.each(function(){if(!isChecked&&this.checked){$(this).attr("checked","checked");}else{$(this).attr("checked",isChecked);}});metadata.$trigger.attr("disabled",isChecked);}else{isChecked=$checkboxes.filter(":checked").length===$checkboxes.length;metadata.$trigger.attr({"disabled":isChecked,"checked":isChecked});}}};var setup=function($formField){var metadata=$formField.metadata();var $checkboxes;if(typeof metadata.target==="undefined"){return;}metadata.$trigger=$formField.find("input:checkbox:eq(0)");metadata.$target=$(escapeId(metadata.target));if(!metadata.$target.length){return;}$checkboxes=getCheckboxes(metadata);$checkboxes.data("metadata",metadata).click(checkStatus);metadata.$trigger.data("metadata",metadata).click(checkStatus).each(function(){checkStatus(null,$(this));});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();LBG.preventPaste={init:function(){$("input.noPaste").bind("paste",function(e){e.preventDefault();});}};LBG.branchFinder={onlyLloyds:false,allResultsContainer:null,allResults:null,numberItemsDisplay:5,init:function(){LBG.branchFinder.allResultsContainer=$("div.selectBranchAccountSetup div.branchResults");LBG.branchFinder.allResults=LBG.branchFinder.allResultsContainer.find("div.inputGroup");LBG.branchFinder.altRows();$("#slctBranches").change(function(e){if($("#slctBranches option:selected").attr("value")==="onlyLloyds"){LBG.branchFinder.onlyLloyds=true;LBG.branchFinder.goToPage(1);}else{LBG.branchFinder.onlyLloyds=false;LBG.branchFinder.goToPage(1);}});$("div.selectBranchAccountSetup div.paginationSudoButtons li.next input.pseudoLink").click(function(){});},goToPage:function(pageNumber){var localCurrentView=LBG.branchFinder.allResults;var minIndex=(pageNumber-1)*LBG.branchFinder.numberItemsDisplay;var maxIndex=(pageNumber*LBG.branchFinder.numberItemsDisplay)-1;localCurrentView.show();if(LBG.branchFinder.onlyLloyds){localCurrentView=localCurrentView.filter("div.branchDivested").hide();}localCurrentView.filter(":visible").filter(function(index){return index<minIndex||index>maxIndex;}).hide();LBG.branchFinder.altRows();},altRows:function(){var visibleResults=LBG.branchFinder.allResults.filter(":visible");$(visibleResults).each(function(){if($(this).find(".alt")){$(this).find(".alt").removeClass("alt");}});$(visibleResults).filter(":odd").find(".branchDetails").addClass("alt");}};LBG.showMeOrientation={journeyCookieName:"IBCookie04",loadedStubs:[],welcomeBubbleAnchorExceptionConstant:"welcomeShowMeAnchor",doneBubbleAnchorExceptionConstant:"doneShowMeAnchor",showMeSupportAnchorConstant:"showMeSupport",isWelcomeMessage:false,frameIsInjected:false,origialBubbleTopMargin:undefined,bubbleNavigationControls:[".goNext",".goPrev",".close"],currentBubbleControl:0,bubbleControlFocus:".goNext",showMeWebTrends:false,forceJourneyEnd:".bubbleJourneyEnd",thisSlideNumber:0,bubblesToShow:[],bubblesToLookFor:[],match_anchors_to_functions:function(anchor){if(anchor===LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant){LBG.showMeOrientation.isWelcomeMessage=true;LBG.showMeOrientation.welcomeSlide();}else{if(anchor===LBG.showMeOrientation.doneBubbleAnchorExceptionConstant){LBG.showMeOrientation.isWelcomeMessage=false;LBG.showMeOrientation.doneSlide();}else{if(anchor==="welcomeOnly"){LBG.showMeOrientation.welcomeOnlySlide();}else{if(anchor==="accountNameShowMeAnchor"){var $accountAnchorWrapper=$(".accountNameShowMeAnchor").parents(".accountDetails");var $AccountNameTextElement=$accountAnchorWrapper.find("h2 a");var account_name="Account name";if($AccountNameTextElement.text().length>1){account_name=$AccountNameTextElement.text();}$("#showMeOrientation .accountName h2").empty().append(account_name);LBG.showMeOrientation.showBubble("accountName",anchor,"up",10,20);}else{var metadata=$("."+anchor).metadata();var pointer="up";if(metadata.hasOwnProperty("pointer")){pointer=metadata.pointer;}var topPositionOffset=0;if(metadata.hasOwnProperty("topPositionOffset")){topPositionOffset=metadata.topPositionOffset;}var leftPositionOffset=0;if(metadata.hasOwnProperty("leftPositionOffset")){leftPositionOffset=metadata.leftPositionOffset;}if(metadata.hasOwnProperty("bubble")){LBG.showMeOrientation.showBubble(metadata.bubble,anchor,pointer,topPositionOffset,leftPositionOffset);}}}}}},createBubbleIndicators:function(){LBG.showMeOrientation.bubblesToShow.length=0;if(($.inArray(LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant,LBG.showMeOrientation.bubblesToLookFor))>-1){LBG.showMeOrientation.bubblesToShow.push(LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant);}for(var i=0;i<LBG.showMeOrientation.bubblesToLookFor.length;i++){if(($("."+LBG.showMeOrientation.bubblesToLookFor[i]).length>0)&&(LBG.showMeOrientation.bubblesToLookFor[i]!==LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant)&&(LBG.showMeOrientation.bubblesToLookFor[i]!==LBG.showMeOrientation.doneBubbleAnchorExceptionConstant)){LBG.showMeOrientation.bubblesToShow.push(LBG.showMeOrientation.bubblesToLookFor[i]);}}if(($.inArray(LBG.showMeOrientation.doneBubbleAnchorExceptionConstant,LBG.showMeOrientation.bubblesToLookFor))>-1){LBG.showMeOrientation.bubblesToShow.push(LBG.showMeOrientation.doneBubbleAnchorExceptionConstant);}if(LBG.showMeOrientation.bubblesToShow.length>1){$("ul.steps").empty();for(var j=1;j<=LBG.showMeOrientation.bubblesToShow.length;j++){if(j===1){$("ul.steps").append('<li class="first current"><span>'+j+"</span></li>");}else{if(j===LBG.showMeOrientation.bubblesToShow.length){$("ul.steps").append('<li class="last"><span>'+j+"</span></li>");}else{$("ul.steps").append("<li><span>"+j+"</span></li>");}}}$("#showMeOrientation .bubbleControls").css("display","inline");}else{$("#showMeOrientation .bubbleControls").css("display","none");}},welcomeSlide:function(){LBG.showMeOrientation.bubbleControlFocus=".goNext";LBG.showMeOrientation.thisSlideNumber=0;this.scrollPage(0);$("#showMeOrientation a.goPrev").removeClass("restart");$("#showMeOrientation").removeClass("tip").addClass("showMeWelcome");$("#showMeOrientation .bubbleControls").css("display","inline");$("#showMeMask").addClass("show");$("#showMeOrientation a.goNext img").attr({"src":DI.showme.welcomeNextArrow,"alt":DI.showme.welcomeNextAlt}).css("display","inline");$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.welcomePrevArrow,"alt":DI.showme.welcomePrevAlt}).css("display","inline");$("#showMeOrientation a.goNext").css("display","inline");$("#showMeOrientation a.goPrev").css("display","inline");$("ul.steps li").removeClass("current");$("ul.steps li.first").addClass("current");$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .midspace img.welcome").addClass("show");$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace .textContent .welcome").css("display","block");$("#showMeOrientation img.pointUp").css("display","none");$("#showMeOrientation img.pointUpRight").css("display","none");$("#showMeOrientation img.pointRight").css("display","none");
$("#showMeOrientation img.pointLeft").css("display","none");$("#showMeOrientation img.pointDownLeft").css("display","none");$("#showMeOrientation img.pointDownRight").css("display","none");$("#showMeOrientation").animate({top:135,left:"50%",width:"810px"},500,function(){});$(LBG.showMeOrientation.bubbleControlFocus).prev().focus();LBG.showMeOrientation.web_trends("welcome_journey_start");},fade_text:function(in_or_out){var fade=0;if(in_or_out==="in"){fade=1;}$("#showMeOrientation .textContent").animate({opacity:fade},350,function(){});},showBubble:function(bubbleClassName,anchor,pointer,positionTopOffset,positionLeftOffset,metadata){if($("."+anchor).length>0){$("#showMeOrientation img").css("margin-left","");$("#showMeOrientation img.pointRight").removeClass("doneStretch");$("#showMeOrientation").removeClass("showMeWelcome");var arrowTopOffset,arrowLeftOffset;switch(pointer){case"up":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointUp").css("display","block");arrowTopOffset=70;arrowLeftOffset=360;break;case"upRight":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointUpRight").css("display","block");arrowTopOffset=70;arrowLeftOffset=0;break;case"left":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointLeft").css("display","block");arrowTopOffset=-12;arrowLeftOffset=500;break;case"right":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointRight").css("display","block");arrowTopOffset=-20;arrowLeftOffset=-10;if($.browser.msie&&parseInt($.browser.version)<8){arrowTopOffset=-10;}break;case"downLeft":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointDownLeft").css("display","block");arrowTopOffset=35;arrowLeftOffset=360;break;default:LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointUp").css("display","block");arrowTopOffset=70;arrowLeftOffset=360;break;}if((positionTopOffset>0)||(positionTopOffset<0)){arrowTopOffset=arrowTopOffset+positionTopOffset;}if((positionLeftOffset>0)||(positionLeftOffset<0)){arrowLeftOffset=arrowLeftOffset+positionLeftOffset;}if(anchor===LBG.showMeOrientation.showMeSupportAnchorConstant){LBG.showMeOrientation.thisSlideNumber=0;}$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .textContent").animate({opacity:0},350,function(){$("#showMeOrientation").addClass("tip");$("#showMeMask").removeClass("show");$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace ."+bubbleClassName).css("display","block");$("#showMeOrientation a.goNext img").attr({"src":DI.showme.standardNextTip,"alt":DI.showme.standardNextTipAlt});$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.standardPrevTip,"alt":DI.showme.standardPrevTipAlt});if(LBG.showMeOrientation.thisSlideNumber===0){$("#showMeOrientation a.goPrev img").css("display","none");$("#showMeOrientation a.goPrev").css("display","none");$("#showMeOrientation a.goNext img").css("display","inline");$("#showMeOrientation a.goNext").css("display","inline");$(LBG.showMeOrientation.bubbleControlFocus).focus();}else{if((LBG.showMeOrientation.thisSlideNumber+1)===LBG.showMeOrientation.bubblesToShow.length){$("#showMeOrientation a.goPrev img").css("display","inline");$("#showMeOrientation a.goPrev").css("display","inline");$("#showMeOrientation a.goNext img").css("display","none");$("#showMeOrientation a.goNext").css("display","none");LBG.showMeOrientation.bubbleControlFocus=".goPrev";$(LBG.showMeOrientation.bubbleControlFocus).focus();}else{if(LBG.showMeOrientation.isWelcomeMessage===true&&((LBG.showMeOrientation.thisSlideNumber+2)===LBG.showMeOrientation.bubblesToShow.length)){$("#showMeOrientation a.goNext img").attr({"src":DI.showme.standardNextArrow,"alt":DI.showme.standardNextArrowAlt});}else{if(LBG.showMeOrientation.isWelcomeMessage===true&&((LBG.showMeOrientation.thisSlideNumber)===1)){$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.standardPrevArrow,"alt":DI.showme.standardPrevArrowAlt});}else{$("#showMeOrientation a.goPrev").css("display","inline");$("#showMeOrientation a.goNext").css("display","inline");$("#showMeOrientation a.goPrev img").css("display","inline");$("#showMeOrientation a.goNext img").css("display","inline");}}}}if(bubbleClassName==="showMeSupport"){$(".showmMeSupport > li:first").focus();}else{if($("#showMeOrientation a.goNext img:visible").length>0||$("#showMeOrientation a.goPrev img:visible").length>0){$(LBG.showMeOrientation.bubbleControlFocus).focus();}else{$("#showMeOrientation .close").focus();}}});var p=$("."+anchor);var position=p.offset();var thisBubbleHeight=$("#showMeOrientation > .showWrap:visible:last").height();var thisBubbleContentHight=$("#showMeOrientation .textContent:visible:last").height();var isBottomArrow=(pointer==="downLeft"||pointer==="downRight");var newContentHeight=$("."+bubbleClassName+":last").height();var offsetTop=position.top;var offsetCorrection=newContentHeight-thisBubbleContentHight;if(isBottomArrow){if(LBG.showMeOrientation.origialBubbleTopMargin===undefined){LBG.showMeOrientation.origialBubbleTopMargin=(Number($("#showMeOrientation .pointDownLeft:first").css("marginTop").replace("px","")));}if(newContentHeight!==thisBubbleContentHight){offsetCorrection=newContentHeight-thisBubbleContentHight;}offsetTop=position.top-thisBubbleHeight-offsetCorrection;}else{offsetTop=position.top+arrowTopOffset;offsetCorrection=0;}var width=bubbleClassName==="showMeSupport"?"396px":"480px";$("#showMeOrientation").animate({top:offsetTop,left:position.left+arrowLeftOffset,width:width},500,function(){if($(".showMeSupport:visible").length>0){$(".showMeSupport li a:first").focus();}});if(pointer!=="downLeft"){LBG.showMeOrientation.scrollPage(position.top-100);}LBG.showMeOrientation.fade_text("in");}$("#showMeOrientation .midspace .textContent div").filter(":visible").focus();var bubbleMetaData=$("."+anchor).metadata();LBG.showMeOrientation.web_trends(bubbleClassName,bubbleMetaData);},doneSlide:function(){LBG.showMeOrientation.thisSlideNumber=LBG.showMeOrientation.bubblesToShow.length+1;this.scrollPage(0);$("#showMeOrientation a.goPrev").addClass("restart");$("#showMeMask").removeClass("show");$("#showMeOrientation a.goNext img").attr({"src":DI.showme.doneNextArrow,"alt":DI.showme.doneNextArrowAlt});$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.donePrevArrow,"alt":DI.showme.donePrevArrowAlt});$("#showMeOrientation a.goNext").css("display","inline");$("#showMeOrientation a.goPrev").css("display","inline");$("ul.steps li").removeClass("current");$("ul.steps li.last").addClass("current");$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .midspace img.done").addClass("show");$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace .textContent .done").css("display","block");LBG.showMeOrientation.hide_all_bubble_arrows();var is_button_visible=$(".showMeSupportLinkShowMeAnchor").parents("div").hasClass("selected");var p=$(".showMeSupportLinkShowMeAnchor");if(is_button_visible===false){p=$(".showMeSupportLinkShowMeAnchor").parents(".part").find("h2");}var ie7Offset=($.browser.msie===true&&Number($.browser.version)===7)?7:20;if($(".showMeSupportLinkShowMeAnchor").length>0){$("#showMeOrientation img.pointRight").css("display","block").addClass("doneStretch");$("#showMeOrientation .bubbleControls").addClass("lastBubble");var position=p.offset();
$("#showMeOrientation").animate({top:position.top-ie7Offset,left:position.left-300,width:680},500,function(){});}else{$("#showMeOrientation").animate({top:135,left:"50%",width:"700px"},500,function(){});}LBG.showMeOrientation.web_trends("welcome_journey_done");},welcomeOnlySlide:function(){LBG.showMeOrientation.thisSlideNumber=LBG.showMeOrientation.bubblesToShow.length+1;this.scrollPage(0);$("#showMeOrientation a.goPrev").addClass("restart");$("#showMeOrientation").addClass("tip showMeWelcome");$("#showMeMask").removeClass("show");$("#showMeOrientation a.goNext img").attr("src",DI.showme.doneNextArrow);$("#showMeOrientation a.goPrev img").css("display","none");$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .midspace img.welcome").addClass("show");$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace .textContent .welcomeOnly").css("display","block").css("width","375px");LBG.showMeOrientation.hide_all_bubble_arrows();if($(".showMeSupportLinkShowMeAnchor").length>0){$("#showMeOrientation img.pointRight").css("display","block").css("margin-left","759px");var p=$(".showMeSupportLinkShowMeAnchor");var position=p.offset();$("#showMeOrientation").animate({top:position.top-15,left:position.left-420,width:810},500,function(){});}else{$("#showMeOrientation").animate({top:135,left:"68%",width:"810px"},500,function(){});}},checkForNudge:function(){var container_metadata=$(".showMeContainer").metadata();if(container_metadata.hasOwnProperty("nudge")){var nudgeJourneyKey=container_metadata.nudge;return nudgeJourneyKey;}else{return false;}},scrollPage:function(y){$("html, body").animate({scrollTop:y},500);},setCookie:function(cookieName,cookieValue){if($(LBG.showMeOrientation.forceJourneyEnd).length<1){document.cookie=cookieName+"="+cookieValue+";path=/";}},getCookie:function(get_cookie_name){var noCookie=true;var i,cookieName,cookieVal,ARRcookies=document.cookie.split(";");for(i=0;i<ARRcookies.length;i++){cookieName=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));cookieVal=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);cookieName=cookieName.replace(/^\s+|\s+$/g,"");if(cookieName===get_cookie_name){if((cookieVal.length>0)&&(cookieVal!=="false")){noCookie=false;return cookieVal;}}}if(noCookie===true){return false;}},removeCookie:function(cookieName){document.cookie=cookieName+"= "+";expires=Thu, 01 Jan 1970 00:00:01 GMT"+";path=/";},collapseToShowMe:function(){LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.hide_all_bubble_arrows();var is_button_visible=$(".showMeSupportLinkShowMeAnchor").parents(".part").hasClass("selected");var closeTo=$(".showMeSupportLinkShowMeAnchor");if(is_button_visible===false){closeTo=$(".showMeSupportLinkShowMeAnchor").parents(".part").find("h2");}var curHeight=$("#showMeOrientation").height();var position=closeTo.offset(),topPos=position.top-15,leftPos=position.left+85,width=0,currentLeft=$("#showMeOrientation").offset().left,params={top:topPos,left:leftPos,width:0,margin:0};if($(".showMeSupportLinkShowMeAnchor").length>0){$("#showMeOrientation").css({left:currentLeft}).animate(params,850,function(){$(this).css({top:135,left:"50%",width:"810px",marginTop:-60,marginLeft:-405,display:"none"});$("#showMeMask").removeClass("show");});}else{$("#showMeOrientation").css("display","none");$("#showMeMask").removeClass("show");}},showMeSupportClicks:function($clicked_element){var link_metadata=$clicked_element.metadata();var existing_content=$(".showMeContainer #showMeOrientation .textContent").html();LBG.showMeOrientation.setCookie(LBG.showMeOrientation.journeyCookieName,link_metadata.journeyKey);var i=$(".showMeContainer").metadata();if(i.journeyKeys.lastIndexOf(link_metadata.journeyKey)!==-1){if($.inArray(link_metadata.journeyKey,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").empty();$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+link_metadata.journeyKey+DI.showme.stubFileExtension,function(responseText,textStatus,req){if(textStatus==="error"){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}if(textStatus==="success"){LBG.showMeOrientation.setCookie(LBG.showMeOrientation.journeyCookieName,link_metadata.journeyKey);$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(link_metadata.journeyKey);LBG.showMeOrientation.invokeJourneyFromKey(link_metadata.journeyKey);}});}else{LBG.showMeOrientation.invokeJourneyFromKey(link_metadata.journeyKey);}}else{if($(".backToAccountsAnchor").length>0){$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("backToAccountOverview","backToAccountsAnchor","up");}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}}},invokeJourneyFromKey:function(journey_key){if(journey_key.length>0){var container_metadata=$(".showMeContainer").metadata();var journey_arrays=container_metadata.journeyKeys.split(";");var journey_anchors=[];var found=false;var i;for(i=0;i<journey_arrays.length;i++){var kee=journey_arrays[i].split(":");if(kee[0]===journey_key){journey_anchors=kee[1].split(",");found=true;}}if(found===true){LBG.showMeOrientation.setCookie(LBG.showMeOrientation.journeyCookieName,journey_key);LBG.showMeOrientation.bubblesToLookFor=journey_anchors;LBG.showMeOrientation.createBubbleIndicators();if(LBG.showMeOrientation.bubblesToShow.length>0){LBG.showMeOrientation.match_anchors_to_functions(LBG.showMeOrientation.bubblesToShow[0]);}else{if($(".backToAccountsAnchor").length>0){$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("backToAccountOverview","backToAccountsAnchor","up");}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}}}else{if($(".backToAccountsAnchor").length>0){$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("backToAccountOverview","backToAccountsAnchor","up");}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}}}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}},isCurrentJourneyInTheShowMeMetadata:function(){var current_journey=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);if(current_journey!==false){var container_metadata=$(".showMeContainer").metadata();var journey_arrays=container_metadata.journeyKeys.split(";");var i;var found=false;for(i=0;i<journey_arrays.length;i++){var kee=journey_arrays[i].split(":");if(kee[0]===current_journey){found=true;}}return found;}else{return false;}},hide_all_bubble_arrows:function(){$("#showMeOrientation img.pointUp").css("display","none");$("#showMeOrientation img.pointUpRight").css("display","none");$("#showMeOrientation img.pointRight").css("display","none");$("#showMeOrientation img.pointLeft").css("display","none");
$("#showMeOrientation img.pointDownLeft").css("display","none");$("#showMeOrientation img.pointDownRight").css("display","none");},web_trends:function(bubble_identifier,bubbleMetaData){var time=new Date().toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");var date=new Date();var datestring=("0"+(date.getMonth()+1).toString()).substr(-2)+"/"+("0"+date.getDate().toString()).substr(-2)+"/"+(date.getFullYear().toString()).substr(2);if(typeof WebTrends!=="undefined"){if(LBG.showMeOrientation.showMeWebTrends===false){}if(typeof bubbleMetaData!="undefined"){var dcsuri=location.pathname.slice(-1)==="/"?location.pathname+bubble_identifier:location.pathname+"/"+bubble_identifier;LBG.track("WT.ti",bubble_identifier,"DCS.dcsuri",dcsuri,"WT.dl","77","dcsext.pagename",bubbleMetaData.pagename,"DCSext.overlayid",bubbleMetaData.module,"DCSext.content",bubbleMetaData.content,"WT.tx_it",time,"WT.tx_id",datestring);}else{LBG.track("WT.ti",bubble_identifier,"WT.dl","77","WT.tx_it",time,"WT.tx_id",datestring);}}},init:function(){if($(".showMeContainer").length>0){LBG.showMeOrientation.thisSlideNumber=0;$(".showMeMenu ul").prepend(DI.showme.showMeMenuButton);var item=1;$("li.showMeItem").each(function(index){if(item!==1){$(this).remove();}item=2;});var current_journey=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);var nudge=LBG.showMeOrientation.checkForNudge();var existing_content="";if(current_journey!==false){if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;if($.inArray(current_journey,LBG.showMeOrientation.loadedStubs)===-1){existing_content=$(".showMeContainer #showMeOrientation .textContent").html();$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+current_journey+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(current_journey);LBG.showMeOrientation.invokeJourneyFromKey(current_journey);});}else{LBG.showMeOrientation.invokeJourneyFromKey(current_journey);}});}else{if($.inArray(current_journey,LBG.showMeOrientation.loadedStubs)===-1){existing_content=$(".showMeContainer #showMeOrientation .textContent").html();$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+current_journey+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(current_journey);LBG.showMeOrientation.invokeJourneyFromKey(current_journey);});}else{LBG.showMeOrientation.invokeJourneyFromKey(current_journey);}}}else{if(nudge!==false){if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;existing_content=$(".showMeContainer #showMeOrientation .textContent").html();if($.inArray(nudge,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+nudge+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(nudge);LBG.showMeOrientation.invokeJourneyFromKey(nudge);});}else{LBG.showMeOrientation.invokeJourneyFromKey(nudge);}});}else{existing_content=$(".showMeContainer #showMeOrientation .textContent").html();if($.inArray(nudge,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+nudge+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(nudge);LBG.showMeOrientation.invokeJourneyFromKey(nudge);});}else{LBG.showMeOrientation.invokeJourneyFromKey(nudge);}}}else{$("#showMeOrientation").css("display","none");$("#showMeMask").removeClass("show");}}$("a.close").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.isWelcomeMessage=false;LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.collapseToShowMe();LBG.showMeOrientation.web_trends("close");});$("a.goNext").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber++;var thisAnchor=LBG.showMeOrientation.bubblesToShow[LBG.showMeOrientation.thisSlideNumber];var $currentStepNum=$("ul.steps li.current");var $nextStepNum=$("ul.steps li.current").next();$currentStepNum.removeClass("current");$nextStepNum.addClass("current");if(LBG.showMeOrientation.thisSlideNumber===(LBG.showMeOrientation.bubblesToShow.length+2)){LBG.showMeOrientation.thisSlideNumber=0;$(".restart").removeClass("restart");LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.collapseToShowMe();}else{LBG.showMeOrientation.match_anchors_to_functions(thisAnchor);}});$("a.goPrev").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber--;var thisAnchor=LBG.showMeOrientation.bubblesToShow[LBG.showMeOrientation.thisSlideNumber];var $totalSteps=$("ul.steps li").length;var $currentStepNum=$("ul.steps li.current");var $prevStepNum=$("ul.steps li.current").prev();$currentStepNum.removeClass("current");$prevStepNum.addClass("current");if(LBG.showMeOrientation.thisSlideNumber===-1){$("#showMeMask").removeClass("show");LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.collapseToShowMe();}else{if($(this).hasClass("restart")){LBG.showMeOrientation.welcomeSlide();}else{LBG.showMeOrientation.match_anchors_to_functions(thisAnchor);}}});$("#showMeOrientation .showMeSupport a").live("click",function(e){e.preventDefault();var $cligged=$(this);if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;LBG.showMeOrientation.showMeSupportClicks($cligged);});}else{LBG.showMeOrientation.showMeSupportClicks($cligged);}});$("a.showMeSupportLinkShowMeAnchor").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.isWelcomeMessage=false;var node=e?$(e.target):$(window.event.srcElement);var metadata=node.metadata();var nodename=node.nodeName;var pointer="right";if(metadata.hasOwnProperty("pointer")){pointer=metadata.pointer;}var topPositionOffset=0;if(metadata.hasOwnProperty("topPositionOffset")){topPositionOffset=metadata.topPositionOffset;}var leftPositionOffset=0;if(metadata.hasOwnProperty("leftPositionOffset")){leftPositionOffset=metadata.leftPositionOffset;}var existing_contents="";if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;
existing_contents=$(".showMeContainer #showMeOrientation .textContent").html();if($.inArray(DI.showme.menuStubFile,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.menuStubFile,function(){$("#showMeOrientation .bubbleControls").css("display","none");$(".showMeContainer #showMeOrientation .textContent").prepend(existing_contents);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(DI.showme.menuStubFile);LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);});}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);}});}else{existing_contents=$(".showMeContainer #showMeOrientation .textContent").html();if($.inArray(DI.showme.menuStubFile,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.menuStubFile,function(){$("#showMeOrientation .bubbleControls").css("display","none");$(".showMeContainer #showMeOrientation .textContent").prepend(existing_contents);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(DI.showme.menuStubFile);LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);});}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);}}LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointRight").css("display","block");$(".showMeSupport ul li").focus();LBG.showMeOrientation.web_trends("show_me_menu");});document.onmousedown=function(evt){var $clicked_thing=evt?$(evt.target):$(window.event.srcElement);var cookie_running=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);if($clicked_thing.hasClass("backToAccountsAnchor")){var sameJourney=LBG.showMeOrientation.isCurrentJourneyInTheShowMeMetadata();if(sameJourney===true){var current_journey=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);var metadata=$(".showMeContainer").metadata();var journey_arrays=metadata.journeyKeys.split(";");var i;var classes;var classCount=0;var killCookie=true;for(i=0;i<journey_arrays.length;i++){var kee=journey_arrays[i].split(":");if(kee[0]===current_journey){classes=kee[1].split(",");for(var j=0;j<classes.length;j++){var currentClass="."+classes[j];classCount+=$(currentClass).length;}}}if(classCount===0){killCookie=false;}if(killCookie){LBG.showMeOrientation.collapseToShowMe();LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);}else{killCookie=true;LBG.showMeOrientation.collapseToShowMe();}}}else{if(($clicked_thing.hasClass(cookie_running))||($clicked_thing.parents("a").hasClass(cookie_running))){}else{if($clicked_thing.parents(".showMeContainer").length>0){}else{if(($clicked_thing.hasClass("showMeSupportLinkShowMeAnchor"))||($clicked_thing.parents("a").hasClass("showMeSupportLinkShowMeAnchor"))){}else{if(($clicked_thing.parents().hasClass("retainCookieSetup"))){if($("#showMeOrientation").is(":visible")){LBG.showMeOrientation.collapseToShowMe();}}else{var tagType=$clicked_thing.attr("tagName");var parentType=$clicked_thing.parent().attr("tagName");var exceptions=["A"];if(($.inArray(tagType,exceptions)!==-1)||($.inArray(parentType,exceptions)!==-1)){LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.thisSlideNumber=0;if($("#showMeOrientation").is(":visible")){LBG.showMeOrientation.collapseToShowMe();}}}}}}}};if($(LBG.showMeOrientation.forceJourneyEnd).length>0){LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);}}else{LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);}}};LBG.iadaUtilities={parameters:{ajaxUserNameCheckSelector:"input[class*=ajaxUserNameCheck]:first",focusOnSuccess:"#passwordField"},addAnimation:function(){var $loaderAnimation=$("<div/>").append("<span class='loading' />&nbsp;"+DI.lang.ajaxLoader.waitMessage);$("input[class*=ajaxUserNameCheck]:first").after($loaderAnimation);},removeAnimation:function(){$("span.loading").parent("div").remove();},ajaxUserNameCheck:function(){var $ajaxUserNameCheck=$(LBG.iadaUtilities.parameters.ajaxUserNameCheckSelector);if($ajaxUserNameCheck.parents(".error").length){return false;}var classSelector=$ajaxUserNameCheck.attr("class").split(" ");jsonURLSelector="url";var v=classSelector;for(var i=0;i<v.length;i++){var test=v[i].search(/ajaxUserNameCheck/);if(test){classSelector.splice(i,1);classSelector=classSelector[0].replace("ajaxUserNameCheck","url");}}LBG.iadaUtilities.removeSuggestions();var jsonURL=DI.iada.userName[classSelector]+"?userName="+$ajaxUserNameCheck.val()+"&_"+new Date().getTime();LBG.iadaUtilities.addAnimation();$.getJSON(jsonURL,function(data){LBG.iadaUtilities.removeAnimation();if(data.userName.length>0){var $suggestionsText=$("<p class='userNameSuggestions note informational'/>"),$suggestions=$("<ul class='userNameSuggestionsList note informational' />");if($ajaxUserNameCheck.next().hasClass("note")){$ajaxUserNameCheck.next().css("display","none");}$(data.userName).each(function(index){var $li=$('<li><a href="#"></a></li>');$("a",$li).text(data.userName[index]);$suggestions.append($li);});$suggestionsText.append(data.displayText);$("input[class*=ajaxUserNameCheck]:first").after($suggestionsText);$(".userNameSuggestions:first").after($suggestions);var h=$(".userNameSuggestionsList").height();$(".userNameSuggestionsList").css("height",h);}else{return true;}});},removeSuggestions:function(){$(".userNameSuggestions, .userNameSuggestionsList").remove();$(".iada p:hidden").css("display","block");},deleteFormContent:function(){LBG.iadaUtilities.removeSuggestions();$(this).val("");},listeners:function(){$("input[class*=ajaxUserNameCheck]").blur(this.ajaxUserNameCheck);$("input[class*=ajaxUserNameCheck]").focus(function(){LBG.iadaUtilities.removeSuggestions();$(this).val("");});$(".userNameSuggestionsList a").live("click",function(e){e.preventDefault();$(this).find(":hidden").css("display","block");var $this=$(e.target);$("input[class*=ajaxUserNameCheck]:first").val($this.text());LBG.iadaUtilities.removeSuggestions();$(this).val("");if(LBG.iadaUtilities.parameters.focusOnSuccess){$(LBG.iadaUtilities.parameters.focusOnSuccess).focus();}return false;});$('.iada input[name="applyForISA"]').click(function(){if($(this).val()==="yes"){$(".conditionalFields").show("slow");}else{$(".conditionalFields").hide("slow");}});},init:function(){this.listeners();}};LBG.selectReference=(function(initSelector,textSelector,dropDownSelector){var setup=function($formField){$(dropDownSelector,$formField).change(function(){var $input=$(this).parents(initSelector).parent().find(textSelector),$option=$("option:selected",this),metadata=$option.metadata(),$refhelp=$(this).parents(initSelector).nextAll(".showHide").eq(0);if(typeof metadata==="undefined"||!$input.length){return;}if($option.attr("disabled")){metadata.reference="";}$input.val(metadata.reference);if(metadata.reference){$refhelp.show();}else{$refhelp.hide();$input.removeAttr("disabled","disabled").removeClass("isDisabled");}if(metadata.hide){$(metadata.hide).hide();
}});};return{init:function(){$(initSelector).each(function(){setup($(this));$(dropDownSelector,this).trigger("change");});}};});LBG.beneficaryReference=(function(){return LBG.selectReference(".formField.beneficaryReference",".formField.beneficaryReferenceLinkedTextField input:text","select.existingPayee");})();LBG.isaTopUpReference=(function(){return LBG.selectReference(".formField.isaTopUpReference","div.dcfModule","select.isaTopUpAccount");})();LBG.multichannel={selectChipAndPinValue:function(){var selectedVal=$('fieldset.multichannel input[type="radio"]:checked').val();if($('fieldset.multichannel input[name$="confirmCheckboxTelephony"]').size()!=0){$('fieldset.multichannel input[name$="confirmCheckboxTelephony"]').attr("checked",false);}if(selectedVal==="available"){$("fieldset.multichannel .chipAndPinAvailableInfo").show();$("fieldset.multichannel .chipAndPinUnavailableInfo").hide();$("fieldset.multichannel .chipAndPinSelected").val("available");}else{$("fieldset.multichannel .chipAndPinUnavailableInfo").show();$("fieldset.multichannel .chipAndPinAvailableInfo").hide();$('fieldset.multichannel .chipAndPinUnavailableInfo input[type="checkbox"]').attr("checked",false);$("fieldset.multichannel .chipAndPinSelected").val("unavailable");}},selectReasonForWaiver:function(){if($(".content dl.summary .descriptionGroup").find(":checkbox").attr("checked")===true){$(".content dl.summary .descriptionGroup select").attr("disabled",false);}else{$(".content dl.summary .descriptionGroup select").attr("disabled",true);$(".content fieldset.select_account select").attr("disabled",false);}var totalCostVal=$(".content dl.summary .descriptionGroup em").text();$(".content dl.summary .descriptionGroup").find(":checkbox").click(function(){if($(this).attr("checked")===true){$(".content dl.summary .descriptionGroup select").attr("disabled",false);}else{$(".content dl.summary .descriptionGroup select").attr("disabled",true);$(".content dl.summary .descriptionGroup select").val("-");$(".content dl.summary .descriptionGroup em").text(totalCostVal);$(".content fieldset.select_account select").attr("disabled",false);}});},updateTotalCosts:function(){var totalCostVal=$(".content dl.summary .descriptionGroup em").text();$(".content dl.summary .descriptionGroup select").change(function(){if($(this).val()!="-"){$(".content dl.summary .descriptionGroup em").text("£0");$(".content fieldset.select_account select").attr("disabled","true");}else{$(".content dl.summary .descriptionGroup em").text(totalCostVal);$(".content fieldset.select_account select").attr("disabled",false);}});},showReasonText:function(){$(".content .manageAuthPassword,.content .manageAuthDomain").hide();$(".content p.manageAuthReasonLabel,.content .manageAuthReasonText").hide();if($(".content .manageAuthReasonText").siblings(".error").length>0){$(".content .manageAuthReasonText").siblings(".error").remove();}if($(".content .manageAuthReasonText").parent().parent().hasClass(".error")===true){$(".content .manageAuthReasonText").parent().parent().removeClass("error");}var selectedRadioval=$(".content .formField.stackedField .radioGroup.managerAuthGroup").find(":radio:checked").val();if(selectedRadioval==="1"){$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").hide();}else{$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").show();}$(".content .formField.stackedField .radioGroup.managerAuthGroup").find(":radio").click(function(){if($(this).val()==="2"){$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").show();$(".content .manageAuthPassword").show();$(".content .manageAuthDomain").show();$(".content .manageAuthPasswordRequired").hide();$(".content .manageAuthDomainRequired").hide();}else{if($(".content .manageAuthReasonText").siblings(".error").length>0){$(".content .manageAuthReasonText").siblings(".error").remove();}if($(".content .manageAuthReasonText").parent().parent().hasClass(".error")===true){$(".content .manageAuthReasonText").parent().parent().removeClass("error");}$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").hide();$(".content .manageAuthPassword").hide();$(".content .manageAuthDomain").hide();$(".content .manageAuthPasswordRequired").show();$(".content .manageAuthDomainRequired").show();}});},init:function(){LBG.multichannel.selectChipAndPinValue();LBG.multichannel.selectReasonForWaiver();LBG.multichannel.updateTotalCosts();LBG.multichannel.showReasonText();$('fieldset.multichannel input[type="radio"]').click(function(){LBG.multichannel.selectChipAndPinValue();});$("fieldset.multichannel #initiateChipAndPin").click(function(event){event.preventDefault();event.stopPropagation();try{var AGCI=new ActiveXObject("AGCI.functionCall");}catch(e){}var temp=[],alias="PEDIDV",data="<root><data>PEDIDV</data></root>";if(AGCI){var responseObject=AGCI.doFunction(alias,data,temp);if(responseObject){$("fieldset.multichannel #chipAndPinRespPBS").val(responseObject);}}});}};LBG.fatcaNationality=(function(){var initSelector="fieldset.fatcaNationality .nationalityContext",legacyInitSelector="fieldset.fatcaNationality",addSelector="div.addNationality",nationalitySelector="div.formField.nationality";var checkLimit=function($wrapper){var $formFields=$wrapper.find(nationalitySelector),$addWrapper=$wrapper.find(addSelector);if($formFields.filter(":visible").length!==$formFields.length){$addWrapper.show();}else{$addWrapper.hide();}};var updateLabel=function($formField){$formField.find("label").each(function(){var meta=$(this).metadata();if(typeof meta.altLabel==="string"){$(this).html(meta.altLabel);}});};var setup=function($wrapper){var $formFields=$wrapper.find(nationalitySelector),$addWrapper=$wrapper.find(addSelector),$selects=$formFields.find("select"),$sudoButtons=$formFields.find("ul.sudoButtons");$formFields.each(function(i){var $select=$(this).find("select");var threshold=1;if($wrapper.hasClass("taxResidencies")){threshold--;}$select.data("options",$select.find("option"));updateLabel($(this));if($select.val()==="-"&&i>threshold){$(this).hide();}});$selects.each(function(){var formField=$(this).parents(".formField");$(this).change(function(){var vals=$selects.map(function(){return $.trim($(this).val());});if("-"!==$.trim($(this).val())){formField.removeClass("error").find("span.error").remove();}$selects.each(function(){$("span",this).each(function(){if(-1===$.inArray($.trim($(this).attr("data-val")),vals)){var option=$("<option/>").val($(this).attr("data-val")).text($(this).text());$(this).before(option).remove();}});var pIndex=this.selectedIndex;$("option",this).filter(function(){if(pIndex==this.index){return false;}var myval=$.trim(this.value);return -1!==$.inArray(myval,vals)&&"-"!==myval;}).each(function(){var clone=$("<span/>").attr("data-val",$(this).val()).text($(this).text());$(this).before(clone).remove();});});});});setTimeout(function(){$selects.change();},0);$sudoButtons.find("input").click(function(e){var ctx=$(this).parents(legacyInitSelector);var idx=$("input.pseudoLink",ctx).index(this);var me=ctx.find(nationalitySelector).eq(idx+(ctx.is(".taxResidencies")?0:1));if(me.nextAll(nationalitySelector+":visible").length<1){$("option:selected",this).removeAttr("selected");ctx.find(nationalitySelector).eq(1).hide();}me.nextAll(nationalitySelector+":visible").each(function(){var next=$(this).next(nationalitySelector+":visible");if(next.length>0&&next.is(":visible")){var opt=document.createElement("option");opt.value=$("select",next).val();opt.text=$("select",next).find("option:selected").text();
var optindex=$("select",next).find("option:selected")[0].index;$("select",this)[0].add(opt);$("select",this).val(opt.value);$("select",this).html($("select option",this).sort(function(a,b){return a.text==b.text?0:a.text<b.text?-1:1;}));}else{$("option:selected",this).removeAttr("selected");$(this).hide();}});$(nationalitySelector+" select:not(:visible)",ctx).val("-").change();checkLimit($wrapper);e.preventDefault();});checkLimit($wrapper);$addWrapper.find("a").click(function(e){e.preventDefault();var $visible=$formFields.filter(":visible");var index=$formFields.index($visible[$visible.length-1]);var validationHandler;var fieldInvalid=false;var blnRequiredValidationAddedDynamically=false;$visible.each(function(i){var $current=$($visible[i]);if($current.find("select option:selected").val()==="-"){validationHandler=LBG.Forms.Validation.Tools.getFieldHandler($current);if(!validationHandler.validationRoutines.required){blnRequiredValidationAddedDynamically=true;validationHandler.validationRoutines.push("required");validationHandler.validationRoutines.required={msg:"validateSelect"};}validationHandler.validate();if(blnRequiredValidationAddedDynamically){delete validationHandler.validationRoutines.required;validationHandler.validationRoutines.splice($.inArray("required",validationHandler.validationRoutines),1);}fieldInvalid=true;}});if(fieldInvalid){return false;}$formFields.eq(index+1).find('option[value="-"]').attr("selected","selected");$formFields.eq(index+1).show();$formFields.eq(index+1).find("select").focus();checkLimit($wrapper);});};return{init:function(){$initElements=$(initSelector);if(!$initElements.length){$initElements=$(legacyInitSelector);}$initElements.each(function(){setup($(this));});}};})();LBG.appointmentBookings={init:function(){if($(".appointment-booker").length>0){LBG.appointmentBookings.page_load_setup();$(".appointment-booker tbody th a").click(function(e){e.preventDefault();if($(this).hasClass("closed")){$(this).removeClass("closed");$(this).parents("tr").find("td span").slideDown("slow");}else{$(this).addClass("closed");$(this).parents("tr").find("td span").slideUp("slow");}});$(".appointment-booker tbody td a").click(function(e){e.preventDefault();$(".appointment-booker tbody td a").removeClass("selected");$(this).addClass("selected");$(this).parents(".appointment-booker tr td").find("input[type=radio]").attr("checked","checked");target_val=$(this).attr("href").substr(1);$(".appointment_booger_radio_conglomerate").val(target_val);});}},page_load_setup:function(){if($(".appointment-booker tbody tr th a").length>0){$(".appointment-booker tbody tr td").wrapInner("<span />");$(".appointment-booker tbody tr td span").hide();$(".appointment-booker tbody tr").eq(0).find("td span").show();$(".appointment-booker tbody tr th a").addClass("closed");$(".appointment-booker tbody tr").eq(0).find("th a").removeClass("closed");}$(".appointment-booker tbody tr td label").each(function(){var labeltxt=$(this).html();var is_radio_selected=$(this).parents("td").find("input[type=radio]").is(":checked");if(is_radio_selected){$('<a href="#" class="selected">'+labeltxt+"</a>").insertBefore(this);}else{$('<a href="#">'+labeltxt+"</a>").insertBefore(this);}});$(".appointment-booker tbody tr td input:radio").hide();$(".appointment-booker tbody tr td label").hide();}},LBG.oabShowHidePropertyBox={init:function(){if($(".oabPropertyField").length>0){LBG.oabShowHidePropertyBox.show_hide_property_box();$(".oabMoneyField select").change(function(){LBG.oabShowHidePropertyBox.show_hide_property_box();});}},show_hide_property_box:function(){if($(".oabMoneyField select option:selected").hasClass("showPropertyBox")){$(".oabPropertyField").show();}else{$(".oabPropertyField").hide();}}},LBG.oabShowHideEmailPhoneReminderBoxes={init:function(){LBG.oabShowHideEmailPhoneReminderBoxes.showhide_email();$(".oab .formField.oabEmailReminder input").blur(function(){LBG.oabShowHideEmailPhoneReminderBoxes.showhide_email();});LBG.oabShowHideEmailPhoneReminderBoxes.showhide_sms();$(".oab .formField.oabSMSReminder input").blur(function(){LBG.oabShowHideEmailPhoneReminderBoxes.showhide_sms();});},showhide_email:function(){var emailReminderField=$(".oab .formField.oabEmailReminder input").val();if(($.trim(emailReminderField).length>0)&&(!$(".oab .formField.oabEmailReminder").hasClass("error"))){$(".oab .linkedTooabEmailReminder").show();}else{$(".oab .linkedTooabEmailReminder input:checkbox").attr("checked",false);$(".oab .linkedTooabEmailReminder").hide();}},showhide_sms:function(){var phoneReminderField=$(".oab .formField.oabSMSReminder input").val();if(($.trim(phoneReminderField).length>0)&&(!$(".oab .formField.oabSMSReminder").hasClass("error"))&&(LBG.oabShowHideEmailPhoneReminderBoxes.is_mobile_number(phoneReminderField)===true)){$(".oab .linkedTooabSMSReminder").show();}else{$(".oab .linkedTooabSMSReminder input:checkbox").attr("checked",false);$(".oab .linkedTooabSMSReminder").hide();}},is_mobile_number:function(phone_number){var mob=false;if(phone_number.substring(0,2)=="07"){mob=true;}if(phone_number.substring(0,3)=="447"){mob=true;}return mob;}},LBG.oabSearchSelectBranchBoxes={init:function(){var searchBranchBox=$(".selectBranch .colPart:eq(0) .subPanel");var selectedBranchBox=$(".findBranch .colPart:eq(1) .subPanel");if(searchBranchBox.height()>selectedBranchBox.height()){selectedBranchBox.height(searchBranchBox.height());}else{searchBranchBox.height(selectedBranchBox.height());}}},LBG.vefTable={z_index_fixed:false,init:function(){if($(".ajax_loaded_vef_debit_transactions_table").length>0){var isCreditCard=false;var tansactionURL=DI.vef.transactions;$(".vef-get-content a").click(function(){isCreditCard=$(this).parent().hasClass("creditcard");if(isCreditCard){tansactionURL=DI.vef.creditCardTransactions;}$(".ajax_loaded_vef_debit_transactions_table").load(tansactionURL+"?_"+new Date().getTime(),function(){if(typeof dcsMultiTrack!="undefined"){if(!isCreditCard){dcsMultiTrack("WT.ac","modules/m342/properties.pm342lnk503c,modules/m342/properties.pm342lnk503a,Pending debit card transactions and uncleared cheques");}else{dcsMultiTrack("WT.ac","modules/m342/properties.pm342lnk503c,modules/m342/properties.pm342lnk503a,Pending credit card transactions");}}$(".vefTable").each(function(index){var $thisVefTable=$(this);var vefmeta=$thisVefTable.metadata();var onLoadThisManyRows=vefmeta.num_rows_to_load||10;var vefTableRowCount=$("tbody tr",$thisVefTable).length;if(vefTableRowCount>onLoadThisManyRows){$("tbody",$thisVefTable).addClass("startHidden").css("display","none");$("thead",$thisVefTable).after('<tbody class="first"></tbody>');$("tbody tr",$thisVefTable).each(function(index){if(index<onLoadThisManyRows){$("tbody.first",$thisVefTable).append($(this).clone());$(this).remove();}});var numCols=$("thead tr th",$thisVefTable).length;$("tbody.startHidden",$thisVefTable).before('<tbody><tr><td colspan="'+numCols+'" class="first centerAlignContent"><a href="#" class="showMoreRows">See all</a></td></tr></tbody>');$("tbody.startHidden",$thisVefTable).after('<tbody style="display:none"><tr><td colspan="'+numCols+'" class="first centerAlignContent"><a href="#" class="hideMoreRows">Hide</a></td></tr></tbody>');}});$("a.showMoreRows").click(function(e){e.preventDefault();$(this).parents(".vefTable").find("tbody.startHidden").toggle();$(this).parents("tbody").fadeOut("slow");$(this).parents(".vefTable").find("a.hideMoreRows").parents("tbody").fadeIn("slow");});$("a.hideMoreRows").click(function(e){e.preventDefault();
$(this).parents(".vefTable").find("tbody.startHidden").toggle();$(this).parents("tbody").fadeOut("slow");$(this).parents(".vefTable").find("a.showMoreRows").parents("tbody").fadeIn("slow");});LBG.vefTable.bobbers_zindex_fix();});});}},bobbers_zindex_fix:function(){if(!LBG.vefTable.z_index_fixed&&($.browser.msie&&$.browser.version<8)){if($(".ajax_loaded_vef_debit_transactions_table").length>0){$("div.secondary .subPanel .pane").css({"z-index":1,"position":"static"});}}}},LBG.travelFlags={init:function(){$(".addNewTravelFlagPanel").hide();$("form.changeTravelFlag").hide();$(".addNewTravelFlagButton").click(function(e){e.preventDefault();$(".addNewTravelFlagButton").slideUp("slow");$(".addNewTravelFlagPanel").slideDown("slow");});$(".addNewTravelFlagPanel .cancelTravel").click(function(e){e.preventDefault();$(".addNewTravelFlagPanel").slideUp("slow");$(".addNewTravelFlagButton").slideDown("slow");});$(".changeTravelFlagButton").click(function(e){e.preventDefault();$(this).parents(".travelFlagPanel").find("form.changeTravelFlag").slideDown();});$("form.changeTravelFlag .cancelTravel").click(function(e){e.preventDefault();$(this).parents("form.changeTravelFlag").slideUp();});$(".countrySearchTxt").keydown(function(e){if(e.keyCode===40){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();var resGrp=$(".countryLookupResults .resultsGroup");if(resGrp&&resGrp.length>0){resGrp[0].children[0].children[0].focus();}}});}},LBG.jsPrintButton={init:function(){$(".jsPrintButton").css("display","block");$(".jsPrintButton").parents("ul.printactions").css("position","static").css("position","absolute");}},LBG.loanServicing={init:function(){$(".loanServicing .loadHidden").hide();if($(".loanServicing .showHiddenIfChecked").is(":checked")){$(".loanServicing .loadHidden").show();}}},LBG.LinkDropDownToToolTip_Hrefs={init:function(){if($("select.LinkToolTips").length>0){$("select.LinkToolTips").change(function(){LBG.LinkDropDownToToolTip_Hrefs.populateTooltip();}).change();}},populateTooltip:function(){var dd_meta=$("select.LinkToolTips").metadata();var linked_tip_class=dd_meta.tooltipclass;var option_meta=$("select.LinkToolTips").find(":selected").metadata();var option_tipref=option_meta.tooltip_ref;$("."+linked_tip_class).attr("href","#"+option_tipref);}},LBG.avaRadioButtons={init:function(){$(".avaSuitabilityCheck .avaSuitabilitySectionOne input:radio").each(function(){var label=$("label[for="+'"'+this.id+'"'+"]").text();var checked=$(this).attr("checked");var radioStatus=checked?"radio-checked":"radio";var radioButton=$('<a title=" '+$.trim(label)+' " class="avaRadioBtn '+this.name+'" href="#"><span class="'+radioStatus+'"></span></a>');radioButton.insertAfter(this);});$(".avaSuitabilityCheck .avaSuitabilitySectionOne .avaRadioBtn").click(function(e){var $check=$(this).prev("input:radio");var unique="."+this.className.split(" ")[1]+" span";unique=unique.replace(/:/g,"\\:");$(unique).attr("class","radio");$(this).find("span").attr("class","radio-checked");$check.attr("checked",true);if($(this).parents("tr").hasClass("error")){$check.trigger("click");}return false;});$(".avaSuitabilityCheck .avaSuitabilitySectionOne .disabled .avaRadioBtn").click(function(){$(this).find("span").attr("class","radio");return false;});}};LBG.ajaxPoweredBankFinder=(function(){var initSelector="div.bankFinder",isFilterResults=DI.lang.bankFinder.isFilterResults,bankNameSpecialChars=LBG.Forms.Validation.Expressions.bankNameSpecialChars,bankFinderURL=DI.lang.bankFinder.bankFinderURL,dataURL=DI.lang.bankFinder.bankData,addressDataURL=DI.lang.bankFinder.bankAddressData,loadingData=false,ajaxResultsSelector="div.ajaxPoweredBankFinderResults",$elementsForAjaxResponseInjection,resultsTemplateURL=DI.lang.bankFinder.bankResults,resultsTemplate,bankNoResultsText=DI.lang.bankFinder.bankNoResultsText,radioGroupSelector="div.radioGroup",$radioGroupTemplate,resultsArr=[],inputTextBoxSelector="input.bankSearchTxt",bankInputDefaultText=DI.lang.bankFinder.bankNameInputText,isPagedResults=DI.lang.bankFinder.isPagedResults,numSearchItemsToDisplay=DI.lang.bankFinder.numSearchItemsToDisplay,numBrowseItemsToDisplay=DI.lang.bankFinder.numBrowseItemsToDisplay,numItemsToDisplay,pagingSelector="fieldset ul.paginationSudoButtons",previousImgEnabled=DI.lang.bankFinder.previousImgEnabled,previousImgDisabled=DI.lang.bankFinder.previousImgDisabled,nextImgEnabled=DI.lang.bankFinder.nextImgEnabled,nextImgDisabled=DI.lang.bankFinder.nextImgDisabled,$previousLink,$nextLink,$tabSearch,$tabBrowse,resetBrowseSubTabs=true,currentPage=1,numPages=0,tabCache;var setup=function($wrapper){$elementsForAjaxResponseInjection=$wrapper.find(ajaxResultsSelector);if($elementsForAjaxResponseInjection.length===0){return false;}$("li.primaryAction a.submitAction",initSelector).addClass("disabled");if($wrapper.find("div.searchBank").length>0){var $bankInputBox=$wrapper.find(inputTextBoxSelector);$bankInputBox.attr("defaultVal",bankInputDefaultText);$bankInputBox.val(bankInputDefaultText);$bankInputBox.addClass("bgColor");$bankInputBox.focus(function(){bankInputFocusHandler($bankInputBox);});$bankInputBox.blur(function(){bankInputBlurHandler($bankInputBox);});$bankInputBox.bind("keyup",function(){if($bankInputBox.val().length>=3&&$bankInputBox.val().substring(0,3)!=="   "){$("div.formSubmitError",initSelector).remove();$($bankInputBox).closest("div.error").removeClass("error").find("span.error").remove();getJsonResults($bankInputBox.val(),null,null,null,null);}else{$(ajaxResultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();$(ajaxResultsSelector,initSelector).empty();$(pagingSelector,initSelector).hide();$("li.primaryAction a.submitAction",initSelector).addClass("disabled");}});}$.get(resultsTemplateURL,function(data){resultsTemplate=data;$radioGroupTemplate=$(resultsTemplate).find(radioGroupSelector);if($wrapper.find("div.browseBank.active").length>0){setBankBrowseLinks($wrapper);}},"html");$previousLink=$wrapper.find(pagingSelector).find("li.previous a.pseudoLink");$nextLink=$wrapper.find(pagingSelector).find("li.next a.pseudoLink");$tabSearch=$("ul.tabs li a.tabSearch",initSelector);$tabBrowse=$("ul.tabs li a.tabBrowse",initSelector);tabCache=$("ul.subTabs").clone();$tabBrowse.live("click",function(e){e.preventDefault();$("ul.subTabs").before(tabCache.clone()).remove();$(".searchBank").removeClass("active").addClass("hide");$(".browseBank").removeClass("hide").addClass("active");setBankBrowseLinks($wrapper);});$tabSearch.live("click",function(e){e.preventDefault();$(".browseBank").removeClass("active").addClass("hide");$(".searchBank").removeClass("hide").addClass("active");clearForm();});if(isPagedResults){setPagingLinks();if(resultsArr.length===0){$wrapper.find(pagingSelector).hide();}}else{$wrapper.find(pagingSelector).hide();}$(".radioGroup input").live("click",function(){var radioSelected=$(".radioGroup input:checked").length;$("li.primaryAction a.submitAction",initSelector).addClass("disabled");if(radioSelected>0){$("div.formSubmitError",initSelector).remove();$("span.error",initSelector).remove();$("div.formField.error",initSelector).removeClass("error");$("li.primaryAction a.submitAction",initSelector).removeClass("disabled");}});$(initSelector+" form").submit(function(e){var radioSelected,radioSelectedValue;e.preventDefault();radioSelected=$(".radioGroup input:checked").length;if(radioSelected>0){radioSelectedValue=$(".radioGroup input:checked").val();processSmartSearchResult(radioSelectedValue);
}else{return false;}});$(initSelector+" .submitAction").live("click",function(e){var radioSelected,radioSelectedValue;if(3===e.which){return;}e.preventDefault();radioSelected=$(".radioGroup input:checked").length;if(radioSelected>0){radioSelectedValue=$(".radioGroup input:checked").val();processSmartSearchResult(radioSelectedValue);}else{return false;}});$(initSelector+" a.searchAgainLink").live("click",function(e){e.preventDefault();$.ajax({type:"GET",url:bankFinderURL,cache:false,data:{searchAgain:"true"}});$(".bankFinderConfirmation",initSelector).addClass("hide");$(".searchBank",initSelector).removeClass("hide").addClass("active");clearForm();});$previousLink.live("click",function(e){if($previousLink.is(".disabled")||3===e.which){return;}$("li.primaryAction a.submitAction",initSelector).addClass("disabled");e.preventDefault();currentPage-=1;displayResults();setPagingLinks();});$nextLink.live("click",function(e){if($nextLink.is(".disabled")||3===e.which){return;}$("li.primaryAction a.submitAction",initSelector).addClass("disabled");e.preventDefault();currentPage+=1;displayResults();setPagingLinks();});},processSmartSearchResult=function(smartSearchResult){var addressDataURLBase=addressDataURL;addressDataURL+="?selectedOption="+encodeURIComponent(smartSearchResult);$(".searchBank",initSelector).addClass("hide");$(".browseBank",initSelector).addClass("hide");$(initSelector+" .isaProviderConfirmation").empty();$.ajax({type:"GET",url:addressDataURL,cache:false,dataType:"json",success:function(data){var t=buildTemplate(data);$(initSelector+" .isaProviderConfirmation").append(t);},error:function(data){$(initSelector+" .isaProviderConfirmation").append("<h3>An error occurred. Please try again</h3>");}});addressDataURL=addressDataURLBase;$(".bankFinderConfirmation",initSelector).removeClass("hide");},clearForm=function(){$(ajaxResultsSelector,initSelector).empty();$("form input",initSelector).each(function(){var inputType=$(this).attr("type");if(inputType==="text"){$(this).val("");}else{if(inputType==="radio"){$(this).attr("checked",false);}}});$("div.formSubmitError",initSelector).remove();$("span.error",initSelector).remove();$("div.formField.error",initSelector).removeClass("error");$(inputTextBoxSelector,initSelector).val(bankInputDefaultText).addClass("bgColor");$(pagingSelector,initSelector).hide();$("li.primaryAction a.submitAction",initSelector).addClass("disabled");},buildTemplate=function(data){var template="";if(data.bankSunData.length>0){for(var key in data){var obj=data[key];for(var prop in obj){template+="<h3>Your existing Cash ISA provider</h3>";template+="<p>"+obj[prop].Provider+"</p>";template+="<h3>Your existing Cash ISA provider's address</h3>";template+="<p>"+obj[prop].Address1+"<br>";template+=obj[prop].hasOwnProperty("Address2")?obj[prop].Address2+"<br>":"";template+=obj[prop].hasOwnProperty("Address3")?obj[prop].Address3+"<br>":"";template+=obj[prop].hasOwnProperty("Address4")?obj[prop].Address4+"<br>":"";template+=obj[prop].PostCode1;template+="</p>";}}}else{template+="<h3>No results found</h3>";}return template;},setPagingLinks=function(){if(currentPage>1){$previousLink.children("img").attr("src",previousImgEnabled);$previousLink.unbind("click");$previousLink.removeClass("disabled");}else{$previousLink.children("img").attr("src",previousImgDisabled);$previousLink.click(function(){return false;});$previousLink.addClass("disabled");}if(currentPage<numPages){$nextLink.children("img").attr("src",nextImgEnabled);$nextLink.unbind("click");$nextLink.removeClass("disabled");}else{$nextLink.children("img").attr("src",nextImgDisabled);$nextLink.click(function(){return false;});$nextLink.addClass("disabled");}};bankInputFocusHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val("");$input.removeClass("bgColor");$input.addClass("fgColor");}},bankInputBlurHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val($input.attr("defaultVal"));$input.removeClass("fgColor");$input.addClass("bgColor");}},setBankBrowseLinks=function($wrapper){var $browseBankTabs=$wrapper.find("ul.subTabs span.tabInner");if($browseBankTabs.length>0){var $currentTab,$currentList,$list;var $parent,meta,letters;var metaBackup;var startLetter=null,endLetter=null,isBrowseNum=false,isBrowseSpecialChar=false;$currentTab=$browseBankTabs.find("em");if($currentTab.length!==0){$parent=$currentTab.parents("span.tabInner");meta=$currentTab.metadata();if(typeof meta.browseBankAlpha==="string"){letters=meta.browseBankAlpha.split("-");if(letters.length>0){startLetter=letters[0];endLetter=letters[letters.length-1];}}if(typeof meta.browseBankNum==="boolean"){isBrowseNum=meta.browseBankNum;}if(typeof meta.browseBankSpecialChars==="boolean"){isBrowseSpecialChar=meta.browseBankSpecialChars;}if(typeof meta.browseBankAlpha==="undefined"){letters=$currentTab.html();letters=letters.split("-");startLetter=letters[0];endLetter=letters[letters.length-1];}getJsonResults(null,startLetter,endLetter,isBrowseNum,isBrowseSpecialChar);isBrowseNum=false;isBrowseSpecialChar=false;}if(resetBrowseSubTabs){resetBrowseSubTabs=false;$browseBankTabs.find("a").live("click",function(e){e.preventDefault();$browseBankTabs=$wrapper.find("ul.subTabs span.tabInner");$("li.primaryAction a.submitAction",initSelector).addClass("disabled");$currentTab=$browseBankTabs.find("em");$currentList=$currentTab.parents("li");$list=$(this).parents("li");$parent=$(this).parents("span.tabInner");meta=$(this).metadata();if(typeof meta.browseBankAlpha==="string"){letters=meta.browseBankAlpha.split("-");if(letters.length>0){startLetter=letters[0];endLetter=letters[letters.length-1];$currentList.removeClass("current");$currentList.removeAttr("class");metaBackup=$currentTab.html();metaBackup="{browseBankAlpha:'"+metaBackup+"'}";if($currentTab.hasClass("numbersAndSpecial")){metaBackup="{browseBankAlpha:'"+$currentTab.html()+"', browseBankNum:true, browseBankSpecialChars:true} numbersAndSpecial";}$currentTab.replaceWith('<a href="#" class="'+metaBackup+'">'+$currentTab.html()+"</a>");$list.addClass("current");metaBackup=$(this).metadata();metaBackup=metaBackup.browseBankAlpha;if($(this).hasClass("numbersAndSpecial")){$(this).replaceWith("<em class=\"{browseBankAlpha:'"+metaBackup+"', browseBankNum:true, browseBankSpecialChars:true} numbersAndSpecial\">"+metaBackup+"</em>");}else{$(this).replaceWith("<em>"+metaBackup+"</em>");}}}if(typeof meta.browseBankNum==="boolean"){isBrowseNum=meta.browseBankNum;}if(typeof meta.browseBankSpecialChars==="boolean"){isBrowseSpecialChar=meta.browseBankSpecialChars;}getJsonResults(null,startLetter,endLetter,isBrowseNum,isBrowseSpecialChar);isBrowseNum=false;isBrowseSpecialChar=false;});}}},displayResults=function(){var resultsHTML="",resultsLength=resultsArr.length;$elementsForAjaxResponseInjection.empty();if(resultsLength>0){var radioList="";resultsHTML=resultsTemplate;if(isPagedResults){var i,j,k;numPages=(isNaN(numItemsToDisplay)?1:Math.ceil(resultsLength/numItemsToDisplay));if(numPages>1){$(initSelector).find(pagingSelector).show();}else{$(initSelector).find(pagingSelector).hide();}i=(currentPage*numItemsToDisplay)-numItemsToDisplay;j=(((currentPage*numItemsToDisplay)-1)>resultsLength-1?resultsLength-1:(currentPage*numItemsToDisplay)-1);for(k=i;k<=j;k++){radioList+=$radioGroupTemplate.clone().html().replace(/{id}/g,resultsArr[k].id).replace(/\s*{Provider}\s*/g,resultsArr[k].provider);}}else{$.each(resultsArr,function(index,value){radioList+=$radioGroupTemplate.clone().html().replace(/{id}/g,value.id).replace(/\s*{Provider}\s*/g,value.provider);
});}var target=$elementsForAjaxResponseInjection.filter(function(){return $(this).parents(".active").length!=0;});target.append(resultsHTML);var $radioGroupResults=$elementsForAjaxResponseInjection.find(radioGroupSelector);$radioGroupResults.empty();$radioGroupResults.append(radioList);}else{$elementsForAjaxResponseInjection.append("<p>"+bankNoResultsText+"</p>");$(ajaxResultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();$(initSelector).find(pagingSelector).hide();}},getJsonResults=function(searchStr,startLetter,endLetter,isBrowseNum,isBrowseSpecialChar){$("li.primaryAction a.submitAction",initSelector).addClass("disabled");$.ajax({type:"GET",url:dataURL,data:{searchStr:searchStr,startLetter:startLetter,endLetter:endLetter,isBrowseNum:isBrowseNum,isBrowseSpecialChar:isBrowseSpecialChar},cache:false,dataType:"json",success:function(response){if(typeof response.bankSunData!=="undefined"){var resultsData=response.bankSunData;resultsArr=[];currentPage=1;numPages=0;numItemsToDisplay=(searchStr!==null?numSearchItemsToDisplay:numBrowseItemsToDisplay);if(isFilterResults){if(searchStr!==null){searchStr=searchStr.toLowerCase();for(var key in resultsData){if($.trim(resultsData[key].Provider).substring(0,searchStr.length).toLowerCase()===searchStr){resultsArr.push({id:resultsData[key].ID,provider:resultsData[key].Provider});}}}else{if(startLetter!==null||isBrowseNum!==null||isBrowseSpecialChar!==null){startLetter=(startLetter!==null?startLetter.toLowerCase():"");endLetter=(endLetter!==null?"-"+endLetter.toLowerCase():"");isBrowseNum=(isBrowseNum!==null?isBrowseNum:false);isBrowseSpecialChar=(isBrowseSpecialChar!==null?isBrowseSpecialChar:false);var regExp="^["+startLetter+endLetter+(isBrowseNum?"\\d":"")+(isBrowseSpecialChar?bankNameSpecialChars:"")+"]+$";for(var key in resultsData){if($.trim(resultsData[key].Provider).substring(0,1).toLowerCase().match(regExp)){resultsArr.push({id:resultsData[key].ID,provider:resultsData[key].Provider});}}}}}else{for(var key in resultsData){resultsArr.push({id:resultsData[key].ID,provider:resultsData[key].Provider});}}displayResults();setPagingLinks();}},error:function(){loadingData=false;}});};return{init:function(){setup($(initSelector));}};})();var countryData;LBG.countryLookup=(function(countryData){var initSelector=".countryLookup",countryData=countryData,loadingData=false,resultsSelector=".countryLookupResults",resultsTemplateURL=DI.lang.countryLookup.countryResults,resultsTemplate,countryNoResultsText=DI.lang.countryLookup.countryNoResultsText,resultsGroupSelector=".resultsGroup",$resultGroupTemplate,resultsArr=[],searchType="advanced",inputTextBoxSelector=".countrySearchTxt",countryInputDefaultText=DI.lang.countryLookup.countryInputText,numSearchItemsToDisplay=DI.lang.countryLookup.numSearchItemsToDisplay,numItemsToDisplay;var setup=function($wrapper){$wrapper.find(".searchCountry").each(function(){var $thisSearch=$(this),$inputTextBoxSelector=$thisSearch.find(inputTextBoxSelector),$elementsForResultsInjection=$thisSearch.find(resultsSelector),$countryInputBox=$thisSearch.find(inputTextBoxSelector),thisSearchId=$thisSearch.attr("id").replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");if($elementsForResultsInjection.length===0){return false;}if($inputTextBoxSelector[0].value.length<1){$countryInputBox.attr("defaultVal",countryInputDefaultText).val(countryInputDefaultText);}$countryInputBox.focus(function(){countryInputFocusHandler($countryInputBox);});$countryInputBox.blur(function(){countryInputBlurHandler($countryInputBox);});$countryInputBox.bind("keyup",function(){if($.browser.msie&&$.browser.version<7&&$countryInputBox.val().length>2&&resultsArr.length<1){showIE6Selet($countryInputBox,"visible",true);$(resultsSelector,initSelector).empty();}if($countryInputBox.val().length>=3&&$countryInputBox.val().substring(0,3)!=="   "){$(".formSubmitError",initSelector).remove();$($countryInputBox).closest("div.error").removeClass("error").find("span.error").remove();getResults($countryInputBox.val(),$elementsForResultsInjection);if($.browser.msie&&$.browser.version<7){showIE6Selet($countryInputBox,"hidden",true);}}else{if($.browser.msie&&$.browser.version<7){showIE6Selet($countryInputBox,"visible",true);$(resultsSelector,initSelector).empty();return;}$(resultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();$(resultsSelector,initSelector).empty();$("li.primaryAction a.submitAction",initSelector).addClass("disabled");}});$countryInputBox.bind("keydown",function(e){var keyCode=e.keyCode||e.which;if($countryInputBox.val().length>=3&&$countryInputBox.val().substring(0,3)!=="   "){if(keyCode===40){if($("#"+thisSearchId+" .result").length>0){$("#"+thisSearchId+" .result:first").find("a").focus();}}}});$.get(resultsTemplateURL,function(data){resultsTemplate=data;$resultsGroupTemplate=$(resultsTemplate).find(resultsGroupSelector);},"html");$("#"+thisSearchId+" .result a").live("click",function(e){e.preventDefault();updateCountryInputVal($(this),$countryInputBox);});$("#"+thisSearchId+" .result a").live("keydown",function(e){e.preventDefault();var keyCode=e.keyCode||e.which;if(!e.shiftKey&&keyCode===9||keyCode===40){$(this).parent().next(".result").find("a").focus();}if(e.shiftKey&&keyCode===9||keyCode===38){if($(this).parent().prev(".result").length>0){$(this).parent().prev(".result").find("a").focus();}else{$countryInputBox.focus();}}if(keyCode===13){updateCountryInputVal($(this),$countryInputBox);}});});},updateCountryInputVal=function($this,$input){$input.val($this.attr("data-country"));$(".resultsGroup").hide();if($.browser.msie&&$.browser.version<7){showIE6Selet($input,"visible",false);}$(".setDate").find("select").focus();},showIE6Selet=function($theElem,state,setFocus){$theElem.parents(".summary").find("select").each(function(idx){if($(this)[0].style.visibility!=state){$(this)[0].style.visibility=state;$(this).parents(".detail").each(function(){if($(this)[0].style.display=="block"){$(this)[0].style.display="none";$(this)[0].style.display="block";}});if(setFocus&&$theElem[0]&&$theElem[0].type=="text"){$theElem[0].style.display="none";$theElem[0].style.display="block";$theElem.focus();}}});},countryInputFocusHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val("");}},countryInputBlurHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val($input.attr("defaultVal"));}},displayResults=function($elementsForResultsInjection,$searchStr){var resultsHTML="",resultsLength=resultsArr.length;$elementsForResultsInjection.empty();if(resultsLength>0){var resultsList="";resultsHTML=resultsTemplate;$.each(resultsArr,function(index,value){if($searchStr){$searchStr2=$searchStr.substr(0,1).toUpperCase()+$searchStr.substr(1);$searchStr3=$searchStr.toUpperCase();var searchExpr=new RegExp($searchStr,"g");var searchExpr2=new RegExp($searchStr2,"g");var searchExpr3=new RegExp($searchStr3,"g");var higlightCtr=value.country.replace(searchExpr,"<strong>"+$searchStr+"</strong>");higlightCtr=higlightCtr.replace(searchExpr2,"<strong>"+$searchStr2+"</strong>");higlightCtr=higlightCtr.replace(searchExpr3,"<strong>"+$searchStr3+"</strong>");resultsList+=$resultsGroupTemplate.clone().html().replace(/\s*{country}\s*\</g,higlightCtr+"<");resultsList=resultsList.replace(/\s*{country}\s*/g,value.country);}else{resultsList+=$resultsGroupTemplate.clone().html().replace(/\s*{country}\s*/g,value.country);}});var target=$elementsForResultsInjection.filter(function(){return $(this).parents(".active").length!=0;
});target.append(resultsHTML);var $resultsGroupResults=$elementsForResultsInjection.find(resultsGroupSelector);$resultsGroupResults.empty();$resultsGroupResults.append(resultsList);}else{$elementsForResultsInjection.append("<p>"+countryNoResultsText+"</p>");$(resultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();}},getResults=function(searchStr,$elementsForResultsInjection){if(typeof countryData!=="undefined"){var resultsData=countryData;resultsArr=[];resultsArrAdv=[];numItemsToDisplay=numSearchItemsToDisplay;if(searchStr!==null){searchStr=searchStr.toLowerCase();for(var key in resultsData){var searchPos=$.trim(resultsData[key].country).toLowerCase().indexOf(searchStr);if(searchType=="startsWith"||searchType=="advanced"){if(searchPos==0){resultsArr.push({country:resultsData[key].country});}}else{if(searchType=="all"){if(searchPos>-1){resultsArr.push({country:resultsData[key].country});}}}if(searchType=="advanced"){if(searchPos>0){resultsArrAdv.push({country:resultsData[key].country});}}}resultsArr=resultsArr.concat(resultsArrAdv);}displayResults($elementsForResultsInjection,searchStr);}};return{init:function(){setup($(initSelector));}};})(countryData);LBG.showNextOnChange={init:function(){var selector=".showNextOnChange",formFieldSelector=".formField",hideClass="hideJS";$(selector).find("input, select").each(function(){var elem=$(this);elem.data("oldVal",elem.val());elem.bind("propertychange keyup input paste",function(event){if(elem.data("oldVal")!=elem.val()){elem.data("oldVal",elem.val());elem.parents(selector).next(formFieldSelector).show().removeClass(hideClass).find("input, select").val("");}});});}};LBG.closeWindowLink={init:function(){$("a.closeWindow").unbind("click").bind("click",function(e){e.preventDefault();window.open("","_self","");window.close();});}};LBG.fixedTermDepositReinvestDropDown={initSelector:".maturityOptionsDropdowns",successorProduct:".successorProduct",interestFrequency:".interestFrequency",init:function(){if($(LBG.fixedTermDepositReinvestDropDown.initSelector).length>0){$(LBG.fixedTermDepositReinvestDropDown.successorProduct).change(function(){LBG.fixedTermDepositReinvestDropDown.populateNextDropDown($(this));});$(LBG.fixedTermDepositReinvestDropDown.successorProduct).keyup(function(){LBG.fixedTermDepositReinvestDropDown.populateNextDropDown($(this));});}},populateNextDropDown:function($successorProduct){var dropDownReceiverData=DI.lang.fixedTermDeposit.dropDownReceiverData;var $interestFrequencyElement=$successorProduct.parents(LBG.fixedTermDepositReinvestDropDown.initSelector).find(LBG.fixedTermDepositReinvestDropDown.interestFrequency);if($successorProduct.val()!=="-"){$.get(dropDownReceiverData,{"successorProduct":$successorProduct.val()},function(data){$interestFrequencyElement.empty().append($("option",$(data)));$("option:first-child",$interestFrequencyElement).attr("selected","selected");});}else{$interestFrequencyElement.html('<option selected="selected" value="-">&lt;Please select&gt;</option>');}}};LBG.ieZindexFix={apply:function(override,cxt){if(override||(!LBG.ieZindexFix.zIndexFixed&&($.browser.msie&&$.browser.version<8))){var elems,count,offset;if(!cxt){elems=$(".content div:not(.no-z-fix)");count=elems.length;offset=0;}else{others=$(".content div");others.css("z-index","");elems=cxt.parents("div:not(.no-z-fix)");count=elems.length;offset=others.length;}for(var i=0;i<count;i++){$(elems[i]).css({"z-index":(count-i)+offset});}LBG.ieZindexFix.zIndexFixed=true;return true;}else{return false;}},zIndexFixed:false};LBG.dateShortcut={init:function(){$("a.dateRangeShortcut").each(function(){if(!$(this).metadata().period){$(this).remove();}else{$(this).data("period",$(this).metadata().period);}}).click(function(){var cxt=$(this).closest("form");var period=$(this).data("period");var from=new Date((new Date()).getTime()-parseInt(period)*86400000);var to=new Date();$(".datesAndNames select.slctDay:eq(0)",cxt).val(LBG.dateShortcut.dayFormat(from.getUTCDate()));$(".datesAndNames select.slctMonth:eq(0) > option",cxt).attr("selected","").eq(from.getUTCMonth()+1).attr("selected","selected");$(".datesAndNames select.slctYear:eq(0)",cxt).val(from.getUTCFullYear());$(".datesAndNames select.slctDay:eq(1)",cxt).val(LBG.dateShortcut.dayFormat(to.getUTCDate()));$(".datesAndNames select.slctMonth:eq(1) > option",cxt).attr("selected","").eq(to.getUTCMonth()+1).attr("selected","selected");$(".datesAndNames select.slctYear:eq(1)",cxt).val(to.getUTCFullYear());return false;});},dayFormat:function(val){if(val<10){return"0"+val;}return val;}};LBG.eloanUtils={init:function(){$(".cancelInput").click(function(e){e.preventDefault();var target=e?$(e.target):$(window.event.srcElement),context=$(target).parents(".showHide");$(".triggerChild",context).trigger("click");$(":input",context).val("");});}};LBG.altOverlay=(function(){var reposition=function(){var verticalSpace=Math.min($(".altOverlayContainer").height(),$(window).height());var coverage=Math.min(0.95,$(".altOverlay").height()/verticalSpace);$(".altOverlay").css("margin-top",coverage*verticalSpace/-2);};var bind=function(){$(".altOverlay a.dismiss, .altOverlayMask").click(function(e){e.preventDefault();$(".hasAltOverlay").removeClass("hasAltOverlay");$(".altOverlayContainer").hide();return false;});};return{init:function(){if($(".altOverlay").length>0){$("html").addClass("hasAltOverlay").find("body").append($(".altOverlayContainer"));reposition();$(window).resize(reposition);bind();}}};})();LBG.marmaladePhaseTwo=(function(){var expand=(function(){var initSelector="td.first a.avaRadioBtn";var parent;var setup=function($wrapper){$wrapper.click(function(event){$parent=$(this).parents("table");$thisRow=$(this).parents("tr");currentRowIndex=$("tr",$parent).index($thisRow);$("tr",$parent).each(function(index){var $this=$(this);var $trigger=$(this).find(".triggerChild:first");var testDiv=$(".showHide",$(this));if(index===currentRowIndex){if(testDiv.hasClass("closed")){$trigger.trigger("click");}}else{if(!testDiv.hasClass("closed")){$trigger.trigger("click");}}});});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var validateCountable=(function(){var initSelector=".avaSales .avaSuitabilityCheck table",radioGroupSelector=".formField .radioGroup .inputGroup",countableSelector=".countable .formField .radioGroup .inputGroup",checkedSelector=".radio-checked";var getThreshold=function($wrapper){var meta=$wrapper.metadata();return meta.threshold;};var setup=function($wrapper){var $countables=$(countableSelector),$inputGroups=$(radioGroupSelector),$form=$wrapper.parents("form");var countableThreshold=getThreshold($wrapper);var total=$(".radioGroup").find(":input[value='yes']").length;var successfulSubmit=false;var performCountableCheck=function(){var answered=$(".radioGroup").find(":input:radio[checked='true']").length;if(answered<total){return false;}var count=$(".countable .radioGroup").find(":input:radio[checked='true']").filter("[value='yes']").length;return count<=countableThreshold;};var updateWarning=function(){var showWarning=performCountableCheck();var disclosure=$(".disclosure");var benefitCount=$wrapper.parents("form").find("tr").length;var questionsAnswered=$wrapper.parents("form").find(":radio:checked").length;if(showWarning){disclosure.slideDown();$wrapper.parents("form").find(".submitAction").attr("disabled",true);}else{disclosure.slideUp();if(benefitCount===questionsAnswered){$wrapper.parents("form").find(".submitAction").attr("disabled",false);
}}};$(".radioGroup .avaRadioBtn",$wrapper).click(function(e){updateWarning();});$(":radio").click(function(e){updateWarning();});$(document).ready(function(){updateWarning();});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var ageDisclosure=(function(){var initSelector=".avaSales .disclosurePanel",nearingIneligibleWarningSelector=".nearingIneligibleWarning",ineligibleWarningSelector=".ineligibleWarning";var setup=function($wrapper){var meta=$wrapper.metadata();var ineligibleAge=meta.ineligibleAge;var nearingIneligibleAge=meta.nearingIneligibleAge;var $datePicker=$wrapper.parent().find(".formField .date");var createDate=function($dateWrapper){var daySelector="select.slctDay";var monthSelector="select.slctMonth";var yearSelector="select.slctYear";var day=$dateWrapper.find(daySelector).val(),month=$dateWrapper.find(monthSelector).val(),year=$dateWrapper.find(yearSelector).val();return new Date(year,month-1,day);};var greaterOrEqualToAge=function(dateOfBirth,age){var ageDateOfBirth=new Date();ageDateOfBirth=new Date(ageDateOfBirth.getFullYear()-age,ageDateOfBirth.getMonth(),ageDateOfBirth.getDate());return ageDateOfBirth>=dateOfBirth;};$(":input",$datePicker).change(function(e){var ageNotEntered=false;$datePicker.find(":input").each(function(){var ageNotEntered=ageNotEntered||$(this).val()==="-";});if(ageNotEntered){return false;}var dob=createDate($datePicker);var ineligible=greaterOrEqualToAge(dob,ineligibleAge);var nearingIneligible=false;if(!ineligible){var nearingIneligible=greaterOrEqualToAge(dob,nearingIneligibleAge);}if(ineligible){$(ineligibleWarningSelector,$wrapper).slideDown();}else{$(ineligibleWarningSelector,$wrapper).slideUp();}if(nearingIneligible){$(nearingIneligibleWarningSelector,$wrapper).slideDown();}else{$(nearingIneligibleWarningSelector,$wrapper).slideUp();}return false;}).change();};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();return{init:function(){expand.init();ageDisclosure.init();}};})();LBG.marmaladePhaseTwo=(function(){var expand=(function(){var initSelector="td.first a.avaRadioBtn";var parent;var setup=function($wrapper){$wrapper.click(function(event){$parent=$(this).parents("table");$thisRow=$(this).parents("tr");currentRowIndex=$("tr",$parent).index($thisRow);$("tr",$parent).each(function(index){var $this=$(this);var $trigger=$(this).find(".triggerChild:first");var testDiv=$(".showHide",$(this));if(index===currentRowIndex){if(testDiv.hasClass("closed")){$trigger.trigger("click");}}else{if(!testDiv.hasClass("closed")){$trigger.trigger("click");}}});});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var validateCountable=(function(){var initSelector=".avaSales .avaSuitabilityCheck table",radioGroupSelector=".formField .radioGroup .inputGroup",countableSelector=".countable .formField .radioGroup .inputGroup",checkedSelector=".radio-checked";var getThreshold=function($wrapper){var meta=$wrapper.metadata();return meta.threshold;};var setup=function($wrapper){var $countables=$(countableSelector),$inputGroups=$(radioGroupSelector),$form=$wrapper.parents("form");var countableThreshold=getThreshold($wrapper);var total=$(".radioGroup").find(":input[value='yes']").length;var successfulSubmit=false;var performCountableCheck=function(){var answered=$(".radioGroup").find(":input:radio[checked='true']").length;if(answered<total){return false;}var count=$(".countable .radioGroup").find(":input:radio[checked='true']").filter("[value='yes']").length;return count<=countableThreshold;};var updateWarning=function(){var showWarning=performCountableCheck();var disclosure=$(".disclosure");var benefitCount=$wrapper.parents("form").find("tr").length;var questionsAnswered=$wrapper.parents("form").find(":radio:checked").length;if(showWarning){disclosure.slideDown();$wrapper.parents("form").find(".submitAction").attr("disabled",true);}else{disclosure.slideUp();if(benefitCount===questionsAnswered){$wrapper.parents("form").find(".submitAction").attr("disabled",false);}}};$(".radioGroup .avaRadioBtn",$wrapper).click(function(e){updateWarning();});$(":radio").click(function(e){updateWarning();});$(document).ready(function(){updateWarning();});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var ageDisclosure=(function(){var initSelector=".avaSales .disclosurePanel",nearingIneligibleWarningSelector=".nearingIneligibleWarning",ineligibleWarningSelector=".ineligibleWarning";var setup=function($wrapper){var meta=$wrapper.metadata();var ineligibleAge=meta.ineligibleAge;var nearingIneligibleAge=meta.nearingIneligibleAge;var $datePicker=$wrapper.parent().find(".formField .date");var createDate=function($dateWrapper){var daySelector="select.slctDay";var monthSelector="select.slctMonth";var yearSelector="select.slctYear";var day=$dateWrapper.find(daySelector).val(),month=$dateWrapper.find(monthSelector).val(),year=$dateWrapper.find(yearSelector).val();return new Date(year,month-1,day);};var greaterOrEqualToAge=function(dateOfBirth,age){var ageDateOfBirth=new Date();ageDateOfBirth=new Date(ageDateOfBirth.getFullYear()-age,ageDateOfBirth.getMonth(),ageDateOfBirth.getDate());return ageDateOfBirth>=dateOfBirth;};$(":input",$datePicker).change(function(e){var ageNotEntered=false;$datePicker.find(":input").each(function(){var ageNotEntered=ageNotEntered||$(this).val()==="-";});if(ageNotEntered){return false;}var dob=createDate($datePicker);var ineligible=greaterOrEqualToAge(dob,ineligibleAge);var nearingIneligible=false;if(!ineligible){var nearingIneligible=greaterOrEqualToAge(dob,nearingIneligibleAge);}if(ineligible){$(ineligibleWarningSelector,$wrapper).slideDown();}else{$(ineligibleWarningSelector,$wrapper).slideUp();}if(nearingIneligible){$(nearingIneligibleWarningSelector,$wrapper).slideDown();}else{$(nearingIneligibleWarningSelector,$wrapper).slideUp();}return false;}).change();};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var fixTextWrap=(function(){var initSelector=".avaSummaryTable .notEligible";var setup=function($wrapper){var elWidth=$wrapper.outerWidth(true)+10;$wrapper.parent("a").css("padding-right",elWidth);};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();return{init:function(){expand.init();ageDisclosure.init();fixTextWrap.init();}};})();LBG.textNoSpace={init:function(){$(".js-noSpace input:text").blur(function(){var txt=this.value;txt=txt.replace(/[()+\-\s]/ig,"");$(this).val(txt);});}};LBG.lostAndStolen={init:function(){var submit=$("div.lostAndStolen .submitAction");var formReplacement=$("div.lostAndStolen form");var formReqReplacement=$("div.reqReplacement form");var field=$("div.lostAndStolen input.field");var row=$("table.lostAndStolenCardCancellation tbody tr");var rowReqReplacement=$("table.lostAndStolenCardReplace tbody tr");var creditCardRepRow=$("table.lostAndStolenCardReplace tbody tr.creditCard");var cancel=$("table.lostAndStolenCardCancellation td div.replaceCard input, table.lostAndStolenCardCancellation td div.newPin input");var radio=$("div.lostAndStolen .radioGroup input");var radioContainer=$("div.lostAndStolen div.radio");var checkbox=$("div.lostAndStolen table.lostAndStolenCardCancellation td div.cancelCard input");var checkboxReqReplacement=$("div.reqReplacement table.lostAndStolenCardReplace td input");var errorMessage=$(".formSubmitError");var confirmationRadio=$("div.lostAndStolen.confirmationSummary .radioGroup");var confirmAddressLS=$(".confirmAddressLostandStolen");
$(confirmAddressLS).hide();var replaceErrShown=false;var wrapperValues=$(".lostAndStolen .formField");var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(wrapperValues);LBG.Forms.Validation.ValidationHandlers.push(formValidationHandler);var reqWrapperValues=$(".reqReplacement .formField");var reqformValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(reqWrapperValues);LBG.Forms.Validation.ValidationHandlers.push(reqformValidationHandler);if(formValidationHandler!=false&&formValidationHandler.validationRoutines!=undefined&&!formValidationHandler.validationRoutines.customMessage){blnRequiredValidationAddedDynamically=true;formValidationHandler.validationRoutines.push("customMessage");formValidationHandler.validationRoutines.customMessage={msg:"validateRadio"};}$(radioContainer).find("input:radio").click(function(){if(formValidationHandler){formValidationHandler.hideError();}});$(rowReqReplacement).each(function(){var tmpChekbx=$(this).find("input:checkbox");tmpChekbx.unbind("click");tmpChekbx.click(function(){if(reqformValidationHandler){reqformValidationHandler.hideError();}if($(this.checked)&&($(".submitAction").attr("disabled")!==undefined)){if(formValidationHandler){formValidationHandler.hideError();}$(".submitAction").removeAttr("disabled");}});});$(creditCardRepRow).each(function(){var replaceCard=$(this).find(".replaceCard input");var newPin=$(this).find(".newPin input");replaceCard.click(function(event){if(replaceCard[0].checked){newPin.addClass("isDisabled").attr("disabled","disabled");}else{newPin.removeClass("isDisabled").removeAttr("disabled");}});newPin.click(function(){if(newPin[0].checked){replaceCard.addClass("isDisabled").attr("disabled","disabled");}else{replaceCard.removeClass("isDisabled").removeAttr("disabled");}});});$(formReqReplacement).submit(function(e){if(checkboxReqReplacement.filter(":checked").length==0){errorMessage.show();rowReqReplacement.addClass("error");return false;}});$(row).each(function(){var boxchecked=$(this).find(".cancelCard input");$(this).find("input:checkbox").click(function(){if(radio.filter(":checked").length!==0){if(formValidationHandler){formValidationHandler.hideError();}}});if($.browser.msie){$(this).find(".newPin input").removeClass("isDisabled").removeAttr("disabled");}if($(boxchecked).is(":checked")){$(this).find(".replaceCard input").removeClass("isDisabled").removeAttr("disabled");if(!$(this).find(".replaceCard input").is(":checked")){$(this).find(".newPin input").addClass("isDisabled").attr("disabled","disabled");}}else{$(this).find(".replaceCard input").addClass("isDisabled").attr("disabled","disabled");$(this).find(".newPin input").addClass("isDisabled").attr("disabled","disabled");}$(this).find(".cancelCard input").click(function(){if(this.checked){$(this).parents("tr").find(".replaceCard input, .newPin input").removeClass("isDisabled").removeAttr("disabled");$(this).parents("tr").find(".replaceCard input").attr("checked","checked");}else{$(this).parents("tr").find(".replaceCard input, .newPin input").addClass("isDisabled").removeAttr("checked").attr("disabled","disabled");}});$(this).find(".replaceCard input").click(function(){if(this.checked){$(this).parents("tr").find(".newPin input").removeClass("isDisabled").removeAttr("disabled");}else{if(!replaceErrShown){if(formValidationHandler.validationRoutines!=undefined){formValidationHandler.validationRoutines.customMessage={msg:"msg2476"};}if(formValidationHandler){formValidationHandler.showError();}replaceErrShown=true;}$(this).parents("tr").find(".newPin input").addClass("isDisabled").removeAttr("checked").attr("disabled","disabled");}});});$(submit).click(function(){if(($(field).length==0)){if((checkbox.filter(":checked").length==0)||(radio.filter(":checked").length==0)){if(radio.filter(":checked").length==0){if(formValidationHandler.validationRoutines!=undefined){formValidationHandler.validationRoutines.customMessage={msg:"validateRadio"};}}else{if(checkbox.filter(":checked").length==0){if(formValidationHandler.validationRoutines!=undefined){formValidationHandler.validationRoutines.customMessage={msg:"msg2474"};}}}if(formValidationHandler){formValidationHandler.showError();}return false;}}});$(formReplacement).submit(function(e){if(!formValidationHandler){return true;}if(($(field).length==0)){if((checkbox.filter(":checked").length==0)||(radio.filter(":checked").length==0)){errorMessage.show();if(checkbox.filter(":checked").length==0){$(row).addClass("error");}if(radio.filter(":checked").length==0){$(radioContainer).addClass("error");}return false;}}});$(field).bind("paste",function(e){setTimeout(function(){if($(field).val()!==""){$(submit).removeAttr("disabled").attr("src",DI.lang.lostAndStolen.submitImgEnabled);}else{$(submit).attr("disabled","disabled").attr("src",DI.lang.lostAndStolen.submitImgDisabled);}},100);});$(field).keyup(function(){if($(field).val()!==""){$(submit).removeAttr("disabled").attr("src",DI.lang.lostAndStolen.submitImgEnabled);}else{$(submit).attr("disabled","disabled").attr("src",DI.lang.lostAndStolen.submitImgDisabled);}});$(confirmationRadio).find("input").click(function(){if($(this).val()==1){$(".lostAndStolenSummary .choiceValue").each(function(){$(this).parent().attr("orig-value",$(this).text());$(this).text("N/A");$(confirmAddressLS).show("slow",function(){});});}else{if($(this).val()==0){$(".lostAndStolenSummary .choiceValue").each(function(){$(this).text($(this).parent().attr("orig-value"));$(confirmAddressLS).hide("slow",function(){});});}}});}};LBG.cssFixUtilities={init:function(){var isIE9=($.browser.msie&&parseInt($.browser.version)===9)?true:false;var hasPaymentTable=$("table.payments").length>0?true:false;if(isIE9&&hasPaymentTable){var cells=$("th,td");var div=$("<div/>");cells.each(function(){$(this).wrapInner(div);});}else{return false;}}};LBG.browserSniffer={init:function(){var browser=$.browser;var version=parseInt($.browser.version);for(var key in browser){if(browser[key]===Boolean(true)){$("body").addClass(key+"_"+version).attr({"data-browser":key,"data-version":version});}key++;}}};var AspectCollection=(function(){function AspectCollection(){this.aspects=[];}AspectCollection.prototype.init=function(){for(var i=0;i<this.aspects.length;i++){this.aspects[i].init();}};AspectCollection.prototype.addAspectAsLiteral=function(aspect){this.aspects.push(aspect);return this;};AspectCollection.prototype.addAspectAsFunction=function(aspect){this.aspects.push({init:aspect});return this;};AspectCollection.prototype.add=function(aspect){if("function"===typeof aspect){this.addAspectAsFunction(aspect);}else{if(aspect.init&&"function"===typeof aspect.init){this.addAspectAsLiteral(aspect);}}return this;};return AspectCollection;})();LBG.wtError={init:function(){$(".formField.wtError input:text").blur(function(){if($(".formField.wtError").hasClass(".error")){LBG.track({"WT.ti":this.id,"DCSext.CurrentPostcode":this.value,"DCSext.CurrentPostcodeValid":"false"});}else{LBG.track({"WT.ti":this.id,"DCSext.CurrentPostcode":this.value,"DCSext.CurrentPostcodeValid":"true"});}});}};LBG.selectAccountNew=function(){var el;function init(){el=$(".selectAccountNewList");if(!el.length){return;}el.find("li").each(function(){var button=$("<a href='#' class='button selectAccountButton'>Select</a>");$(this).append(button);button.bind("click",function(e){radioButton_click(e,this);});});el.find("input[type='radio']").click(function(){refreshClasses();});refreshClasses();}function refreshClasses(){if(el.find("input:checked").length){el.addClass("account-selected").find("li").removeClass("selected").find("a.selectAccountButton").text("Select");
el.find("input:checked").parents("li").addClass("selected").find("a.selectAccountButton").text("Selected");}else{el.removeClass("account-selected");}}function radioButton_click(e,el){e.preventDefault();var radio=$(el).parents("li").find("input[type='radio']");radio.attr("checked","checked");refreshClasses();}return{init:init};}();LBG.ajaxSelect=(function(){var init=function(){$("select.ajaxSelect").each(function(){var md=$(this).metadata();$(this).change(function(){var url=$(":selected",this).metadata().url;if(!url){$(md.target).html("");}else{$(md.target).load(url,function(){$(this).removeClass("loading");LBG.Forms.Validation.init();LBG.common.getNewWindowLinks();if(undefined!==LBG.smrboxBorderChange&&!LBG.smrboxBorderChange.singleBuisness){LBG.smrboxBorderChange.applyBorder();}}).addClass("loading");}}).change();});};return{init:init};})();LBG.loans=window.LBG.loans||(function(config){var loans=new AspectCollection();loans.addAspectAsFunction(function(){var OverpaymentCalculator=(function($,config){var selectors={amount:"input[type=text]",form:"form",result:".overpayment-calc-result",submit:".submitAction",linkedField:".colPart:eq(0) .amountField input",containers:{form:".overpayment-calc-form",result:".overpayment-calc-result-container",page:".colLayout"}};var classes={progress:"overpayment-calc-progress"};function OPCalc(element){context=$(element);var self=this;this.form=$(selectors.form,context);this.form.submit(function(e){e.preventDefault();self.handler(e);return false;}).bind("error",function(){self.result.hide();$(selectors.submit,self.form).removeAttr("disabled");});$(selectors.submit,self.form).keydown(function(e){if(13==e.which){$(this).click();}});this.amount=$(selectors.amount,context);this.amount.keydown(function(e){if(13==e.which){e.preventDefault();$(selectors.submit,self.form).click();}});this.result=$(selectors.containers.result,context);this.context=context;}OPCalc.prototype.getAmount=function(){return this.amount.val();};OPCalc.prototype.handler=function(e){e.preventDefault();LBG.track({"WT.tx_s":this.amount.val(),"WT.ac":"pages/p60_00_loan_statements/properties.p6000btn518a,pages/p60_00_loan_statements/properties.p6000btn518b,Calculate"});var val=this.amount.val();if(""==val||isNaN(parseFloat(val))){return false;}var data={};data[this.amount.attr("name")]=val;$(selectors.result,this.result).text(config.text.loading).addClass(classes.progress);this.result.show();var self=this;$.ajax({url:config.ajax.url,data:data,success:function(result){self.form[0].reset();self.amount.val(val);$(selectors.result,self.result).html(result).removeClass(classes.progress);$(selectors.submit,self.form).removeAttr("disabled");$(self.context).parents(selectors.containers.page).find(selectors.linkedField).val(val).parents(".error").removeClass("error").find("span.error").remove();},error:function(){self.form[0].reset();self.amount.val(val);$(selectors.result,self.result).html(config.html.error).removeClass(classes.progress);$(selectors.submit,self.form).removeAttr("disabled");}});return false;};return OPCalc;})($,config.overpaymentCalculator||{});$(".overpayment-calc").each(function(){new OverpaymentCalculator(this);});});return loans;})(DI.lang.loans||{});LBG.selectAccountNew=function(){var el;function init(){el=$(".selectAccountNewList");if(!el.length){return;}el.find("input[type='radio']").click(function(){refreshClasses();});refreshClasses();}function refreshClasses(){if(el.find("input:checked").length){el.addClass("account-selected").find("li").removeClass("selected");el.find("input:checked").parents("li").addClass("selected");}else{el.removeClass("account-selected");}}function radioButton_click(e,el){e.preventDefault();var radio=$(el).parents("li").find("input[type='radio']");radio.attr("checked","checked");refreshClasses();}return{init:init};}();LBG.emailModule=(function(){var init=function(){$("div.optionalEmail").each(function(){var $this=$(this);var checkbox=$this.find('input[type="checkbox"]').eq(0);var hidden=$this.find('input[type="hidden"]').eq(0);var emailfields=$this.find('input[type="text"]');var emailcapture=$this.find("div.emailShowHide");var pane=$this.find(".pane");if(checkbox.length>0){checkbox.attr("checked","");emailcapture.hide();checkbox.click(function(){if(emailcapture.hasClass("email-visible")){emailcapture.removeClass("email-visible");emailcapture.hide();pane.hide();if(hidden.length>0){emailfields.val(hidden.val());}}else{emailcapture.addClass("email-visible");emailcapture.show();}});}else{emailcapture.show();$this.find(".inner").eq(0).addClass("dash");}});};return{init:init};})();LBG.inTNGA={init:function(){if($("#txtRequestType").attr("value","TNGA").length){$("body").addClass("inTNGA");}}};LBG.enableCheckbox={init:function(){$(".newwinEnablePrint").click(function(event){if($(".opcRadioGroup input:radio[class='label']").length){if(!$(".opcRadioGroup input:radio[class='label']").is(":checked")){$(".opcRadioGroup .inputGroup input:last").trigger("click");$(".opcRadioGroup .inputGroup input:last").removeAttr("checked");$(".opcRadioGroup .radioGroup").attr("style","width: 100%");event.stopPropagation();event.preventDefault();event.stopImmediatePropagation();}else{$(".inputEnabledAfterPrint").removeAttr("disabled");var radioID=$(".opcRadioGroup input:radio:checked").attr("id");var printFormLink=$(".newwinEnablePrint").attr("href");var valRadio=radioID.slice(radioID.length-1);printFormLink=printFormLink+"&opc="+valRadio;$(".newwinEnablePrint").attr("href",printFormLink);}}else{$(".inputEnabledAfterPrint").removeAttr("disabled");}});var emailFields=[];var emailBoxes=[];$(".captureusernameandpassword .emailAddressComparison input:text").each(function(i){emailFields[i]=$(this);});if(emailFields[0]!=undefined&&emailFields[1]!=undefined){emailFields[0].change(function(){if(emailFields[0].val()!=""){LBG.enableCheckbox.makeRequired(true,emailFields);}else{if(emailFields[0].val()==""&&emailFields[1].val()==""){LBG.enableCheckbox.makeRequired(false,emailFields);}}});emailFields[1].change(function(){if(emailFields[1].val()!=""){LBG.enableCheckbox.makeRequired(true,emailFields);}else{if(emailFields[1].val()==""&&emailFields[0].val()==""){LBG.enableCheckbox.makeRequired(false,emailFields);}}});}},makeRequired:function(isReq,emailFields){var xxx=LBG.Forms.Validation.Tools.getFieldHandler(emailFields[0]);var yyy=LBG.Forms.Validation.Tools.getFieldHandler(emailFields[1]);if(isReq){if(-1===$.inArray("required",xxx.validationRoutines)){xxx.validationRoutines.push("required");yyy.validationRoutines.push("required");}}else{var index=$.inArray("required",xxx.validationRoutines);xxx.validationRoutines.splice(index,1);var index2=$.inArray("required",yyy.validationRoutines);yyy.validationRoutines.splice(index2,1);xxx.hideError();yyy.hideError();}}};(function(){var Autobinder=(function(){function autobinder(){this.bindings={};this.autobind={};this.handlers={};this.instances=[];}autobinder.prototype.register=function(selector,cls,autobind,args){var path=selector;var target=this.bindings;for(var i=0;i<path.length;i++){if(undefined==target[path[i]]){target[path[i]]={};}target=target[path[i]];}target._=cls;target.__autobind=autobind;target.__args=args;this.trigger("register",target,{selector:selector,"class":cls,autobind:autobind,args:args});return this;};autobinder.prototype.registerInstance=function(instance){return this.instances.push(instance)-1;};autobinder.prototype.bind=function(){var self=this;var lastkey=null;var walk=function(subclasses,element){var classAtThisDepth=subclasses._;
for(var key in subclasses){if(subclasses.hasOwnProperty(key)&&"_"!=key&&element.is(key)){lastkey=key;return walk(subclasses[key],element);}}var elem_attr=self.getElemAttr(subclasses._.getSelector());if(subclasses.__autobind&&undefined===element.attr("data-instance"+elem_attr)){function F(elem,args){var new_inst=classAtThisDepth.apply(this,[].concat(elem,args));elem.attr("data-instance"+elem_attr,self.registerInstance(this));return new_inst;}F.prototype=classAtThisDepth.prototype;new F(element,subclasses.__args);}};var baseclasses=this.bindings;for(var selector in baseclasses){if(baseclasses.hasOwnProperty(selector)){var elem_attr=self.getElemAttr(selector);var e=$(self.escapeChar(selector));if(!!e){var n=e.not("[data-instance"+elem_attr+"]");n.each(function(){if(navigator.userAgent.indexOf("MSIE")>-1&&parseInt($.browser.version,10)<=7){if(selector.indexOf("model=")!=-1){selector="."+selector.substring(selector.indexOf("model")+6,selector.length-2);elem_attr="-"+elem_attr.substring(elem_attr.indexOf("model")+6,elem_attr.length-2);}}walk(baseclasses[selector],$(this));});}}}return this;};autobinder.prototype.removeBindings=function(parent){var baseclasses=this.bindings;var self=this;for(var selector in baseclasses){if(baseclasses.hasOwnProperty(selector)){if($(parent).is(selector)){var elem_attr=self.getElemAttr(selector);$(parent).unbind().removeAttr("data-instance"+elem_attr);}$(parent).find(selector).each(function(){var elem_attr=self.getElemAttr(selector);$(this).unbind().removeAttr("data-instance"+elem_attr);});}}return this;};autobinder.prototype.reBind=function(parent){this.removeBindings(parent);setTimeout($.proxy(function(){this.bind();},this),1);return this;};autobinder.prototype.getElemAttr=function(selector){return selector.replace(/[\.;\/'\[\]= ]/g,"-");};autobinder.prototype.escapeChar=function(selector){if($.browser.msie&&$.browser.version<=7){return selector.replace(/(\[|\])/g,"\\\\$1");}else{return selector;}};autobinder.prototype.getInstanceForElement=function(element){if($(element).is("[data-instance]")){return this.instances[parseInt($(element).data("instance"))];}var lastkey=null;var walk=function(subclasses,element){var classAtThisDepth=subclasses._;for(var key in subclasses){if(subclasses.hasOwnProperty(key)&&"_"!=key&&element.is(key)){lastkey=key;return walk(subclasses[key],element);}}function F(elem,args){return classAtThisDepth.apply(this,[].concat(elem,args));}F.prototype=classAtThisDepth.prototype;return new F(element,subclasses.__args);};var baseclasses=this.bindings;for(var selector in baseclasses){if(baseclasses.hasOwnProperty(selector)){if($(element).is(selector)){if(undefined!=$(element).attr("data-instance"+this.getElemAttr(selector))){return this.instances[parseInt($(element).attr("data-instance"+this.getElemAttr(selector)))];}return walk(baseclasses[selector],$(element));}}}return null;};autobinder.prototype.on=function(event,handler){if(!this.handlers[event]){this.handlers[event]=[];}this.handlers[event].push(handler);return this;};autobinder.prototype.trigger=function(event,ctx,obj){if(!this.handlers[event]){return this;}for(var i=0;i<this.handlers[event];i++){this.handlers[event][i].call(ctx,obj);}return this;};return new autobinder();})();var initing;function Class(options,prop){var F=function(){};initing=true;var prototype=this instanceof Function?(new this()):{};initing=false;var _super=this.prototype||{};if(undefined==prop){prop=options;options=undefined;}for(var name in prop){prototype[name]=(typeof prop[name]=="function"&&typeof _super[name]=="function")?(function(name,func){return function(){var tmp=this._super;this._super=_super[name];var ret=func.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}var Class=function(){if(!initing&&this.init){this.init.apply(this,arguments);}};Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;Class.getSelector=function(){return Class.selector.join("");};if(options&&(options.selector||"string"==typeof options)){var selector=options.selector||options;var autobind=options.autobind!==false;Class.selector=this.selector?this.selector.concat(selector):[selector];Autobinder.register(Class.selector,Class,autobind,arguments.length>2?[].slice.call(arguments,2):[]);}Class.prototype.delegate=function(func){var self=this;return function(){return func.call(self,arguments);};};return Class;}this.Autobinder=Autobinder;this.Class=Class;})();var Config=new Class({init:function(obj){this.obj=obj;},tryGet:function(key){return this.get(key,null);},getPath:function(path,fallback){var breadcrumbs=path.split("/");var curr=null;var target=this.obj;while((curr=breadcrumbs.shift())!==undefined){if(!target[curr]){return fallback;}target=target[curr];}return target;},get:function(key,fallback){if(undefined!=this.obj&&undefined!=this.obj[key]){if(this.obj[key].toString()==({}).toString()){return new Config(this.obj[key]);}return this.obj[key];}if(-1!==key.indexOf("-")){key=key.replace(/\-([a-z])/g,function(a,match){return match.toUpperCase();});return this.get(key,fallback);}if(undefined===fallback){throw"Key '"+key+"' is not defined.";}return fallback;},val:function(){return this.obj;},tryGetNested:function(key){if(this.obj!=null){return this.obj.get(key,null);}else{return this.get(key,null);}}});var Repeatable=new Class({selector:".repeatable",autobind:false},{init:function(element){this.element=$(element);this.removeButton=$(".removeRepeatable",this.element);this.bind();this.handlers={remove:[]};},bind:function(){var self=this;this.removeButton.click(function(e){self.remove();e.preventDefault();});},canRemove:function(){return true;},onRemove:function(handler){this.handlers.remove.push(handler);return this;},toggleRemoveButton:function(show){if(show){this.removeButton.show();}else{this.removeButton.hide();}},remove:function(element){$(this.element).hide();this.element.find("input:text").val("");this.element.find("select").val("-").change();for(var i in this.handlers.remove){if(this.handlers.remove.hasOwnProperty(i)){this.handlers.remove[i].apply(this);}}},isVisible:function(){return $(this.element).is(":visible");},show:function(){$(this.element).show();return this;},hasShown:function(){return this;}},false);var LoanRepeatable=Repeatable.extend({selector:".loanPurpose",autobind:false},{init:function(element){Repeatable.prototype.init.call(this,element);$("select",element).change(function(){element.find("input:text").val("");LBG.Forms.Validation.Tools.getFieldHandler(element.find("input:text")[0]).isShowingError=false;});this.controller=null;},bind:function(){var self=this;this.removeButton.click(function(e){e.preventDefault();e.stopImmediatePropagation();self.shiftData();});},setController:function(controller){this.controller=controller;return this;},getController:function(){return this.controller;},canRemove:function(){var empty=true;$(":input",this.element).each(function(){empty=empty&&($(this).val()==($(this).is("select")?"-":""));});return empty;},hasShown:function(){return this;},shiftData:function(){var next=this.getController().nextChild(this);if(null==next||!next.isVisible()){this.remove();return;}var self=this;var selVal;var data=[];var errMsgs=[];var hasActualCost=[];$("input",next.element).each(function(i){data[i]=$(this).val();errMsgs[i]="";hasActualCost[i]=$(this).is(":visible");var inValHandler=LBG.Forms.Validation.Tools.getFieldHandler($(this));if(inValHandler.isShowingError){errMsgs[i]=inValHandler.errorMessage.innerHTML;}});
$("select",next.element).each(function(i){var selVal=$(this).val();$(this).val("-").change();$("select:eq("+i+")",self.element).val(selVal);});$("input",this.element).each(function(i){$(this).val(data[i]);if(i==1){if(hasActualCost[i]){$(this).parent().parent().parent().show();}else{$(this).parent().parent().parent().hide();}}var inValHandler=LBG.Forms.Validation.Tools.getFieldHandler($(this));if(errMsgs[i]!=""){inValHandler.showError();$(this).parent().find("span.error").each(function(x){this.innerHTML=errMsgs[i];});}else{inValHandler.hideError();}});next.shiftData();}});var RepeatableWrapper=new Class(".repeatableWrapper",{init:function(element){var loanRepeatableMaxReachedMessage=DI.lang.repeatableLoanElements.maxReached;$(".repeatableMaxReached .infoMessage p").text(loanRepeatableMaxReachedMessage);var self=this;this.reserve=[];this.element=element;this.limit=$(Repeatable.getSelector()).length;this.elements=[];this.addButton=$(".addRepeatable",element).show().click(function(e){e.preventDefault();var previousFieldsInvalid=false;var $previousVisibleRepeatables=$(this).prevAll(".repeatable").filter(":visible");$previousVisibleRepeatables.each(function(){var self=$(this);var $visibleFormFields=self.find(".formField").filter(":visible");$visibleFormFields.each(function(i){var $current=$($visibleFormFields[i]);if("-"===$current.find("select option:selected").val()||""===$current.find("input:text").filter(":enabled").val()){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler($current);var errorMessage="required";if("-"===$current.find("select option:selected").val()){errorMessage="requiredSelect";}if(validationHandler.validationRoutines.required){validationHandler.showError(errorMessage);previousFieldsInvalid=true;}}});});if(!previousFieldsInvalid){if(self.countRepeatable()<self.limit){self.nextChild().show().hasShown();}self.updateButtons();}});$(Repeatable.getSelector(),element).each(function(index){var elem=Autobinder.getInstanceForElement(this);elem.onRemove(function(){self.updateButtons();});elem.setController(self);if(index!=0&&elem.canRemove()){elem.remove();}self.elements.push(elem);});self.updateButtons();},nextChild:function(child){if(child){for(var i=0,l=this.elements.length;i<l;i++){if(this.elements[i]==child){if(i+1<l){return this.elements[i+1];}return null;}}}for(var i=0,l=this.elements.length;i<l;i++){if(!this.elements[i].isVisible()){return this.elements[i];}}return null;},updateButtons:function(){this.notifyChildren("toggleRemoveButton",[this.countRepeatable()>1]);this.toggleAddButton();},addChild:function(element){var elem=Autobinder.getInstanceForElement(element);var self=this;elem.onRemove(function(){self.updateButtons();});this.elements.push(elem);return this;},toggleAddButton:function(){if(this.countRepeatable()<this.limit){this.addButton.show();$(".repeatableMaxReached").hide();}else{this.addButton.hide();$(".repeatableMaxReached").show();}},countRepeatable:function(){var count=0;for(var i=0,l=this.elements.length;i<l;i++){if(this.elements[i].isVisible()){count++;}}return count;},notifyChildren:function(event,params){for(var i in this.elements){if(this.elements.hasOwnProperty(i)){this.elements[i][event].apply(this.elements[i],params);}}}});var UniqueSelection=new Class(".uniqueSelection",{init:function(element){var $repeatableWrapper=$(".repeatableWrapper");$(element).change(function(e){var scope=$("select",$repeatableWrapper);if($(this).parents(":eq(1)").next().hasClass("error")){$(this).parents(":eq(1)").next().removeClass("error").find("span.error").remove();}scope.each(function(){var vals=scope.map(function(){return $.trim($(this).val());});$("span",this).each(function(){if(-1===$.inArray($.trim($(this).attr("data-val")),vals)){var option=$("<option/>").val($(this).attr("data-val")).addClass($(this).attr("class-val")).text($(this).text());$(this).before(option).remove();}});var pIndex=this.selectedIndex;$("option",this).filter(function(){if(pIndex==this.index){return false;}var myval=$.trim(this.value);return -1!==$.inArray(myval,vals)&&"-"!==myval;}).each(function(){var clone=$("<span/>").attr("data-val",$(this).val()).attr("class-val",$(this).attr("class")).text($(this).text());$(this).before(clone).remove();});});});}});var OPSCalculatorController=new Class(".ops-calculator",{init:function(elem){this.element=elem;var self=this;$(":radio",elem).click(function(){if($(this).is(":checked")){var modelObj=new Config($(this).metadata()).get("model");self.swapModels(modelObj);}});},swapModels:function(model){$(".ops-calculator-total, .ops-calculator-monthly",this.element).each(function(){var cls=$(this).attr("class");cls=cls.replace(/ops[\-a-z]+\-calculator\-model/g,"");$(this).attr("class",cls).addClass(model);});return this;}});var OPSCalculator=new Class({init:function(elem){this.config=new Config($(elem).metadata());this.element=elem;this.isValid=false;this.quoteContent=$(".quote-content",this.element);if(this.quoteContent.length){var quoteHtml=this.quoteContent.html();quoteHtml=quoteHtml.replace("{0}",'<strong><span class="premium">&pound;XX.XX</span></strong>');quoteHtml=quoteHtml.replace("{1}",'<strong><span class="term">XX</span></strong>');quoteHtml=quoteHtml.replace("{2}",'<strong><span class="age">XX</span></strong>');quoteHtml=quoteHtml.replace("{3}",'<strong><span class="cover">&pound;X,XXX</span></strong>');this.quoteContent.html($(quoteHtml));}this.quoteContentOverlay=$(".quote-content-overlay",this.element);if(this.quoteContentOverlay.length){var quoteHtmlOverlay=this.quoteContentOverlay.html();quoteHtmlOverlay=quoteHtmlOverlay.replace("{0}",'<span class="premium">&pound;XX.XX</span>');quoteHtmlOverlay=quoteHtmlOverlay.replace("{1}",'<span class="term">XX</span>');quoteHtmlOverlay=quoteHtmlOverlay.replace("{2}",'<span class="age">XX</span>');quoteHtmlOverlay=quoteHtmlOverlay.replace("{3}",'<span class="cover">&pound;X,XXX</span>');this.quoteContentOverlay.html($(quoteHtmlOverlay));}this.quoteContentOverlay1=$(".quote-content-overlay1",this.element);if(this.quoteContentOverlay1.length){var quoteHtmlOverlay1=this.quoteContentOverlay1.html();quoteHtmlOverlay1=quoteHtmlOverlay1.replace("{0}",'<span class="premium">&pound;XX.XX</span>');quoteHtmlOverlay1=quoteHtmlOverlay1.replace("{1}",'<span class="term">XX</span>');quoteHtmlOverlay1=quoteHtmlOverlay1.replace("{2}",'<span class="age">XX</span>');quoteHtmlOverlay1=quoteHtmlOverlay1.replace("{3}",'<span class="cover">&pound;X,XXX</span>');this.quoteContentOverlay1.html($(quoteHtmlOverlay1));}var data=$("table",elem);this.fields={cover:$(".cover",data),term:$(".term",data),premium:$(".premium",data),total:$(".cost",data),age:$(".age",data)};$("div.exitOverlay").hide();$("div.ops-lowterm-overlay").hide();$("a#overlay-default-ops").show();var curVal=this;$(".ops-calculator .input-text").bind("blur",function(){if($(this).parent().parent().hasClass("error")){LBG.disableQuoteTabsOnLoad.init();}var isValid=LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.currencyCharacters,$(this).val().replace(/,/g,""));if(!isValid){curVal.clearSummaryPanel();}LBG.OPSSummaryData.continueJourney();});$(".ops-calculator .slider .plus",".ops-calculator .slider .minus").bind("click",function(){$(".ops-calculator .input-text").bind();});if($(".ops-engagement-hub .ui-slider").length){$(".ops-engagement-hub .ui-slider").bind("slidechange slide",this.delegate(this.updateEngagementHub));}else{$(".ui-slider",elem).bind("slidechange slide",this.delegate(this.update));}if($("input:hidden[name$=mliUseValuesPopulatedInForm]").val()=="true"){LBG.enableQuoteTabsMli();
$("ul.opsCalculatorTabs li").siblings("li").removeClass("current");if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"){$("ul.opsCalculatorTabs li").eq(0).addClass("current");}else{$("ul.opsCalculatorTabs li").eq(1).addClass("current");}}$("ul.opsCalculatorTabs li").click(function(){$(this).siblings("li").removeClass("current");$(this).addClass("current");});$(".ops-calculator input[type='radio'], .sidePaneHeadingRight a, ul.opsCalculatorTabs li").bind("click",function(e){var target=e.currentTarget;if(target.nodeName==="INPUT"&&target.name==="frmInsuranceQuoteMLI:cover-type"){LBG.enableQuoteTabsMli();}if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"){var totalCover=$("table.monthly .cover").html().replace("£","");}else{var totalCover=$("table.total .cover").html().replace("£","");}var totalTerm=$("table.monthly .term").html().replace("years","").trim();var monthlyPremium=$("table.total .premium").html().replace("£","");var monthlyTerm=$("table.total .term").html().replace("years","").trim();$(".ui-slider").each(function(){if($(this).closest(".formField").hasClass("error")){}else{if(!$(e.target).hasClass("statusToggle")){if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"){$("[name$=ops-total-cover]").val(totalCover);$("[name$=ops-total-length]").val(totalTerm);}else{$("[name$=ops-monthly-premium]").val(monthlyPremium);$("[name$=ops-monthly-length]").val(monthlyTerm);}}var minVal=parseFloat($(this).closest(".formFieldInner").find(".minVal, .min .limit").text().replace(/,/g,""),10);var maxVal=parseFloat($(this).closest(".formFieldInner").find(".maxVal, .max .limit").text().replace(/,/g,""),10);$(this).slider("option","min",minVal);$(this).slider("option","max",maxVal);if(maxVal<parseFloat($(this).closest(".formFieldInner").find("input").val().replace(/,/g,""),10)){$(this).slider("value",maxVal);$(this).closest(".formFieldInner").find(".input-text").val(maxVal).trigger("blur");}else{if(maxVal>=parseFloat($(this).closest(".formFieldInner").find("input").val().replace(/,/g,""),10)){$(this).slider("value",parseFloat($(this).closest(".formFieldInner").find("input").val().replace(/,/g,""),10));}}}$(this).trigger("slidechange");});var mliUseValuesPopulatedInForm=$("input:hidden[name$=mliUseValuesPopulatedInForm]").val();mliUseValuesPopulatedInForm=mliUseValuesPopulatedInForm=="true"?"true":"false";if($("input:hidden[name$=mliCRSwitchStatus]").val()=="true"&&mliUseValuesPopulatedInForm=="false"){$(".opsCoverAmount .slider").slider("value",parseInt($("input:hidden[name$=defaultCoverAmountValueMLI]").val()));$(".opsCoverAmount .slider").closest(".formFieldInner").find("input").val($("input:hidden[name$=defaultCoverAmountValueMLI]").val());$(".opsCoverTerm .slider").slider("value",parseInt($("input:hidden[name$=defaultTermAmountValueMLI]").val()));$(".opsCoverTerm .slider").closest(".formFieldInner").find("input").val($("input:hidden[name$=defaultTermAmountValueMLI]").val());$("input:hidden[name$=mliCRSwitchStatus]").attr("value","false");$("input:hidden[name$=mliUseValuesPopulatedInForm]").attr("value","true");}});this.model=null;var slider=$(".opsCoverAmount .slider");slider.bind("slide",function(event,ui){if(ui!==undefined&&Math.round(ui.value/5000)!==0&&ui.value>slider.slider("option","min")){var val=ui.value%5000?Math.round(ui.value/5000)*5000:ui.value;ui.value=val;}});var sliderMonthly=$(".opsMonthlyCover .slider");sliderMonthly.bind("slide",function(event,ui){if(ui!==undefined&&ui.value/1!==0&&ui.value<sliderMonthly.slider("option","max")){var val=ui.value%1?Math.round(ui.value/1)*1:ui.value;if((sliderMonthly.slider("option","max")-val)<1){val=sliderMonthly.slider("option","max");ui.value=val;}else{ui.value=val;}}});if($("form.ops-engagement-hub").length){this.engagementHubInit();}},engagementHubInit:function(){var minCoverAmount=this.getModels().decreasing.getMinimumCoverAmount();var minCoverAmountHub=minCoverAmount.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");var coverInput=$(".opsCoverAmount");coverInput.find(".slider").slider("option","min",minCoverAmount);coverInput.find("input").val(minCoverAmountHub);coverInput.find(".ops-cover-min-amount").html(minCoverAmountHub);},getModel:function(){if(!/ops-[\-a-z]+calculator-model/.test(this.element.attr("class"))){throw"Model not selected";}var modelName=this.element.attr("class").match(/ops-[\-a-z]+calculator-model/)[0];if(!this.model||!this.model.obj||this.model.name!=modelName){this.model={name:modelName,obj:Autobinder.getInstanceForElement($("[type='application/json; model="+modelName+"']:eq(0)"))};}return this.model.obj;},getModels:function(){var models={level:Autobinder.getInstanceForElement($("[type='application/json; model=ops-level-term-calculator-model']:eq(0)")),decreasing:Autobinder.getInstanceForElement($("[type='application/json; model=ops-decreasing-term-calculator-model']:eq(0)"))};return models;},getPremium:function(e){throw"getPremium is not implemented";},getSaleCost:function(){return((this.getPremium()*12)*this.getTerm()*this.getModel().getSaleCostPercent()/100+this.getModel().getSaleCost()).toFixed(2);},getCover:function(){throw"getCover is not implemented";},getTerm:function(){return parseInt(this.term.val());},update:function(e){var formStatus=$("input:hidden[name$=frmOPSStatus]").val();var errorMessage=$("div.formSubmitError");var minCoverAmount=this.getModel().getMinimumCoverAmount();$("span.ops-cover-min-amount.limit").html(minCoverAmount.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));var monthlyMaxCoverAmount=this.getModel().getMonthlyMaxCoverAmount();var premium=this.getPremium();var coverInput=$("[name$=ops-total-cover]"),termInput=$("[name$=ops-total-length]"),coverLimitContainer=coverInput.closest(".formFieldInner").find(".limit-container"),termLimitContainer=termInput.closest(".formFieldInner").find(".limit-container");var modelName=this.element.attr("class").match(/ops-[\-a-z]+calculator-model/)[0];if($("input:hidden[name$=levelSelected]").val()=="false"&&(modelName=="ops-level-term-calculator-model")){if($(".quote-content").length){levelCoverAmount=(($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""))?($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""):this.getCover();}else{levelCoverAmount=this.getCover();}coverInput.val(levelCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}else{if($("input:hidden[name$=levelSelected]").val()=="true"&&(modelName=="ops-level-term-calculator-model")){levelCoverAmount=(($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""))?($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""):this.getCover();coverInput.val(levelCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}}if($("input:hidden[name$=decreasingSelected]").val()=="false"&&(modelName=="ops-decreasing-term-calculator-model")){if($(".quote-content").length){decCoverAmount=(($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""))?($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""):this.getCover();}else{decCoverAmount=this.getCover();}coverInput.val(decCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}else{if($("input:hidden[name$=decreasingSelected]").val()=="true"&&(modelName=="ops-decreasing-term-calculator-model")){decCoverAmount=(($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""))?($("[name$=ops-total-cover]").val()).replace(/[^0-9]/g,""):this.getCover();coverInput.val(decCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));
}}if(modelName=="ops-level-term-calculator-model"){coverAmount=levelCoverAmount;}else{if(modelName=="ops-decreasing-term-calculator-model"){coverAmount=decCoverAmount;}}if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"){if(parseInt(coverInput.val().replace(/,/g,""))>=coverAmount&&parseFloat(premium)>=5&&parseInt(coverInput.val().replace(/,/g,""))<=parseInt(coverLimitContainer.find(".max .limit").html().replace(/,/g,""))&&parseInt(termInput.val().replace(/,/g,""))>=parseInt(termLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseInt(termInput.val().replace(/,/g,""))<=parseInt(termLimitContainer.find(".max .limit").html().replace(/,/g,""))){$(".sidePaneHeadingRight").removeClass("disabledDiv");var term=this.getTerm();var getCover=this.getCover();var saleCost=this.getSaleCost();this.fields.cover.html("&pound;"+LBG.converter.formatCurrency(getCover));this.fields.term.html(term+" years");this.fields.premium.html("&pound;"+premium);this.fields.total.html("&pound;"+(premium*term*12).toFixed(2));if(parseInt($("input:hidden[name$=exactCustomerAge]").val())==18){this.fields.age.html(this.getTerm()+18);}else{this.fields.age.html(this.getModel().getAge()+this.getTerm()-1);}$("span.ops-sale-cost").html(saleCost);$(".showSubmitErrorPrepend").removeClass("ops-monthly-error");$(".showSubmitErrorPrependMLIQuote").removeClass("ops-monthly-error");$(".opsRightPanelTotalToggle").show();if(formStatus=="false"&&parseFloat(premium)<5){errorMessage.show();}else{LBG.enableQuoteTabsMli();errorMessage.removeClass("formSubmitError").empty();}}else{if(parseFloat(premium)<5&&parseFloat(premium)>0){LBG.disableQuoteTabsOnLoad.init();errorMessage.show();$(".showSubmitErrorPrepend").addClass("formSubmitError ops-monthly-error");$(".showSubmitErrorPrependMLIQuote").addClass("formSubmitError ops-monthly-error");$(".opsRightPanelTotalToggle").hide();$(".showSubmitErrorPrepend").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3015);$(".showSubmitErrorPrependMLIQuote").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3278);}this.clearSummaryPanel();}}else{$("span.ops-monthly-max-amount.limit").html(monthlyMaxCoverAmount);var getCover=this.getCover();var monCoverInput=$("[name$=ops-monthly-premium]"),monTermInput=$("[name$=ops-monthly-length]"),coverLimitContainer=monCoverInput.closest(".formFieldInner").find(".limit-container"),termLimitContainer=monTermInput.closest(".formFieldInner").find(".limit-container");if(parseFloat(monCoverInput.val().replace(/,/g,""))>=parseFloat(coverLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseFloat(monCoverInput.val().replace(/,/g,""))<=monthlyMaxCoverAmount&&parseInt(getCover)<=500000&&parseInt(monTermInput.val().replace(/,/g,""))>=parseInt(termLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseInt(monTermInput.val().replace(/,/g,""))<=parseInt(termLimitContainer.find(".max .limit").html().replace(/,/g,""))){$(".sidePaneHeadingRight").removeClass("disabledDiv");var term=this.getTerm();var saleCost=this.getSaleCost();this.fields.cover.html("&pound;"+LBG.converter.formatCurrency(getCover));this.fields.term.html(term+" years");this.fields.premium.html("&pound;"+premium);this.fields.total.html("&pound;"+(premium*term*12).toFixed(2));if(parseInt($("input:hidden[name$=exactCustomerAge]").val())==18){this.fields.age.html(this.getTerm()+18);}else{this.fields.age.html(this.getModel().getAge()+this.getTerm()-1);}$("span.ops-sale-cost").html(saleCost);$(".showSubmitErrorPrepend").removeClass("ops-total-error");$(".showSubmitErrorPrependMLIQuote").removeClass("ops-total-error");$(".opsRightPanelMonthlyToggle").show();if(formStatus=="false"&&parseInt(coverAmount)<500000){errorMessage.show();}else{LBG.enableQuoteTabsMli();errorMessage.removeClass("formSubmitError").empty();}}else{if(parseInt(this.getCover())>500000){LBG.disableQuoteTabsOnLoad.init();errorMessage.show();$(".showSubmitErrorPrepend").addClass("formSubmitError ops-total-error");$(".showSubmitErrorPrependMLIQuote").addClass("formSubmitError ops-total-error");$(".opsRightPanelMonthlyToggle").hide();$(".showSubmitErrorPrepend").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3014);$(".showSubmitErrorPrependMLIQuote").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3277);}this.clearSummaryPanel();}}},clearSummaryPanel:function(){$(".sidePaneHeadingRight").each(function(){$(this).addClass("disabledDiv");});this.fields.cover.html("");this.fields.term.html("");this.fields.premium.html("");this.fields.total.html("");this.fields.age.html("");},updateEngagementHub:function(){var coverAmount=this.getCoverEngagement();var defaultAmount,defaultTerm;if($("input:hidden[name$=mliCRSwitchStatus]").val()=="true"){defaultAmount=this.getDefaultCoverAmount();defaultTerm=this.getDefaultTermAmount();}else{defaultAmount=coverAmount.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");}var $summary=$(".ops-engagement-hub .summary");var errorMessage=$("div.formSubmitError");var coverInput=$("[name$=ops-total-cover]"),lengthInput=$("[name$=ops-total-length]"),coverLimitContainer=coverInput.closest(".formFieldInner").find(".limit-container"),lengthLimitContainer=lengthInput.closest(".formFieldInner").find(".limit-container");if($("input:hidden[name$=decreasingSelected]").val()=="false"){$("input:hidden[name$=decreasingSelected]").val("true");defaultAmount=defaultAmount.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");coverInput.val(defaultAmount);if(defaultTerm){lengthInput.val(defaultTerm);$(".opsCoverTerm .ui-slider").slider("value",defaultTerm);}if(typeof(defaultAmount)==="string"){$(".opsCoverAmount .ui-slider").slider("value",parseInt(defaultAmount.replace(/,/g,"")));}else{$(".opsCoverAmount .ui-slider").slider("value",defaultAmount);}}if(parseInt(coverInput.val().replace(/,/g,""))>=parseInt(coverAmount)&&parseInt(coverInput.val().replace(/,/g,""))<=parseInt(coverLimitContainer.find(".max .limit").html().replace(/,/g,""))&&parseInt(lengthInput.val().replace(/,/g,""))>=parseInt(lengthLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseInt(lengthInput.val().replace(/,/g,""))<=parseInt(lengthLimitContainer.find(".max .limit").html().replace(/,/g,""))){$summary.css("display","block");errorMessage.removeClass("formSubmitError").empty();$(".opsOptions").show();var premiumCounts=this.getPremiumEngagement();$(".ops-engagement-hub .levelPremium").html(premiumCounts.level);$(".ops-engagement-hub .decreasingPremium").html(premiumCounts.decreasing);}else{$summary.css("display","none");errorMessage.show();$(".showSubmitErrorPrepend").addClass("formSubmitError");$(".showSubmitErrorPrependMLI").addClass("formSubmitError");$(".opsOptions").hide();$(".showSubmitErrorPrepend").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3015);$(".showSubmitErrorPrependMLI").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3278);}},getBaseRate:function(){return this.getModel().getBaseRate(term);}});var OPSMonthlyCalculator=OPSCalculator.extend(".ops-calculator-monthly",{init:function(elem){this._super(elem);this.premium=$("[name$=ops-monthly-premium]",elem);this.term=$("[name$=ops-monthly-length]",elem);},getPremium:function(){return parseFloat(this.premium.val().replace(/,/g,"")||0).toFixed(2);},getCover:function(){var premium=this.getPremium();var modelName=this.element.attr("class").match(/ops-[\-a-z]+calculator-model/)[0];if($("input:hidden[name$=levelSelected]").val()=="false"&&(modelName=="ops-level-term-calculator-model")){$("input:hidden[name$=levelSelected]").val("true");
premium=5;}if($("input:hidden[name$=decreasingSelected]").val()=="false"&&(modelName=="ops-decreasing-term-calculator-model")){$("input:hidden[name$=decreasingSelected]").val("true");premium=5;}var cover=0;if($("input:hidden[name$=switchStatusRepriceCR]").val()=="true"){cover=1000*(((((premium-this.getModel().getPolicyFee())/(this.getModel().getDiscountFactor()))*12)-this.getModel().getFixedAdjustment())/((1+this.getModel().getTotalRating()/100)*this.getModel().getBaseRate(this.getTerm())));}else{if($("input:hidden[name$=switchStatusRepriceCR]").val()=="false"){cover=1000*((premium-this.getModel().getPolicyFee())/(1+this.getModel().getTotalRating()/100)*12)/(this.getModel().getBaseRate(this.getTerm())*this.getModel().getDiscountFactor());}}return(cover).toFixed();}});var OPSTotalCalculator=OPSCalculator.extend(".ops-calculator-total",{init:function(elem){this._super(elem);this.cover=$("[name$=ops-total-cover]",elem);this.term=$("[name$=ops-total-length]",elem);},getDefaultCoverAmount:function(){return parseInt($("input:hidden[name$=defaultCoverAmountValueMLI]").val())||0;},getDefaultTermAmount:function(){return parseInt($("input:hidden[name$=defaultTermAmountValueMLI]").val())||0;},getPremium:function(e){var premium=0;if($("input:hidden[name$=switchStatusRepriceCR]").val()=="true"){premium=this.getModel().getPolicyFee()+((((1+(this.getModel().getTotalRating()/100))*this.cover.val().replace(/,/g,"")*(this.getModel().getBaseRate(this.getTerm())/1000))+this.getModel().getFixedAdjustment())*(this.getModel().getDiscountFactor()/12));}else{if($("input:hidden[name$=switchStatusRepriceCR]").val()=="false"){premium=(1+this.getModel().getTotalRating()/100)*(this.cover.val().replace(/,/g,"")/1000*this.getModel().getBaseRate(this.getTerm())*this.getModel().getDiscountFactor()/12)+this.getModel().getPolicyFee();}}return(premium).toFixed(2);},getCover:function(){return parseInt(this.cover.val().replace(/,/g,"")||0).toFixed();},getPremiumEngagement:function(e){var premiumJson={};if($("input:hidden[name$=switchStatusRepriceCR]").val()=="true"){premiumJson={level:(this.getModels().level.getPolicyFee()+((((1+(this.getModels().level.getTotalRating()/100))*$("[name$=ops-total-cover]").val().replace(/,/g,"")*(this.getModels().level.getBaseRate(this.getTerm())/1000))+this.getModels().level.getFixedAdjustment())*(this.getModels().level.getDiscountFactor()/12))).toFixed(2),decreasing:(this.getModels().decreasing.getPolicyFee()+((((1+(this.getModels().decreasing.getTotalRating()/100))*$("[name$=ops-total-cover]").val().replace(/,/g,"")*(this.getModels().decreasing.getBaseRate(this.getTerm())/1000))+this.getModels().decreasing.getFixedAdjustment())*(this.getModels().decreasing.getDiscountFactor()/12))).toFixed(2)};}else{if($("input:hidden[name$=switchStatusRepriceCR]").val()=="false"){premiumJson={level:((1+this.getModels().level.getTotalRating()/100)*($("[name$=ops-total-cover]").val().replace(/,/g,"")/1000*this.getModels().level.getBaseRate(this.getTerm())*this.getModels().level.getDiscountFactor()/12)+this.getModels().level.getPolicyFee()).toFixed(2),decreasing:((1+this.getModels().decreasing.getTotalRating()/100)*($("[name$=ops-total-cover]").val().replace(/,/g,"")/1000*this.getModels().decreasing.getBaseRate(this.getTerm())*this.getModels().decreasing.getDiscountFactor()/12)+this.getModels().decreasing.getPolicyFee()).toFixed(2)};}}return premiumJson;},getCoverEngagement:function(){var premium=5;var coverEngagement=0;if($("input:hidden[name$=switchStatusRepriceCR]").val()=="true"){coverEngagement=1000*(((((premium-this.getModels().decreasing.getPolicyFee())/(this.getModels().decreasing.getDiscountFactor()))*12)-this.getModels().decreasing.getFixedAdjustment())/((1+this.getModels().decreasing.getTotalRating()/100)*this.getModels().decreasing.getBaseRate(this.getTerm())));}else{if($("input:hidden[name$=switchStatusRepriceCR]").val()=="false"){coverEngagement=1000*((premium-this.getModels().decreasing.getPolicyFee())/(1+this.getModels().decreasing.getTotalRating()/100)*12)/(this.getModels().decreasing.getBaseRate(this.getTerm())*this.getModels().decreasing.getDiscountFactor());}}return(coverEngagement).toFixed();}});var Model=new Class({init:function(elem,config){var data;if(window["JSON"]){data=JSON.parse(elem.html());}else{var text=elem.html();data=!(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(text.replace(/"(\\.|[^"\\])*"/g,"")))&&eval("("+text+")");}this.data=new Config(data);this.config=config;}});var OPSCalculatorModel=Model.extend({init:function(elem){this._super(elem,new Config(DI.onlineProtectionSales));},getMaximumAge:function(){return this.config.get("maximum-age");},getMinimumAge:function(){return this.config.get("minimum-age");},getAge:function(){return Math.max(this.config.get("minimum-age"),parseInt(this.data.get("customer-age")));},getSaleCost:function(){return this.data.get("cost-of-sale");},getSaleCostPercent:function(){return this.data.get("cost-sale-perc");},getMinimumCoverAmount:function(){return this.data.get("min-cover-amt");},getMonthlyMaxCoverAmount:function(){return this.data.get("monthly-max-cover-amt");},getPolicyFee:function(){return this.data.get("policy-fee");},getSumAssured:function(){return this.data.get("sum-assured");},getTotalRating:function(){return this.data.get("total-rating");},getDiscountFactor:function(){var discountFactor=0;if($("input:hidden[name$=switchStatusRepriceCR]").val()=="true"){var factorList=this.data.get("factor-list").obj[0];var tmp=new Config(factorList);discountFactor=tmp.get("discount-factor");}else{discountFactor=this.data.get("discount-factor");}return discountFactor;},getFixedAdjustment:function(){var factorList=this.data.get("factor-list").obj[0];var tmp=new Config(factorList);var fixedAdjustment=tmp.get("fixed-adjustment");return fixedAdjustment;},getBoundaryRates:function(targetTerm){var targetTerm=parseInt(targetTerm),isBoundaryTerm=targetTerm%5==0,data=this.data.get("base-rate-list"),targetAge=this.data.get("customer-age");var compare=function(fromBelow){if(fromBelow){return(function(value,target,current){return value<=target&&(null==current||value>=current);});}else{return(function(value,target,current){return value>=target&&(null==current||value<=current);});}};var rates={upper:{upper:null,lower:null},lower:{upper:null,lower:null}};var lower=compare(true);var upper=compare();var check=0;var C=function(obj){return new Config(obj);};for(var i=0;i<data.length;i++){var tmp=new Config(data[i]);var term=tmp.get("policy-term");var age=tmp.get("age");if(lower(term,targetTerm,C(rates.lower.upper).tryGetNested("policy-term"))||lower(term,targetTerm,C(rates.lower.lower).tryGetNested("policy-term"))){if(lower(age,targetAge,C(rates.lower.lower).tryGet("age"))){rates.lower.lower=tmp;check|=1;}else{if(upper(age,targetAge,C(rates.lower.upper).tryGet("age"))){rates.lower.upper=tmp;check|=2;}}}if(!isBoundaryTerm&&C(rates.lower.lower).tryGetNested("policy-term")==(term-5)&&C(rates.lower.lower).tryGetNested("age")==age){rates.upper.lower=tmp;check|=4;}if(!isBoundaryTerm&&C(rates.lower.upper).tryGetNested("policy-term")==(term-5)&&C(rates.lower.upper).tryGetNested("age")==age){rates.upper.upper=tmp;check|=8;}}if(isBoundaryTerm){rates.upper.lower=rates.lower.lower;rates.upper.upper=rates.lower.upper;check=15;}if(15!=check){throw"Could not find matching boundary for term '"+term+"'";}for(var fkey in rates){if(rates.hasOwnProperty(fkey)){for(var skey in rates[fkey]){if(rates[fkey].hasOwnProperty(skey)){rates[fkey][skey]=rates[fkey][skey].get("rates");
}}}}return rates;},getRateInterpolator:function(position,gap){return function(rates){return rates.lower+(rates.upper-rates.lower)*(position%gap)/gap;};},getBaseRate:function(term){var rates=this.getBoundaryRates(term);var intByAge=this.getRateInterpolator(this.getAge(),5);var intByTerm=this.getRateInterpolator(term,5);return Math.round(intByTerm({lower:intByAge(rates.lower),upper:intByAge(rates.upper)})*10000)/10000;}});LBG.OPSSummaryData={init:function(){if($(".ops-calculator input[type='radio']").is(":checked")){var totalFlag=$("input:hidden[name$=opsPanelUsedHiddenInfo]").val();if(totalFlag=="true"){$(".ops-calculator-total").removeClass("statusToggleHide");$(".ops-calculator-monthly").addClass("statusToggleHide");}else{$(".ops-calculator-monthly").removeClass("statusToggleHide");$(".ops-calculator-total").addClass("statusToggleHide");}$("input[type='radio']:checked")[0].click();$(".ui-slider").each(function(){$(this).trigger("slidechange");});}$(".ops-engagement-hub .opsCoverAmount").find(".slider").trigger("slidechange");},continueJourney:function(){if($("input:hidden[name$=frmOPSStatus]").val()=="false"){$("input:hidden[name$=frmOPSStatus]").val("true");}}};var OPSLevelCalculatorModel=OPSCalculatorModel.extend("[type='application/json; model=ops-level-term-calculator-model']",{});var OPSDecreasingCalculatorModel=OPSCalculatorModel.extend("[type='application/json; model=ops-decreasing-term-calculator-model']",{});LBG.sliderInputProgress={init:function(){var conf=new Config(DI);var trigger=$(".slider-input.progressbar input:text, .slider-input input:text"),sliderWrapper='<div class="sliderWrapper"><div><div class="sliderInnerWrapper"><div class="slider"><div class="progressArea progressColored" /></div></div></div><div class="ccMinLimit"></div><div class="clearer"></div></div>',btnPlus='<span class="plus"><a href="#" title="'+conf.getPath("sliderInput/button/plus","Increase")+'">'+conf.getPath("sliderInput/button/plus","Increase")+"</a></span>",btnMinus='<span class="minus"><a href="#" title="'+conf.getPath("sliderInput/button/minus","Decrease")+'">'+conf.getPath("sliderInput/button/minus","Decrease")+"</a></span>";if(!trigger.length){return;}function commaConvert(currAmount){return currAmount.replace(/\B(?=(\d{3})+(?!\d))/g,",");}if(LBG.sliderInputProgress.determineAdjusterPresence()){var availableCredit=function(){return parseInt($(".secondCard").find("[name$=available-credit-limit]").text().replace(/,/g,""));};var compareUIValues=function(ui,input){if(ui.value>=parseFloat(input.val().replace(/,/,""))){return true;}return false;};$(".progressBarContainer").each(function(){var minimum=parseFloat($(".currentValue span",this).text().replace(/[^\d\.]/g,""));var maximum=parseFloat($(".ccLimit span",this).text().replace(/[^\d\.]/g,""));var ratio=minimum/maximum;$(".preamble",this).width(ratio*100+"%");$(".innerChart",this).width((1-ratio)*100+"%");});}var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(trigger);trigger.each(function(i){var input=$(this),params=input.metadata(),sliderMin=parseInt(input.closest(".formFieldInner").find(".minVal, .min .limit").text().replace(/,/,""),10),sliderMax=parseFloat(input.closest(".formFieldInner").find(".maxVal, .max .limit").text().replace(/,/,""),10),interval=(params.sliderInterval)?parseFloat(params.sliderInterval,10):1,startOverlay=parseInt(input.closest(".formFieldInner").find(".startBestRate").text().replace(/,/,""),10),endOverlay=parseInt(input.closest(".formFieldInner").find(".endBestRate").text().replace(/,/,""),10),positionOverlay,widthOverlay,slider,oValue,labelUnit;var formFieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData($(this).closest(".formField")[0],"validationName:")[0];var formFieldValidationHandler=formValidationHandler.getChild(formFieldName);if(params.allowDecimals&&interval!="undefined"){interval=parseFloat(interval.toFixed(2));}input.closest("input").after(sliderWrapper);slider=input.closest("input").next(".sliderWrapper").find(".slider");slider.slider({min:sliderMin,max:sliderMax,step:interval,animate:!$(".secondCard").length,slide:function(event,ui){function updateValues(value){if(params.allowDecimals&&value!="undefined"){value=value.toFixed(2);if((slider.slider("option","max")-value)<1){slider.slider("option","step",0.01);value=parseFloat(slider.slider("option","max"));}else{slider.slider("option","step",interval);}}input.val(value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")).change();if(LBG.sliderInputProgress.determineAdjusterPresence()){LBG.sliderInputProgress.adjustProgressBar(slider);}}if(LBG.sliderInputProgress.determineAdjusterPresence()){var getAvailableCredit=function(override){var progressBar=$(".progressBarContainer");var availableCredit=parseInt(progressBar.find(".maxValue span").text().replace(/,/,""))-parseInt(progressBar.find(".minValue span").text().replace(/,/,""));var total=0;$(".slider-input.progressbar").each(function(i){var min=parseInt($(this).find(".min .limit").text().replace(/,/,""));var newLimit=$(event.target).parents(".slider-input.progressbar:eq(0)")[0]==this&&!override?ui.value:$(this).find("input").val().replace(/,/,"");total+=(newLimit-min);});return availableCredit-total;};var available=getAvailableCredit();if(available<0){slider.slider("value",ui.value+available);updateValues(ui.value+available);return false;}}LBG.OPSSummaryData.continueJourney();updateValues(ui.value);},stop:function(event){if(LBG.sliderInputProgress.determineAdjusterPresence()){LBG.sliderInputProgress.adjustProgressBar(slider);}},start:function(event,ui){if(params.allowDecimals&&(parseFloat(ui.value)!="undefined")){ui.value=parseFloat(ui.value).toFixed(2);}input.val(ui.value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));if(formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;}}});$(".slider").find("a.ui-slider-handle").attr({title:"Slider Price Ajust Bar",href:"slidebar"});if($(this).parents(".secondCard").length>0){var ratio=sliderMin/sliderMax;ratio=(ratio>0.8)?0.8:ratio;$(".ccMinLimit",$(this).parents(".slider-input.progressbar")).width(ratio*100+"%");$(".sliderInnerWrapper",$(this).parents(".slider-input.progressbar")).css("left",ratio*100+"%");}input.focus(function(){if(!(formFieldValidationHandler.isShowingError)){oValue=$(this).val().replace(/,/,"");}});var getAvailableCredit=function(context){var progressBar=$(".progressBarContainer");var availableCredit=parseInt(progressBar.find(".maxValue span").text().replace(/,/,""))-parseInt(progressBar.find(".minValue span").text().replace(/,/,""));var total=0;$(".slider-input.progressbar").filter(function(){return this!=context;}).each(function(i){var min=getMinimumLimit(this);var newLimit=getCurrentLimit(this);total+=(newLimit-min);});return availableCredit-total;};var sanitiseStringNumber=function(number){if(params.allowDecimals){return parseFloat(number.replace(/,/,"")).toFixed(2);}else{return parseFloat(number.replace(/[^\d\.]/g,""));}};var getMinimumLimit=function(context){return sanitiseStringNumber($(context).find(".min .limit").text());};var getMaximumLimit=function(context){return sanitiseStringNumber($(context).find(".max .limit").text());};var getCurrentLimit=function(context){return sanitiseStringNumber($(context).find("input").val());};input.blur(function(){var typedVal=$(this).val().replace(/,/,"");if(formFieldValidationHandler.isShowingError&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);
}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}input.change();});input.bind("keypress",function(e){var typedVal=sanitiseStringNumber($(this).val().replace(/,/,""));if(e.keyCode===13&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}});input.change(function(){var typedVal=$(this).val().replace(/,/,""),roundedVal,i;if(!params.allowDecimals){if(typedVal.indexOf(".")!==-1){typedVal=typedVal.substr(0,typedVal.indexOf("."));}}if(!isNaN(Math.abs(typedVal))){if(typedVal%interval!==0){roundedVal=Math.round(typedVal/interval)*interval;slider.slider("value",roundedVal);}else{slider.slider("value",typedVal);}}$(this).val(typedVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));});input.change();slider.parent().before(btnMinus).after(btnPlus);$(input.closest(".formFieldInner").find(".minus,.plus")).bind("click",function(e){if(LBG.sliderInputProgress.determineAdjusterPresence()){if($(this).hasClass("plus")){if(availableCredit()<=0){return false;}}}if(params.updatableSlider){var context=input.parents(".slider-input")[0];sliderMin=getMinimumLimit(context);sliderMax=getMaximumLimit(context);}var oldVal=parseFloat(input.val().replace(/,/,""),10),newVal;if(isNaN(oldVal)){oldVal=sliderMin;}e.preventDefault();LBG.OPSSummaryData.continueJourney();if($(this).hasClass("minus")){newVal=((oldVal-interval)<sliderMin)?sliderMin:(oldVal-interval);newVal=(parseFloat(newVal)>=parseFloat(sliderMax))?sliderMax:Math.round(newVal);}else{newVal=((oldVal+interval)>sliderMax)?sliderMax:(oldVal+interval);newVal=(parseFloat(newVal)<=parseFloat(sliderMin))?sliderMin:newVal;}if(newVal>sliderMin&&newVal<sliderMax){newVal=newVal%interval?Math.round(newVal/interval)*interval:newVal;}if(params.allowDecimals){if(newVal!="undefined"){newVal=parseFloat(newVal).toFixed(2);}}slider.slider("option","value",newVal).trigger("slide");if(newVal>=sliderMin&&newVal<=sliderMax&&formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;}newVal=newVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");input.val(newVal).change();});$(input.closest(".slider-input.progressbar").find(".minus")).bind("click",function(e){if(!LBG.Forms.Validation.Routines.validateSliderProgress($(this).closest(".formField"))){var newVal=sliderMin.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");input.val(newVal).blur();}});if(startOverlay<endOverlay&&startOverlay>=sliderMin&&endOverlay<=sliderMax){positionOverlay=((startOverlay-sliderMin)/(sliderMax-sliderMin))*100;widthOverlay=(((endOverlay-startOverlay)/(sliderMax-sliderMin))*100);input.closest(".formFieldInner").find(".slider").append('<div class="overlayLoanCalculator" style="left:'+positionOverlay+"%; width:"+widthOverlay+'%;"/>');}if(input.prev("span").hasClass("currency")){labelUnit=input.prev("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").prepend(labelUnit);}if(input.next("span").hasClass("durationUnit")){labelUnit=" "+input.next("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").append(labelUnit);}});$(".ui-slider a").bind("touchmove",function(e){var evt=e.originalEvent;evt.preventDefault();if(evt.touches.length>1||(evt.type=="touchend"&&evt.touches.length>0)){return;}var newEvt=document.createEvent("MouseEvents");var touch=evt.changedTouches[0];newEvt.initMouseEvent("mousemove",true,true,window,0,touch.screenX,touch.screenY,touch.clientX,touch.clientY,evt.ctrlKey,evt.altKey,evt.shiftKey,evt.metaKey,0,null);this.dispatchEvent(newEvt);}).bind("touchstart",function(e){var evt=e.originalEvent;evt.preventDefault();if(evt.touches.length>1||(evt.type=="touchend"&&evt.touches.length>0)){return;}var newEvt=document.createEvent("MouseEvents");var touch=evt.changedTouches[0];newEvt.initMouseEvent("mousedown",true,true,window,0,touch.screenX,touch.screenY,touch.clientX,touch.clientY,evt.ctrlKey,evt.altKey,evt.shiftKey,evt.metaKey,0,null);this.dispatchEvent(newEvt);}).bind("touchend",function(e){var evt=e.originalEvent;evt.preventDefault();if(evt.touches.length>1||(evt.type=="touchend"&&evt.touches.length>0)){return;}var newEvt=document.createEvent("MouseEvents");var touch=evt.changedTouches[0];newEvt.initMouseEvent("mouseup",true,true,window,0,touch.screenX,touch.screenY,touch.clientX,touch.clientY,evt.ctrlKey,evt.altKey,evt.shiftKey,evt.metaKey,0,null);this.dispatchEvent(newEvt);});},determineAdjusterPresence:function(){return $(".adjuster").length;},adjustProgressBar:function(slider){if(LBG.sliderInputProgress.determineAdjusterPresence()){var sanitiseStringNumber=function(number){return parseFloat(number.replace(/[^\d\.]/g,""));};function commaConvert(currAmount){return currAmount.replace(/\B(?=(\d{3})+(?!\d))/g,",");}var progressBar=$(".progressBarContainer");var availableCredit=sanitiseStringNumber(progressBar.find(".maxValue span").text())-sanitiseStringNumber(progressBar.find(".minValue span").text());var runningTotal=0;$(".slider-input.progressbar").each(function(i){var min=sanitiseStringNumber($(this).find(".min .limit").text());var max=sanitiseStringNumber($(this).find(".max .limit").text());var newLimit=sanitiseStringNumber($(this).find("input").val());runningTotal+=(newLimit-min);var currAvCred=$(this).find("p.currentAvailableCredit span.currentAvailableCreditAmount");if(!currAvCred.data("initial-value")){currAvCred.data("initial-value",sanitiseStringNumber(currAvCred.text()));}var currentAvailableCredit=currAvCred.data("initial-value")+(newLimit-min);if(!isNaN(currentAvailableCredit)){$(this).find("p.currentAvailableCredit span.currentAvailableCreditAmount").text(commaConvert(parseFloat(currentAvailableCredit).toFixed(2)));}var position=$(".ui-slider-handle",$(this)).css("left");if(position){$(".progressArea",$(this)).css("width",parseInt(position.slice(0,-1))+2+"%");}});var pc=(availableCredit-runningTotal)/availableCredit*100;progressBar.find(".value").css("width",pc+"%");var ccAvailableLimit=progressBar.find(".ccAvailable span.currentAvailableCreditAmount");if(!ccAvailableLimit.data("initial-value")){ccAvailableLimit.data("initial-value",sanitiseStringNumber(ccAvailableLimit.text()).toFixed(2));}var ccAvailableLimitVal=parseFloat(ccAvailableLimit.data("initial-value")-runningTotal).toFixed(2);var creditLeft=availableCredit-runningTotal;if(!isNaN(ccAvailableLimitVal)){progressBar.find(".ccAvailable span.currentAvailableCreditAmount").text(commaConvert(ccAvailableLimitVal));}if(!isNaN(creditLeft)){$(".sliderAvailableCredit span:first").text(commaConvert(creditLeft.toString()));}var currentCCLimit=progressBar.find(".ccLimit span");if(!currentCCLimit.data("initial-value")){currentCCLimit.data("initial-value",sanitiseStringNumber(commaConvert(currentCCLimit.text())));}var newCCLimit=currentCCLimit.data("initial-value")-runningTotal;if(!isNaN(newCCLimit)){progressBar.find(".ccLimit span").text(commaConvert(parseFloat(newCCLimit).toString()));}}}};function overlayMliCRQuotePage(e){var $this=$(e.target);var cover=parseInt($("table.total .cover").html().replace("£","").replace(",",""));var monthlyTerm=$("table.total .term").html().replace("years","").trim();var monthlyCover=parseInt($("table.monthly .cover").html().replace("£","").replace(",",""));var totalTerm=$("table.monthly .term").html().replace("years","").trim();var term=parseInt($("table.total .term").html().replace("years","").trim());
if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"&&cover==parseInt($("input:hidden[name$=defaultCoverIBAAmountValueMLI]").val())&&term==parseInt($("input:hidden[name$=defaultTermIBAAmountValueMLI]").val())){$(".exitOverlay").find(".overlay-cover").html($("table.total .cover").html());$(".exitOverlay").find(".overlay-term").html($("table.total .term").html());$(".exitOverlay").find(".overlay-premium").html($("table.total .premium").html());showOverlay("exitOverlayDOMElement",$this);}else{if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="false"&&monthlyCover==parseInt($("input:hidden[name$=defaultCoverIBAAmountValueMLI]").val())&&totalTerm==parseInt($("input:hidden[name$=defaultTermIBAAmountValueMLI]").val())){$(".exitOverlay").find(".cover").html($("table.monthly .cover").html());$(".exitOverlay").find(".term").html($("table.monthly .term").html());$(".exitOverlay").find(".premium").html($("table.monthly .premium").html());showOverlay("exitOverlayDOMElement",$this);}else{if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"&&monthlyTerm<=10){$(".ops-lowterm-overlay").find(".term").html($("table.total .term").html());$(".ops-lowterm-overlay").find(".age").html($("table.total .age").html());$(".ops-lowterm-overlay").find(".overlay-cover").html($("table.total .cover").html());$(".ops-lowterm-overlay").find(".overlay-premium").html($("table.total .premium").html());showOverlay("lowTermOverlayDOMElement",$this);}else{if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="false"&&totalTerm<=10){$(".ops-lowterm-overlay").find(".term").html($("table.monthly .term").html());$(".ops-lowterm-overlay").find(".age").html($("table.monthly .age").html());$(".ops-lowterm-overlay").find(".cover").html($("table.monthly .cover").html());$(".ops-lowterm-overlay").find(".premium").html($("table.monthly .premium").html());showOverlay("lowTermOverlayDOMElement",$this);}}}}e.preventDefault();e.stopImmediatePropagation();function showOverlay(domElementName,element){var metadata=element.metadata();element.show();var $domElement=metadata[domElementName]?$(metadata[domElementName]).eq(0).clone():undefined;if($domElement){$domElement[0].className+="-temp";LBG.overlay.fromDomElement=true;LBG.overlay.open($domElement,this,true);$("div."+$domElement[0].className).show();$("body").append($domElement);}}}LBG.carFinanceTable={json:false,init:function(){if($("table.car-finance").length>0){$(".car-finance-deposit .formField, .car-finance-price .formField").removeClass("amountField");$(".car-finance .slider-input input[type=text]").change(function(){LBG.carFinanceTable.updateTable();});if($("#updateTable").length){var hdnTrigger=document.getElementById("updateTable").value;if(hdnTrigger==="true"||hdnTrigger==="True"||hdnTrigger==="TRUE"){LBG.carFinanceTable.updateTable();}}$(".car-finance .slider-input input[type=text]").bind("keypress",function(e){if(e.which===13){e.preventDefault();e.stopPropagation();}});$(".car-finance .car-finance-print-quote a:not(.newwin)").unbind("click").live("click",function(e){e.preventDefault();var printLink=$(this);$.ajax({data:{carMake:$(".car-finance .car-make").html(),carModel:$(".car-finance .car-model").html(),carDerivative:$(".car-finance .car-derivative").html(),carRegistration:$(".car-finance .car-registration").html(),carRegYear:$(".car-finance .car-reg-year").html(),carPrice:$(".car-finance-price input.input-text").val(),deposit:$(".car-finance-deposit input.input-text").val(),hpLoanAmount:$(".car-finance .hp-loan-amount").html(),hpTerm:$(".car-finance .hp-term").html(),hpApr:$(".car-finance .hp-apr").html(),hpTotalPayable:$(".car-finance .hp-total-payable").html(),hpMonthly:$(".car-finance .hp-monthly").html(),hpFinalPayment:$(".car-finance .hp-final-payment").html(),fpLoanAmount:$(".car-finance .fp-loan-amount").html(),fpTerm:$(".car-finance .fp-term").html(),fpApr:$(".car-finance .fp-apr").html(),fpTotalPayable:$(".car-finance .fp-total-payable").html(),fpMonthly:$(".car-finance .fp-monthly").html(),fpFinalPayment:$(".car-finance .fp-final-payment").html()},url:"/personal/ajax/printFunction",success:function(){printLink.addClass("newwin").unbind().click().removeClass("newwin");},error:function(){window.location.replace(DI.lang.loans.car.detailsDropdown.ajax.errorUrl);}});});}},updateTable:function(){if($(".formField").hasClass("error")){LBG.carFinanceTable.productStatus("hp",false);LBG.carFinanceTable.productStatus("fp",false);LBG.carFinanceTable.messageController([]);return;}var json=LBG.carFinanceTable.json;if(json.hp){var customerLimitsHp={minMonthlyPayment:json.min_monthly_payment||0,maxMonthlyPayment:json.max_monthly_payment,hpMinDepositPriceRatio:json.hp.min_deposit_price_ratio||0,hpMinLoanAmount:json.hp.min_amount,hpMaxLoanAmount:json.hp.max_amount,hpMinTerm:json.hp.min_term,hpMaxTerm:json.hp.max_term,hpMaxTermAge:json.hp.max_term_age};}if(json.fp){var customerLimitsFp={minMonthlyPayment:json.min_monthly_payment||0,maxMonthlyPayment:json.max_monthly_payment,fpMinDepositPriceRatio:json.fp.min_deposit_price_ratio||0,fpMinLoanAmount:json.fp.min_amount,fpMaxLoanAmount:json.fp.max_amount,fpMinTerm:json.fp.min_term,fpMaxTerm:json.fp.max_term,fpMaxTermAge:json.fp.max_term_age};}var carPrice=parseInt($(".car-finance-price input.input-text").val().replace(/,/,""));var deposit=parseInt($(".car-finance-deposit input.input-text").val().replace(/,/,""));var term=parseInt($(".car-finance-term input.input-text").val());var currentMileage=$("#currentMileage").val();var expectedAnnualMileage=$("#expectedMileage").val();var maxMileage=$("#maxMileage").val();if(currentMileage&&expectedAnnualMileage&&maxMileage){var riSwitch="true";currentMileage=currentMileage?parseFloat(currentMileage.replace(/[^0-9\.]+/g,"")):0;expectedAnnualMileage=expectedAnnualMileage?parseFloat(expectedAnnualMileage.replace(/[^0-9\.]+/g,"")):0;maxMileage=maxMileage?parseFloat(maxMileage.replace(/[^0-9\.]+/g,"")):0;}$("table.car-finance .hp-term").empty().text(term);$("table.car-finance .fp-term").empty().text(term-1);if(isNaN(carPrice)||isNaN(deposit)||isNaN(term)){LBG.carFinanceTable.productStatus("hp",false);LBG.carFinanceTable.productStatus("fp",false);LBG.carFinanceTable.messageController([]);return;}var loanAmount=$(".car-finance-price input.input-text").val().replace(/,/,"")-deposit;$("table.car-finance .hp-loan-amount").empty().text(LBG.converter.formatCurrency(loanAmount.toFixed(2)));$("table.car-finance .fp-loan-amount").empty().text(LBG.converter.formatCurrency(loanAmount.toFixed(2)));if(json.hp){var hpApr=LBG.carFinanceTable.getApr(json.hp.apr,term,deposit,loanAmount);$("table.car-finance .hp-apr").empty().text((hpApr*100).toFixed(1));var monthlyInterestRateHp=LBG.carFinanceTable.getMonthlyInterestRate(hpApr);var monthlyPaymentHp=LBG.carFinanceTable.getMonthlyPaymentHp(loanAmount,term,monthlyInterestRateHp,0);$("table.car-finance .hp-monthly").empty().text(LBG.converter.formatCurrency(monthlyPaymentHp.toFixed(2)));var totalPayableHp=LBG.carFinanceTable.getTotalPayable("hp",term,monthlyPaymentHp,0,json.hp.fee);$("table.car-finance .hp-total-payable").empty().text(LBG.converter.formatCurrency(totalPayableHp.toFixed(2)));}if(json.fp){var fpApr=LBG.carFinanceTable.getApr(json.fp.apr,term,deposit,loanAmount);$("table.car-finance .fp-apr").empty().text((fpApr*100).toFixed(1));var monthlyInterestRateFp=LBG.carFinanceTable.getMonthlyInterestRate(fpApr);var residualValueFp=LBG.carFinanceTable.getResidualValueFp(json.fp.depreciation,carPrice,term);var monthlyPaymentFp=LBG.carFinanceTable.getMonthlyPaymentFp(loanAmount,term,monthlyInterestRateFp,residualValueFp,json.fp.fee);
$("table.car-finance .fp-monthly").empty().text(LBG.converter.formatCurrency(monthlyPaymentFp.toFixed(2)));var finalPaymentFp=LBG.carFinanceTable.getFinalPaymentFp(residualValueFp,json.fp.fee);$("table.car-finance .fp-final-payment").empty().text(LBG.converter.formatCurrency(finalPaymentFp.toFixed(2)));var totalPayableFp=LBG.carFinanceTable.getTotalPayable("fp",term,monthlyPaymentFp,residualValueFp,json.fp.fee);$("table.car-finance .fp-total-payable").empty().text(LBG.converter.formatCurrency(totalPayableFp.toFixed(2)));}if(riSwitch==="true"){var totalMileage=currentMileage+((expectedAnnualMileage/12)*term);var fpTmPermitted=(totalMileage<=98000);}var hpAffordable=(json.hp&&monthlyPaymentHp<=customerLimitsHp.maxMonthlyPayment);var hpPositive=(json.hp&&monthlyPaymentHp>customerLimitsHp.minMonthlyPayment);var hpAmountAboveMin=(json.hp&&loanAmount>=customerLimitsHp.hpMinLoanAmount);var hpAmountBelowMax=(json.hp&&loanAmount<=customerLimitsHp.hpMaxLoanAmount);var hpTermAboveMin=(json.hp&&term>=customerLimitsHp.hpMinTerm);var hpTermBelowMax=(json.hp&&term<=customerLimitsHp.hpMaxTerm);var hpAgeBelowMax=(json.hp&&term<=customerLimitsHp.hpMaxTermAge);var hpDpRatioAboveMin=(json.hp&&(deposit/carPrice)>=customerLimitsHp.hpMinDepositPriceRatio);var fpAffordable=(json.fp&&monthlyPaymentFp<=customerLimitsFp.maxMonthlyPayment);var fpPositive=(json.fp&&monthlyPaymentFp>customerLimitsFp.minMonthlyPayment);var fpAmountAboveMin=(json.fp&&loanAmount>=customerLimitsFp.fpMinLoanAmount);var fpAmountBelowMax=(json.fp&&loanAmount<=customerLimitsFp.fpMaxLoanAmount);var fpTermAboveMin=(json.fp&&term>=customerLimitsFp.fpMinTerm);var fpTermBelowMax=(json.fp&&term<=customerLimitsFp.fpMaxTerm);var fpAgeBelowMax=(json.fp&&term<=customerLimitsFp.fpMaxTermAge);var fpDpRatioAboveMin=(json.fp&&(deposit/carPrice)>=customerLimitsFp.fpMinDepositPriceRatio);var fpCurrentMileageExceeded=(json.fp&&json.fp.max_current_mileage_exceeded);var fpFutureMileageExceeded=(json.fp&&json.fp.max_future_mileage_exceeded);var hpValid=json.hp&&hpAffordable&&hpPositive&&hpAmountAboveMin&&hpAmountBelowMax&&hpTermAboveMin&&hpTermBelowMax&&hpAgeBelowMax&&hpDpRatioAboveMin;var fpValid=json.fp&&fpAffordable&&fpPositive&&fpAmountAboveMin&&fpAmountBelowMax&&fpTermAboveMin&&fpTermBelowMax&&fpAgeBelowMax&&fpDpRatioAboveMin&&!fpCurrentMileageExceeded&&!fpFutureMileageExceeded;if(riSwitch==="true"){fpValid=fpValid&&fpTmPermitted;}LBG.carFinanceTable.productStatus("hp",hpValid);LBG.carFinanceTable.productStatus("fp",fpValid);var msg=[];if(json.hp&&!hpValid){if(!hpAffordable){msg[msg.length]="hp-msgMonthlyMax";}if(!hpPositive){msg[msg.length]="hp-msgMonthlyMin";}if(!hpDpRatioAboveMin){msg[msg.length]="hp-msgDepositRatioMin";}if(!hpAmountAboveMin){msg[msg.length]="hp-msgLoanMin";}if(!hpAmountBelowMax){msg[msg.length]="hp-msgLoanMax";}if(!hpTermAboveMin){msg[msg.length]="hp-msgTermMin";}if(hpTermBelowMax&&!hpAgeBelowMax){msg[msg.length]="hp-msgTermAge";}if(!hpTermBelowMax&&hpAgeBelowMax){msg[msg.length]="hp-msgTermMax";}if(!hpTermBelowMax&&!hpAgeBelowMax){msg[msg.length]="hp-msgTermAge";}}if(!fpTmPermitted&&(riSwitch==="true")){msg[msg.length]="fp-msgTotalMileageNotPermitted";}if(json.fp&&!fpValid){if(fpCurrentMileageExceeded){msg[msg.length]="fp-msgCurrentMileageMax";}else{if(fpFutureMileageExceeded){msg[msg.length]="fp-msgAnnualMileageMax";}else{if(!fpAffordable){msg[msg.length]="fp-msgMonthlyMax";}if(!fpPositive){msg[msg.length]="fp-msgMonthlyMin";}if(!fpDpRatioAboveMin){msg[msg.length]="fp-msgDepositRatioMin";}if(!fpAmountAboveMin){msg[msg.length]="fp-msgLoanMin";}if(!fpAmountBelowMax){msg[msg.length]="fp-msgLoanMax";}if(!fpTermAboveMin){msg[msg.length]="fp-msgTermMin";}if(!fpTermBelowMax){msg[msg.length]="fp-msgTermMax";}else{if(fpTermBelowMax&&!fpAgeBelowMax){msg[msg.length]="fp-msgTermAge";}if(!fpTermBelowMax&&!fpAgeBelowMax){msg[msg.length]="fp-msgTermAge";}}}}}LBG.carFinanceTable.messageController(msg);},getApr:function(terms,desiredTerm,deposit,loanAmount){var apr,terms,deposits,loanAmounts,i,j,k;deposits=terms[terms.length-1];for(i=terms.length-2;i>=0;i-=2){if(desiredTerm>terms[i]){break;}deposits=terms[i+1];}loanAmounts=deposits[1];for(k=0;k<deposits.length;k=k+2){if(deposit<deposits[k]){break;}loanAmounts=deposits[k+1];}apr=loanAmounts[1];for(k=0;k<loanAmounts.length;k=k+2){if(loanAmount<loanAmounts[k]){break;}apr=loanAmounts[k+1];}return apr;},getMonthlyInterestRate:function(apr){return(Math.pow((1+apr),(1/12)))-1;},getMonthlyPaymentHp:function(loanAmount,term,monthlyInterestRate,residualValue){return -(residualValue-loanAmount*Math.pow(1+monthlyInterestRate,term))*monthlyInterestRate/(Math.pow((1+monthlyInterestRate),term)-1);},getMonthlyPaymentFp:function(loanAmount,term,monthlyInterestRate,residualValue,fee){var paymentNumber=term-1;return(loanAmount-(residualValue+fee)/Math.pow((1+monthlyInterestRate),term))/((Math.pow((1+monthlyInterestRate),paymentNumber)-1)/(Math.pow((1+monthlyInterestRate),paymentNumber)*monthlyInterestRate));},getFinalPaymentFp:function(residualValueFp,fee){return residualValueFp+fee;},getTotalPayable:function(type,term,monthlyPayment,residualValueFp,fee){if(type==="hp"){return term*parseFloat(monthlyPayment.toFixed(2));}else{if(type==="fp"){return(term-1)*parseFloat(monthlyPayment.toFixed(2))+residualValueFp+fee;}}},getResidualValueFp:function(depreciationTable,carPrice,term){var depreciationFp=depreciationTable.values[1];for(i=0;i<depreciationTable.values.length;i+=2){if(term<depreciationTable.values[i]){break;}depreciationFp=depreciationTable.values[i+1];}if(depreciationTable.type==="Absolute"){return depreciationFp;}var monthlyDepreciationFp=Math.pow((1-depreciationFp),(1/12))-1;return carPrice*Math.pow((1+monthlyDepreciationFp),term);},productStatus:function(type,state){if($("table.car-finance").length>0){var objTable=$("table.car-finance");var tableRow=objTable.find("tr."+type);var tableHeaderCell=objTable.find("tr th."+type);var tableCell=objTable.find("tr td."+type);var rdoButton=objTable.find("tr td."+type+"input[type=radio]");var carFinance=$(".car-finance");if(state===true){tableRow.removeClass("disabled");tableHeaderCell.removeClass("disabled");tableCell.removeClass("disabled");LBG.carFinanceTable.toggleContinueButton(type,"on");if($(".sji.full-quote").length>0){tableCell.find("input[type=radio]").removeAttr("disabled","disabled");$(".car-finance input[type=radio]").click(function(){LBG.carFinanceTable.toggleContinueButton(type,"on");});}}else{tableRow.addClass("disabled");tableHeaderCell.addClass("disabled");tableCell.addClass("disabled");tableRow.find(".submit-on").addClass("hide");tableRow.find(".submit-off").removeClass("hide");tableCell.find("input[type=radio]").attr("disabled","disabled");LBG.carFinanceTable.toggleContinueButton(type,"off");$("table.car-finance ."+type+"-monthly").empty().text("0.00");$("table.car-finance ."+type+"-loan-amount").empty().text("0.00");$("table.car-finance ."+type+"-term").empty().text("0");$("table.car-finance ."+type+"-apr").empty().text("0.0");if(type==="hp"){$("table.car-finance ."+"hp-final-payment").empty().text("n/a");}else{if(type==="fp"){$("table.car-finance ."+"fp-final-payment").empty().text("0.00");}}$("table.car-finance ."+type+"-total-payable").empty().text("0.00");}}},toggleContinueButton:function(product,status){var carFinance=$(".car-finance");var buttonOff=$("tr."+product+" .submit-off").or(".submit-off");var buttonOn=$("tr."+product+" .submit-on").or(".submit-on");if($(".sji").length>0){if($(".sji.full-quote").length>0){if($(".car-finance.sji td.hp input[type=radio]").is(":checked")&&!$(".car-finance.sji td.hp.disabled").length>0||$(".car-finance.sji td.fp input[type=radio]").is(":checked")&&!$(".car-finance.sji td.fp.disabled").length>0){var status="on";
LBG.carFinanceTable.togglePrintLink(true);}else{var status="off";LBG.carFinanceTable.togglePrintLink(false);}if(!$(".car-finance.sji td.hp.disabled").length>0||!$(".car-finance.sji td.fp.disabled").length>0){LBG.carFinanceTable.togglePrintLink(true);}}else{if($(".car-finance.sji table tr td.fp").hasClass("disabled")&&$(".sji table tr td.hp").hasClass("disabled")){var status="off";LBG.carFinanceTable.togglePrintLink(false);}else{var status="on";LBG.carFinanceTable.togglePrintLink(true);}}}if(status==="on"){buttonOff.addClass("hide");buttonOn.removeClass("hide");}else{if(status==="off"){buttonOn.addClass("hide");buttonOff.removeClass("hide");}}},togglePrintLink:function(status){var printLink=$("ul.car-finance-print-quote");if(status===true){printLink.find("li").removeClass("hide");}else{printLink.find("li").addClass("hide");}},messageController:function(msg){var alwaysShow=$(".car-finance-message.always-show");var msgs=$(".car-finance-message p");var msgsShow=$(".car-finance-message p.no-hide");$(msgs).addClass("hide");$(msgsShow).removeClass("hide");if(msg.length>0){for(var m=0;m<msg.length;m++){$("."+msg[m]).removeClass("hide");}$(".car-finance-message").removeClass("hide");}else{if(alwaysShow.length>0){$(".car-finance-message").removeClass("hide");}else{$(".car-finance-message").addClass("hide");}}}};var BaseSelectableTable=new Class({init:function(element){this.element=element;this.toggleControl();this.bind();},getToggleControl:function(){throw"Not implemented in subclass of BaseSelectableTable";},resetTable:function(){$("."+this.getSelectedClass(),this.element).removeClass(this.getSelectedClass());},selectTargetFromContarol:function(control){throw"Not implemented in subclass of BaseSelectableTable";},toggleControl:function(){$(this.getToggleControl(),this.element).addClass("postit");$("."+this.getNewControlContainer()+" td label",this.element).prepend(this.loadControl());},loadControl:function(){return'<span class="selectable-table-radio"></span>';},bind:function(){var self=this;$(this.getToggleControl()).change(function(){$(".selectable-table-radio",self.element).removeClass("checked");if($(this).is(":checked")){self.selectTargetFromControl(this);$(this).next("label").find(".selectable-table-radio").addClass("checked");}}).filter(":checked").change();},getSelectedClass:function(){return"selected";},getNewControlContainer:function(){return"selector";},selectControl:function(control){var row=$(control).parents("tr");$(row+" td span").addClass("checked");}});var HorizontalSelectableTable=BaseSelectableTable.extend(".pat304.horizontal-selectable-table",{getToggleControl:function(){return $("td:first input[type=radio]",this.element);},selectTargetFromControl:function(control){var row=$(control).parents("tr");this.resetTable();row.addClass(this.getSelectedClass());}});var VerticalSelectableTable=BaseSelectableTable.extend(".pat304.vertical-selectable-table",{getToggleControl:function(){return $("tr:last input[type=radio]",this.element);},selectTargetFromControl:function(control){var offset=$(control).parents("td").prevAll().length;this.resetTable();$("td:nth-child("+(offset+1)+"), th:nth-child("+(offset+1)+")",this.element).addClass(this.getSelectedClass());}});LBG.statements=window.LBG.statements||(function(){var config=DI.lang.statement||{};var statements=new AspectCollection();statements.addAspectAsFunction(function(){var TransactionDetails=(function($,config){var templates={debit:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>',credit:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>',vef:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>',current:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>'};function TransactionDetail(element){var self=this;var metadata=$(element).metadata();this.type=metadata.type;this.rowid=metadata.rowid;this.transAmount=metadata.amount;this.transRef=metadata.transactionRef;this.merchantName=metadata.merchantName;if(this.type=="credit"){this.url=DI.vtdCredit.ajax.url;}else{this.url=DI.vtd.ajax.url;}var tmp=$(templates[this.type]).clone();$(element).bind("row_expanded",function(e){self.handler(e);if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.ac","xxx TBC","WT.si_n","ViewTransactionDetails","WT.si_x",1,"WT.tx_e","s","WT.pn_sku",self.type,"WT.tx_s",self.transAmount,"WT.tx_i",self.transRef,"DCSext.mername",self.merchantName);}});$(element).bind("row_collapsed",function(e){LBG.track({});});if($(element).is(".alt")){tmp.addClass("alt");}$("td",tmp).attr("colSpan",$("td, th",element).length);$(element).after(tmp);if("vef"===this.type){var html=$("td:first-child",element).remove().html();$(element).prepend($('<th class="first"></td>').html(html));tmp.addClass("creditCard");if(!$(element).closest(".pane").is(".accountData")){$(element).closest(".pane").addClass("accountData");}}this.details=tmp;}TransactionDetail.prototype.handler=function(e){var self=this;var details=$(this.details);if(!details.hasClass("loaded")){details.addClass("loading");$.ajax({url:this.url,data:{"rowid":this.rowid,"merchantname":this.merchantName},success:function(result){$("td > div",details).html(result);details.removeClass("loading").addClass("loaded");$("a.transQuery",details).click(function(){var metadata=$(this).metadata();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.ac",metadata.analyticsRef);}});if(typeof dcsMultiTrack!="undefined"){if(self.type=="credit"){dcsMultiTrack("WT.ac","pages/p42_00_account_statement/properties.p4200lnk521a,pages/p42_00_account_statement/properties.p2700lnk521c,I have a query about this transaction");}else{dcsMultiTrack("WT.ac","pages/p27_00_account_statement/properties.p2700lnk501a,pages/p27_00_account_statement/properties.p2700lnk501c,I have a query about this transaction");}}},error:function(){$("td > div",details).html(config[self.type].html.error).addClass("error");details.removeClass("loading");}});}};return TransactionDetail;})($,config.viewTransactionDetails||{});$(".vtd").each(function(idx){new TransactionDetails(this);});});return statements;})();LBG.emailModule=(function(){var init=function(){$("div.optionalEmail").each(function(){var $this=$(this);var checkbox=$this.find('input[type="checkbox"]').eq(0);var hidden=$this.find('input[type="hidden"]').eq(0);var emailfields=$this.find('input[type="text"]');var emailcapture=$this.find("div.emailShowHide");var pane=$this.find(".pane");if(checkbox.length>0){checkbox.attr("checked","");emailcapture.hide();checkbox.click(function(){if(emailcapture.hasClass("email-visible")){emailcapture.removeClass("email-visible");emailcapture.hide();pane.hide();if(hidden.length>0){emailfields.val(hidden.val());}}else{emailcapture.addClass("email-visible");emailcapture.show();}});}else{emailcapture.show();$this.find(".inner").eq(0).addClass("dash");}});};return{init:init};})();LBG.IEemptyCells=(function(){var init=function(){if(jQuery.browser.msie&&jQuery.browser.version<8){$("td:empty").html("&nbsp;");}};return{init:init};})();LBG.residentialStatusLRA=(function(){var init=function(){$(".residentialStatus select").change(function(){var residentialInputs=$(".residentialStatus").find('input[type="text"]:visible');var regexDecimal=/^[0-9]+\.?[0-9]*$/;if(residentialInputs.length>1){residentialInputs.each(function(){$(this).blur(function(){if(((regexDecimal.test($(".homeOwner input").val())==true)&&(regexDecimal.test($(".privateTenant input").val())==false))||((regexDecimal.test($(".homeOwner input").val())==false)&&(regexDecimal.test($(".privateTenant input").val())==true))){residentialInputs.each(function(){if((regexDecimal.test($(this).val())==false)&&($(this).val()=="")){$(this).parent().parent().removeClass("error");
$(this).parent().children("span.error").remove();}});}});});}});};return{init:init};})();LBG.tsfTabs={init:function(){$(".sp-pat-306-tabs").each(function(){var container=$(this);var containerTitles=$(".sp-pat-516-table h2");$(".sp-pat-516-table.s01-dt-default").attr("role","tabpanel");$(".sp-pat-516-table").not(":first").hide();container.prepend('<ul class="tabs tfsTabs sp-pat-306-tabs" role="tablist"></ul>');containerTitles.hide();for(var i=0;i<containerTitles.length;i++){$(".tabs.tfsTabs").append('<li><span class="tabOuter"><span class="tabInner"><a href="#" role="tab">'+containerTitles[i].innerHTML+"</a></span></span></li>");}container.find(".tfsTabs li").eq(0).addClass("current").attr("aria-selected","true").find("a").attr("aria-selected","true");container.find(".tabs.tfsTabs a").click(function(e){e.preventDefault();var indexEl=container.find(".tfsTabs a").index(this);if(indexEl>=0){container.find(".sp-pat-516-table").hide();container.find(".sp-pat-516-table").eq(indexEl).toggle();container.find(".tfsTabs li").removeClass("current").attr("aria-selected","false").find("a").attr("aria-selected","false");container.find(".tfsTabs li").eq(indexEl).addClass("current").attr("aria-selected","true").find("a").attr("aria-selected","true");}});});}};LBG.tooltipNoID={init:function(){$(".sp-pat-306-tabs").each(function(){for(var i=0;i<=$(".osrTableHead li",this).length;i++){var j=i+1;var tipTitle=$(".tooltips > div",this).eq(i).find("h2").text();$(".tooltips > div",this).eq(i).attr("id","cxtHelp"+j);$(".osrTableHead li .accountDetailsTableTitle",this).eq(i).append(' <span class="cxtHelp"><a class="cxtTrigger" title="Click to find out more about '+tipTitle+'" href="#cxtHelp'+j+'">[?]</a></span>');}});}};LBG.showHidePanel={init:function(){$(".showHidePanel").each(function(){if($(this).hasClass("open")){$(".showHideContent").show();$(".showHideHeader").after('<a class="toggler" href="#">close</a>');}else{$(".showHideContent").hide();$(".showHideHeader").after('<a class="toggler" href="#">open</a>');}$(".toggler").toggle(function(){$(".showHideContent").show();$(".toggler").text("open");},function(){$(".showHideContent").hide();$(".toggler").text("close");});});}};LBG.addRemoveRowsLRA={init:function(){$(".tblStyle .inner").hide();$(".tblStyle .inner:first-child").show();$(".tblStyle .inner").each(function(){$(this).find("select").each(function(){if(($(this).val()!="")&&($(this).val()!="-")){$(this).closest("div.inner").show();}}),$(this).find("input").each(function(){if($(this).val()!=""){$(this).closest("div.inner").show();}});});$(".currentCosts input[type=radio]").click(function(){if($(this).val()=="yes"){var visibleRows=$(this).closest(".currentCosts").find(".inner:visible");if(visibleRows.length>1){visibleRows.each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{$(this).find(".removeDebt").show();}});}if(($(this).closest(".currentCosts").find("p.addMoreDebt").length==0)&&(visibleRows.length<20)){visibleRows.parent().append('<p class="addMoreDebt"><a href="#">Add another?</a></p>');}$(".addMoreDebt a").live("click",function(){var tblAction=$(this).closest(".tblStyle");tblAction.children(":hidden:eq(0)").show();if((tblAction.find(".inner:visible").length>=2)){tblAction.find(".inner:visible").each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{tblAction.find(".inner").find(".removeDebt").show();}});}if(tblAction.find(".inner:visible").length==20){$(this).hide();}return false;});$(".removeDebt").live("click",function(){var tblReset=$(this).closest("div.inner");var tblContainer=$(this).closest("div.tblStyle");tblReset.find("select").val([0]);tblReset.find("input[type=text]").val("");tblReset.find(".formField").removeClass("error");tblReset.find("span.error").html("");tblReset.find(".removeDebt").remove();tblReset.hide().insertBefore($(".addMoreDebt"));if((tblContainer.find(".inner:visible").length<20)&&(tblContainer.find(".addMoreDebt").length==1)){tblContainer.find(".addMoreDebt a").show();}if(tblContainer.find(".inner:visible").length==1){tblContainer.find(".inner:visible .removeDebt").remove();}return false;});}});}};LBG.residentialStatusLRA={init:function(){$(".residentialStatus select").change(function(){$(".homeOwner , .privateTenant").removeClass("error");$(".homeOwner span.error , .privateTenant span.error").remove();if($(".residentialStatus input[type=text]:visible").length==1){$(".residentialStatus input[type=text]:hidden").val("");LBG.Forms.Validation.Manip.add($(".formField.homeOwner , .formField.privateTenant"),"required");}else{if($(".residentialStatus input[type=text]:visible").length>1){LBG.Forms.Validation.Manip.remove($(".formField.homeOwner:eq(0) , .formField.privateTenant:eq(0)"),"required");}}});}};LBG.addRemoveRowsLRA={init:function(){$(".tblStyle .inner").hide();$(".tblStyle .inner:first-child").show();$(".tblStyle .inner").each(function(){$(this).find("select").each(function(){if(($(this).val()!="")&&($(this).val()!="-")){$(this).closest("div.inner").show();if($(".currentCosts input[type=radio]").val()=="yes"){var visibleRows=$(this).closest(".currentCosts").find(".inner:visible");if(visibleRows.length>1){visibleRows.each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{$(this).find(".removeDebt").show();}});}if(($(this).closest(".currentCosts").find("p.addMoreDebt").length==0)&&(visibleRows.length<20)){visibleRows.parent().append('<p class="addMoreDebt"><a href="#">Add another?</a></p>');}$(".addMoreDebt a").live("click",function(){var tblAction=$(this).closest(".tblStyle");tblAction.children(":hidden:eq(0)").show();if((tblAction.find(".inner:visible").length>=2)){tblAction.find(".inner:visible").each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{tblAction.find(".inner").find(".removeDebt").show();}});}if(tblAction.find(".inner:visible").length==20){$(this).hide();}return false;});$(".removeDebt").live("click",function(){var tblReset=$(this).closest("div.inner");var tblContainer=$(this).closest("div.tblStyle");tblReset.find("select").val([0]);tblReset.find("input[type=text]").val("");tblReset.find(".formField").removeClass("error");tblReset.find("span.error").html("");tblReset.find(".removeDebt").remove();tblReset.hide().insertBefore($(".addMoreDebt"));if((tblContainer.find(".inner:visible").length<20)&&(tblContainer.find(".addMoreDebt").length==1)){tblContainer.find(".addMoreDebt a").show();}if(tblContainer.find(".inner:visible").length==1){tblContainer.find(".inner:visible .removeDebt").remove();}return false;});}}}),$(this).find("input").each(function(){if($(this).val()!=""){$(this).closest("div.inner").show();}});});$(".currentCosts input[type=radio]").click(function(){if($(this).val()=="yes"){var visibleRows=$(this).closest(".currentCosts").find(".inner:visible");if(visibleRows.length>1){visibleRows.each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{$(this).find(".removeDebt").show();}});}if(($(this).closest(".currentCosts").find("p.addMoreDebt").length==0)&&(visibleRows.length<20)){visibleRows.parent().append('<p class="addMoreDebt"><a href="#">Add another?</a></p>');}$(".addMoreDebt a").live("click",function(){var tblAction=$(this).closest(".tblStyle");tblAction.children(":hidden:eq(0)").show();
if((tblAction.find(".inner:visible").length>=2)){tblAction.find(".inner:visible").each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{tblAction.find(".inner").find(".removeDebt").show();}});}if(tblAction.find(".inner:visible").length==20){$(this).hide();}return false;});$(".removeDebt").live("click",function(){var tblReset=$(this).closest("div.inner");var tblContainer=$(this).closest("div.tblStyle");tblReset.find("select").val([0]);tblReset.find("input[type=text]").val("");tblReset.find(".formField").removeClass("error");tblReset.find("span.error").html("");tblReset.find(".removeDebt").remove();tblReset.hide().insertBefore($(".addMoreDebt"));if((tblContainer.find(".inner:visible").length<20)&&(tblContainer.find(".addMoreDebt").length==1)){tblContainer.find(".addMoreDebt a").show();}if(tblContainer.find(".inner:visible").length==1){tblContainer.find(".inner:visible .removeDebt").remove();}return false;});}});}};LBG.procedureIndicator={init:function(){$(".procImgOverrideAction").click(function(){var activeCheckbox=$(this).prev();if(activeCheckbox.is(":checked")===false){$(this).attr("src",DI.procedureIndicatorImages.overrideInActive);activeCheckbox.attr("checked","checked").change();$(this).closest(".formField").removeClass("error");if(availableCredit()<0){return false;}}});}};var AuthPollingInProgress=false;var AuthPolling=new Class(".authPanel",{init:function(element,window,config){if(false===AuthPollingInProgress){AuthPollingInProgress=true;var metadata=new Config($(element).metadata()).get("authPanel",null);this.config=config.get(null!=metadata&&metadata.get("variant")?metadata.get("variant"):"authPolling");$("form, div.inner.dash").hide();this.delegate=function(func){var self=this;return function(){return func.apply(self,arguments);};};this.interval=window.setInterval(this.delegate(this.tick),this.config.get("frequency"));this.timeout=window.setTimeout(this.delegate(this.timeout),this.config.get("timeoutInterval"));this.isSubmitting=false;}},tick:function(){$.getJSON(LBG.common.ajax.tagUrl(this.config.get("url")),this.delegate(this.process));},timeout:function(){window.clearInterval(this.interval);this.process(this.config.get("timeoutData").val());},process:function(json){var i=0;for(var k in json){if(json.hasOwnProperty(k)){$('<input type="hidden">').attr({name:k,value:json[k]}).appendTo("form");++i;}}if(i&&!this.isSubmitting){this.submit();}},submit:function(){this.isSubmitting=true;window.clearInterval(this.interval);$("form input[type=image], form input[type=submit]").click(function(e){LBG.Forms.Validation._submitManagement(e);}).click();}},window,new Config(DI));LBG.MiData=(function(){var init=function(){if($("body").hasClass("pageLoadWithAjax")){setInterval(function(){poll();},3000);}function poll(){var json_url=DI.lang.miData.ajax.url;var success_url=DI.lang.miData.navigation.success;var error_url=DI.lang.miData.navigation.error;$.ajax({url:json_url,type:"GET",dataType:"json",success:function(data){$.each(data,function(key,val){if(key=="status"){switch(val){case"NotStarted":$("body.pageLoadWithAjax .statusInProcess").remove();$("body.pageLoadWithAjax .statusNotStarted").css({"display":"block"});break;case"InProgress":$("body.pageLoadWithAjax .statusNotStarted").css({"display":"none"});$("body.pageLoadWithAjax .statusInProcess").css({"display":"block"});break;case"Error":$("body.pageLoadWithAjax .statusInProcess").remove();$("div.miDataVariantContent").load("selectaccount.jsp div.statusNotStarted");window.location.href=error_url;break;case"Success":$("body.pageLoadWithAjax .statusInProcess").remove();$("div.miDataVariantContent").load("selectaccount.jsp div.statusNotStarted");window.location.href=success_url;break;}}});},error:function(data){$("body.pageLoadWithAjax .statusInProcess").remove();$("body.pageLoadWithAjax .miDataErrorContainer").css({"display":"block"});LBG.track({"DCSext.Errorcode":"MI Data Ajax Error"});$("body.pageLoadWithAjax .statusNotStarted").css({"display":"block"});},cache:false});}};return{init:init};})();LBG.siblingVerticalCentering={init:function(){var refHeight=$(".bannerReduced:first").height();var myElementHeight=$(".bannerReduced .buttonLink").height();$(".bannerReduced .buttonLink").css({"margin-top":((refHeight-myElementHeight)/2)+"px"});}};LBG.equalWidth={init:function(){$(".widthChild").each(function(){var thisWidth=Math.floor($(this).parent().width()/$(this).parent().children(".widthChild").length)-1;$(this).width(thisWidth);if($(this).parent().hasClass("spRateIntroDetails")){var elLeftPadding=$(this).css("padding-left");if(/em/i.test(elLeftPadding)||/px/i.test(elLeftPadding)){elLeftPadding=elLeftPadding.substring(0,(elLeftPadding.length-2));}else{if(/%/i.test(elLeftPadding)){elLeftPadding=elLeftPadding.substring(0,(elLeftPadding.length-1));}}$(this).width(thisWidth-elLeftPadding);}});}};LBG.appBanner=function(){var bannerEl;function getOS(){var mobileOS;if(navigator.userAgent.match(/Android/i)!==null){mobileOS="android";}return mobileOS;}function closeBanner(){bannerEl.style.display="none";$(".hasJS").removeClass("app-banner-open");$("#wrapper").css("margin-top","0");}function openBanner(){bannerEl.style.display="block";$(".hasJS").addClass("app-banner-open");if((".app-banner:visible")){var wid=window.screen.width;if(wid>360){wid=wid/window.devicePixelRatio;}var ratio=$(window).width()/wid;if(ratio>3){ratio=2;}$(".app-banner").css("top",parseFloat($(".app-banner").css("top"))*ratio);$(".app-banner").css("height",parseFloat($(".app-banner").css("height"))*ratio);$(".app-banner .sb-container").css("-webkit-transform","scale("+ratio+")");$(".app-banner .sb-container").css("-msie-transform","scale("+ratio+")");$(".app-banner .sb-container").css("-moz-transform","scale("+ratio+")");$(".app-banner .sb-container").css("width",$(window).width()/ratio);var appheight=$(".app-banner").outerHeight();$("#wrapper").css("margin-top",appheight+"px");}}function init(){var closeEl;bannerEl=$(".app-banner");bannerContainter=$(".app-banner .sb-container");if(!bannerEl.length){return;}bannerEl=bannerEl[0];bannerContainter=bannerContainter[0];closeEl=document.createElement("a");closeEl.className="sb-close";closeEl.title="Hide App Link";closeEl.href="#";closeEl.innerHTML="<span>x</span>";bannerContainter.appendChild(closeEl);openBanner();$(closeEl).click(function(e){e.preventDefault();closeBanner();},false);}return{init:init};}();LBG.panelContentShowHide={init:function(){$(".contentResize").each(function(el){if($(this).hasClass("spRateDesc")&&($(".contentResizeLimit",this).length==0)){if($(this).find("li").length>3){$(this).find("li").eq(3).addClass("contentResizeLimit");}else{if($(this).children("p").length>3){$(this).find("p").eq(2).addClass("contentResizeLimit");}}}var $firstDemarcation=$(".contentResizeLimit",this).eq(0);if($firstDemarcation){var demIndex=$firstDemarcation.prevAll().length,numSiblings=$firstDemarcation.parent().children().length,demNode=$firstDemarcation.attr("nodeName");for(var i=demIndex;i<numSiblings;i++){if($firstDemarcation.attr("nodeName")=="LI"){$firstDemarcation.parent().children(demNode).eq(i).addClass("hide");}else{$firstDemarcation.siblings().eq(i).addClass("hide");}}if($firstDemarcation.parent().length>0){$firstDemarcation.parent().nextAll().addClass("hide");$firstDemarcation.parent().append('<p><a class="readMoreLnk" href="">Find out more</a></p>');}}$(".readMoreLnk",this).click(function(element){element.preventDefault();$(this).parents(".contentResize").find(".hide").removeClass("hide");
$(this).remove();});});}};LBG.CommercialRBBSCardDetails=(function(){var init=function(){if($(".cardTotal").length>0){$("dl.highlighted_cash_balance").show();}else{$("dl.highlighted_cash_balance").hide();}$(".rbbsCardSelection").change(function(){var cardLastFourDigits=$(this).val();var cardId=DI.lang.rbbsCardDetails.url+"?cardID="+cardLastFourDigits;$("div.rbbs_card_spinner").show();$(".rbbs_ajax_error").hide();$.ajax({url:cardId,success:function(data){$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").hide();$("table.rbbs_commercial_table tbody").children().remove();$("table.rbbs_commercial_table tbody").html($(data).find(".filter_"+cardLastFourDigits).html());if($(data).filter("div.filterWrapper_"+cardLastFourDigits).find("div.cardTotal").length>0){$("dl.highlighted_cash_balance").show();$("div.dropdown_pattern dl.highlighted_cash_balance dd").html($(data).filter("div.filterWrapper_"+cardLastFourDigits).find("div.cardTotal").html());}else{$("dl.highlighted_cash_balance").hide();}},cache:false,error:function(jqXHR,textStatus,errorThrown){$("table.rbbs_commercial_table").hide();$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").show();}});});$(".rbbs_cards .rbbs_more_trans").click(function(){var cardId=DI.lang.rbbsCardDetails.moreTransUrl;$("div.rbbs_card_spinner").show();$(".rbbs_ajax_error").hide();$.ajax({url:cardId,success:function(data){$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").hide();$("table.rbbs_commercial_table tbody").append(data);$(".rbbs_cards .rbbs_more_trans").hide();},error:function(jqXHR,textStatus,errorThrown){$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").show();}});});};return{init:init};})();LBG.RetailBaselinePJB=(function(){var sortCodeContainer=$(".content .infoAlertBox").prev().find("input:text, input[type=number]");var sameValue=false;var arr=[];var sortedSortCode;var prevSortCode;var returnedData;$(sortCodeContainer).blur(function(){$(sortCodeContainer).each(function(i){arr[i]=$(this).val();if((arr[0]&&arr[1]&&arr[2]!=="")&&((arr[0]).length==2&&(arr[1]).length==2&&(arr[2]).length==2)){if(arr[0].match(/^\d+$/)&&arr[1].match(/^\d+$/)&&arr[2].match(/^\d+$/)){sortedSortCode=arr[0]+arr[1]+arr[2];if(sameValue==false||sortedSortCode!==prevSortCode){prevSortCode=arr[0]+arr[1]+arr[2];var sortCodeId=DI.lang.baselinePJB.url+"?sortCode="+sortedSortCode;$("div.pjb_spinner").show();$(".pjb_ajax_error").hide();$(".pjb_mismatch_error").hide();$.ajax({url:sortCodeId,success:function(data,success){returnedData=data;var bankNameDisplayBox=$(".content .infoAlertBox dl dd em");$("div.pjb_spinner").hide();if(data==""||data==undefined){$(".pjb_mismatch_error").show();$(".pjb_ajax_error").hide();$(".content .infoAlertBox").hide();}else{if(data=="null"){$(".pjb_ajax_error").show();$(".pjb_mismatch_error").hide();$(".content .infoAlertBox").hide();}else{$(".pjb_mismatch_error").hide();$(".pjb_ajax_error").hide();$(".content .infoAlertBox").show();bankNameDisplayBox.show();bankNameDisplayBox.empty();bankNameDisplayBox.html(data);sameValue=true;}}},cache:false,error:function(jqXHR,textStatus,error){$("div.pjb_spinner").hide();$(".pjb_ajax_error").show();$(".pjb_mismatch_error").hide();}});}else{if(sortedSortCode==prevSortCode){$(".pjb_mismatch_error").hide();$(".pjb_ajax_error").hide();$(".content .infoAlertBox").show();$(".content .infoAlertBox dl dd em").show();$(".content .infoAlertBox dl dd em").empty();$(".content .infoAlertBox dl dd em").html(returnedData);}}}else{$(".content .infoAlertBox").hide();}}else{$(".pjb_mismatch_error").hide();$(".pjb_ajax_error").hide();$(".content .infoAlertBox").hide();}});});});LBG.RetailBaselineCRS=(function(){var current=0;var brr=new Array(6);var dropDownIndex;var selfValue;var mySelectedDropDown;var mySelectedDropdownHTML;var mySelectedDropdownValue;populateSelectedOptions();addCRSSelectOption();removeCRSSelectOption();function populateSelectedOptions(){$(".customerNationalityDropDown").each(function(i){var mySelectedDropdownValue=$(this).find(":selected").attr("value");dropDownIndex=$(".customerNationalityDropDown").index(this);if(mySelectedDropdownValue!=="Please select"||mySelectedDropdownValue!=="Please Select"){brr[dropDownIndex]=mySelectedDropdownValue;$(".customerNationalityDropDown").each(function(j){hideSelectedOptions($(this),i,j,true);});}});var customerNationalityDropDownValue=$("form#frmChangeDet .crsCountryDropDownHolder select.customerNationalityDropDown").find(":selected").attr("value");if(customerNationalityDropDownValue=="-"){$("ul.addNewCustomerNationality li a.addNewCustomerNationalityDropDown").addClass("hiddenLink");}else{$("ul.addNewCustomerNationality li a.addNewCustomerNationalityDropDown").removeClass("hiddenLink");}$(".customerNationalityDropDown").change(function(){mySelectedDropDown=$(this).find(":selected");mySelectedDropdownHTML=$(this).find(":selected").html();mySelectedDropdownValue=$(this).find(":selected").attr("value");dropDownIndex=$(".customerNationalityDropDown").index(this);if(mySelectedDropdownValue!=="Please select"||mySelectedDropdownValue!=="Please Select"){brr[dropDownIndex]=mySelectedDropdownValue;}if(mySelectedDropdownValue!=="-"){getAJAXResponse($(this),mySelectedDropdownValue,dropDownIndex);$("ul.addNewCustomerNationality a.addNewCustomerNationalityDropDown").removeClass("hiddenLink");}else{$(this).closest(".crsCountryDropDownHolder").find(".tinHolder").hide();$("ul.addNewCustomerNationality a.addNewCustomerNationalityDropDown").addClass("hiddenLink");}if($(".hiddenCRSDropDownHolder").length==0){$("ul.addNewCustomerNationality a.addNewCustomerNationalityDropDown").addClass("hiddenLink");}$(".customerNationalityDropDown").each(function(i){hideSelectedOptions($(this),dropDownIndex,i,true);if(this.options[this.selectedIndex].disabled){if(this.options.length==0){this.selectedIndex=-1;}else{this.selectedIndex=0;}$(this).trigger("change");}});});}function addCRSSelectOption(){$("ul.addNewCustomerNationality a").click(function(e){if($(".hiddenCRSDropDownHolder").length>0){var firstCRSDropDownSelector=$(".hiddenCRSDropDownHolder").eq(0);$("ul.addNewCustomerNationality a.addNewCustomerNationalityDropDown").addClass("hiddenLink");}$(".customerNationalityContainerCRS").each(function(i){if($(this).hasClass("hiddenCRSDropDownHolder")){firstCRSDropDownSelector.removeClass("hiddenCRSDropDownHolder");firstCRSDropDownSelector.find("select").focus();}});if($(".customerNationalityContainerCRS.hiddenCRSDropDownHolder").length==0){$("ul.addNewCustomerNationality a").addClass("hiddenLink");}$("ul.addNewCustomerNationality a.addNewCustomerNationalityDropDown").addClass("hiddenLink");e.preventDefault();});}function removeCRSSelectOption(){$(".crsRemoveTaxCountryField a").click(function(e){var closestCRSContainer=$(this).closest(".customerNationalityContainerCRS");var dropDownIndex=$(".customerNationalityDropDown").index($(this).closest(".customerNationalityContainerCRS").find(".customerNationalityDropDown"));brr[dropDownIndex]="";$(this).closest(".crsCountryDropDownHolder").find(".tinHolder").hide();closestCRSContainer.addClass("hiddenCRSDropDownHolder");closestCRSContainer.find(".customerNationalityDropDown option").each(function(){$(this).removeAttr("selected");$(this).find(":first").attr("selected","selected");});if($("ul.addNewCustomerNationality a").hasClass("hiddenLink")){$("ul.addNewCustomerNationality a").removeClass("hiddenLink");}$(".customerNationalityDropDown").each(function(i){hideSelectedOptions($(this),dropDownIndex,i,false);});e.preventDefault();});
}function hideSelectedOptions(selfDD,ddIndex,iterator,bool){if(dropDownIndex==iterator){}else{selfDD.find("option").each(function(i){var index=$.inArray($(this).attr("value"),brr);if(bool){if(index!==-1&&index==ddIndex){if($(this).attr("value")!=="-"){$(this).attr("disabled",true);$(this).css({"color":"#cccccc"});}}if(index==-1){$(this).removeAttr("disabled");$(this).css({"color":"#000000"});}}else{if(index==-1){$(this).removeAttr("disabled");$(this).css({"color":"#000000"});}}});}}function getAJAXResponse(selectedDD,countryName,panelNumber){var cxtHelpNumber;var selectedStringCRS=[];var selectedStringTitleCRS=[];var ukResidentCheckCRS=$(".crsFormFieldsHolder .ukNationalityRadio input:checked");var ukResidentCheckCRSValue;var stringToMergeCRS="";var crsTinToAppendContainer=selectedDD.parent().parent().parent();$(".crsFormFieldsHolder .nationality").each(function(i){var crsSelectedNationalityVar=$(this).find("select").find(":selected").attr("value");if(crsSelectedNationalityVar!="-"){selectedStringTitleCRS.push("&nationality"+i+"=");selectedStringCRS.push(crsSelectedNationalityVar);}});if($(".crsFormFieldsHolder .countryOfBirth").find(":selected").attr("value")!=="-"){var selectedCountryOfBirthCRS=$(".crsFormFieldsHolder .countryOfBirth").find(":selected").attr("value");selectedStringTitleCRS.push("&countryofbirth=");selectedStringCRS.push(selectedCountryOfBirthCRS);}if(ukResidentCheckCRS.length>0){ukResidentCheckCRSValue=ukResidentCheckCRS.next("label").html();selectedStringTitleCRS.push("&ukresidentcheck=");selectedStringCRS.push(ukResidentCheckCRSValue);}$.each(selectedStringTitleCRS,function(index,item){stringToMergeCRS+=selectedStringTitleCRS[index]+selectedStringCRS[index];});cxtHelpNumber=(panelNumber+1)*2;$("div.crs_spinner").show();$("div.crs_ajax_error").hide();var jsonTinCrs=DI.lang.baselineCRS.tinUrl+"?countryName="+countryName+"&panelNumber="+panelNumber+"&cxtHelpNumber="+cxtHelpNumber;jsonTinCrs+=stringToMergeCRS;$.ajax({url:jsonTinCrs,type:"GET",success:function(data,success){crsTinToAppendContainer.find("div.tinHolder").remove();$("div.crs_spinner").hide();$("div.crs_ajax_error").hide();if(data==""||data==undefined||data==null){}else{crsTinToAppendContainer.append(data);LBG.Forms.Validation.init();}},cache:false,error:function(jqXHR,textStatus,error){$("div.crs_spinner").hide();$("div.crs_ajax_error").show();}});}});LBG.VulnerableCustomers=(function(){addSupportNeedButtonEnableDisable();$("div.supportNeedDD select").change(function(){hideAllSupportNeedsText();hideAllSupportNeedsDurationText();addSupportNeedButtonEnableDisable();if($("div.supportNeedDD select option:selected").hasClass("temp")){$("div.supportNeedDD").next().find("div.temporary").show();}if($("div.supportNeedDD select option:selected").hasClass("ongoing")){$("div.supportNeedDD").next().find("div.ongoing").show();}if($("div.supportNeedDD select option:selected").hasClass("both")){$("div.durationContainer").show();if($("div.durationContainer select option:selected").hasClass("noSelection")){$("div.vulnerable_customers form input.submitAction").attr("disabled","disabled");$("div.vulnerable_customers form input.submitAction").addClass("disabled");}else{$("div.vulnerable_customers form input.submitAction").removeAttr("disabled");$("div.vulnerable_customers form input.submitAction").removeClass("disabled");}if($("div.durationContainer select option:selected").hasClass("temp")){$("div.durationContainer").next().find("div.temporary").show();}if($("div.durationContainer select option:selected").hasClass("ongoing")){$("div.durationContainer").next().find("div.ongoing").show();}}});$("div.durationContainer select").change(function(){hideAllSupportNeedsDurationText();if($("div.durationContainer select option:selected").hasClass("noSelection")){$("div.vulnerable_customers form input.submitAction").attr("disabled","disabled");$("div.vulnerable_customers form input.submitAction").addClass("disabled");}else{$("div.vulnerable_customers form input.submitAction").removeAttr("disabled");$("div.vulnerable_customers form input.submitAction").removeClass("disabled");}if($("div.durationContainer select option:selected").hasClass("temp")){$("div.durationContainer").next().find("div.temporary").show();}if($("div.durationContainer select option:selected").hasClass("ongoing")){$("div.durationContainer").next().find("div.ongoing").show();}});$("div.vulnerable_customers div.supportNeedStates div.rightBlock a.supportNeedManageButton").click(function(e){e.preventDefault();if($(this).parent().next().css("display")=="none"){$(this).parent().next().slideDown();}});$("div.vulnerable_customers div.supportNeedStates a.closeManageArea").click(function(e){e.preventDefault();$(this).closest(".toggleContent").slideUp();});$("div.supportNeedToggleDD select").change(function(){var _self=$(this);hideAllSupportNeedsDurationText();if(_self.find("option:selected").hasClass("temp")){_self.closest(".supportNeedToggleDD").next().find("div.temporary").show();}if(_self.find("option:selected").hasClass("ongoing")){_self.closest(".supportNeedToggleDD").next().find("div.ongoing").show();}});$("div.supportNeedStates ul.supportNeedsList select").change(function(){var _self=$(this);var sectionUpdateButton=$(this).closest(".supportNeedListItem").find("input.support-need-update");if(sectionUpdateButton.length){if(_self.find("option:selected").hasClass("noSelection")){sectionUpdateButton.addClass("disabled");sectionUpdateButton.attr("disabled","disabled");}else{sectionUpdateButton.removeClass("disabled");sectionUpdateButton.removeAttr("disabled");}}});var supportNeedListItem;$("ul li.deleteNeedHolder a").click(function(){supportNeedListItem=$(this).closest("li.supportNeedListItem").attr("id");});$(".supportNeedConfirmButton").live("click",function(){$("form.vulnerable-delete-overlay").remove();var deleteNeedUrl=DI.lang.vulnerablecustomers.url+"?supportNeedListItem="+supportNeedListItem;$.ajax({type:"GET",url:deleteNeedUrl,success:function(data){$("div#olMask").hide();$("div#overlayWrapper").hide();$("div.vulnerable_customers div.infoMessageInner p").html("Support need deleted");},cache:false,error:function(jqXHR,textStatus,error){$("div#olMask").hide();$("div#overlayWrapper").hide();$("div.vulnerable_customers .alert div.infoMessageInner p").html("Error: Connection failed");}});});});function addSupportNeedButtonEnableDisable(){if($("div.supportNeedDD select option:selected").hasClass("noSelection")){$("div.vulnerable_customers form ul.actions li.primaryAction input.submitAction").attr("disabled","disabled");$("div.vulnerable_customers form ul.actions li.primaryAction input.submitAction").addClass("disabled");}else{$("div.vulnerable_customers form ul.actions li.primaryAction input.submitAction").removeAttr("disabled");$("div.vulnerable_customers form ul.actions li.primaryAction input.submitAction").removeClass("disabled");}}function hideAllSupportNeedsText(){$("div.mainSupportText div").hide();$("div.durationContainer").hide();}function hideAllSupportNeedsDurationText(){$("div.duration div").hide();}LBG.unsecuredLoan={init:function(){$("div.EmailAddressBlock a.lnkChnageEmailAddress").click(function(e){e.preventDefault();$("div.EmailAddressBlock").hide();var emailID=$("div.EmailAddressBlock dl.summary span.eamilAddress").text();$("input.field.clsEmailAddress").val(emailID);$("div.DynamicEmailAddressBlock").show();});}};LBG.confimSavingsPayment={init:function(){$(".interestAccount input:radio").change(function(){if($(this).is(":checked")){$(".textGroup.accountDetails input[type=text]").each(function(){$(this).val("");
});}});}};LBG.newWindow={init:function(){var $links=$('a[class^="newWindow"]');$links.each(function(e){$(this).bind("click",function(e){var classDimensions=$(this).attr("class").split("_"),winWidth=classDimensions[1],winHeight=classDimensions[2];if($(this).parents().hasClass(".osrAccountDetailsTable")){var targetPage=$(this).prev().find("#slctType option:selected").text();window.open($(this).attr("href")+targetPage,"_blank","width="+winWidth+" , height="+winWidth+" , scrollbars=yes");}else{window.open($(this).attr("href"),"_blank","width="+winWidth+" , height="+winWidth+" , scrollbars=yes");}return false;});});}};var mobileType="";var userAgent=navigator.userAgent||navigator.vendor||window.opera;if(/android/i.test(userAgent)){mobileType="Android";}else{if(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream){mobileType="iOS";}}LBG.penniesForPudsey=(function(){$("select.p4pSelectionList").change(function(){if($(this)[0].selectedIndex===0){$(".showOnSelectionChange").hide();}else{$(".showOnSelectionChange").show();}});if($("a.tAndCOverlayLauncher").attr("href")!=="#"){if(($.browser.msie&&$.browser.version>=8)||!($.browser.msie)){$("a.tAndCOverlayLauncher").attr("href","#");}}$("a.tAndCOverlayLauncher").click(function(){$(".togglep4pOverlay").show();});$(".togglep4pOverlay input.closeOverlay").click(function(){$(".sp-pat-m-hf-03-footer,form,header,#strbrandname,#lkAccOverView_retail,#txtUserName").removeAttr("aria-hidden");$("a.tAndCOverlayLauncher").hide();$(".togglep4pOverlay").hide("fast",function(){$("a.tAndCOverlayLauncher").show().focus();});});$(".p4pRole").attr("role","option");if(mobileType==="Android"){$("#frmStandingOrderP4PPh22 .newwin").append("<span class='postit p4pLink'> link : "+DI.lang.newWindow.info+"</span>");$("#frmStandingOrderP4PPh22 .tAndCOverlayLauncher").append("<span class='postit p4pLink'> link :"+DI.lang.overlay.openTriggerTitle+"</span>");}});LBG.penniesForPudseyTCOverlayFocus=function(){$("a.tAndCOverlayLauncher").live("click",function(){if(mobileType==="iOS"||mobileType==="Android"){$("div.togglep4pOverlay h2:first").attr("tabindex",-1).focus();}else{$("div.togglep4pOverlay :input:first").focus();$("div.togglep4pOverlay a#lnkPrintOverlayph22").live("focusout",function(){$("div.togglep4pOverlay :input:first").focus();});}$(".sp-pat-m-hf-03-footer,form,header,#strbrandname,#lkAccOverView_retail,#txtUserName").attr("aria-hidden",true);var printElm=$("div.togglep4pOverlay a.printwin");if(mobileType=="iOS"){$(printElm).attr("title",$(printElm).text()+": "+DI.lang.printWin.printLinkTitle+" and is the last item of the overlay");}else{if(mobileType=="Android"){$(printElm).append('<span class="postit p4pLink">'+DI.lang.printWin.printLinkTitle+"  and is the last item of the overlay</span>");}}});};LBG.colleagueBar=function(){function toggleTableRowContent(){$(".table-expanding-row .toggle").click(function(e){e.preventDefault();var toggleElem=$(this).closest("tr").next("tr.expand-child");if(toggleElem.css("display")=="none"){toggleElem.show();$(this).removeClass("open");$(this).addClass("close");}else{toggleElem.hide();$(this).removeClass("close");$(this).addClass("open");}});}function tieChild(){$(".expand-child").each(function(i){i+=1;$(".tie-child-"+i).after($(".child-"+i));});}function createZebra(){$(".table-expanding-row tbody tr.odd, .table-expanding-row tbody tr.even").each(function(i){i+=1;$(this).removeClass("even");$(this).removeClass("odd");if(i%2==0){$(this).addClass("even");}else{$(this).addClass("odd");}});}function getFirstElementText(node){var getFirstElementText;if($(node).children().length>=1){getFirstElementText=$(node).children().eq(0).html();}else{getFirstElementText=$(node).html();}return getFirstElementText;}function colleagueBarOverlay(){$("a.colleagueOverlayClosed").click(function(){$("div.colleagueOverlayClosed").removeClass("show-element-colleaguebar");$("div.colleagueOverlayClosed").addClass("hide-element-colleaguebar");$("div.colleagueOverlayVisible").removeClass("hide-element-colleaguebar");$("div.colleagueOverlayVisible").addClass("show-element-colleaguebar");$("div.overlayLauncher, table.table-expanding-row thead").width($(".outer").width());if($.browser.msie&&$.browser.version==6){var screenHeight=$(window).height();var screenWidth=$(window).width();$("div#olMaskColleagueBar").height(screenHeight);$("div#olMaskColleagueBar").width(screenWidth);$(".navBar .formField select.slctViewAccount").css("display","none");}});$("a.colleagueOverlayOpen").click(function(){$("div.colleagueOverlayClosed").removeClass("hide-element-colleaguebar");$("div.colleagueOverlayClosed").addClass("show-element-colleaguebar");$("div.colleagueOverlayVisible").removeClass("show-element-colleaguebar");$("div.colleagueOverlayVisible").addClass("hide-element-colleaguebar");if($.browser.msie&&$.browser.version==6){$(".navBar .formField select.slctViewAccount").css("display","block");}});}function fixedPositionMinWidth(){$("div.overlayLauncher, table.table-expanding-row thead").width($(".outer").width());$(window).resize(function(){$("div.overlayLauncher, table.table-expanding-row thead").width($(".outer").width());});}function findTopOfPage(){if($("div.colleague_intro_message").length>0){$(window).scroll(function(){if($(window).scrollTop()<50){$("table.table-expanding-row thead").removeClass("activeScroll");$("table.table-expanding-row thead").addClass("inActiveScroll");}else{$("table.table-expanding-row thead").removeClass("inActiveScroll");$("table.table-expanding-row thead").addClass("activeScroll");}});}}function init(){$("table.table-expanding-row").tablesorter({cssChildRow:"expand-child",dateFormat:"uk",textExtraction:getFirstElementText,headers:{6:{sorter:false},7:{sorter:false}}});toggleTableRowContent();colleagueBarOverlay();fixedPositionMinWidth();findTopOfPage();$("table.table-expanding-row").bind("sortEnd",function(){tieChild();createZebra();});}return{init:init};}();LBG.focusOnPageLoad={init:function(){if($(".pageload-focus").length){$(".pageload-focus input[type=text]").focus();}if($(".hasJS .content .avaSuitabilityCheck .avaSuitabilitySectionOne a.avaRadioBtn").length>0){$(this).focus();}}};LBG.config={newWindowTabClassList:{newWinClass:"newwin",newFaqClass:"newfaqwin",newhelpClass:"newhelpwin",overlayClass:"overlay",printwinClass:"printwin",statementLinkClass:"statementLink",pdfLinkClass:"pdfLink",tabBrowseClass:"tabBrowse",tabSearchClass:"tabSearch",oabAddToCalLinkClass:"oabAddToCalLink"}};LBG.newWindowTabClassListChecker=(function(){return{checkMatchingClass:function(obj){var isLinkClassMatching=false;$.each(LBG.config.newWindowTabClassList,function(key,value){if($(obj).hasClass(value)){isLinkClassMatching=true;return false;}});return isLinkClassMatching;}};})();LBG.autoLogoutApp=(function(){return{init:function(){if(DI.cookieAutoLogout){var isGenerateCookieParam=true,params=DI.cookieAutoLogout,keepAliveTimeInMilliSec=null,unloadTimeInMilliSec=null,cookieValue=null;var updateStatusCookie=function(){updateKeepAliveTimestamp();cookieValue=keepAliveTimeInMilliSec+"|";writeCookie(cookieValue);},updateKeepAliveTimestamp=function(){keepAliveTimeInMilliSec=+new Date();},writeCookie=function(cookieValue){document.cookie=params.name+"="+cookieValue+";path="+params.path+";secure="+params.secure+";";};updateStatusCookie();setInterval(updateStatusCookie,10000);$(window).bind("beforeunload",function(event){if(isGenerateCookieParam===true){unloadTimeInMilliSec=+new Date();cookieValue=unloadTimeInMilliSec+"|"+unloadTimeInMilliSec;writeCookie(cookieValue);
}});$("form").submit(function(e){isGenerateCookieParam=false;});$("a").click(function(e){isGenerateCookieParam=false;var hrefLinkMatch=$(this).attr("href").substring(0,1)=="#";var ajaxLinkMatch=$(this).attr("data-ajax-uri")!=null;var hasMatchingLinkClass=LBG.newWindowTabClassListChecker.checkMatchingClass(this);if(hrefLinkMatch||ajaxLinkMatch||hasMatchingLinkClass){isGenerateCookieParam=true;}});}}};})();LBG.inputKeyboard={init:function(){var touchCapable=false;var lastElement;if(("ontouchstart" in window)||(navigator.maxTouchPoints>0)||(navigator.msMaxTouchPoints>0)){touchCapable=true;}var pat804=$(".pat-804-input-number input");if(pat804.length>0){lastElement=pat804[pat804.length-1];}var enableSortCodeFields=function(){var pat804=$(".pat-804-input-number input");for(var i=0;i<pat804.length;i++){pat804[i].ready=true;}};for(var i=0;i<pat804.length;i++){if(touchCapable){pat804[i].setAttribute("type","tel");}pat804[i].setAttribute("max","99");pat804[i].setAttribute("maxlength","2");$(pat804[i]).blur(function(e){if(this.id==lastElement.id){this.ready=true;LBG.Forms.Validation.Tools.getFieldHandler($(".pat-804-input-number")).validate();}});$(pat804[i]).focus(function(e){var maxLength=2;if(lastElement.value.length==0){lastElement.ready=false;}if(this.value.length>0&&this.id!=lastElement.id){this.value=this.value.slice(0,maxLength);if($.browser.msie){$(this).select();}}});$(pat804[i]).keyup(function(e){var maxLength=2;var key=e.which||e.keyCode||e.charCode;if(key==37||key==39){return;}if($(this).val().length==maxLength){var inputs=$(this).closest(".pat-804-input-number").find(":input");if((key!=8&&key!=46&&key!=9&&key!=35&&key!=36)){inputs.eq(inputs.index(this)+1).focus();}}if((key==8||key==46)){enableSortCodeFields();}},false);$(pat804[i]).keydown(function(e){var key=e.which||e.keyCode||e.charCode;if((key==8||key==46)&&$(this).val()==""){var inputs=$(this).closest(".pat-804-input-number").find(":input");inputs.eq(inputs.index(this)-1).focus();e.preventDefault();}},false);}if(touchCapable){var pat800=$(".pat-800-input-email input");for(var i=0;i<pat800.length;i++){pat800[i].setAttribute("type","email");pat800[i].setAttribute("autocomplete","on");}var pat801=$(".pat-801-input-tel input");for(var i=0;i<pat801.length;i++){pat801[i].setAttribute("autocomplete","on");pat801[i].setAttribute("type","tel");}var pat802=$(".pat-802-input-telext input");for(var i=0;i<pat802.length;i++){pat802[i].setAttribute("autocomplete","on");pat802[i].setAttribute("type","tel");$(".pat-802-input-telext .fullNumber").css("width","70%");$(".pat-802-input-telext .fullNumber").css("float","left");$(".pat-802-input-telext label").addClass("postit");$(".pat-802-input-telext .fullNumber").css("margin-right","4%");$(".extension").css("width","20%");$(".extension").attr("placeholder","ext");if($(".pat-802-input-telext .ngb-grouped-input").length){$(".pat-802-input-telext .ngb-grouped-input").css("display","inline");}}$(".pat-802-input-telext input").blur(function(){$(".pat-802-input-telext .fullNumber").css("width","70%");$(".extension").css("width","20%");if($(".pat-802-input-telext .ngb-grouped-input").length){$(".pat-802-input-telext .ngb-grouped-input").css("display","inline");}});$(".pat-802-input-telext input").focus(function(){this.setAttribute("type","tel");this.setAttribute("placeholder","");$(".pat-802-input-telext .fullNumber").css("width","70%");$(".extension").css("width","20%");if($(".pat-802-input-telext .ngb-grouped-input").length){$(".pat-802-input-telext .ngb-grouped-input").css("display","inline");}});$(".pat-802-input-telext .extension").blur(function(){$(".pat-802-input-telext .fullNumber").css("width","70%");$(".extension").css("width","20%");if(this.value==""){this.setAttribute("placeholder","ext");}});var pat803=$(".pat-803-input-number input");for(var i=0;i<pat803.length;i++){pat803[i].setAttribute("type","number");pat803[i].setAttribute("step","any");}$(".pat-803-input-number input").blur(function(){var a=this;if(a.value!="0"){a.value=a.value.replace(/^0+/,"");}if(a.value.indexOf(".")<0&&a.value!=""){a.value=a.value+".00";}if(a.value<1&&a.value!=""){a.value="0"+a.value;}if(a.value.indexOf(".")<0&&a.value!=""){if(LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,parseInt(a.value.replace(/,/g,""),10))){a.value+=".00";}}else{if(a.value!=""){var splitDecimal=a.value.split("."),decimalPlaces="";for(var i=1;i<splitDecimal.length;i++){if(splitDecimal[i]!==""){decimalPlaces=splitDecimal[i];}}if(decimalPlaces.length<2){a.value=a.value+"0";}if(decimalPlaces.length<1){a.value=a.value+"0";}}}LBG.Forms.Validation.init();});$(".pat-803-input-number input").keydown(function(e){var charCode=e.which||e.keyCode||e.charCode;if((charCode<47||charCode>57)&&charCode!=190&&charCode!=8&&charCode!=46&&charCode!=13&&charCode!=32&&charCode!=9){e.preventDefault();}var b=this;if((b.value.indexOf(".")>0&&charCode==190)){e.preventDefault();}});$(".pat-803-input-number input").keyup(function(e){var maxLength=this.getAttribute("maxlength");maxLength=(maxLength!=null)?maxLength:10;this.value=this.value.slice(0,maxLength);});var pat805=$(".pat-805-input-number input");for(var i=0;i<pat805.length;i++){pat805[i].setAttribute("type","tel");}var pat809=$(".pat-809-input-number input");for(var i=0;i<pat809.length;i++){if(!$(pat809[i]).hasClass("submitAction")){pat809[i].setAttribute("type","tel");}}}}};LBG.clickableAreaForCheckbox={isCheckboxClicked:false,init:function(){$("input:checkbox[class$=cbxSelectableSignature]").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("label[class$=clsLblSignature]").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("div[class$=cbxSelectableDiv] strong").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("div[class$=cbxSelectableDiv] span").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("div[class$=cbxSelectableDiv]").click(function(event){if(event.target.nodeName=="A"||(event.target.nodeName=="SPAN"&&event.target.className=="error")){return;}var selector="";selector=$(this).closest(".cbxSelectableDiv");var checkbox=selector.find("input:checkbox[class$=cbxSelectableSignature]");if(LBG.clickableAreaForCheckbox.isCheckboxClicked){LBG.clickableAreaForCheckbox.isCheckboxClicked=false;event.stopPropagation();}else{if(checkbox.length>0){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler(checkbox);if(checkbox.is(":checked")){checkbox.attr("checked",false);}else{checkbox.attr("checked",true);}validationHandler.validate();if(validationHandler.isValid){validationHandler.hideError();}else{validationHandler.showError();}event.stopPropagation();}}});}};LBG.progressiveRevealForm={years:0,months:0,timeAtCurAdr:0,selectedElement:"",selectedFieldID:[],HomeDiallingCode:0,HomeAreaCode:0,HomePhoneNumber:0,isValidHomeNumber:false,MobileDiallingCode:0,MobilePhoneNumber:0,isValidMobileNumber:false,WorkDiallingCode:0,WorkAreaCode:0,WorkPhoneNumber:0,WorkPhoneExtensionNumber:0,isValidWorkNumber:false,MemorableWord:"",ConfMemorableWord:"",ExcludeKeuUpValidation:"excludeKeuUpValidation",fieldsTobeChecked:{"address":[{"YearsAtCurrentAddress":":txtYearsAtCurrentAddress","MonthsAtCurrentAddress":":txtMonthsAtCurrentAddress","YearsAtPreviousAddress":":txtYearsAtPreviousAddress","MonthsAtPreviousAddress":":txtMonthsAtPreviousAddress","AJAXMonthsAtPreviousAddress":":txtMonthsAtPreviousAddress0","AJAXYearsAtPreviousAddress":":txtYearsAtPreviousAddress0","UnauthYearsAtPreviousAddress":":txtYearsAtPreviousAddress0","UnauthMonthsAtPreviousAddress":":txtMonthsAtPreviousAddress0"}],"OtherName":"clsOtherName","EmailAddress":"clsEmailAddress","MemorableWord":"clsMemorableWord","ConfMemorableWord":"clsConfMemorableWord","phoneNumbers":[{"HomeDiallingCode":"intDialCode","HomeAreaCode":"areaCode","HomePhoneNumber":"subscriberNumber"},{"MobileDiallingCode":"intDialCode","MobilePhoneNumber":"mobileNumber"},{"WorkDiallingCode":"intDialCode","WorkAreaCode":"areaCode","WorkPhoneNumber":"subscriberNumber","WorkPhoneExtensionNumber":"extension"}]},checkMonthOfCurrentAddress:function(){if(isNaN(this.years)||this.years<0||isNaN(this.months)||this.months<0){return 0;
}else{return this.years*12+this.months;}},validateContactInfo:function(controller,type){if(type=="homephonenumber"){this.HomeDiallingCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[0].HomeDiallingCode.toLowerCase())>=0)?parseInt(controller.value,10):this.HomeDiallingCode;this.HomeAreaCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[0].HomeAreaCode.toLowerCase())>=0)?parseInt(controller.value,10):this.HomeAreaCode;this.HomePhoneNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[0].HomePhoneNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.HomePhoneNumber;if(this.HomeDiallingCode>0&&this.HomeAreaCode>0&&this.HomePhoneNumber>0){this.isValidHomeNumber=true;}}if(type=="mobilephonenumber"){this.MobileDiallingCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[1].MobileDiallingCode.toLowerCase())>=0)?parseInt(controller.value,10):this.MobileDiallingCode;this.MobilePhoneNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[1].MobilePhoneNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.MobilePhoneNumber;if(this.MobileDiallingCode>0&&this.MobilePhoneNumber>0){this.isValidMobileNumber=true;}}if(type=="workphonenumber"){this.WorkDiallingCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkDiallingCode.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkDiallingCode;this.WorkAreaCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkAreaCode.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkAreaCode;this.WorkPhoneNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkPhoneNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkPhoneNumber;this.WorkPhoneExtensionNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkPhoneExtensionNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkPhoneExtensionNumber;if(this.WorkDiallingCode>0&&this.WorkAreaCode>0&&this.WorkPhoneNumber>0&&this.WorkPhoneExtensionNumber>0){this.isValidWorkNumber=true;}}},validateDurationOfAddress:function(controller,frmID){var status=false;if(controller.id==frmID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress){this.years=parseInt(controller.value,10);}if(controller.id==frmID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress){this.months=parseInt(controller.value,10);}if(controller.id==frmID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress){this.timeAtCurAdr=LBG.progressiveRevealForm.checkMonthOfCurrentAddress();if(this.timeAtCurAdr>=36){status=true;}else{status=false;}}if(controller.id==frmID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].UnauthYearsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress){if(controller.value>0){status=true;}else{status=false;}}if(controller.id==frmID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].UnauthMonthsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress){if(controller.value>0){status=true;}else{status=false;}}return status;},checkValidation:function(sectionId,step,whichEvent){var formElmController=sectionId.find(".formField").find("input:not(.submitAction), textarea, select").filter(":visible");var formID=sectionId.closest("form").attr("id");var count=0;var adrFieldArray=[formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress,formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress,formID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].UnauthYearsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].UnauthMonthsAtPreviousAddress];var validFieldArray=[];for(var i=0;i<formElmController.length;i++){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler(formElmController[i]);if(validationHandler){var fldValue=$.trim(formElmController[i].value);if(fldValue!=""&&fldValue!="-"){if($.inArray(formElmController[i].id,LBG.progressiveRevealForm.selectedFieldID)>-1){switch(whichEvent.toLowerCase()){case"keyup":if(formElmController[i].className.toLowerCase().indexOf(LBG.progressiveRevealForm.ExcludeKeuUpValidation.toLowerCase())<0&&$(formElmController[i]).closest(".formField").hasClass(LBG.progressiveRevealForm.ExcludeKeuUpValidation)==false&&formElmController[i].id.toLowerCase().indexOf("addresspostcode")<0){validationHandler.validate();}break;case"click":case"mousemove":break;default:validationHandler.validate();break;}}switch(step){case"step-address-details":if(($.inArray(formElmController[i].id,adrFieldArray))>-1){validFieldArray[formElmController[i].id]=LBG.progressiveRevealForm.validateDurationOfAddress(formElmController[i],formID);}else{validFieldArray[formElmController[i].id]=true;}break;case"step-contact-details":if($(formElmController[i]).closest(".formField")[0].className.toLowerCase().indexOf("homephonenumber")>=0){LBG.progressiveRevealForm.validateContactInfo(formElmController[i],"homephonenumber");}if($(formElmController[i]).closest(".formField")[0].className.toLowerCase().indexOf("mobilephonenumber")>=0){LBG.progressiveRevealForm.validateContactInfo(formElmController[i],"mobilephonenumber");}if($(formElmController[i]).closest(".formField")[0].className.toLowerCase().indexOf("workphonenumber")>=0){LBG.progressiveRevealForm.validateContactInfo(formElmController[i],"workphonenumber");}if(this.isValidHomeNumber||this.isValidMobileNumber){validFieldArray[formElmController[i].id]=true;}if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.EmailAddress.toLowerCase())>=0){if(validationHandler.isValid==true){validFieldArray[formElmController[i].id]=true;}else{validFieldArray[formElmController[i].id]=false;}}break;case"lastStep":if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.MemorableWord.toLowerCase())>=0){this.MemorableWord=fldValue;}if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.ConfMemorableWord.toLowerCase())>=0){this.ConfMemorableWord=fldValue;}if((this.MemorableWord===this.ConfMemorableWord)&&this.ConfMemorableWord.length>2){validFieldArray[formElmController[i].id]=true;if($(".primaryAction .prgRvlSubmitAction").length>0){$(".primaryAction .prgRvlSubmitAction").attr("disabled","");}}else{validFieldArray[formElmController[i].id]=false;}break;default:if(validationHandler.isValid){validFieldArray[formElmController[i].id]=true;}else{validFieldArray[formElmController[i].id]=false;}break;}if(formElmController[i].id==formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress||formElmController[i].id==formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress){if(this.timeAtCurAdr>=36){validFieldArray[formElmController[i].id]=true;}}}else{switch(step){case"step-unauth-user-details":if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.OtherName.toLowerCase())>0){if(validationHandler.isShowingError==true){validFieldArray[formElmController[i].id]=false;
}else{validFieldArray[formElmController[i].id]=true;}}break;case"step-contact-details":if(this.isValidHomeNumber||this.isValidMobileNumber){if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.EmailAddress.toLowerCase())>=0){validFieldArray[formElmController[i].id]=false;}else{validFieldArray[formElmController[i].id]=true;}}break;case"step-income-details":if(formElmController[i].id.toLowerCase().indexOf(("txtYearsAtEmpAddress").toLowerCase())>=0||formElmController[i].id.toLowerCase().indexOf(("txtMonthsAtCurrentAddress").toLowerCase())>=0){if(validationHandler.isShowingError==true){validFieldArray[formElmController[i].id]=false;}else{validFieldArray[formElmController[i].id]=true;}}break;default:if(($.inArray(formElmController[i].id,adrFieldArray))>-1){if(this.timeAtCurAdr>=36){validFieldArray[formElmController[i].id]=true;}}else{validFieldArray[formElmController[i].id]=false;}if(formElmController[i].className.indexOf("fldOptional")>0){validFieldArray[formElmController[i].id]=true;}break;}}}else{validFieldArray[formElmController[i].id]=true;}}if(validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].UnauthYearsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress]===true){validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress]=true;}if(validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].UnauthMonthsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress]===true){validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress]=true;}for(var i=0;i<formElmController.length;i++){if(validFieldArray[formElmController[i].id]==true){count++;}}if(count>=formElmController.length){return true;}else{return false;}},GetUnique:function(iptArray){var optArray=[];for(var i=0;i<iptArray.length;i++){if(($.inArray(iptArray[i],optArray))==-1){optArray.push(iptArray[i]);}}return optArray;},initVallidation:function(step,stepId,whichEvent){if(stepId=="lastStep"){LBG.progressiveRevealForm.checkValidation(step,stepId,whichEvent);}else{if(LBG.progressiveRevealForm.checkValidation(step,stepId,whichEvent)){step.next().fadeIn(1000);}}},bindEvent:function(){$(".frmProgressiveReveal .section-row input:not(.submitAction,.pseudoLink), textarea, select").bind("click",function(e){LBG.progressiveRevealForm.initVallidation($(this).closest(".section-row"),$(this).closest(".section-row")[0].className.split(" ",1)[0],"click");}).change(function(e){e.preventDefault();LBG.progressiveRevealForm.initVallidation($(this).closest(".section-row"),$(this).closest(".section-row")[0].className.split(" ",1)[0],"change");}).live("keyup",function(e){e.preventDefault();LBG.progressiveRevealForm.initVallidation($(this).closest(".section-row"),$(this).closest(".section-row")[0].className.split(" ",1)[0],"keyup");});},init:function(e){if($(".clsOthetTitle").length>0&&$(".clsOthetTitle").val()!=""){$(".clsSlctTitleStatus").val("Other");$(".other").attr("style","display:block");}if($(".frmProgressiveReveal .formField.error").length>0||$(".formSubmitError").length>0||($(".frmProgressiveReveal .formField.pat-805-input-number input.excludeKeuUpValidation").length>0&&$(".frmProgressiveReveal .formField.pat-805-input-number input.excludeKeuUpValidation").val()!="")){if($(".frmProgressiveReveal .section-row ").length>0){$(".frmProgressiveReveal .section-row ").addClass("revealIt");}}else{if($(".primaryAction .prgRvlSubmitAction").length>0){$(".primaryAction .prgRvlSubmitAction").attr("disabled","disabled");}var objElm="";var vldHnlr="";$(".frmProgressiveReveal .section-row input:not(.submitAction,.pseudoLink), textarea, select").click(function(){LBG.progressiveRevealForm.selectedElement=$(this).attr("id");objElm=$(this);LBG.progressiveRevealForm.selectedFieldID.push($(this).attr("id"));LBG.progressiveRevealForm.selectedFieldID=LBG.progressiveRevealForm.GetUnique(LBG.progressiveRevealForm.selectedFieldID.sort());}).change(function(){LBG.progressiveRevealForm.selectedElement=$(this).attr("id");objElm=$(this);LBG.progressiveRevealForm.selectedFieldID.push($(this).attr("id"));LBG.progressiveRevealForm.selectedFieldID=LBG.progressiveRevealForm.GetUnique(LBG.progressiveRevealForm.selectedFieldID.sort());}).keyup(function(e){LBG.progressiveRevealForm.selectedElement=$(this).attr("id");objElm=$(this);LBG.progressiveRevealForm.selectedFieldID.push($(this).attr("id"));LBG.progressiveRevealForm.selectedFieldID=LBG.progressiveRevealForm.GetUnique(LBG.progressiveRevealForm.selectedFieldID.sort());});$(".section-row:not(.lastStep)").bind("keypress",function(event){if(event.which===13){vldHnlr=LBG.Forms.Validation.Tools.getFieldHandler(objElm);if(vldHnlr){vldHnlr.validate();if(vldHnlr.isValid){objElm.closest(".formField").next().find("input:not(.submitAction,.pseudoLink), textarea, select").focus();}}return false;}});if($(".frmProgressiveReveal .section-row input:not(.submitAction,.pseudoLink), textarea, select").closest(".section-row").length>0){LBG.progressiveRevealForm.bindEvent();}}}};var positionOnPageLoad=new Class(".pageload-position",{init:function(element){this.element=element;$("html, body").animate({scrollTop:element.offset().top},700);}});LBG.carPriceDepositCalc={init:function(){$(".container-payment-info .cash-amount, .container-payment-info .cheque-amount,.container-payment-info .exchange-amount").keyup(function(){LBG.carPriceDepositCalc.performDepositCalculation();});$(".container-payment-info .cash-amount").blur(function(){var cashAmount=$(".container-payment-info .cash-amount").val();if(!isNaN(cashAmount)){cashAmount=cashAmount?parseFloat(cashAmount.replace(/[^0-9\.]+/g,"")):0;$(".container-payment-info .cash-amount").val(cashAmount.toFixed(2));}});$(".container-payment-info .cheque-amount").blur(function(){var chequeAmount=$(".container-payment-info .cheque-amount").val();if(!isNaN(chequeAmount)){chequeAmount=chequeAmount?parseFloat(chequeAmount.replace(/[^0-9\.]+/g,"")):0;$(".container-payment-info .cheque-amount").val(chequeAmount.toFixed(2));}});$(".container-payment-info .exchange-amount").blur(function(){var exchangeAmount=$(".container-payment-info .exchange-amount").val();if(!isNaN(exchangeAmount)){exchangeAmount=exchangeAmount?parseFloat(exchangeAmount.replace(/[^0-9\.]+/g,"")):0;$(".container-payment-info .exchange-amount").val(exchangeAmount.toFixed(2));}});},performDepositCalculation:function(){var cashdeposit=$(".container-payment-info .deposit-amount").text();var cashAmount=$(".container-payment-info .cash-amount").val();var chequeAmount=$(".container-payment-info .cheque-amount").val();var exchangeAmount=$(".container-payment-info .exchange-amount").val();cashAmount=cashAmount?parseFloat(cashAmount.replace(/[^0-9\.]+/g,"")):0;chequeAmount=chequeAmount?parseFloat(chequeAmount.replace(/[^0-9\.]+/g,"")):0;
exchangeAmount=exchangeAmount?parseFloat(exchangeAmount.replace(/[^0-9\.]+/g,"")):0;cashdeposit=cashdeposit?parseFloat(cashdeposit.replace(/[^0-9\.]+/g,"")):0;var totalAmount=cashAmount+chequeAmount+exchangeAmount;totalAmount=totalAmount?parseFloat(totalAmount):0;$(".container-payment-info .total-amount").html(totalAmount.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,"));var balance=0;var allocationStatus="";if(totalAmount>cashdeposit){balance=totalAmount-cashdeposit;allocationStatus+="(The amount is in excess of &pound;"+balance.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")+")";}else{if(totalAmount<cashdeposit){balance=cashdeposit-totalAmount;allocationStatus+="(Another &pound;"+balance.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")+" needs to be allocated)";}else{}}$(".container-payment-info .allocation-status").html(allocationStatus);}};LBG.carDetailsDropDowns={init:function(){$(".carLoan-car-details .container-car-reg-yesno input:radio.rdo-reg-no").click(function(){$(".carLoan-car-details .container-car-reg .car-reg input:text").val("");});$(".carLoan-car-details .container-car-reg-yesno input:radio").click(function(){if(typeof dcsMultiTrack!="undefined"){$(this).val()==="true"?dcsMultiTrack("WT.si_x","4"):dcsMultiTrack("WT.si_x","3");}$("form.form-car-details").submit();});$(".carLoan-car-details .container-car-condition input:radio").click(function(){LBG.clearForm(".container-dropdown","empty");LBG.clearForm(".option-panel .inputGroup","empty");$(".submit-car-details.on").addClass("hide");$(".continueToCalc").addClass("hide");$(".car-filter-list").addClass("hide");$(".cars-amend-filters").addClass("hide");$(".additional-details").addClass("hide");});$(".container-car-condition input:radio").click(function(){$(".formSubmitError").remove();});$(".container-car-condition .rdo-car-new").click(function(){if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.si_x","4");}$(".container-car-used").addClass("hide");if(!$(".car-make select").hasClass("select-dropdown")){LBG.carDetailsDropDowns.getData(null,"car-make");$(".carLoan-car-details .container-car-details").removeClass("hide");}$(".submit-car-details.on").addClass("hide");$(".submit-car-details.off").removeClass("hide");});$(".container-car-condition .rdo-car-used").click(function(){if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.si_x","3","WT.tx_e","d2","WT.tx_n","Registration Required");}$(".carLoan-car-details .container-car-details").addClass("hide");LBG.clearForm(".container-dropdown","empty");$(".container-car-used").removeClass("hide").removeAttr("style");});$(".submit-car-details.off").click(function(e){e.preventDefault();});$(".submit-car-details.on a").click(function(e){e.preventDefault();var userSelection=$(".car-engine").find("select").val();if(!LBG.carDetailsDropDowns.state.inital){$(".disabled-calc").addClass("hide");$(".continueToCalc").removeClass("hide");}LBG.carDetailsDropDowns.doFilterList(userSelection);});$(".carLoan-car-details .additional-details .rdo-existing-finance input:radio.rdo-yes").click(function(){$(".additional-details .txt-monthly-repayment").addClass("validate:(required_validateCurrency)");LBG.Forms.Validation.init();});},bindEventsAfterAjax:function(context){$(".select-dropdown",context).change(function(){var ddCurrent=(context.attr("class").match(/car-[\w-]*\b/)[0]);var userSelection=$(this).val();LBG.carDetailsDropDowns.checkDropDownState();LBG.carDetailsDropDowns.getNextDropdown(ddCurrent,userSelection);});},getNextDropdown:function(ddCurrent,userSelection){var dropdowns=["car-make","car-model","car-transmission","car-fuel","car-body","car-engine"];var currentPos=jQuery.inArray(ddCurrent,dropdowns);if(dropdowns.length-1<=currentPos&&!$(".container-dropdown."+ddCurrent).find("select option:eq(0)").is(":selected")){$(".submit-car-details.off").addClass("hide");$(".submit-car-details.on").removeClass("hide");}else{if($(".container-dropdown."+ddCurrent).find("select option:eq(0)").is(":selected")){var nextDropdown=currentPos+1;$(".container-dropdown."+dropdowns[nextDropdown]+" select").attr("disabled","disabled");$(".submit-car-details.on").addClass("hide");$(".submit-car-details.off").removeClass("hide");}else{$(".submit-car-details.on").addClass("hide");$(".submit-car-details.off").removeClass("hide");LBG.carDetailsDropDowns.getData(dropdowns[currentPos],dropdowns[currentPos+1],userSelection);}for(var i=currentPos;i<dropdowns.length;i++){$(".container-dropdown."+dropdowns[i+1]+" select option:eq(0)").attr("selected","selected");$(".container-dropdown."+dropdowns[i+1]+" select").attr("disabled","disabled");}}},getData:function(ddCurrent,ddNext,userSelection){var ajaxUrl=DI.lang.loans.car.detailsDropdown.ajax.url;var errorUrl=DI.lang.loans.car.detailsDropdown.ajax.errorUrl;var nextDdContainer=$(".container-dropdown."+ddNext);$.ajax({url:ajaxUrl,data:{dropdown:ddCurrent,selection:userSelection},beforeSend:function(){var loading="<p class='inline-loading'>Loading</p>";nextDdContainer.empty().append(loading);},success:function(data){$(".container-dropdown."+ddNext+" .loading").hide();nextDdContainer.empty().append(data);nextDdContainer.find("option:first").attr("selected","selected");LBG.carDetailsDropDowns.bindEventsAfterAjax(nextDdContainer);var riSwitchStatus=parseInt($("#riSwitch").val());if(riSwitchStatus&&($(data).find(".select-dropdown option").length===2)){nextDdContainer.find("option:second").attr("selected","selected");LBG.carDetailsDropDowns.checkDropDownState();LBG.carDetailsDropDowns.getNextDropdown(ddNext,nextDdContainer.find("option:selected").val());}},error:function(){window.location.replace(errorUrl);}});$(document).ajaxStop(function(){$(".container-dropdown."+ddNext+" .loading").hide();});},doFilterList:function(userSelection){LBG.carDetailsDropDowns.state.inital=false;$(".pat522 .car-spec, .pat522.car-filter-list").removeClass("hide");$(".pat522 .cars-no-value, .pat522 .cars-too-many, .pat522 .selected-option-panel").addClass("hide");$(".pat522 .refine-list").css("display","block");$("html, body").animate({scrollTop:$(".pat522.car-filter-list").offset().top},1000);LBG.filterList.init({validate:function(data){if(data.tooManyCarsFound){$(".cars-too-many").removeClass("hide");$(".pat522 .car-spec, .cars-amend-filters").addClass("hide");LBG.filterList.failedValidation();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.si_x","4","WT.tx_e","n1","WT.tx_n","Too many results");}return false;}if(data.noCarFound){$(".cars-no-value").removeClass("hide");$(".pat522 .car-spec, .cars-amend-filters").addClass("hide");LBG.filterList.failedValidation();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.si_x","4","WT.tx_e","n1","WT.tx_n","Options Invalid");}return false;}$(".cars-amend-filters").addClass("hide");$(".pat522 .selected-car-panel").removeClass("hide");LBG.filterList.passedValidation();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.si_x","5");}return true;},radioBtnClick:function(that){var $radio=$(that).find('input[type="radio"]');var selectedMake=$(".car-make").find("select").val();var selectedModel=$(".car-model").find("select").val();var selectedCar=$radio.next("span").text();var selectedCarValue=$radio.val();$(".pat522 div.radio-btn-wrap").removeClass("selected");$(that).addClass("selected");$radio.attr("checked",true);$radio.triggerHandler("click");LBG.filterList.storage.selectedRadioBtn=selectedCarValue;$(".pat522 .radio-button-selected").html(selectedMake+" "+selectedModel+" "+selectedCar);$(".additional-details, .continueToCalc").removeClass("hide");
LBG.filterList.collapse();},changeRadioOption:function(){LBG.filterList.expand();},afterFilterCollapse:function(){$("#frmNewCarJourney\\:newCarstxtExpectedMileage").focus();},data:{dropdown:"car-engine",selection:userSelection}});},checkDropDownState:function(){if(!this.state.inital){$(".pat522 .car-spec, .car-filter-list, .cars-no-value, .cars-too-many, .selected-option-panel, .continueToCalc").addClass("hide");$(".pat522.car-filter-list, .cars-amend-filters, .disabled-calc").removeClass("hide");LBG.filterList.storage.selectedRadioBtn=null;LBG.filterList.failedValidation();if(LBG.quickPagination.settings.paginationOn){$(".quick-pagination").addClass("hide");}}},state:{inital:true}};LBG.osrValidation=function(){function validateSelect(el,valid){if((typeof el==="object")&&(typeof valid==="boolean")){if(valid==true){el.bind("click",function(e){var classDimensions=el.attr("class").split("_"),winWidth=classDimensions[1],winHeight=classDimensions[2];window.open(el.attr("href"),"_blank","width="+winWidth+" , height="+winWidth+" , scrollbars=yes");return false;});}else{LBG.Forms.Validation.init(el);var testField=LBG.Forms.Validation.Tools.getFieldHandler(el.parent().find(".formField"));testField.validate();}}}function init(){var selectOption=false;var $links=$('.actionListItem.last > a[class*="newWindow"]');$links.each(function(){var $selectElement=$(this).parent().find(".formFieldInner select");if($selectElement.length==1){$(this).unbind("click",LBG.newWindow.init());$(this).click(function(e){if($selectElement.val()!="-"){selectOption=true;}else{e.preventDefault();e.stopImmediatePropagation();selectOption=false;}validateSelect($(this),selectOption);});}});}return{init:init};}();LBG.filterList={getData:function(){$.ajax({contentType:"application/json",dataType:"json",cache:LBG.filterList.settings.cache,data:LBG.filterList.settings.data,url:DI.lang.loans.car.pat522FilterList.ajax.url,beforeSend:function(){$('<p class="filter inline-loading">Loading</p>').insertBefore(LBG.filterList.settings.ele);$("refine-list").css("display","none");},success:function(data){$(LBG.filterList.settings.ele).removeClass("hide");$(".filter.inline-loading").remove();LBG.filterList.storage.data=data;if(LBG.filterList.settings.validate(data)){LBG.filterList.populate(data.filterList);LBG.filterList.bind(data.filterList);}},error:function(){window.location.replace(DI.lang.loans.car.detailsDropdown.ajax.errorUrl);}});},populate:function(data){var $optionPanel=$(this.settings.ele).find(".option-panel .radioGroup");$optionPanel.empty();$optionPanel.append('<div class="panel-radio-btn clearfix"></div>');$(".select-model-list").empty();$(".select-model-list").append("<select></select>");for(var i=0;i<data.length;i++){$(".select-model-list select").append('<option value="'+data[i].selectList+'">'+data[i].selectList+"</option>");}for(var j=0;j<data[0].radioBtn.length;j++){$(this.settings.ele).find(".option-panel div.panel-radio-btn").append('<div class="radio-btn-wrap"><div class="inputGroup"><label><input id="'+this.replaceSpace(data[0].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[0].radioBtn[j].value+'"><span>'+data[0].radioBtn[j].label+"</span></label></div></div>");}LBG.filterList.setTotalItems();LBG.filterList.doPagination();LBG.filterList.scrollBarCheck();this.alternate();},bind:function(data){var $div=$(this.settings.ele).find(".option-panel div.panel-radio-btn");$(".pat522").find(".select-model-list select").change(function(value){var $val=$(this).val();$div.empty();if($val===data[0].selectList){for(var j=0;j<data[0].radioBtn.length;j++){if(LBG.filterList.storage.selectedRadioBtn===data[0].radioBtn[j].value){$div.append('<div class="radio-btn-wrap selected"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[0].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[0].radioBtn[j].value+'" checked><span>'+data[0].radioBtn[j].label+"</span></label></div></div>");}else{$div.append('<div class="radio-btn-wrap"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[0].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[0].radioBtn[j].value+'"><span>'+data[0].radioBtn[j].label+"</span></label></div></div>");}}}else{for(var i=0;i<data.length;i++){if(data[i].selectList===$val){for(var j=0;j<data[i].radioBtn.length;j++){if(LBG.filterList.storage.selectedRadioBtn===data[i].radioBtn[j].value){$div.append('<div class="radio-btn-wrap selected"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[i].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[i].radioBtn[j].value+'" checked><span>'+data[i].radioBtn[j].label+"</span></label></div></div>");}else{$div.append('<div class="radio-btn-wrap"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[i].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[i].radioBtn[j].value+'"><span>'+data[i].radioBtn[j].label+"</span></label></div></div>");}}}}}LBG.filterList.doPagination();LBG.filterList.scrollBarCheck();LBG.filterList.alternate();});if(!this.storage.initialBind){$(this.settings.ele).find(".option-panel div.radio-btn-wrap").live("keydown",function(evt){var key=evt.which||evt.keyCode;if(key===13){return false;}setTimeout(function(){$(LBG.filterList.settings.ele).find('.radio-btn-wrap input[type="radio"]').attr("checked",false);$(LBG.filterList.settings.ele).find('.radio-btn-wrap.selected input[type="radio"]').attr("checked",true);},0);if(key===32){LBG.filterList.settings.radioBtnClick(this);}});$(this.settings.ele).find(".option-panel div.radio-btn-wrap").live("mousedown",function(evt){LBG.filterList.settings.radioBtnClick(this);});$(this.settings.ele).find(".change-radio-option").live("click",function(evt){evt.preventDefault();LBG.filterList.settings.changeRadioOption(this);});this.storage.initialBind=true;}},replaceSpace:function(value){return value.replace(/ /g,"");},doPagination:function(){LBG.quickPagination.init(this.settings.paginationSettings);},scrollBarCheck:function(){if(this.settings.scrollSettings.scrollOn){var countItems=$(this.settings.ele).find(".option-panel .radio-btn-wrap .inputGroup").length;if(countItems>this.settings.scrollSettings.scrollOnCount){var calHeight=parseInt($(this.settings.ele).find(".option-panel .radio-btn-wrap .inputGroup").height()*this.settings.scrollSettings.scrollOnCount);$(this.settings.ele).find(".option-panel").css("height",calHeight+"px").css("overflow","auto");}else{$(this.settings.ele).find(".option-panel").css("height","").css("overflow","");}}},failedValidation:function(){$(this.settings.ele).find(".refine-list").css("display","none");$(this.settings.ele).find(".no-value").removeClass("hide");},passedValidation:function(){$(this.settings.ele).find(".no-value").addClass("hide");$(this.settings.ele).find(".refine-list").css("display","block");},alternate:function(){$(this.settings.ele).find(".option-panel div.radio-btn-wrap:even").addClass("alt");},collapse:function(){var ele=LBG.filterList.settings.ele;if(this.settings.paginationSettings.paginationOn){$(".quick-pagination").addClass("hide");}setTimeout(function(){$(ele).find(".selected-option-panel").removeClass("hide");$(ele).find(".refine-list").slideUp("slow",function(){LBG.filterList.settings.afterFilterCollapse();});},500);},expand:function(){if(this.settings.paginationSettings.paginationOn){$(".quick-pagination").removeClass("hide");}$(this.settings.ele).find(".refine-list").slideDown("slow",function(){$(".pat522 .radio-btn-wrap.selected input").blur().focus();
});$(this.settings.ele).find(".selected-option-panel").addClass("hide");},setTotalItems:function(){var totalItems=$(this.settings.paginationSettings.itemEleWrap).length;var stringReplaceOn=this.settings.stringReplaceOn;var totalItemsEle=this.settings.totalItemsEle;var stringToReplace=this.settings.stringToReplace;if(stringReplaceOn){if(!this.storage.totalItemsUpdate){var str=$(totalItemsEle).html();var res=str.replace(stringToReplace,'<span class="total-items str-updated">'+totalItems+"</span>");$(totalItemsEle).html(res);this.storage.totalItemsUpdate=true;}else{$(".total-items.str-updated").html(totalItems);}}else{$(totalItemsEle).html(totalItems);}},storage:{selectedRadioBtn:null,totalItemsUpdated:false,initialBind:false},settings:{cache:true,data:null,ele:".pat522",totalItemsEle:".total-items",stringReplaceOn:true,stringToReplace:"{0}",validate:function(data){if(!data.filterList.length>0){LBG.filterList.failedValidation();return false;}LBG.filterList.passedValidation();return true;},radioBtnClick:function(that){$(LBG.filterList.settings.ele).find("div.radio-btn-wrap").removeClass("selected");$(that).addClass("selected");var $radio=$(that).find('input[type="radio"]');$radio.attr("checked",true);$radio.triggerHandler("click");LBG.filterList.storage.selectedRadioBtn=$radio.val();$(LBG.filterList.settings.ele).find(".radio-button-selected").html($radio.next("span").text());LBG.filterList.collapse();},changeRadioOption:function(){LBG.filterList.expand();},afterFilterCollapse:function(){},scrollSettings:{scrollOnCount:20,scrollOn:true},paginationSettings:{parentEle:".option-panel",itemEleWrap:"div.radio-btn-wrap",perPage:30,pagOnCount:30,paginationOn:false,totalItemsEle:".total-items"}},init:function(options){if(options){$.extend(this.settings,options);}isVisible=$(this.settings.ele).is(":visible");if(isVisible){$(this.settings.ele).addClass("hide");this.getData();}}},LBG.quickPagination={doPagination:function(){var perPage=this.settings.perPage;var pagOnCount=this.settings.pagOnCount;var parentEle=$(this.settings.parentEle);var itemEleWrap=parentEle.find(this.settings.itemEleWrap);var totalItems=itemEleWrap.length;var pagingNumbers=$(".quick-pagination .paging-numbers");pagingNumbers.empty();if(totalItems<pagOnCount){$(".quick-pagination").addClass("hide");return false;}var pagNumCount=Math.ceil(itemEleWrap.length/perPage);for(var i=0;i<pagNumCount;i++){itemEleWrap.slice(i*perPage,(i+1)*perPage).wrapAll('<div class="pagWrap" />');pagingNumbers.append('<a href="#" class="pageLinks"> '+(i+1)+" </a> ");}var pagWrap=parentEle.find(".pagWrap");pagWrap.each(function(){$(this).addClass("hide");});var pageLinks=".quick-pagination .paging-numbers a.pageLinks";$(pageLinks).click(function(e){$(pageLinks).removeClass("active");$(pageLinks+":nth-child("+parseInt($(this).text())+")").addClass("active");pagWrap.addClass("hide");pagWrap.eq(parseInt($(this).text())-1).removeClass("hide");if(parseInt($(this).text())===1){$(".quick-pagination .paging-items").html("<strong>1</strong> to <strong>"+perPage+"</strong> (of <strong>"+totalItems+"</strong>)");}else{var value=((parseInt($(this).text())-1)*perPage)+1;result=pagWrap.eq(parseInt($(this).text())-1).find(LBG.quickPagination.settings.itemEleWrap).length;resultCount=value+(result-1);$(".quick-pagination .paging-items").html("<strong>"+value+"</strong> to <strong>"+resultCount+"</strong> (of <strong>"+totalItems+"</strong>)");}e.preventDefault();});$(pageLinks+":first-child").addClass("active");$(pagWrap.eq(0)).removeClass("hide");$(".quick-pagination").removeClass("hide");$(".quick-pagination .paging-items").html("<strong>1</strong> to <strong>"+perPage+"</strong> (of <strong>"+totalItems+"</strong>)");},settings:{parentEle:".option-panel",itemEleWrap:"div.radio-btn-wrap",perPage:5,pagOnCount:21,paginationOn:true},init:function(options){if(options){$.extend(this.settings,options);}if(this.settings.paginationOn){this.doPagination();}}};LBG.dealerDetails={errorFallback:function(){$(this.settings.continueBtn).addClass("hide");$(this.settings.disabledBtn).addClass("hide");$(this.settings.ele).remove();$(this.settings.inputs).remove();$(this.settings.fallback).removeClass("hide");},isPopulated:function(){if(!this.settings.populateComplete&&$("input.dealer-id").val()){$(this.settings.sel).removeClass("hide");$(this.settings.continueBtn).removeClass("hide");$(this.settings.disabledBtn).addClass("hide");$(this.settings.ele).addClass("hide");this.setSize();$("span.dealer-postcode").html($("input.dealer-postcode").val());$("span.dealer-name").html($("input.dealer-name").val());$("span.dealer-addr1").html($("input.dealer-addr1").val());$("span.dealer-addr2").html($("input.dealer-addr2").val());$("span.dealer-addr3").html($("input.dealer-addr3").val());$("span.dealer-town").html($("input.dealer-town").val());$("span.dealer-county").html($("input.dealer-county").val());this.settings.redraw=true;this.settings.populateComplete=true;return true;}return false;},setSize:function(){this.resize();var that=this;$(window).resize(function(){that.resize();});},mapLoadCheck:function(postData,fallbackTimer){var that=this;if(postData==='"Yes"'||postData==='"FocusDown"'||postData==='"FocusUp"'||postData.substring(2,4)==="id"){that.consoleOutput(postData,"Map successfully loaded response");return true;}else{that.consoleOutput(postData,"Map failed");clearTimeout(fallbackTimer);that.errorFallback();return false;}},mapAccessibility:function(recievedData){var that=this;var focusCount=1;if(!that.settings.focusCountSet){$("a").each(function(index){if($(this).is(":hidden")===false||$(this).hasClass("hidden-focus")){$(this).attr("data-focusCount",focusCount);focusCount++;}});var hiddenFocus=parseInt($(".hidden-focus").attr("data-focusCount"));$('a[data-focusCount="'+(hiddenFocus-1)+'"]').addClass(that.settings.focusUp.replace(".",""));that.settings.focusCountSet=true;}if(recievedData==="FocusUp"){$(that.settings.focusUp).blur().focus();}if(recievedData==="FocusDown"){$(that.settings.focusDown).blur().focus();}},resize:function(){if(!this.settings.hiddenWidthSet){$(this.settings.ele).before('<a href="#" class="hidden-focus hide"></a><div class="'+this.settings.hiddenWidthEle.replace(".","")+'"></div>');this.settings.hiddenWidthSet=true;}var x=$(this.settings.hiddenWidthEle).outerWidth();var y=$(window).height();var rh=0.7*y;$(this.settings.ele).find("iframe").css("width",x+"px").css("height",rh+"px");},selPanel:function(recievedData){var that=this;if(recievedData.ref){$(that.settings.sel).removeClass("hide");$(that.settings.ele).addClass("hide");$("span.dealer-postcode").html(recievedData.postcode);$("span.dealer-name").html(recievedData.name);$("span.dealer-addr1").html(recievedData.addr1);$("span.dealer-addr2").html(recievedData.addr2);$("span.dealer-addr3").html(recievedData.addr3);$("span.dealer-county").html(recievedData.county);$("span.dealer-town").html(recievedData.town);$("input.dealer-postcode").val(recievedData.postcode);$("input.dealer-id").val(recievedData.ref);$("input.dealer-name").val(recievedData.name);$("input.dealer-addr1").val(recievedData.addr1);$("input.dealer-addr2").val(recievedData.addr2);$("input.dealer-addr3").val(recievedData.addr3);$("input.dealer-county").val(recievedData.county);$("input.dealer-lat").val(recievedData.lat);$("input.dealer-lat-lng-h").val(recievedData.latLng.H);$("input.dealer-lat-lng-l").val(recievedData.latLng.L);$("input.dealer-long").val(recievedData["long"]);$("input.dealer-phone").val(recievedData.phone);$("input.dealer-town").val(recievedData.town);
$(that.settings.continueBtn).removeClass("hide");$(that.settings.disabledBtn).addClass("hide");$(that.settings.focusDown).blur().focus();}},bindBtns:function(){var that=this;$(that.settings.disabledBtn).click(function(e){e.preventDefault();});$(that.settings.changeSelection).click(function(e){if(that.settings.redraw){var iframe=$(that.settings.ele+" iframe")[0];var iframewindow=iframe.contentWindow?iframe.contentWindow:iframe.contentDocument.defaultView;iframewindow.postMessage("Redraw","*");that.settings.redraw=false;}$(that.settings.sel).addClass("hide");$(that.settings.ele).removeClass("hide");$(that.settings.continueBtn).addClass("hide");$(that.settings.disabledBtn).removeClass("hide");e.preventDefault();});},consoleOutput:function(value,name){if(!this.settings.debugMode){return;}if(typeof name!=="undefined"){}},dealerSearch:function(){var that=this;var eventMethod=window.addEventListener?"addEventListener":"attachEvent";var eventer=window[eventMethod];var messageEvent=eventMethod=="attachEvent"?"onmessage":"message";var recievedData;var domain=$(that.settings.domain).text();that.consoleOutput(domain,"iframe input origin value");var fallbackTimer=setTimeout(function(){if(recievedData===undefined){that.errorFallback();}},4000);eventer(messageEvent,function(e){that.consoleOutput(e,"iframe response");that.consoleOutput(e.origin,"iframe origin");if(e.origin!=domain){return;}var postData=e.data;that.consoleOutput(e.data,"recieved data");isLoaded=that.mapLoadCheck(postData,fallbackTimer);if(!isLoaded){return false;}recievedData=JSON.parse(postData);if(!that.isPopulated()){$(that.settings.ele).removeClass("hide");that.setSize();}$(that.settings.fallback).remove();that.mapAccessibility(recievedData);that.selPanel(recievedData);},false);that.bindBtns();},fallbackTest:function(){var hasUrl,fallBackState;var hasElement=$(this.settings.ele).length>0;var iframeSrc=$(this.settings.ele).find("iframe").attr("src");iframeSrc?hasUrl=iframeSrc.length:hasUrl=0;fallBackState=$(this.settings.fallbackMode).val()||false;fallBackState==="true"?true:false;this.consoleOutput(hasElement,"element exists");this.consoleOutput(hasUrl,"iframe src count");this.consoleOutput(fallBackState,"fallback mode");if(!hasElement||fallBackState||hasUrl===0){this.errorFallback();return false;}this.dealerSearch();},settings:{ele:".dealer-details",sel:".dealer-details-selected",fallback:".dealer-details-fallback",fallbackMode:"input.dealer-details-fallback-on",continueBtn:".dealer-continue",disabledBtn:".button.disabled",changeSelection:".change-dealer-details",domain:".dealer-domain",inputs:".dealer-details-inputs",focusDown:".dealer-focus-down",focusUp:".dealer-focus-up",redraw:false,populateComplete:false,hiddenWidthSet:false,hiddenWidthEle:".dealer-details-width",focusCountSet:false,debugMode:false},init:function(options){if(options){$.extend(this.settings,options);}this.fallbackTest();}};LBG.youngSaverSTP={init:function(){$(".differentAddress").bind("click",function(){if($(this).is(":checked")){$(".enableApplyNow").attr("disabled",true).addClass("disable-apply-now-button");}$(".time-current-address-STP").hide();});$(".sameAddress").bind("click",function(){if($(this).is(":checked")){$(".enableApplyNow").removeAttr("disabled").removeClass("disable-apply-now-button");}$(".time-current-address-STP").show();});}};LBG.savingsCustomerSegmentedPricing={init:function(){$(".osrTableLastCol").find(".scspInfoMessage").each(function(){if($(this).children("a")){$(this).css("background-color","#F8F8F8");$(this).children("p").css("background-color","#FFC");$(this).children("a").css("float","right");}});$(".osrTableData").find("select.field").each(function(){var $anchor=$(this).closest("li").find("a.scspFindMore");var href=$anchor.attr("href");href=href.substring(0,href.indexOf("&al=")+4);$anchor.attr("href",href+$(this).val());$(this).bind("change",function(){$anchor.attr("href",href+$(this).val());});});}};LBG.iccForm={planName:"",init:function(){var form=$(".iccSetupPlanForm");if($("body").hasClass("hasJS")){LBG.iccForm.closeAccordian();}$(form).submit(function(e){$(".icc-continue").click();e.preventDefault();});$(".icc-continue").live("click",function(event){$(this.form).submit(function(e){event.preventDefault();});LBG.iccForm.validateOverlay(form);});$(".installmentTerm").change(function(){if($(".installmentAmount").val()!=""&&$(".installmentAmount").val()!=undefined&&$(".installmentTerm").val()!="-"&&$(".installmentTerm").val()!=undefined){if(!($(".installmentAmount").closest(".formField").hasClass("error"))){$(".ajaxData").removeClass("hide");LBG.iccForm.getQuoteServiceCall();}else{$(".ajaxData").addClass("hide");}}else{$(".ajaxData").addClass("hide");}});$(".installmentAmount").change(function(){if($(".installmentTerm").val()!="-"&&$(".installmentTerm").val()!=undefined&&$(".installmentAmount").val()!=""&&$(".installmentAmount").val()!=undefined){setTimeout(function(){if(!($(".installmentAmount").closest(".formField").hasClass("error"))){$(".ajaxData").removeClass("hide");LBG.iccForm.getQuoteServiceCall();}else{$(".ajaxData").addClass("hide");}},200);}else{$(".ajaxData").addClass("hide");}});},getPlanName:function(){var installmentPlanName=DI.lang.iccPlanNameSaveOverlay.url+"?planName="+LBG.iccForm.planName;$.ajax({url:installmentPlanName,success:function(data,success){},cache:false,error:function(jqXHR,textStatus,error){}});},getPlanNameBeforeCancel:function(){$(".installmentPlanName").change(function(){LBG.iccForm.planName=$(".installmentPlanName").val();});},validateOverlay:function(form){if(LBG.iccForm.validateICCForm(form)){var launchOverlay={ajaxURL:DI.lang.iccPlanNameOverlay.url};LBG.overlay.open(launchOverlay.ajaxURL,null,false,true);setTimeout(LBG.iccForm.getPlanNameBeforeCancel,300);$(".close").live("click",function(){LBG.overlay.close();});LBG.overlay.onClose(function(){LBG.iccForm.getPlanName();});setTimeout(LBG.iccForm.ChangePostToGet,2000);return true;}else{event.preventDefault();}},validateICCForm:function(objID){var formElmController=objID.find(".formField").find("input:not(.submitAction), textarea, select").filter(":visible");var count=0;var validFieldArray=[];var validForm=false;for(var i=0;i<formElmController.length;i++){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler(formElmController[i]);if(validationHandler){validationHandler.validate();var fldValue=$.trim(formElmController[i].value);if(fldValue!=""&&fldValue!="-"){if(validationHandler.isValid==true){validForm=true;validFieldArray[i]=validForm;}else{validForm=false;validationHandler.showError();validFieldArray[i]=validForm;}}else{validForm=false;validationHandler.showError();validFieldArray[i]=validForm;}}else{validForm=false;validationHandler.showError();validFieldArray[i]=validForm;}}for(var k=0;k<formElmController.length;k++){if(validFieldArray[k]==true){count++;}}if(count>0&&count==formElmController.length){return true;}else{return false;}},getQuoteServiceCall:function(formObj){var term,amount;amount=$(".installmentAmount").val();term=$(".installmentTerm").val();var getQuoteAJAXUrl=DI.lang.iccAJAX.url;$(".loadingSign ").removeClass("hide");$(".loadingSign").addClass("loading-indicator");$(".left-panel").addClass("disabled");$(".right-panel").addClass("disabled");$(".bottom-text").addClass("disabled");$.ajax({url:getQuoteAJAXUrl+"?term ="+term+"&amount="+amount,dataType:"json",cache:false,success:function(response){$(".loadingSign ").removeClass("loading-indicator");$(".loadingSign ").addClass("hide");$(".left-panel").removeClass("disabled");
$(".right-panel").removeClass("disabled");$(".bottom-text").removeClass("disabled");if(response){LBG.iccForm.renderQuoteValue(response);}else{DI.lang.iccAJAX.loadingText;}},error:function(){$(".loadingSign ").removeClass("loading-indicator");DI.lang.iccAJAX.errorText;}});},renderQuoteValue:function(data){$(".monthlyrepaymentamount").text(data.planQuote.Quote.monthlyrepaymentamount);$(".term").text(data.planQuote.Quote.term);$(".apr").text(data.planQuote.Quote.apr);$(".totalrepaymentamount").text(data.planQuote.Quote.totalrepaymentamount);$(".interestamount").text(data.planQuote.Quote.interestamount);},resetRadioPanal:function(){var $panelSelect=$(".content .optionPanel .subPanel");$panelSelect.click(function(){$panelSelect.each(function(){$(this).closest(".subPanel").removeClass("panelSelected");});$(this).closest(".subPanel").addClass("panelSelected");$(this).closest(".subPanel").find("input").attr("checked",true);if($(this).closest(".subPanel").find(".txtOverdraftAmount").val()!=undefined){$(this).closest(".subPanel").find(".txtOverdraftAmount").attr("disabled",false);$(this).closest(".subPanel").find(".txtOverdraftAmount").focus();}else{$(".txtOverdraftAmount").attr("disabled","disabled");if($(".txtOverdraftAmount").closest(".formField").hasClass("error")){$(".txtOverdraftAmount").closest(".formField").removeClass("error");$(".error").remove();}}var $panelGroup=$(".content .optionPanel .subPanel");$panelGroup.each(function(){if(!$(this).hasClass(".panelSelected")){$(this).find("input:text").val("");}});});if($(".optionPanel .colLayout .colPart")){$(".optionPanel .colLayout .colPart").attr("tabIndex","0");}setTimeout(function(){if($(".colPart .amountField input")){$(".colPart .amountField input").attr("size","17");}},200);},closeAccordian:function(){$(".icc-expand-collapse").addClass("closed");$(".icc-expand-collapse .pane").css("display","none");},ChangePostToGet:function(){if($(".ChangePostToGet")){$('form:not(".iccSetupPlanForm")').each(function(){var $this=$(this);var $field=$('<input type="hidden" name="req" value ="POST" />');$this.attr("method","GET");$this.append($field);});}}};LBG.gformCertOfInterest={init:function(){var currentMonth=(new Date).getMonth()+1;var currentYear=(new Date).getFullYear();if(currentMonth<4){currentYear=currentYear-1;}$("#certYear1").html("April "+(currentYear-1)+" - April "+currentYear);$("#certYear2").html("April "+(currentYear-2)+" - April "+(currentYear-1));$("#certYear3").html("April "+(currentYear-3)+" - April "+(currentYear-2));$("#certYear4").html("April "+(currentYear-4)+" - April "+(currentYear-3));$("#certYear5").html("April "+(currentYear-5)+" - April "+(currentYear-4));$("#certYear6").html("April "+(currentYear-6)+" - April "+(currentYear-5));}};LBG.gFormsClearExpiryDate={init:function(){LBG.gFormsClearExpiryDate.clearInput();},clearInput:function(){$("#radioSoleSoleHasDebitCard .inputGroup:first, #radioJointSoleHasDebitCard .inputGroup:first, #radioJointJointAccHolderHasDebitCard .inputGroup:first, #radioJointJointSecondAccHolderHasDebitCard .inputGroup:first").click(function(){$(this).parent().parent().parent().next().next().find("input").val("");$(this).parent().parent().parent().next().next().find(".concatDatePickerExpiry").val("");});}};LBG.gFormsServerTime={init:function(){LBG.gFormsServerTime.todaysDate();},todaysDate:function(){var serverTime=$(".gformsServerTimeStamp").val(),timezone_map={"BST":"GMT+0100"},todaysDate=new Date(re_order(serverTime));function re_order(str){var re=/^(\w+) (\w+) (\d\d) (\d\d:\d\d:\d\d) (\w+) (\d\d\d\d)$/;return str.replace(re,function($0,day,month,date,time,zone,year){return day+" "+month+" "+date+" "+year+" "+time+" "+(timezone_map[zone]||zone);});}return todaysDate;}};LBG.gFormsSetWorkingDay={init:function(){LBG.gFormsSetWorkingDay.nextSevenWorkingDays();},nextSevenWorkingDays:function(){var ukHolidays=["2017-05-29","2017-08-28","2017-12-25","2017-12-26","2018-01-01","2018-03-30","2018-04-02","2018-05-07","2018-05-28","2018-08-27","2018-12-25","2018-12-26","2019-01-01","2019-04-19","2019-04-22","2019-05-06","2019-05-27","2019-08-26","2019-12-25","2019-12-26","2020-01-01","2020-04-10","2020-04-13","2020-05-04","2020-05-25","2020-08-31","2020-12-25","2020-12-26"],serverTime=$(".gformsServerTimeStamp").val(),timezone_map={"BST":"GMT+0100"},todaysDate=new Date(re_order(serverTime)),d=new Date(re_order(serverTime)),currentHour=todaysDate.getHours(),newWorkingDate=null;function re_order(str){var re=/^(\w+) (\w+) (\d\d) (\d\d:\d\d:\d\d) (\w+) (\d\d\d\d)$/;return str.replace(re,function($0,day,month,date,time,zone,year){return day+" "+month+" "+date+" "+year+" "+time+" "+(timezone_map[zone]||zone);});}function getISODate(date){function z(n){return(n<10?"0":"")+n;}return date.getFullYear()+"-"+z(date.getMonth()+1)+"-"+z(date.getDate());}function add7WorkingDays(date){if(currentHour>=18){if(todaysDate.getDay()==6||todaysDate.getDay()==0){var numberOfDaysToAdd=7;}else{if(ukHolidays.indexOf(getISODate(date))!=-1){var numberOfDaysToAdd=7;}else{var numberOfDaysToAdd=7;}}}else{if(todaysDate.getDay()==6||todaysDate.getDay()==0){var numberOfDaysToAdd=7;}else{if(ukHolidays.indexOf(getISODate(date))!=-1){var numberOfDaysToAdd=7;}else{var numberOfDaysToAdd=6;}}}for(var i=numberOfDaysToAdd;i;i--){date.setDate(date.getDate()+1);while(!(date.getDay()%6)||ukHolidays.indexOf(getISODate(date))!=-1){date.setDate(date.getDate()+1);}}newWorkingDate=date;}add7WorkingDays(d);return newWorkingDate;}};LBG.criaAutoloadCheckbox={init:function(){$(".newwin.newprintwin").click(function(){$(".inputEnabledAfterPrint").removeAttr("disabled");if($(".inputEnabledAfterPrint").is(":checked")){$(".inputEnabledAfterPrint").removeAttr("checked");}});}};LBG.gformCertOfInterest={init:function(){var currentMonth=(new Date).getMonth()+1;var currentYear=(new Date).getFullYear();if(currentMonth<4){currentYear=currentYear-1;}$("#certYear1").html("April "+(currentYear-1)+" - April "+currentYear);$("#certYear2").html("April "+(currentYear-2)+" - April "+(currentYear-1));$("#certYear3").html("April "+(currentYear-3)+" - April "+(currentYear-2));$("#certYear4").html("April "+(currentYear-4)+" - April "+(currentYear-3));$("#certYear5").html("April "+(currentYear-5)+" - April "+(currentYear-4));$("#certYear6").html("April "+(currentYear-6)+" - April "+(currentYear-5));}};LBG.SortcodeTabHandeller={init:function(){LBG.SortcodeTabHandeller.TabHandeller();},TabHandeller:function(){$(".sortCode input").not(":last").keyup(function(event){var theEvent=event||window.event,key=theEvent.keyCode||theEvent.which;if(key!=46&&key!=8&&key!=9&&key!=16){if($(this).val().length==2){$(this).blur();$(this).nextAll("input")[0].focus();}}});}};LBG.GformsTitleSelection={init:function(){LBG.GformsTitleSelection.TitleUpdate();},TitleUpdate:function(){$("#slctAddCardHldrTitle").change(function(){var titleName=$("#slctAddCardHldrTitle option:selected").val();if(titleName.toLowerCase().indexOf("other")>=0){$(".otherTitleSection").removeClass("hide");}else{$(".otherTitleSection").addClass("hide");}});}};LBG.GformsEmailSmsVisibilityControl={changeDetailsStatus:false,init:function(){LBG.GformsEmailSmsVisibilityControl.VisibilityUpdate();},VisibilityUpdate:function(){$(".GformEmailSmsVisibleCtrl input").each(function(){if(($(this).val())!=""&&(LBG.GformsEmailSmsVisibilityControl.changeDetailsStatus==false)){$(this).closest(".GformEmailSmsVisibleCtrl").addClass("hide");}else{$(this).closest(".GformEmailSmsVisibleCtrl").removeClass("hide");LBG.GformsEmailSmsVisibilityControl.changeDetailsStatus=true;
}});}};LBG.GformsEmailSmsStateControl={changeDetailsStatus:false,init:function(){LBG.GformsEmailSmsStateControl.StateUpdate();},StateUpdate:function(){$(".GformEmailSmsStateCtrl input").each(function(){if($(this).attr("type")!="hidden"){if(($(this).val()!="")&&(LBG.GformsEmailSmsVisibilityControl.changeDetailsStatus==false)){$(this).attr("disabled","true");$(this).next().attr("value",$(this).val());}else{$(this).removeAttr("disabled");LBG.GformsEmailSmsVisibilityControl.changeDetailsStatus=true;$(this).change(function(){$(this).next().attr("value",$(this).val());});}}else{if(($(this).val()!="")&&(LBG.GformsEmailSmsVisibilityControl.changeDetailsStatus==false)){$(this).siblings("input").attr("value",$(this).val());$(this).siblings("input").attr("disabled","true");}else{LBG.GformsEmailSmsVisibilityControl.changeDetailsStatus=true;}}});$(".change-details .GformEmailSmsStateCtrl input[type=text]").removeAttr("disabled").change(function(){$(this).next().attr("value",$(this).val());});$(this).closest(".GformEmailSmsStateCtrl").addClass("change-details");}};LBG.GformsSmsEmailUpdates={init:function(){LBG.GformsSmsEmailUpdates.smsUpdate();LBG.GformsSmsEmailUpdates.emailUpdate();},smsUpdate:function(){if($(".cbxsms")){$(".cbxsms").change(function(){if($(".cbxsms").is(":checked")==true){$(".textBoxSms").removeClass("hide");if($(".textBoxSms").hasClass("txtSms")){if($(".txtSms input").val()!=""){$(".txtSms input").attr("disabled","disabled");}else{$(".txtSms input").attr("disabled","");}}}else{$(".textBoxSms").addClass("hide");}});if($(".cbxsms").is(":checked")==true){$(".textBoxSms").removeClass("hide");if($(".textBoxSms").hasClass("txtSms")){if($(".txtSms input").val()!=""){$(".txtSms input").attr("disabled","disabled");}else{$(".txtSms input").attr("disabled","");}}}else{$(".textBoxSms").addClass("hide");}}},emailUpdate:function(){if($(".cbxEmail")){$(".cbxEmail").change(function(){if($(".cbxEmail").is(":checked")==true){$(".textBoxEmail").removeClass("hide");if($(".textBoxEmail").hasClass("txtEmail")){if($(".txtEmail input").val()!=""){$(".txtEmail input").attr("disabled","true");}else{$(".txtEmail input").removeAttr("disabled");}}}else{$(".textBoxEmail").addClass("hide");}});if($(".cbxEmail").is(":checked")==true){$(".textBoxEmail").removeClass("hide");if($(".textBoxEmail").hasClass("txtEmail")){if($(".txtEmail input").val()!=""){$(".txtEmail input").attr("disabled","true");}else{$(".txtEmail input").removeAttr("disabled");}}}else{$(".textBoxEmail").addClass("hide");}}}};LBG.gFormsDeselectOthers={init:function(){LBG.gFormsDeselectOthers.gFormsDeselectIfAOBselected();},gFormsDeselectIfAOBselected:function(){$(".allOfTheAboveSelected:checkbox").change(function(){if(this.checked){$(".notAllOfTheAbove").attr("checked",false);$(".notAllOfTheAbove").attr("disabled",true);LBG.gFormsDeselectOthers.gFormsClearAllSelectedValues();}else{$(".notAllOfTheAbove").removeAttr("disabled");var el=$(document).find(".subTypesOfallOfTheAboves");LBG.gFormsDeselectOthers.gFormsClearDataOnDeselction(el);}});$(".notAllOfTheAbove:checkbox").change(function(){if(this.checked){}else{if($(this).hasClass(".cbxShow-subTypesOfcreditCards")){var el=$(document).find(".subTypesOfcreditCards");LBG.gFormsDeselectOthers.gFormsClearDataOnDeselction(el);}if($(this).hasClass(".cbxShow-subTypesOfLoans")){var el=$(document).find(".subTypesOfLoans");LBG.gFormsDeselectOthers.gFormsClearDataOnDeselction(el);}if($(this).hasClass(".cbxShow-subTypesOfmortgages")){var el=$(document).find(".subTypesOfmortgages");LBG.gFormsDeselectOthers.gFormsClearDataOnDeselction(el);}if($(this).hasClass(".cbxShow-subTypesOfbankAccounts")){var el=$(document).find(".subTypesOfbankAccounts");LBG.gFormsDeselectOthers.gFormsClearDataOnDeselction(el);}if($(this).hasClass(".clearSelectedCbxSection")){var el=$(document).find(".clearSelectedCbxSubSection");LBG.gFormsDeselectOthers.gFormsClearDataOnDeselction(el);}}});$(".allOfTheDataSelected:checkbox").change(function(){if(this.checked){var el=$(this);LBG.gFormsDeselectOthers.gFormsClearAllDataSelectedValues(el);}else{$(".notAllOfData").removeAttr("disabled");$(".subTypesOfallOfTheAboves input").val("");$(".subTypesOfallOfTheAboves textarea").val("");$(".subTypesOfallOfTheAboves input[type=radio]").attr("checked",false);$(".subTypesOfallOfTheAboves input[type=checkbox]").attr("checked",false);$(".subTypesOfallOfTheAboves select").get(0).selectedIndex=0;$(".subTypesOfallOfTheAboves datePicker").val("");}});},gFormsClearDataOnDeselction:function(el){el.find("input").not("input[type=submit]").val("");el.find("textarea").val("");el.find("input[type=radio]").attr("checked",false);el.find("input[type=checkbox]").attr("checked",false);el.find("select").get(0).selectedIndex=0;el.find("datePicker").val("");el.find("div").removeAttr("style");},gFormsClearAllSelectedValues:function(){$(".clearIfAllOfTheAbove").each(function(){$(".clearIfAllOfTheAbove input").not("input[type=submit]").val("");$(".clearIfAllOfTheAbove textarea").val("");$(".clearIfAllOfTheAbove input[type=radio]").attr("checked",false);$(".clearIfAllOfTheAbove input[type=checkbox]").attr("checked",false);$(".clearCalendarIfAOB select").get(0).selectedIndex=0;$(".clearCalendarIfAOB datePicker").val("");$(".clearIfAllOfTheAbove div").removeAttr("style");});},gFormsClearAllDataSelectedValues:function(el){var target=el;var siblings=target.parent().parent().parent().children();siblings.find("input").not(".allOfTheDataSelected").val("");siblings.find("textarea").not(".allOfTheDataSelected").val("");siblings.find("input[type=radio]").not(".allOfTheDataSelected").attr("checked",false);siblings.find("input[type=checkbox]").not(".allOfTheDataSelected").attr("checked",false);siblings.find("input[type=checkbox]").not(".allOfTheDataSelected").attr("disabled",true);siblings.parent().parent().parent().next().find("input").val("");siblings.parent().parent().parent().next().find("textarea").val("");siblings.parent().parent().parent().next().children().removeAttr("style");}};LBG.gFormsPopulatePostCodeDetails={init:function(){LBG.gFormsPopulatePostCodeDetails.displayPostCodeSelectedAddress();},displayPostCodeSelectedAddress:function(){var addr_1=$("#Addr_1").val();var addr_2=$("#Addr_2").val();var town=$("#Town").val();var postcode=$("#Post_Code").val();var county=$("#County").val();var html="";var manualAddr_1=$("#txtBusinessAddress1").val();var manualAddr_2=$("#txtBusinessAddress2").val();var manualTown=$("#txtBusinessAddress3").val();var manualCounty=$("#txtManualAddressPostcode0").val();var manualPostcode=$("#txtBusinessAddress4").val();var addressPanel=$(".selectedAddress").find("div.adr");html+='<div class="street-address">';if(!LBG.common.isNull(manualAddr_1)){$(".manualAddress").removeClass("hideAddressPanel");$(".addressFinder").find(".selectedAddress,.findAddress,.selectAddress").each(function(){$(this).addClass("hideAddressPanel");});}else{if(!LBG.common.isNull(addr_1)){html+='<span class="buildingname">'+addr_1+"</span>";$(".addressFinder ").find(".selectAddress,.findAddress").each(function(){$(this).addClass("hideAddressPanel");});$(".selectedAddress").removeClass("hideAddressPanel");$("#txtBusinessAddress1").val("");$("#txtBusinessAddress2").val("");$("#txtBusinessAddress3").val("");$("#txtManualAddressPostcode0").val("");$("#txtBusinessAddress4").val("");$("#Addr_1").val();$("#Addr_2").val();$("#Town").val();$("#Post_Code").val();$("#County").val();}if(!LBG.common.isNull(addr_2)){html+='<span class="buildingnumber">'+addr_2+"</span>";}html+=!LBG.common.isNull(town)?'<span class="town">'+town+"</span>":"";
html+=!LBG.common.isNull(county)?'<span class="county">'+county+"</span>":"";html+=!LBG.common.isNull(postcode)?'<span class="postcode">'+postcode+"</span>":"";addressPanel.html(html);}}};LBG.gFormsDisplayFixedOr32gbp={init:function(){LBG.gFormsDisplayFixedOr32gbp.displaySelectedSection();LBG.gFormsDisplayFixedOr32gbp.updatePrevPlaced();},displaySelectedSection:function(){if($("#hdnTotalAmount").val()!=""){var amount=$("#hdnTotalAmount").val();$(".totalAmount").text(amount);}if($("#isFixedOr32gbp").val()=="isFixed"){$(".fixedDepositSection").show();$(".32GbpDepositSection").hide();$("#fixedTermDepositDiv").show();$("#32GBPDepositDiv").hide();}else{if($("#isFixedOr32gbp").val()=="is32Gbp"){$(".32GbpDepositSection").show();$(".fixedDepositSection").hide();$("#fixedTermDepositDiv").hide();$("#32GBPDepositDiv").show();}else{$("#fixedTermDepositDiv").hide();$("#32GBPDepositDiv").hide();}}$(".selectedTerm").html($("#hdnTermLength").val());var interest=$("#hdnInterestRate").val();$(".selectedAER").html(interest+" %");$(".selectedGross").html(interest+" %");var amount=$("#initialDepositAmt").val();amount=LBG.gFormsDisplayFixedOr32gbp.formatCurrency(amount);$(".initialAmount").html("&#163;"+amount);var finalAmount=$("#hdnTotalAmount").val();$(".finalDepositAmt").html("&#163;"+finalAmount);},formatCurrency:function(amountValue){if(amountValue!=undefined){return amountValue.replace(/./g,function(digit,i,amount){return i>0&digit!="."&(amount.length-i)%3===0?","+digit:digit;});}},updatePrevPlaced:function(){$(".gformContentWrapper #previousAccount input[name='previousAccount']").change(function(){var prevPlaced=$("#previousAccount").find(":radio:checked").val();$("#hdnPrevPlaced").val(prevPlaced);});}};LBG.gFormsSmoothScroll={init:function(){LBG.gFormsSmoothScroll.scrollLink();LBG.gFormsSmoothScroll.updateHiddenFields();},scrollLink:function(){$(".scrollLink").click(function(){$("html, body").animate({scrollTop:$("#"+$(this).attr("scrollDiv")).offset().top},500);if($(this).attr("scrollDiv")=="fixedTermDepositDiv"){$("#isFixedOr32gbp").val("isFixed");$("#hdnAppType").val("FTD");}else{$("#isFixedOr32gbp").val("is32Gbp");$("#hdnAppType").val("32FTD");}});},updateHiddenFields:function(){$(".gformContentWrapper .maturityTerm input[name='radio1']").change(function(){var selectedTerm=$(".maturityTerm").find("input[name=radio1]:checked").parent();var term=selectedTerm.find("span .depositTerm").html();var interest=selectedTerm.find("span .depositInterest").html();$(".gformContentWrapper #hdnTermLength").val(term+" Months");$(".gformContentWrapper #hdnInterestRate").val(interest);});}};LBG.gFormsCalendarDays={init:function(){LBG.gFormsCalendarDays.setupCalendar();},setupCalendar:function(){$(".gfCustomTermDepositCalendar").find("#fixedstartDateSelector").datepicker("option",{dateFormat:"dd/mm/yy",minDate:"+3D",maxDate:"+1M +1D"});$(".gfCustomTermDepositCalendar").find("#fixedmaturityDateSelector").datepicker("option",{dateFormat:"dd/mm/yy",minDate:"+1M +2D",maxDate:"+2Y +3D"});$(".gfCustomAppointmentCalendar").find("#appointmentDate").datepicker("option",{dateFormat:"dd/mm/yy"});}};LBG.gformsCalculateFixedTermDeposit={init:function(){LBG.gformsCalculateFixedTermDeposit.calculateFixedDeposit();if($(document).find("#F12SubmissionError").length>0){var customInterestDaysRange=JSON.parse("["+$("#customInterestDaysRangeHdn").val()+"]");var customInterestRange=JSON.parse("["+$("#customInterestRangeHdn").val()+"]");if(customInterestDaysRange!=undefined&&customInterestRange!=undefined&&customInterestDaysRange.length!=customInterestRange.length){$("#F12SubmissionError").html("<div class='formSubmitError' role='alert'>Error while fetching interest rate. Please ensure that the interest rate is published in the correct format.</div>");}}},calculateFixedDeposit:function(){$(".maturityTerm input[name='radio1']").change(function(){$(".maturityInfo").hide();if($(".maturityTerm").find("input[name=radio1]:checked").hasClass("customTerm")){LBG.gformsCalculateFixedTermDeposit.resetCustomDate();}LBG.gformsCalculateFixedTermDeposit.fixedDepositMaturedAmountCalculation();});$(".isFixedTermDeposit input[name='txtSavingsAmount']").change(function(){LBG.gformsCalculateFixedTermDeposit.fixedDepositMaturedAmountCalculation();});$("select.customTermDateSelector").blur(function(){var customTermDatePattern=/^((\d){2}\/(\d){2}\/(\d){4})$/;LBG.gformsCalculateFixedTermDeposit.onManualStartDateSelection();var startDate=$("#fixedstartDateSelector").val();var endDate=$("#fixedmaturityDateSelector").val();if(customTermDatePattern.test(startDate)&&customTermDatePattern.test(endDate)&&!$(".gfCustomTermDepositCalendar").hasClass("error")){LBG.gformsCalculateFixedTermDeposit.fixedDepositMaturedAmountCalculation();var interestRateValue=$(".gformContentWrapper #hdnInterestRate").val();var termLengthValue=$(".gformContentWrapper #hdnTermLength").val();if(interestRateValue!=""){$(".gformContentWrapper .interestRateInfo").html(interestRateValue);$(".gformContentWrapper .termLengthInfo").html(termLengthValue);$(".maturityInfo").show();}}else{$(".isFixedTermDeposit").find("span.totalAmount").text("0.00");}});},formatCurrency:function(amountValue){if(amountValue!=undefined){return amountValue.replace(/./g,function(digit,i,amount){return i>0&digit!="."&(amount.length-i)%3===0?","+digit:digit;});}},fixedDepositMaturedAmountCalculation:function(){var selectedTerm=$(".maturityTerm").find("input[name=radio1]:checked").parent();var interest=selectedTerm.find("span.depositInterest").html();var deposit=$("#txtSavingsAmount").val();$(".gformContentWrapper #initialDepositAmt").val(deposit);if($(".maturityTerm").find("input[name=radio1]:checked").hasClass("regularTerm")){var term=selectedTerm.find("span.depositTerm").html();if(deposit!=null&&deposit!=undefined&&deposit!=""){LBG.gformsCalculateFixedTermDeposit.calculateRegularTermFinalAmount(deposit,term,interest);}else{$(".isFixedTermDeposit").find("span.totalAmount").text("0.00");}}else{if($(".maturityTerm").find("input[name=radio1]:checked").hasClass("spacialTerm")){var startDate=$("#interestEndDate").val();var endDate=selectedTerm.find("span.GFormsTokenContent").html();if(startDate!=""&&startDate!=undefined&&startDate!=null&&endDate!=""&&endDate!=undefined&&endDate!=null&&deposit!=""&&deposit!=undefined&&deposit!=null){LBG.gformsCalculateFixedTermDeposit.calculateSpecialTermFinalAmount(deposit,startDate,endDate,interest);}else{$(".isFixedTermDeposit").find("span.totalAmount").text("0.00");}}else{if($(".maturityTerm").find("input[name=radio1]:checked").hasClass("customTerm")){LBG.gformsCalculateFixedTermDeposit.callingCalculateCustomTermFinalAmount();}}}},resetCustomDate:function(){$(".gfCustomTermDepositCalendar #startDateDay").get(0).selectedIndex=0;$(".gfCustomTermDepositCalendar #startDateMonth").get(0).selectedIndex=0;$(".gfCustomTermDepositCalendar #startDateYear").get(0).selectedIndex=0;$(".gfCustomTermDepositCalendar #maturityDateDay").get(0).selectedIndex=0;$(".gfCustomTermDepositCalendar #maturityDateMonth").get(0).selectedIndex=0;$(".gfCustomTermDepositCalendar #maturityDateYear").get(0).selectedIndex=0;$(".gfCustomTermDepositCalendar datePicker").val("");$(".isFixedTermDeposit").find("span.totalAmount").text("0.00");},callingCalculateCustomTermFinalAmount:function(){var startDate=$("#fixedstartDateSelector").val();var endDate=$("#fixedmaturityDateSelector").val();var deposit=$("#txtSavingsAmount").val();if(startDate!=""&&startDate!=undefined&&startDate!=null&&endDate!=""&&endDate!=undefined&&endDate!=null&&deposit!=""&&deposit!=undefined&&deposit!=null){LBG.gformsCalculateFixedTermDeposit.calculateCustomTermFinalAmount(deposit,startDate,endDate);
}else{$(".isFixedTermDeposit").find("span.totalAmount").text("0.00");}},onManualStartDateSelection:function(){var $dateYear=$(".formField .date.inputGroup.fixedstartdate .slctYear");var $dateMonth=$(".formField .date.inputGroup.fixedstartdate .slctMonth");var $dateDay=$(".formField .date.inputGroup.fixedstartdate .slctDay");var $enddateYear=$(".formField .date.inputGroup.fixedMaturitydate .slctYear");var $enddateMonth=$(".formField .date.inputGroup.fixedMaturitydate .slctMonth");var $enddateDay=$(".formField .date.inputGroup.fixedMaturitydate .slctDay");var concatenateStartDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);var concatenatedEndDate=$enddateDay.val()+"/"+$enddateMonth.val()+"/"+$enddateYear.val().substr(0,4);$("#fixedstartDateSelector").val(concatenateStartDate);$("#fixedmaturityDateSelector").val(concatenatedEndDate);$(".isFixedTermDeposit").find("span.totalAmount").text("0.00");},calculateRegularTermFinalAmount:function(deposit,term,interest){var term=Math.round((term*365)/12);var interest=interest/100;var interestAmount=parseFloat((term*interest*deposit)/365);var finalAmount=parseFloat(interestAmount)+parseFloat(deposit);finalAmount=finalAmount.toFixed(2);finalAmount=LBG.gformsCalculateFixedTermDeposit.formatCurrency(finalAmount);$(".isFixedTermDeposit").find("span.totalAmount").text(finalAmount);$(".gformContentWrapper #hdnTotalAmount").val(finalAmount);},calculateSpecialTermFinalAmount:function(deposit,startDate,endDate,interest){var noOfDays=LBG.gformsCalculateFixedTermDeposit.calculateDaysCount(startDate,endDate);interest=interest/100;var interestAmount=parseFloat((noOfDays*interest*deposit)/365);var finalAmount=parseFloat(interestAmount)+parseFloat(deposit);finalAmount=finalAmount.toFixed(2);finalAmount=LBG.gformsCalculateFixedTermDeposit.formatCurrency(finalAmount);$(".isFixedTermDeposit").find("span.totalAmount").text(finalAmount);$(".gformContentWrapper #hdnTermLength").val(Math.floor(noOfDays)+" Days");$(".gformContentWrapper #hdnTotalAmount").val(finalAmount);},calculateCustomTermFinalAmount:function(deposit,startDate,endDate){var noOfDays=LBG.gformsCalculateFixedTermDeposit.calculateDaysCount(startDate,endDate);var interpolatedRate=LBG.gformsCalculateFixedTermDeposit.interpolatedRateCalculation(noOfDays);var interest=interpolatedRate/100;var term=noOfDays/365;var interestAmount=parseFloat(term*interest*deposit);var finalAmount=parseFloat(interestAmount)+parseFloat(deposit);finalAmount=finalAmount.toFixed(2);finalAmount=LBG.gformsCalculateFixedTermDeposit.formatCurrency(finalAmount);$(".isFixedTermDeposit").find("span.totalAmount").text(finalAmount);$(".gformContentWrapper #hdnTotalAmount").val(finalAmount);var customInterest=interpolatedRate.toFixed(2);$(".gformContentWrapper #hdnInterestRate").val(customInterest);var customDays=Math.round(noOfDays);$(".gformContentWrapper #hdnTermLength").val(customDays+" Days");},calculateDaysCount:function(startDateStr,endDateStr){var startDateArray=startDateStr.split("/");var endDateArray=endDateStr.split("/");var startDate=new Date(startDateArray[2],startDateArray[1]-1,startDateArray[0]);var endDate=new Date(endDateArray[2],endDateArray[1]-1,endDateArray[0]);if(startDate<endDate){var startTime=startDate.getTime();var endTime=endDate.getTime();var diffTime=endTime-startTime;var numberOfDays=diffTime/(24*60*60*1000);return numberOfDays;}else{return 0;}},interpolatedRateCalculation:function(noOfDays){var customInterestDaysRange=JSON.parse("["+$("#customInterestDaysRangeHdn").val()+"]");var customInterestRange=JSON.parse("["+$("#customInterestRangeHdn").val()+"]");var minDay=null;var maxDay=null;var minInterestRate=null;var maxInterestRate=null;for(var i=0;i<customInterestDaysRange.length;i++){if(customInterestDaysRange[i]>(noOfDays*1)){minDay=customInterestDaysRange[i-1];maxDay=customInterestDaysRange[i];minInterestRate=customInterestRange[i-1];maxInterestRate=customInterestRange[i];break;}}if(minDay==null&&i==customInterestDaysRange.length){minDay=customInterestDaysRange[0];maxDay=customInterestDaysRange[customInterestDaysRange.length-1];minInterestRate=customInterestRange[0];maxInterestRate=customInterestRange[customInterestDaysRange.length-1];}var interpolatedRate=((maxInterestRate-minInterestRate)/(maxDay-minDay))*(noOfDays-minDay)+minInterestRate;return interpolatedRate;}};LBG.gforms32DayGPBCalculateReturn={init:function(){LBG.gforms32DayGPBCalculateReturn.calculateReturn();},formatCurrency:function(amountValue){if(amountValue!=undefined){return amountValue.replace(/./g,function(digit,i,amount){return i>0&digit!="."&(amount.length-i)%3===0?","+digit:digit;});}},calculateReturn:function(){$("#32gbInputField").keypress(function(e){if(e.keyCode===13){LBG.gforms32DayGPBCalculateReturn.calculate32DaysInterest(e);}});$("#32gbInputField").change(function(e){LBG.gforms32DayGPBCalculateReturn.calculate32DaysInterest(e);});$("#32gbInputField").blur(function(e){LBG.gforms32DayGPBCalculateReturn.calculate32DaysInterest(e);});},calculate32DaysInterest:function(e){var savingAmount=$("#txt32SavingsAmount").val();$(".gformContentWrapper #initialDepositAmt").val(savingAmount);var minDepositAmount=$("#minDeposit").val();var maxDepositAmount=$("#maxDeposit").val();if(savingAmount>=(minDepositAmount*1)&&savingAmount<=(maxDepositAmount*1)){var GBPDays=$("#yearDay").val();var GBPInterestVariable=$(".isTermD32GbpDeposit").find("span.32DGBPInterestVariable").html();var GBPInterestFixed=$(".isTermD32GbpDeposit").find("span.32DGBPInterestFixed").html();var calc1=((((GBPInterestVariable*1)+(GBPInterestFixed*1))/100)/(GBPDays*1));var calc2=calc1+1;var calc3=savingAmount*Math.pow(calc2,(GBPDays*1));var returnAmount=calc3.toFixed(2);returnAmount=LBG.gforms32DayGPBCalculateReturn.formatCurrency(returnAmount);$(".gformContentWrapper #hdnTotalAmount").val(returnAmount);var hiddenInterestRate=parseFloat(GBPInterestVariable)+parseFloat(GBPInterestFixed);$(".gformContentWrapper #hdnInterestRate").val(hiddenInterestRate.toFixed(2));$(".gformContentWrapper #hdnTermLength").val("0");$(".isTermD32GbpDeposit").find("span.totalAmount").text(returnAmount);}else{$(".isTermD32GbpDeposit").find("span.totalAmount").text("0.00");}}};LBG.gFormsOnlyNumeric={init:function(){LBG.gFormsOnlyNumeric.onlyNumericEntry();},onlyNumericEntry:function(){if($(".formField").hasClass("onlyNumeric")){$(".onlyNumeric").live("keypress",function(evt){if((evt.which<48||evt.which>57)&&evt.which!=8&&evt.keyCode!=37&&evt.keyCode!=38&&evt.keyCode!=39&&evt.keyCode!=40&&evt.keyCode!=46&&evt.keyCode!=9){evt.preventDefault();}});}}};LBG.gFormsCheckInitiateAppAttr={init:function(){LBG.gFormsCheckInitiateAppAttr.callAccountNumberValidationAPI();},callAccountNumberValidationAPI:function(){if($(".gformContentWrapper").attr("attr-initiateApp")=="true"){LBG.gFormsCheckInitiateAppAttr.validateAccountNumberAPI();}},validateAccountNumberAPI:function(){$.ajax({type:"GET",dataType:"json",url:"/gforms-common-api/v1/initiateApp",success:function(data){}});}};LBG.gFormssortcodeAccountNumberValidation={init:function(){var arr=[];var SortCode="";var prevSortCode;var returnedData;$(".sortCode").each(function(){var sortcodeContainer=$(this);var accountNumInput=sortcodeContainer.nextAll(".formField").eq(0).find(".txtFindAccNum");arr[0]=sortcodeContainer.find("input").eq(0).val();arr[1]=sortcodeContainer.find("input").eq(1).val();arr[2]=sortcodeContainer.find("input").eq(2).val();if((arr[0]&&arr[1]&&arr[2]!=="")&&((arr[0]).length==2&&(arr[1]).length==2&&(arr[2]).length==2)){if(arr[0].match(/^\d+$/)&&arr[1].match(/^\d+$/)&&arr[2].match(/^\d+$/)){SortCode=arr[0]+arr[1]+arr[2];
$(".sortCodeGroup").val(arr[0]+"-"+arr[1]+"-"+arr[2]);}}$("input",this).blur(function(){arr[0]=sortcodeContainer.find("input").eq(0).val();arr[1]=sortcodeContainer.find("input").eq(1).val();arr[2]=sortcodeContainer.find("input").eq(2).val();if((arr[0]&&arr[1]&&arr[2]!=="")&&((arr[0]).length==2&&(arr[1]).length==2&&(arr[2]).length==2)){if(arr[0].match(/^\d+$/)&&arr[1].match(/^\d+$/)&&arr[2].match(/^\d+$/)){SortCode=arr[0]+arr[1]+arr[2];$(".sortCodeGroup").val(arr[0]+"-"+arr[1]+"-"+arr[2]);}}});accountNumInput.change(function(){if($(this).val()!=""&&$(this).val()!=undefined&&$(this).val().length=="8"&&SortCode!=""&&SortCode!=undefined&&SortCode.length=="6"&&$(this).val().match(/^\d+$/)){LBG.gFormssortcodeAccountNumberValidation.getPostCodeAccountnumberServiceCall(SortCode,sortcodeContainer,accountNumInput);}});accountNumInput.trigger("change");sortcodeContainer.find("input").blur(function(){sortcodeContainer.find("input").each(function(i){arr[i]=$(this).val();if((arr[0]&&arr[1]&&arr[2]!=="")&&((arr[0]).length==2&&(arr[1]).length==2&&(arr[2]).length==2)){if(arr[0].match(/^\d+$/)&&arr[1].match(/^\d+$/)&&arr[2].match(/^\d+$/)){SortCode=arr[0]+arr[1]+arr[2];if(SortCode!==prevSortCode){prevSortCode=arr[0]+arr[1]+arr[2];if(accountNumInput.val()!=""&&accountNumInput.val()!=undefined&&accountNumInput.val().length=="8"&&accountNumInput.val().match(/^\d+$/)){$(".sortCodeGroup").val(arr[0]+"-"+arr[1]+"-"+arr[2]);LBG.gFormssortcodeAccountNumberValidation.getPostCodeAccountnumberServiceCall(SortCode,sortcodeContainer,accountNumInput);}}}}});});});},getPostCodeAccountnumberServiceCall:function(SortCode,sortCodeContainer,accountNumInput){var sortCode,accountNumber,brand,scope;sortCode=SortCode;accountNumber=accountNumInput.val();scope=sortCodeContainer.attr("data-scope");var sortCodeError=sortCodeContainer.find(".accNumbeSortCodeError"),sortCodeErrorMessage=sortCodeContainer.find(".accNumbeSortCodeErrorMsg"),accNumberError=accountNumInput.nextAll(".accNumbeSortCodeError").eq(0),accNumberErrorMessage=accountNumInput.nextAll(".accNumbeSortCodeErrorMsg").eq(0);var getSortcodeAccountnumberUrl=DI.lang.gformsSortCodeAccountNumber.url;var data={"sortCode":sortCode,"accountNumber":accountNumber,"validate":"true","scope":scope};$.ajax({url:getSortcodeAccountnumberUrl,dataType:"json",type:"post",accept:"application/JSON",contentType:"application/json; charset=UTF-8",data:JSON.stringify(data),cache:false,success:function(response){if(response){if($(".accNumbeSortCodeFormError").hasClass("formSubmitError")){$(".accNumbeSortCodeFormError").remove();sortCodeContainer.removeClass("error");accountNumInput.closest(".formField").removeClass("error");}if(sortCodeContainer.find(".formFieldInner span").hasClass("accNumbeSortCodeError")||accountNumInput.next("span").hasClass("accNumbeSortCodeError")){sortCodeContainer.removeClass("error invalid");accountNumInput.closest(".formField").removeClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").remove();accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).remove();accountNumInput.parents(".formFieldInner").next(".accNumbeSortCodeError").remove();sortCodeContainer.find(".error").remove();}}},error:function(jqXHR){var errMsg="";if($(".accNumbeSortCodeFormError").hasClass("formSubmitError")){$(".accNumbeSortCodeFormError").removeClass("formSubmitError");}if(jqXHR.responseText!==""){errMsg=JSON.parse(jqXHR.responseText);}if($.browser.msie===true&&jqXHR.status===1223){if($(".accNumbeSortCodeFormError").hasClass("formSubmitError")){$(".accNumbeSortCodeFormError").remove();sortCodeContainer.removeClass("error");accountNumInput.closest(".formField").removeClass("error");}sortCodeContainer.removeClass("error invalid");accountNumInput.closest(".formField").removeClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").remove();accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).remove();accountNumInput.parents(".formFieldInner").next(".accNumbeSortCodeError").remove();}switch(jqXHR.status){case 204:if($(".accNumbeSortCodeFormError").hasClass("formSubmitError")){$(".accNumbeSortCodeFormError").remove();sortCodeContainer.removeClass("error");accountNumInput.closest(".formField").removeClass("error");}sortCodeContainer.removeClass("error invalid");accountNumInput.closest(".formField").removeClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").remove();accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).remove();accountNumInput.parents(".formFieldInner").next(".accNumbeSortCodeError").remove();sortCodeContainer.find(".error").remove();break;case 400:if(errMsg.error.message!==""){sortCodeContainer.find(".accNumbeSortCodeError").remove();accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).remove();sortCodeContainer.find(".error").remove();sortCodeContainer.find(".formFieldInner").append('<span class="accNumbeSortCodeError error"/>');accountNumInput.parent(".formFieldInner").append('<span class="accNumbeSortCodeError error"/>');sortCodeContainer.addClass("error invalid");accountNumInput.closest(".formField").addClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").text(errMsg.error.message);accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).text(errMsg.error.message);sortCodeContainer.find(".accNumbeSortCodeErrorMsg").text(errMsg.error.message);accountNumInput.nextAll(".accNumbeSortCodeErrorMsg").eq(0).text(errMsg.error.message);accountNumInput.parents(".formFieldInner").next(".accNumbeSortCodeError").text(errMsg.error.message);}else{sortCodeContainer.addClass("error invalid");accountNumInput.closest(".formField").addClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").addClass("hide");accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).addClass("hide");}break;case 404:$(".accNumbeSortCodeFormError").remove();$(".gformContentWrapper").before('<div class="accNumbeSortCodeFormError formSubmitError"></div>');sortCodeContainer.find(".accNumbeSortCodeError").remove();accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).remove();sortCodeContainer.find(".error").remove();sortCodeContainer.addClass("error invalid");accountNumInput.closest(".formField").addClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).text(DI.lang.gformsSortCodeAccountNumber.errorText);sortCodeContainer.find(".accNumbeSortCodeErrorMsg").text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.nextAll(".accNumbeSortCodeErrorMsg").eq(0).text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.parents(".formFieldInner").next(".accNumbeSortCodeError").text(DI.lang.gformsSortCodeAccountNumber.errorText);$(".accNumbeSortCodeFormError").text(DI.lang.gformsSortCodeAccountNumber.errorText);break;case 500:$(".accNumbeSortCodeFormError").remove();$(".gformContentWrapper").before('<div class="accNumbeSortCodeFormError formSubmitError"></div>');sortCodeContainer.find(".accNumbeSortCodeError").remove();accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).remove();sortCodeContainer.addClass("error invalid");accountNumInput.closest(".formField").addClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.parents(".formFieldInner").next(".accNumbeSortCodeError").text(DI.lang.gformsSortCodeAccountNumber.errorText);
$(".accNumbeSortCodeFormError").text(DI.lang.gformsSortCodeAccountNumber.errorText);break;default:if($.browser.msie===true&&jqXHR.status===1223){break;}$(".accNumbeSortCodeFormError").remove();$(".gformContentWrapper").before('<div class="accNumbeSortCodeFormError formSubmitError"></div>');sortCodeContainer.find(".accNumbeSortCodeError").remove();accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).remove();sortCodeContainer.addClass("error invalid");accountNumInput.closest(".formField").addClass("error invalid");sortCodeContainer.find(".accNumbeSortCodeError").text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.nextAll(".accNumbeSortCodeError").eq(0).text(DI.lang.gformsSortCodeAccountNumber.errorText);sortCodeContainer.find(".accNumbeSortCodeErrorMsg").text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.nextAll(".accNumbeSortCodeErrorMsg").eq(0).text(DI.lang.gformsSortCodeAccountNumber.errorText);accountNumInput.parents(".formFieldInner").next(".accNumbeSortCodeError").text(DI.lang.gformsSortCodeAccountNumber.errorText);$(".accNumbeSortCodeFormError").text(DI.lang.gformsSortCodeAccountNumber.errorText);}}});}};LBG.gFormsGetTotalMonths={init:function(){var $years=$(".calcTermYear input.field"),$months=$(".calcTermMonth input.field"),$totalMonths=$(".hdnTermCalc"),monthTotal=0;if(($years.length>0)&&($months.length>0)&&($totalMonths.length>0)){$(".calcTermYear input.field, .calcTermMonth input.field").change(function(){monthTotal=(LBG.gFormsGetTotalMonths.get_integer($years.val())*12)+LBG.gFormsGetTotalMonths.get_integer($months.val());$totalMonths.val(monthTotal);});}},get_integer:function(p){p=parseInt(p);if(LBG.gFormsGetTotalMonths.is_integer(p)){return p;}else{return 0;}},is_integer:function(param){return parseInt(param)===param;}};LBG.gformsBusinessAddressControl={init:function(){if($(".gformsBusinessAddressControl").length){$(".gformBusAddManualFld").change(function(){LBG.gformsBusinessAddressControl.updateHiddenFields();});}},updateHiddenFields:function(){$("#Addr_1").val($("#txtBusinessAddress1").val());$("#Addr_2").val($("#txtBusinessAddress2").val());$("#Town").val($("#txtBusinessAddress3").val());$("#Post_Code").val($("#txtManualAddressPostcode0").val());$("#County").val($("#txtBusinessAddress4").val());},selectedBusinessAddressUsingFinder:function(data){var addr_1="",addr_2="",town="",post_code="",county="";if($(".gformsBusinessAddressControl").length){if(data.numberOrName){addr_1=addr_1+" "+data.numberOrName;}if(data.organisationName){addr_1=addr_1+" "+data.organisationName;}if(data.subBuildingName){addr_1=addr_1+" "+data.subBuildingName;}if(data.buildingName){addr_1=addr_1+" "+data.buildingName;}if(data.buildingNumber){addr_2=addr_2+" "+data.buildingNumber;}if(data.addressLines){for(var i=0;i<data.addressLines.length;i++){addr_2=addr_2+" "+data.addressLines[i];}}if(data.streetName){addr_2=addr_2+" "+data.streetName;}if(data.district){addr_2=addr_2+" "+data.district;}if(data.town){town=town+" "+data.town;}if(data.townOrCity){town=town+" "+data.townOrCity;}if(data.postcode){$(".gformsBusinessAddressControl #Post_Code").val(data.postcode);}if(data.county){$(".gformsBusinessAddressControl #County").val(data.county);}$(".gformsBusinessAddressControl #Addr_1").val(addr_1.trim());$(".gformsBusinessAddressControl #Addr_2").val(addr_2.trim());$(".gformsBusinessAddressControl #Town").val(town.trim());}}};LBG.gFormsGetBusinessDate={init:function(){var $dateYear=$(".formField .date.inputGroup .slctYear"),$dateMonth=$(".formField .date.inputGroup .slctMonth"),$dateDay=$(".formField .date.inputGroup .slctDay"),$dateBusiness=$(".formField .date.inputGroup .concatDate"),concatDate="";if(($dateYear.length>0)&&($dateMonth.length>0)){concatDate="01/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$dateBusiness.val(concatDate);$(".formField .date.inputGroup .slctYear, .formField .date.inputGroup .slctMonth").change(function(){concatDate="01/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$dateBusiness.val(concatDate);});}}};LBG.gFormsConcatDate={init:function(){$(".gformsDatePickerContainer").each(function(){var $dateYear=$(this).find(".slctYear"),$dateMonth=$(this).find(".slctMonth"),$dateDay=$(this).find(".slctDay"),$datePicker=$(this).find(".concatDatePicker"),concatDate="";if(!$dateYear.hasClass("postit")&&!$dateMonth.hasClass("postit")&&!$dateDay.hasClass("postit")){concatDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$datePicker.val(concatDate);$dateYear.change(function(){concatDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$datePicker.val(concatDate);});$dateMonth.change(function(){concatDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$datePicker.val(concatDate);});$dateDay.change(function(){concatDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$datePicker.val(concatDate);});}else{if(!$dateYear.hasClass("postit")&&!$dateMonth.hasClass("postit")){concatDate=$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$datePicker.val(concatDate);$dateYear.change(function(){concatDate=$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$datePicker.val(concatDate);});$dateMonth.change(function(){concatDate=$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$datePicker.val(concatDate);});}}});}};LBG.gFormsCalculateMonthlyPersonalNet={init:function(){var $monthlyAdd=$(".gformContentWrapper .formFieldRow .monthlyAdd"),$monthlyLess=$(".gformContentWrapper .formFieldRow .monthlyLess"),$totalFld=$(".gformContentWrapper .hdnPersonalMonthlyNet"),$totalLbl=$(".gformContentWrapper p span.amount strong"),fig=0,adds=0,minuses=0,total=0;$totalFld.val(total);$totalLbl.empty().text(total);if(($monthlyAdd.length>0)&&($monthlyLess.length>0)){$(".gformContentWrapper .formFieldRow .monthlyAdd, .gformContentWrapper .formFieldRow .monthlyLess").blur(function(){adds=0;minuses=0;$monthlyAdd.each(function(){fig=parseInt($(this).val())||0;adds=adds+fig;});$monthlyLess.each(function(){fig=parseInt($(this).val())||0;minuses=minuses+fig;});total=adds-minuses;$totalFld.val(total);$totalLbl.empty().text(total);});}}};LBG.showWithCheckBox={init:function(){var showClass;if($(".showWithCheckBox").length>0&&$("#hdnBrand").val()!="HALIFAX"){$(".showWithCheckBox:checkbox").change(function(){atLeastOneCbxChecked=false;showClass=LBG.showWithCheckBox.getShowHideClass($(this));$(".cbxShow-"+showClass.replace(".","")).each(function(){if($(this).is(":checked")){atLeastOneCbxChecked=true;}});if(atLeastOneCbxChecked){$(showClass).show();}else{$(showClass).hide();}});$("input:checkbox:checked").each(function(){atLeastOneCbxChecked=false;showClass=LBG.showWithCheckBox.getShowHideClass($(this));if(showClass){$(".cbxShow-"+showClass.replace(".","")).each(function(){if($(this).is(":checked")){atLeastOneCbxChecked=true;}});if(atLeastOneCbxChecked){$(showClass).show();}else{$(showClass).hide();LBG.gFormsDeselectOthers.gFormsClearDataOnDeselction(el);}}});}},getShowHideClass:function($element){var elementClasses=$element.attr("class").split(" "),showHideClass=false;for(i=0;i<elementClasses.length;++i){if(elementClasses[i].substring(0,8)==="cbxShow-"){showHideClass="."+elementClasses[i].substr(8);break;}}return showHideClass;}};LBG.gFormsRibtForm42={init:function(){$(".personalEmailSection input:checkbox").change(function(){if($(".personalEmailSection input:checked").length>0){$("#trigger138email").attr("value","");$("#trigger138email").attr("value","true");}else{$("#trigger138email").attr("value","");
$("#trigger138email").attr("value","false");}});if($(".gformContentWrapper .showWithCheckBox")){LBG.gFormsRibtForm42.parentCheckBoxes();LBG.gFormsRibtForm42.emailCheckBoxes();LBG.gFormsRibtForm42.mobileCheckBoxes();$(".showWithCheckBox").change(function(){LBG.gFormsRibtForm42.parentCheckBoxes();LBG.gFormsRibtForm42.emailCheckBoxes();});$(".showEmailTxtBox input:checkbox").change(function(){LBG.gFormsRibtForm42.emailCheckBoxes();});$(".F042AccountTypeSection").find(".F042AccountType:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042AccountTypeSection"),".F042AccountType",$("#accountType"));if($(".F042AccountTypeSection").find(".F042AccountType:checkbox[name='cbxAccountTypePersonal']").is(":checked")){LBG.gFormsRibtForm42.teBuildString($(".F042RegistrationEmailOptionsSection"),".F042RegistrationEmailOptions",$("#registrationEmailOptions"));LBG.gFormsRibtForm42.teBuildString($(".F042OnlineBankingoptionsSection"),".F042OnlineBankingoptions",$("#onlineBankingoptions"));LBG.gFormsRibtForm42.teBuildString($(".F042BankAccountOptionsSection"),".F042BankAccountOptions",$("#bankAccountOptions"));LBG.gFormsRibtForm42.teBuildString($(".F042LendingOptionsSection"),".F042LendingOptions",$("#lendingOptions"));LBG.gFormsRibtForm42.teBuildString($(".F042SavingsOptionsSection"),".F042SavingsOptions",$("#savingsOptions"));LBG.gFormsRibtForm42.teBuildString($(".F042InsuranceOptionsSection"),".F042InsuranceOptions",$("#insuranceOptions"));}else{$("#registrationEmailOptions").val("");$("#onlineBankingoptions").val("");$("#bankAccountOptions").val("");$("#lendingOptions").val("");$("#savingsOptions").val("");$("#insuranceOptions").val("");}if($(".F042AccountTypeSection").find(".F042AccountType:checkbox[name='cbxAccountTypeBusiness']").is(":checked")){LBG.gFormsRibtForm42.teBuildString($(".F042RegistrationEmailOptionsSection"),".F042BusEmailSent",$("#busEmailSent"));LBG.gFormsRibtForm42.teBuildString($(".F042BusinessBankingOptions1Section"),".F042BusinessBankingOptions1",$("#businessBankingOptions1"));LBG.gFormsRibtForm42.teBuildString($(".F042BusinessBankingOptions2Section"),".F042BusinessBankingOptions2",$("#businessBankingOptions2"));LBG.gFormsRibtForm42.teBuildString($(".F042BusinessBankingOptions3Section"),".F042BusinessBankingOptions3",$("#businessBankingOptions3"));}else{$("#busEmailSent").val("");$("#businessBankingOptions1").val("");$("#businessBankingOptions2").val("");$("#businessBankingOptions3").val("");}});$(".F042RegistrationEmailOptionsSection").find(".F042RegistrationEmailOptions:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042RegistrationEmailOptionsSection"),".F042RegistrationEmailOptions",$("#registrationEmailOptions"));});$(".F042RegistrationEmailOptionsSection").find(".F042BusEmailSent:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042RegistrationEmailOptionsSection"),".F042BusEmailSent",$("#busEmailSent"));});$(".F042OnlineBankingoptionsSection").find(".F042OnlineBankingoptions:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042OnlineBankingoptionsSection"),".F042OnlineBankingoptions",$("#onlineBankingoptions"));});$(".F042BankAccountOptionsSection").find(".F042BankAccountOptions:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042BankAccountOptionsSection"),".F042BankAccountOptions",$("#bankAccountOptions"));});$(".F042LendingOptionsSection").find(".F042LendingOptions:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042LendingOptionsSection"),".F042LendingOptions",$("#lendingOptions"));});$(".F042SavingsOptionsSection").find(".F042SavingsOptions:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042SavingsOptionsSection"),".F042SavingsOptions",$("#savingsOptions"));});$(".F042InsuranceOptionsSection").find(".F042InsuranceOptions:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042InsuranceOptionsSection"),".F042InsuranceOptions",$("#insuranceOptions"));});$(".F042BusinessBankingOptions1Section").find(".F042BusinessBankingOptions1:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042BusinessBankingOptions1Section"),".F042BusinessBankingOptions1",$("#businessBankingOptions1"));});$(".F042BusinessBankingOptions2Section").find(".F042BusinessBankingOptions2:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042BusinessBankingOptions2Section"),".F042BusinessBankingOptions2",$("#businessBankingOptions2"));});$(".F042BusinessBankingOptions3Section").find(".F042BusinessBankingOptions3:checkbox").change(function(){LBG.gFormsRibtForm42.teBuildString($(".F042BusinessBankingOptions3Section"),".F042BusinessBankingOptions3",$("#businessBankingOptions3"));});}},teBuildString:function($section,fieldClass,$inputField){var selectedItemsArray=new Array();var haveSelectedValue=false;$($section).find(fieldClass+":checkbox:checked").siblings("label").each(function(indexes){haveSelectedValue=true;selectedItemsArray[indexes]=$(this).html().trim();});if(haveSelectedValue==false){$inputField.val("");}else{$inputField.val($.grep(selectedItemsArray,Boolean).join("/"));}},parentCheckBoxes:function(){var ticked=false;$(".showWithCheckBox").each(function(){if($(this).is(":checked")){ticked=true;}});if(ticked){$(".ribtShowWithEitherCheckbox").show();}else{$(".ribtShowWithEitherCheckbox").hide();}return ticked;},mobileCheckBoxes:function(){var ticked=false;$(".showMobTxtBox input:checkbox").each(function(){if($(this).is(":checked")&&LBG.gFormsRibtForm42.parentCheckBoxes()){ticked=true;}});if(ticked){$(".ribtMobTxtBox").show();}else{$(".ribtMobTxtBox").hide();}},emailCheckBoxes:function(){var ticked=false;$(".showEmailTxtBox input:checkbox").each(function(){if($(this).is(":checked")&&LBG.gFormsRibtForm42.parentCheckBoxes()){ticked=true;}});if(ticked){$(".ribtEmailTxtBox").show();}else{$(".ribtEmailTxtBox").hide();}}};LBG.gFormsGenerateLoanReasonString={init:function(){var $reasonsForLoan=$(".gformContentWrapper .reasonsForLoan"),$reasonsForLoanStringField,reasonsString=" ";if($reasonsForLoan.length>0){LBG.gFormsGenerateLoanReasonString.buildString($reasonsForLoan);LBG.gFormsGenerateLoanReasonString.removeValidationError($reasonsForLoan);$reasonsForLoan.find(":checkbox, .txtOtherReasons").change(function(){LBG.gFormsGenerateLoanReasonString.buildString($reasonsForLoan);});$reasonsForLoan.find("fieldset .otherReasonsForLoan").hide();$reasonsForLoan.find("fieldset #otherReason").change(function(){if($(this).is(":checked")){$reasonsForLoan.find("fieldset .otherReasonsForLoan").show();}else{$reasonsForLoan.find("fieldset .otherReasonsForLoan").hide();}});if($reasonsForLoan.find("fieldset #otherReason").is(":checked")){$reasonsForLoan.find("fieldset .otherReasonsForLoan").show();}$reasonsForLoan.find("fieldset .txtOtherReasons").blur(function(){if($(this).val().trim()==""){$reasonsForLoan.find("fieldset > span.error").remove();}});}},buildString:function($reasonsForLoan){var reasonsString=LBG.gFormsGenerateLoanReasonString.getCheckedReasons($reasonsForLoan.find(":checkbox"));if(($reasonsForLoan.find(".txtOtherReasons").val().trim().length>0)&&($reasonsForLoan.find(".otherReasonCbx").is(":checked"))){reasonsString=reasonsString+" / "+$reasonsForLoan.find(".txtOtherReasons").val().trim();}$reasonsForLoan.find(".reasonsForLoanTransferExtract").val(" "+reasonsString);if(reasonsString.length<2){LBG.gFormsGenerateLoanReasonString.addValidationError($reasonsForLoan);}else{LBG.gFormsGenerateLoanReasonString.removeValidationError($reasonsForLoan);
}},getCheckedReasons:function($checkboxes){var rsn="";$checkboxes.each(function(){if((this.checked&&$(this).parents(".formFieldInner").find("label").text().length)&&(!$(this).hasClass("otherReasonCbx"))){rsn=rsn+" / "+$(this).parents(".formFieldInner").find("label").text();}});return rsn.substring(3);},addValidationError:function($reasonBox){$reasonBox.addClass("formField");$reasonBox.addClass("error");$reasonBox.find("fieldset").find("span.error").remove();$reasonBox.find("fieldset").append('<span class="error" aria-live="polite" aria-atomic="true" role="alert">Please ensure at least one reason is specified.</span>');},removeValidationError:function($reasonBox){$reasonBox.removeClass("formField");$reasonBox.removeClass("error");$reasonBox.find("fieldset").find("span.error").remove();}};LBG.gFormsCreditCardNumberValidation={init:function(){$(".txtCrdtCardNum").each(function(){var cardInputField=$(this);$(this).change(function(){cardInputField.closest(".formField").removeClass("error invalid");cardInputField.nextAll(".crdtCardNumError").remove();var isValid=false;var cardNumber_value=cardInputField.val();var cardNumber_length=cardInputField.val().length;if(cardNumber_length==15||cardNumber_length==16){var parity=cardNumber_length%2;for(var i=0,total=0;i<cardNumber_length;i++){var digit=cardNumber_value.charAt(i);if(i%2===parity){digit=digit*2;if(digit>9){digit=digit-9;}}total=total+parseInt(digit,10);}if(total%10===0){isValid=true;}}if(cardInputField.val()!=""&&cardInputField.val()!=undefined&&cardInputField.val().match(/^\d+$/)&&isValid==true){LBG.gFormsCreditCardNumberValidation.getcrdtCrdnumberServiceCall(cardInputField);}});});},getcrdtCrdnumberServiceCall:function(cardInputField){var crdtCardNumber;crdtCardNumber=cardInputField.val();var cardType=cardInputField.attr("data-card-type");var getCrdtCardnumberUrl=DI.lang.gformsCreditCardService.url;var data={"cardNumber":crdtCardNumber,"cardType":cardType,"validate":"true"};$.ajax({url:getCrdtCardnumberUrl,dataType:"json",type:"post",accept:"application/JSON",contentType:"application/json; charset=UTF-8",data:JSON.stringify(data),cache:false,success:function(response){if(response){cardInputField.closest(".formField").removeClass("error invalid");cardInputField.nextAll(".error").remove();if($(".crdtCardNumFormError").hasClass("formSubmitError")){$(".crdtCardNumFormError").remove();cardInputField.closest(".formField").removeClass("error");}if(cardInputField.nextAll("span").eq(0).hasClass(".crdtCardNumError")){cardInputField.nextAll(".crdtCardNumError").eq(0).closest(".formField").removeClass("error invalid");cardInputField.nextAll(".crdtCardNumError").eq(0).remove();}}},error:function(jqXHR){var errMsg="";if($(".crdtCardNumFormError").hasClass("formSubmitError")){$(".crdtCardNumFormError").removeClass("formSubmitError");}if(cardInputField.nextAll("span").eq(0).hasClass(".crdtCardNumError")){cardInputField.nextAll(".crdtCardNumError").eq(0).remove();}if(jqXHR.responseText!==""){errMsg=JSON.parse(jqXHR.responseText);}switch(jqXHR.status){case 204:if($(".crdtCardNumFormError").hasClass("formSubmitError")){$(".crdtCardNumFormError").remove();cardInputField.closest(".formField").removeClass("error");}cardInputField.closest(".formField").removeClass("error invalid");cardInputField.nextAll(".error").remove();cardInputField.nextAll(".crdtCardNumError").eq(0).remove();break;case 400:if(errMsg.error.message!==""){cardInputField.nextAll(".error").remove();cardInputField.nextAll(".crdtCardNumError").eq(0).remove();cardInputField.closest(".formFieldInner").append('<span class="crdtCardNumError" aria-live="polite" aria-atomic="true" role="alert"></span>');cardInputField.nextAll(".crdtCardNumError").eq(0).addClass("error");cardInputField.closest(".formField").addClass("error invalid");cardInputField.nextAll(".crdtCardNumError").eq(0).text(errMsg.error.message);}else{$(".crdtCardNumError").closest(".formField").removeClass("error invalid");$(".crdtCardNumError").remove();}break;case 404:$(".crdtCardNumFormError").remove();$(".gformContentWrapper").before('<div class="crdtCardNumFormError formSubmitError"></div>');cardInputField.closest(".formField").addClass("error");cardInputField.nextAll(".crdtCardNumError").eq(0).text(DI.lang.gformsCreditCardService.errorText);break;case 500:$(".crdtCardNumFormError").remove();$(".gformContentWrapper").before('<div class="crdtCardNumFormError formSubmitError"></div>');cardInputField.closest(".formField").addClass("error");cardInputField.nextAll(".crdtCardNumError").eq(0).text(DI.lang.gformsCreditCardService.errorText);break;default:$(".gformContentWrapper").before('<div class="crdtCardNumFormError formSubmitError"></div>');cardInputField.closest(".formField").addClass("error");cardInputField.nextAll(".crdtCardNumError").eq(0).text(DI.lang.gformsCreditCardService.errorText);}}});}};LBG.gFormsPostCodeFinder={init:function(){$(".txtFindPostCode").change(function(){LBG.gFormsPostCodeFinder.postcodeServiceCall();});},postcodeServiceCall:function(formObj){var postcode=$(".txtFindPostCode").val();var ajaxurl=$(".txtFindPostCode").attr("data-ajax-uri");var url=ajaxurl+"/"+postcode;$.ajax({url:url,dataType:"json",cache:false,success:function(response){if(response){var postcodelist=JSON.parse(JSON.stringify(response));var options="some val";var address="";for(var i=0;i<postcodelist.length;i++){address=(postcodelist[i].buildingNumber+" "+postcodelist[i].addressLines[0]+" "+postcodelist[i].district+" "+postcodelist[i].town);options+='<option value="'+address+'">'+address+"</option>";}$("#slctAddCardHldrTitle1").html(options);$(".dropDownFindPostCode").removeClass("hide");}else{$(".postcodelist").addClass("error");$(".postcodelist").text("no postcode data");}},error:function(){$(".postcodelist").addClass("error");$(".postcodelist").text("Postcode finder service error");}});}};LBG.gFormsSortCodeFinder={init:function(){$(".validateSortAndAccNum").click(function(){LBG.gFormsSortCodeFinder.sortcodeServiceCall();});},sortcodeServiceCall:function(formObj){var sortcode=$(".txtFindSortCode").val();var accountNum=$(".txtFindAccNum").val();var ajaxurl=$(".validateSortAndAccNum").attr("data-ajax-uri");var url=ajaxurl+sortcode+"/accountnumber/"+accountNum;$.ajax({url:url,dataType:"json",cache:false,success:function(response){if(response){var sortcodelist=JSON.parse(JSON.stringify(response));var rescode=(sortcodelist.error.code);var resMsg=(sortcodelist.error.message);if(resMsg){$(".sortcodeVrifyMsg").removeClass("hide");$(".sortcodeVrifyMsg").text(resMsg);}else{$(".sortcodeVrifyMsg").removeClass("hide");$(".sortcodeVrifyMsg").addClass("error");$(".sortcodeVrifyMsg").text("Invalid sortcode, account number");}}else{$(".sortcodeVrifyMsg").removeClass("hide");$(".sortcodeVrifyMsg").addClass("error");$(".sortcodeVrifyMsg").text("No response from server");}},error:function(){$(".sortcodeVrifyMsg").removeClass("hide");$(".sortcodeVrifyMsg").addClass("error");$(".sortcodeVrifyMsg").text("Sort code & account num verify service error");}});}};LBG.gformCertOfInterest={init:function(){var currentYear=(new Date).getFullYear();$("#certYear1").html("April "+(currentYear-1)+" - April "+currentYear);$("#certYear2").html("April "+(currentYear-2)+" - April "+(currentYear-1));$("#certYear3").html("April "+(currentYear-3)+" - April "+(currentYear-2));$("#certYear4").html("April "+(currentYear-4)+" - April "+(currentYear-3));$("#certYear5").html("April "+(currentYear-5)+" - April "+(currentYear-4));$("#certYear6").html("April "+(currentYear-6)+" - April "+(currentYear-5));
}};LBG.gformsConcatSortcode={init:function(){$(".sortCode").each(function(){var sortcodeInputs=$(this).find("input[type=text]"),$hdnSort=$(this).next(".sortCodeConcatenated");LBG.gformsConcatSortcode.updateSortCodeField($hdnSort,sortcodeInputs);sortcodeInputs.change(function(){LBG.gformsConcatSortcode.updateSortCodeField($hdnSort,sortcodeInputs);});sortcodeInputs.blur(function(){LBG.gformsConcatSortcode.updateSortCodeField($hdnSort,sortcodeInputs);});});},updateSortCodeField:function($hdnSort,sortcodeInputs){var concatSC="";sortcodeInputs.each(function(){concatSC=concatSC+$(this).val();});$hdnSort.val(concatSC);}};LBG.gformsTransferExtractTitles={init:function(){var $titleWrap=$(".titleTEwrap");if($titleWrap.length>0){LBG.gformsTransferExtractTitles.updateTEtitleField($titleWrap);$titleWrap.find(".formField select").change(function(){LBG.gformsTransferExtractTitles.updateTEtitleField($titleWrap);});$titleWrap.find(".formField input[type=text]").change(function(){LBG.gformsTransferExtractTitles.updateTEtitleField($titleWrap);});$titleWrap.find(".formField input[type=text]").blur(function(){LBG.gformsTransferExtractTitles.updateTEtitleField($titleWrap);});}},updateTEtitleField:function($titleWrap){$titleWrap.each(function(){if(($(this).find("select").val().toLowerCase()!=="other")&&($(this).find("select").val().toLowerCase()!=="")){$(this).find("input[type=hidden]").val($(this).find("select").val());}else{$(this).find("input[type=hidden]").val($(this).find("input[type=text]").val());}});}};LBG.gformsToggleOtherField={init:function(){var $toggleOtherField=$(".toggleOtherField");$toggleOtherField.each(function(){var $this=$(this),$select=$("select",$this),$otherField=$("input[type=text]",$toggleOtherField).parents(".formField");$select.change(function(){if(""+$(this).val().toLowerCase().indexOf("other")===0){$otherField.show();}else{$otherField.hide();}});});}};LBG.gformsGetTermInMonths={init:function(){var $monthEl=$(".gformDDTermMths"),$yearEl=$(".gformDDTermYrs");LBG.gformsGetTermInMonths.getTerm($monthEl,$yearEl);$yearEl.change(function(){if($(this).val()==="25"){$monthEl.children().eq(0).attr("selected","selected");$monthEl.attr("disabled","disabled");}else{$monthEl.removeAttr("disabled");}});$monthEl.add($yearEl).change(function(){LBG.gformsGetTermInMonths.getTerm($monthEl,$yearEl);});},getTerm:function($monthEl,$yearEl){var termInYears,termInMonths,totalTerm;if($yearEl.val()!==""&&$monthEl.val()!==""){termInYears=$yearEl.val();termInMonths=$monthEl.val();totalTerm=parseInt(termInYears)*12+parseInt(termInMonths);if(isNaN(totalTerm)){totalTerm=0;}$("#hdnTermMonths").val(totalTerm);}}};LBG.GformsTokens={init:function(){LBG.GformsTokens.generateLinkTokens();LBG.GformsTokens.generateInlineTokens();},generateLinkTokens:function(){var $tokenLink=$(".GFormsTokenLink"),linkTitleSelector=".GFormsTokenLinkTitle",linkURLSelector=".GFormsTokenLinkURL",linkAnchorSelector="a";$tokenLink.each(function(){var $this=$(this),linkTitle=$(linkTitleSelector,$this).hide().val(),linkURL=$(linkURLSelector,$this).hide().val(),$linkAnchor=$(linkAnchorSelector,$this);if(linkTitle){$linkAnchor.html(linkTitle);}if(linkURL){$linkAnchor.attr("href",linkURL);}});},generateInlineTokens:function(){var $token=$(".GFormsToken"),contentSelector=".GFormsTokenValue",targetSelector=".GFormsTokenContent";$token.each(function(){var $this=$(this),tokenContent=$(contentSelector,$this).hide().val(),$target=$(targetSelector,$this);if(tokenContent){$target.html(tokenContent);}});}};LBG.gformsConcatenateReasonForLoan={init:function(){LBG.gformsConcatenateReasonForLoan.concatenateReason();},concatenateReason:function(){var $reasonsForLoan=$(".reasonsForLoan"),$reasonsForLoanStringField=$reasonsForLoan.find(".reasonsForLoanString"),reasonsString="";$reasonsForLoan.find(":checkbox, .txtOtherReasons").change(function(){reasonsString=LBG.gformsConcatenateReasonForLoan.getCheckedReasons($reasonsForLoan.find(":checkbox"));if($reasonsForLoan.find(".txtOtherReasons").val().trim().length>0){reasonsString=reasonsString+" / "+$reasonsForLoan.find(".txtOtherReasons").val().trim();}$reasonsForLoanStringField.val(reasonsString);});},getCheckedReasons:function($checkboxes){var rsn="";$checkboxes.each(function(){if(this.checked){rsn=rsn+" / "+$(this).val();}});return rsn.substring(3);}};LBG.gFormsPopulateHiddenAppointmentTime={init:function(){LBG.gFormsPopulateHiddenAppointmentTime.populateHiddenAppointmentTime();},populateHiddenAppointmentTime:function(){var $apmntTime=$(".appointmentTime");var hour,minute;$(".apmntTime .hour").change(function(){hour=$(".apmntTime option:selected").eq(0).val();$apmntTime.val(hour+":"+minute);});$(".apmntTime .minute").change(function(){minute=$(".apmntTime option:selected").eq(1).val();$apmntTime.val(hour+":"+minute);});}};LBG.gformsCheckboxStateToHiddenField={init:function(){LBG.gformsCheckboxStateToHiddenField.setHiddenFieldValue();},setHiddenFieldValue:function(){var $checkbox=$(".checkbox input:checkbox");$checkbox.click(function(){if($(this).parents(".formField").next(".formField").hasClass("fieldHiddenValue")){if($(this).is(":checked")){$(this).parents(".formField").next(".formField").find("input:text, input:hidden").val("true");}else{$(this).parents(".formField").next(".formField").find("input:text, input:hidden").val("false");}}if($(this).parents(".inputGroup").next(".formField").hasClass("fieldHiddenValue")){if($(this).is(":checked")){$(this).parents(".inputGroup").next(".formField").find("input:text, input:hidden").attr("value","");$(this).parents(".inputGroup").next(".formField").find("input:text, input:hidden").attr("value","true");}else{$(this).parents(".inputGroup").next(".formField").find("input:text, input:hidden").attr("value","");$(this).parents(".inputGroup").next(".formField").find("input:text, input:hidden").attr("value","false");}}});}};LBG.gformsTextboxStateToHiddenField={init:function(){LBG.gformsTextboxStateToHiddenField.setHiddenFieldValue();},setHiddenFieldValue:function(){var $textbox=$("input:text");$textbox.blur(function(){if($(this).parents(".formField").next(".formField").hasClass("fieldHiddenValue")){if($(this).val().length>0){$(this).parents(".formField").next(".formField").find("input:text, input:hidden").val("Y");}else{$(this).parents(".formField").next(".formField").find("input:text, input:hidden").val("N");}}});}};LBG.gformsresetInputsOnSelect={init:function(){LBG.gformsresetInputsOnSelect.checkExistingCustomer();},checkExistingCustomer:function(){$(".existingLLoydscustomer").bind("change",function(){var form=$(".notExistingLbgCustomer input");LBG.gformsresetInputsOnSelect.resetForm(form);$("#btnPostcodeSearchCurrent0").val("Find address");$(".street-address span").html("");$("#Addr_1").val("");$("#Addr_2").val("");$("#Town").val("");$("#Post_Code").val("");$("#County").val("");});$(".nonexistingLLoydscustomer").bind("change",function(){var form=$(".isExistingLbgCustomer input");LBG.gformsresetInputsOnSelect.resetForm(form);$(".findAddress").removeClass("hideAddressPanel");$(".selectedAddress").addClass("hideAddressPanel");});},resetForm:function(form){var inputs=form;for(var i=0;i<inputs.length;i++){inputs[i].value="";}}};LBG.promoboxImage={init:function(){var checkpromoboxImage=$("div.sp-pat-034-big-prompts").hasClass("promobox-image");if(checkpromoboxImage){if($("div.sp-pat-034-big-prompts img").hasClass("img-responsive-full-width")){}else{$("div.sp-pat-034-big-prompts.promobox-image ").prepend('<img src="http://images.halifax.co.uk/assets/img/home/images/Home_insurance_sweets_Tile2.jpg" alt="null" class="img-responsive-full-width retina">');
$("div.sp-pat-034-big-prompts.promobox-image ").css("height","auto");}}}};LBG.OTMalert={init:function(){$("div.formSubmitError").attr({"role":"alert"});}};LBG.overrideFocusIE11={init:function(){if(document.documentMode||/Edge/.test(navigator.userAgent)){document.onkeyup=triggerTab;}else{}function triggerTab(evt){var evt=(evt)?evt:((event)?event:null);if(evt.keyCode==9){var focused=document.activeElement.id;var b=$("form#idEpi div.colLayout.cols3").find(".colPart").eq(0).find("a").attr("id");var c=$("form#idEpi  div.colLayout.cols3").find(".colPart").eq(1).find("a").attr("id");var d=$("form#idEpi  div.colLayout.cols3").find(".colPart").eq(2).find("a").attr("id");if(focused==b){$("a#idEpi\\:navigatetoaov").closest("div").css("border","dotted 1px #000");$("a#idEpi\\:navigatetompp").closest("div").css("border","none");$("a#idEpi\\:navigatetosuccess").closest("div").css("border","none");}else{if(focused==c){$("a#idEpi\\:navigatetompp").closest("div").css("border","dotted 1px #000");$("a#idEpi\\:navigatetoaov").closest("div").css("border","none");$("a#idEpi\\:navigatetosuccess").closest("div").css("border","none");}else{if(focused==d){$("a#idEpi\\:navigatetosuccess").closest("div").css("border","dotted 1px #000");$("a#idEpi\\:navigatetompp").closest("div").css("border","none");$("a#idEpi\\:navigatetoaov").closest("div").css("border","none");}else{$("a#idEpi\\:navigatetompp").closest("div").css("border","none");$("a#idEpi\\:navigatetoaov").closest("div").css("border","none");$("a#idEpi\\:navigatetosuccess").closest("div").css("border","none");}}}}}}};LBG.enhancedPaperlessInterstitial={init:function(){if(mobileType==="Android"||mobileType==="iOS"){$("form[name='frmCanNotSuppress'] .preferences .roleOptionLink").attr("role","option");}}};LBG.lostStolenCheckbox={init:function(){$(".lostAndStolenCardCancellation tbody input[type=checkbox]").each(function(){var lsCheckboxText=$(this).prev().find("strong").text();$(this).attr("aria-label",lsCheckboxText);});}};LBG.ariaTagMISelect={init:function(){$(".memInfoSelect select").each(function(){var aTagMIText=$(this).prev().text();if(aTagMIText.indexOf(":")>=0){aTagMIText=aTagMIText.replace(":","");aTagMIText="Please enter "+aTagMIText+"from your memorable information";$(this).find(":option:first").attr("aria-label",aTagMIText);}else{aTagMIText="Please enter character "+aTagMIText+"from your memorable information";$(this).find(":option:first").attr("aria-label",aTagMIText);}});}};LBG.enhancedPaperlessInterstitial={init:function(){if(mobileType==="Android"||mobileType==="iOS"){$("form[name='frmCanNotSuppress'] .preferences .roleOptionLink").attr("role","option");}}};LBG.makeTransferChooseAmount={init:function(){$("form#frmMakeTransfer1 div.inputGroup div.checkbox input.amountFieldAmount, #frmApplyForSaving .interestAccount span.cxtHelp a.cxtTrigger:first").attr("disabled","disabled");}};LBG.ariaUpgradeAcc={init:function(){$("#frm02:lstAVAAccounts > ul > li > .addToCompare > input").each(function(){var titleAria=$(this).parent().prev().text();titleAria=titleAria+" "+"Add to compare";$(this).attr("aria-label",titleAria);});}};LBG.overdraftFields={init:function(){var odAdjustField=$("input.odrInputValue"),odExistingbalance=$(".odrExOverdraftValue"),odUsedbalanace=$(".odrUsedOverdraftValue");LBG.overdraftFields.showOverdraftFields(odAdjustField,odExistingbalance,odUsedbalanace);odAdjustField.keyup(function(){LBG.overdraftFields.showOverdraftFields($(this),odExistingbalance,odUsedbalanace);});},showOverdraftFields:function(ele,odExistingbalance,odUsedbalanace){var decreaseFields=$(".decreseOverDraftFields"),increaseFields=$(".increaseOverDraftFields"),odAdjustFormField=$("input.odrInputValue").parents(".formField");decreaseFields.hide().find("input").addClass("optional").parents("formField").removeClass("error");increaseFields.hide().find("input").addClass("optional").parents("formField").removeClass("error");if(ele.val()!==undefined){if(ele.val().length===0){decreaseFields.find('input[type="checkbox"]').removeAttr("checked");}else{if(parseInt(ele.val())>parseInt(odExistingbalance.val())&&ele.val()%10==0){increaseFields.show().find("input").removeClass("optional");ele.parents(".formField").removeClass("error").find("span.error").remove();}else{if(parseInt(ele.val())<parseInt(odExistingbalance.val())&&parseInt(ele.val())>parseInt(odUsedbalanace.val())&&ele.val()%10==0){decreaseFields.show().find("input").removeClass("optional");ele.parents(".formField").removeClass("error").find("span.error").remove();}}}}}};LBG.readAriaLabel={init:function(){if($.browser.msie!==true){$("#frmSetUpTravelFlag:objcountryFinderAdd span.cxtHelp a.cxtTrigger:first").each(function(){var ariaText=$(this).attr("title")+" "+$(this).text();$(this).attr("aria-label",ariaText);});}}};LBG.vcErrorAccessibility={init:function(){$(".vulnerable_customers p#addSupprtErrorMessage, .vulnerable_customers p#addSupprtSuccessMessage").attr("tabIndex",-1).focus();$("#avaBenefitErrorMessage").attr("aria-live","polite").attr("role","alert").attr("tabIndex",-1).focus();}};LBG.removeQuestionAddInfoAccessibility={init:function(){var infoReader=$(".content span.cxtHelp a.cxtTrigger");$(infoReader).each(function(){if($(this).hasClass("noInfoIcon")!=true){$(this).addClass("infoIcon");var questionMarkText=$(".content span.cxtHelp a.cxtTrigger").text().trim();if($(infoReader).text().indexOf("[?]")!=-1){$(this).text("i");$(this).append('<span class="Accessibilityhidden">Information</span>');$("#smartSearch .showHide .searchCountry span.cxtHelp a.cxtTrigger").removeAttr("aria-label");}}});}};LBG.addInfoGenericLink={init:function(){$("#frm02:lstAVAAccounts > ul li.comparisonSelectItem").each(function(){var titleAria=$(this).find("h3").text();var findtitleAria=$(this).find(".details > .description > ul.linkList > li > a").attr("title");findtitleAria=titleAria+" "+"Click to "+findtitleAria;$(this).find(".details > .description > ul.linkList > li > a").attr("aria-label",findtitleAria);var upgradeBtntitleAria=$(this).find(".action > p > a").attr("title");upgradeBtntitleAria=titleAria+" "+"Click to "+upgradeBtntitleAria;$(this).find(".action > p > a").attr("aria-label",upgradeBtntitleAria);});}};LBG.addInfoPersonalDetails={init:function(){$("#frmChangePersonalDetails\\:valCountryByBirthCPP, #frmChangePersonalDetails\\:valTaxResidencyCPP").each(function(){$(this).html()==="&nbsp;"?$(this).html("Undefined").addClass("visuallyhidden"):"";});}};LBG.gformsCheckEmailTemplate={init:function(){$(".chkEmail").find(":checkbox").change(function(){if($(".chkEmail").find(":checkbox").is(":checked")){if($("#cbxUsefulForms").is(":checked")){$(".usefulFormsEmail").show();}else{$(".usefulFormsEmail").hide();}$(".emailTmpl").show();}else{$(".usefulFormsEmail").hide();$(".emailTmpl").hide();}});}};LBG.gFormsGenerateCustomerEmailString={init:function(){$(".submitAction").click(function(event){if(!$(".chooseOptions .hidTEFields").find(":checkbox").is("checked")){$(".chooseOptionsF46 div div:first span.error").css("marginTop","-40px");}});var $usefulFormsEmail=$(".gformContentWrapper .usefulFormsEmail"),$usefulFormsEmailStringField,usefulFormsEmailString=" ";$(".chooseOptions .hidTEFields").find(":checkbox").change(function(){var cbx=$(this).attr("id").substring(3);var hidId="#hid"+cbx;if($(this).is(":checked")){$(hidId).val("Y");}else{$(hidId).val("N");}});$("#cbxInfLendRev").change(function(){$("input[name=radioAppointmentReq]").attr("checked",false);LBG.gFormsGenerateCustomerEmailString.resetAppointmentSelection();
});$("input[name=radioAppointmentReq]").change(function(){LBG.gFormsGenerateCustomerEmailString.resetAppointmentSelection();});$(".chooseOptionsF46 #cbxUsefulForms").change(function(){if($(this).is(":checked")){LBG.gFormsGenerateCustomerEmailString.teBuildUsefulFormsString();}else{$("#selectedUsefuleForms").val("");}});$(".gformContentWrapper .usefulFormsEmail").find(":checkbox").change(function(){var cbx=$(this).attr("id").substring(3);var hidId="#hid"+cbx;if($(this).is(":checked")){$(hidId).val("true");}else{$(hidId).val("false");}LBG.gFormsGenerateCustomerEmailString.teBuildUsefulFormsString();});if($usefulFormsEmail.length>0){LBG.gFormsGenerateCustomerEmailString.removeValidationError($usefulFormsEmail);$(".submitAction").click(function(event){var validation=false;LBG.gFormsGenerateCustomerEmailString.buildString($usefulFormsEmail);if($("#cbxNewBusiEmail").is(":checked")&&(($("#txtCustomerName").val().trim()=="")||($("#txtPostCode").val().trim()==""))){$(".chooseOptions").removeClass("error").removeClass("formField").find("span.error").remove();$(".postCodeTg").addClass("formField").addClass("error").find("span.error").remove();if($("#txtCustomerName").val().trim()==""){$(".postCodeTg .formField:first").append('<span class="error" aria-live="polite" aria-atomic="true" role="alert">Please enter a value. This is a required field.</span>');}if($("#txtPostCode").val().trim()==""){$(".postCodeTg .formField:last").append('<span class="error" aria-live="polite" aria-atomic="true" role="alert">Please enter a value. This is a required field.</span>');}$("div.formSubmitError").show();$("#txtFileId").attr("data-valid","false");}else{if($("#cbxNewBusiEmail").is(":checked")&&($("#txtCustomerName").val().trim()!="")&&($("#txtPostCode").val().trim()!="")){$("div.formSubmitError").hide();$(".postCodeTg").removeClass("formField").removeClass("error").find("span.error").remove();$("#txtFileId").attr("data-valid","false");}}if($("#cbxNewBusiEmail").is(":checked")&&!LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.postcode,$("#txtPostCode").val().trim(),"i")){$("div.formSubmitError").show();$(".postCodeTg").removeClass("formField").removeClass("error");$(".postCodeTg").addClass("formField").addClass("error");$(".postCodeTg .formField:last span").remove();$(".postCodeTg .formField:last").append('<span class="error" aria-live="polite" aria-atomic="true" role="alert">Sorry, we cannot find an address for the postcode you entered. Please check you have entered the postcode correctly.</span>');$("#txtFileId").attr("data-valid","false");validation=true;}else{if(validation){$("#txtFileId").attr("data-valid","false");}else{$("#txtFileId").attr("data-valid","true");}}if($("#cbxNewBusiEmail").is(":checked")&&!LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.alphaNumericWithExtraSpecialCharsAndSpaces,$("#txtCustomerName").val().trim())){$("div.formSubmitError").show();$(".postCodeTg").removeClass("formField").removeClass("error");$(".postCodeTg").addClass("formField").addClass("error");$(".postCodeTg .formField:first span").remove();$(".postCodeTg .formField:first").append('<span class="error" aria-live="polite" aria-atomic="true" role="alert">Please use valid characters (letters, numbers, spaces and any of the following -/_+()\u00A3&@".,?!\'</span>');$("#txtFileId").attr("data-valid","false");validation=true;}else{if(validation){$("#txtFileId").attr("data-valid","false");}else{$("#txtFileId").attr("data-valid","true");}}});}},teBuildUsefulFormsString:function(){var selectedUsefulFormsArray=new Array();var haveSelectedValue=false;$(".gformContentWrapper .usefulFormsEmail").find(":checkbox:checked").siblings("label").each(function(indexes){haveSelectedValue=true;selectedUsefulFormsArray[indexes]=$(this).text().trim();});if(haveSelectedValue==false){$("#selectedUsefuleForms").val("");}else{$("#selectedUsefuleForms").val($.grep(selectedUsefulFormsArray,Boolean).join("/"));}},buildString:function($usefulFormsEmail){var reasonsString="";$.each($usefulFormsEmail.find(":checkbox"),function(e,v){if(v.checked){if($(v).attr("id")=="cbxAppCPC"&&$("#hdnBrand").val()=="BOS"){reasonsString+="Apply for a Keycard / ";}else{reasonsString+=$(v).attr("data-TEvalue")+" / ";}var currentID=$(v).attr("id").substring(3);var hidID="#hid"+currentID;$(hidID).val("true");}else{var currentID=$(v).attr("id").substring(3);var hidID="#hid"+currentID;$(hidID).val("false");}});$usefulFormsEmail.find("#customerFormsEmailTransferExtract").val(" "+reasonsString);if($("#cbxUsefulForms").is(":checked")&&reasonsString.length<1){LBG.gFormsGenerateCustomerEmailString.addValidationError($usefulFormsEmail);}},addValidationError:function($reasonBox){$("div.formSubmitError").show();$reasonBox.addClass("formField");$reasonBox.addClass("error");$reasonBox.find("span.error").remove();$(".gformContentWrapper .usefulFormsEmail .formField .formFieldInner:first").append('<span class="error" style="margin-left:190px;max-width:300px;" aria-live="polite" aria-atomic="true" role="alert">Please enter a value. This is a required field.</span>');},removeValidationError:function($reasonBox){$("div.formSubmitError").hide();$reasonBox.removeClass("formField");$reasonBox.removeClass("error");$reasonBox.find("span.error").remove();},resetAppointmentSelection:function(){$(".appointmentdate #appointmentDateDay").get(0).selectedIndex=0;$(".appointmentdate #appointmentDateMonth").get(0).selectedIndex=0;$(".appointmentdate #appointmentDateYear").get(0).selectedIndex=0;$(".appointmentdate datePicker").val("");$(".apmntTime #appointmentHour").get(0).selectedIndex=0;$(".apmntTime #appointmentMinute").get(0).selectedIndex=0;$(".isAppointmentDetailYes #appointmentTime").val("");$(".isAppointmentDetailYes #time.date").val("");}};LBG.gformsTransferExtractStringBuild={init:function(){$(".f047MailOption").find(":checkbox").change(function(){var cbx=$(this).attr("id").substring(3);var hidId="#hdn"+cbx;if($(this).is(":checked")){$(hidId).val("Y");}else{$(hidId).val("N");}});}};LBG.gFormsBuildTEFields={init:function(){$(".chooseOptionsF46 .hidTEFields").find(":checkbox").change(function(){$("#txtCustomerNameTE").val($("#txtCustomerFName").val()+" "+$("#txtCustomerLName").val());var cbx=$(this).attr("id").substring(3);var hidId="#hid"+cbx;if($(this).is(":checked")){$(hidId).val("Y");}else{$(hidId).val("N");}});if($(document).find(".chooseOptionsF46").length>0){$("#txtCustomerFName, #txtCustomerLName").blur(function(){$("#txtCustomerNameTE").val($("#txtCustomerFName").val()+" "+$("#txtCustomerLName").val());});$("#appointmentDateDiv").css("width","330px");$("#cbxVidHelp").change(function(){if($(this).is(":checked")){$(".videosPanel").find(":checkbox").each(function(){var cbx=$(this).attr("id").substring(3);var hidId="#hid"+cbx;if($(this).is(":checked")){var temp=[];if(reasonsString!=""){temp=reasonsString.split(" / ");temp.push($(this).attr("data-TEvalue"));reasonsString=temp.join(" / ");}else{temp.push($(this).attr("data-TEvalue"));reasonsString=temp.join(" / ");}$(hidId).val("true");$("#hidVidHelpTE").val(reasonsString);}else{if(reasonsString!=""){temp=reasonsString.split(" / ");LBG.removeItemsFromArray(temp,$(this).attr("data-TEvalue"));reasonsString=temp.join(" / ");}$(hidId).val("false");$("#hidVidHelpTE").val(reasonsString);}});}else{$("#hidVidHelpTE").val("");$(".videosPanel").find(":checkbox").each(function(){var cbx=$(this).attr("id").substring(3);var hidId="#hid"+cbx;$(hidId).val("false");$("#hidVidHelpTE").val(reasonsString);
});}});var reasonsString="";$(".videosPanel").find(":checkbox").change(function(){var cbx=$(this).attr("id").substring(3);var hidId="#hid"+cbx;if($(this).is(":checked")){var temp=[];if(reasonsString!=""){temp=reasonsString.split(" / ");temp.push($(this).attr("data-TEvalue"));reasonsString=temp.join(" / ");}else{temp.push($(this).attr("data-TEvalue"));reasonsString=temp.join(" / ");}$(hidId).val("true");$("#hidVidHelpTE").val(reasonsString);}else{if(reasonsString!=""){temp=reasonsString.split(" / ");LBG.removeItemsFromArray(temp,$(this).attr("data-TEvalue"));reasonsString=temp.join(" / ");}$(hidId).val("false");$("#hidVidHelpTE").val(reasonsString);}});}}};LBG.removeItemsFromArray=function(array,items){var what,a=items,L=a.length,ax;while(L&&array.length){what=a[--L];while((ax=array.indexOf(what))!==-1){array.splice(ax,1);}}return array;};LBG.businessAppointmentDateSelect={init:function(){LBG.businessAppointmentDateSelect.buildBusinessAppointmentDate();$(".isAppointmentDetailYes").find("#appointmentDate").datepicker("option",{dateFormat:"dd/mm/yy",minDate:"+0D"});$(".lendingPanel").find(":radiobutton").change(function(){if($(".lendingPanel").find("#radioAppNo").is(":checked")){$("#timeDate").val("false");}else{$("#timeDate").val("true");}});},buildBusinessAppointmentDate:function(){$("select.customBusinessAppointmentDateSelector").blur(function(){LBG.businessAppointmentDateSelect.onManualBusinessAppointmentDateSelection();});},onManualBusinessAppointmentDateSelection:function(){var $dateYear=$(".formField .date.inputGroup.appointmentdate .slctYear");var $dateMonth=$(".formField .date.inputGroup.appointmentdate .slctMonth");var $dateDay=$(".formField .date.inputGroup.appointmentdate .slctDay");var concatenateBusinessAppointmentDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$("#appointmentDate").val(concatenateBusinessAppointmentDate);}};LBG.noCalendarFocus={init:function(){$("img.ui-datepicker-trigger").parent("a").attr("tabIndex",-1);}};LBG.gformsRadioValueToHiddenF044={init:function(){$(".gformContentWrapper .rdoToHdn input:radio").change(function(){LBG.gformsRadioValueToHiddenF044.updateHiddenFields();});$(".gformContentWrapper .busSegment input:radio").change(function(){LBG.gformsRadioValueToHiddenF044.updateBusinessSegmentVal();});$(".gformContentWrapper .businessVariation input:radio").change(function(){LBG.gformsRadioValueToHiddenF044.clearCustomerNameText();});$(".gformContentWrapper #pegaCaseTxt").blur(function(){if($("#pegaCaseTxt").val().trim()==""){$("#hdnPegacase").val("N/A");}else{$("#hdnPegacase").val($("#pegaCaseTxt").val().trim());}});$(".gformContentWrapper #userNames").blur(function(){if($("#userNames").val().trim()===""){$("#userNames").css("margin-right","120px");}});},updateHiddenFields:function(){var $currentControl;$(".gformContentWrapper .radioTEvalues input").each(function(){currentControl="#"+$(this).attr("class");if($(currentControl).is(":checked")){$(".gformContentWrapper .radioTEvalues input").val("N");$(this).val("Y");}});},updateBusinessSegmentVal:function(){if($("input:radio[name=businessSegment]:checked").val()==="RBB"){$("#hdnRBBEmail").val("true");$("#hdnSMEEmail").val("false");}else{$("#hdnSMEEmail").val("true");$("#hdnRBBEmail").val("false");}},clearCustomerNameText:function(){if($("input:radio[name=emailTypeVar]:checked").val()==="email_06"){$("#userNames").val("");}}};LBG.appointmentDateSelect={init:function(){LBG.appointmentDateSelect.buildAppointmentDate();LBG.appointmentDateSelect.updateCustomerTitle();LBG.appointmentDateSelect.updateOtherTitle();$(".gformContentWrapper .appointmentType input:radio").change(function(){LBG.appointmentDateSelect.updateAppointmentType();});$(".gformContentWrapper .over70years input:radio").change(function(){LBG.appointmentDateSelect.updateOver70YrsOld();});},buildAppointmentDate:function(){$("select.customAppointmentDateSelector").blur(function(){LBG.appointmentDateSelect.onManualAppointmentDateSelection();});},onManualAppointmentDateSelection:function(){var $dateYear=$(".formField .date.inputGroup.appointmentdate .slctYear");var $dateMonth=$(".formField .date.inputGroup.appointmentdate .slctMonth");var $dateDay=$(".formField .date.inputGroup.appointmentdate .slctDay");var concatenateAppointmentDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val().substr(0,4);$("#appointmentDate").val(concatenateAppointmentDate);},updateAppointmentType:function(){if($("input:radio[name=radioAppType]:checked").val()==="IPS Service Review"){$("#hdnIPSServiceEmail").val("true");$("#hdnIPSAdviceEmail").val("false");}else{$("#hdnIPSAdviceEmail").val("true");$("#hdnIPSServiceEmail").val("false");}},updateOver70YrsOld:function(){if($("input:radio[name=radioOver70yrsOld]:checked").val()==="yes"){$("#hdnOver70Email").val("true");}else{$("#hdnOver70Email").val("false");}},updateCustomerTitle:function(){$("select.selectTitle").blur(function(){LBG.appointmentDateSelect.customerTitleValue();});},customerTitleValue:function(){$("#txtCustTitle").val($("#slctTitle option:selected").text());},updateOtherTitle:function(){$(".gformContentWrapper #txtOtherTitle").blur(function(){LBG.appointmentDateSelect.otherTitle();});},otherTitle:function(){if($("#slctTitle option:selected").text()==="Other"){if($("#txtOtherTitle").val().trim()!=""){$("#txtCustTitle").val($("#txtOtherTitle").val().trim());}}}};LBG.labelPlannedOverdraft={init:function(){$('[id="frmApplyForOverdraft:txtMonthlySalary"], [id="frmApplyForOverdraft:txtOtherIncome"], [id="frmApplyForOverdraft:txtMonthlyMortgage"], [id="frmApplyForOverdraft:txtMonthlySpending"], [id="frmApplyForOverdraft:txtMonthlySalary1"], [id="frmApplyForOverdraft:txtOtherIncome1"], [id="frmApplyForOverdraft:txtMonthlyMortgage1"], [id="frmApplyForOverdraft:txtMonthlySpending1"]').each(function(){$(this).attr("aria-label",$(this).parents("div.inner").find("p:eq(0)").text());});}};LBG.tabStateInbox={init:function(){$('[id="frmInbox:pnlTabpane"]').addClass("accessibleTabs");}};LBG.compareSavingsSelect={init:function(){$(".sp-pat-516-table.s01-dt-default > ul.osrTableHead").each(function(){$(this).attr("role","row");$(this).find("li").attr("role","columnheader");});$(".sp-pat-516-table.s01-dt-default > ul.osrTableData").each(function(){$(this).attr("role","row");$(this).find("li:first").attr("role","rowheader");$(this).find("li").not("li:first").attr("role","gridcell");var ariaTitleSelect=$(this).find("li:first").text();$(this).find("li.osrTableLastCol").find("img").attr("aria-label",ariaTitleSelect).attr("role","button");});}};LBG.oracleWebChatIssue={init:function(){$("#rn_DialogButton_rn_Dialog_0_1-button, #rn_DialogButton_rn_Dialog_0_0-button").attr("tabindex","0");}};LBG.validateClubWealthUpgrade={init:function(){$(".F056UpgradeClarificationRadioButton").find("input[type=radio]").change(function(){LBG.validateClubWealthUpgrade.handleYourDetailsSection();var radioName=$(this).attr("name");LBG.validateClubWealthUpgrade.setRadioButtonValues(radioName);});$(".F056SortCode").find(".txtSortCode[type=text]").blur(function(){var sortCodeVal=$("#sortCode12").val()+$("#sortCode34").val()+$("#sortCode56").val();$("#sortCodeConcatenatedHdn").val(sortCodeVal);});$("select.cwuDateOfBirthDate").blur(function(){var $dateYear=$(".cwuDateOfBirth").find(".slctYear");var $dateMonth=$(".cwuDateOfBirth").find(".slctMonth");var $dateDay=$(".cwuDateOfBirth").find(".slctDay");var concatenateCWUDateOfBirthDate=$dateDay.val()+"/"+$dateMonth.val()+"/"+$dateYear.val();$("#cwuDateOfBirthDate").val(concatenateCWUDateOfBirthDate);
$("#cwuDateOfBirthSelectorHdn").val(concatenateCWUDateOfBirthDate);});$(".cwuDateOfBirth").find("#cwuDateOfBirthDate").datepicker("option",{dateFormat:"dd/mm/yy",maxDate:"-18Y",minDate:"-80Y"});$(".cwuDateOfBirthDatePicker").find(".cwuDateOfBirth").css("width","100%");LBG.validateClubWealthUpgrade.F056V002PreviousButtonHandling();},F056V002PreviousButtonHandling:function(){if($(document).find(".F056UpgradeClarificationRadioButton").length!=0){LBG.validateClubWealthUpgrade.handleYourDetailsSection();LBG.validateClubWealthUpgrade.defaultDateSelectionLoader();}},handleYourDetailsSection:function(){var isAllChecked=true;if($(".F056RadioButton:radio:checked").length!=5){return;}var provAdviceValue=$("input:radio[name=provAdvice]:checked").val();var bankingNeedsValue=$("input:radio[name=bankingNeeds]:checked").val();var reviewBenefitsValue=$("input:radio[name=reviewBenefits]:checked").val();var insuranceBenefitsValue=$("input:radio[name=insuranceBenefits]:checked").val();var rightSupportValue=$("input:radio[name=rightSupport]:checked").val();if(provAdviceValue==="Yes"&&bankingNeedsValue==="No"&&reviewBenefitsValue==="No"&&insuranceBenefitsValue==="No"&&rightSupportValue==="No"){$(".F056OptionsError").html("");$(".customerDetailsDiv").css("display","block");$(".primaryAction").css("display","block");}else{$(".F056OptionsError").html("<div class='formSubmitError' role='alert'>Based on your responses to the above question we are unable to proceed with this online application to add Club Lloyds to your account. Please contact your Private Banking and Advice Manager to fully discuss your needs.Alternatively, please contact us on 0345 300 2750. Lines are open Monday to Friday from 09:00 to 17:00 (Tuesday and Thursday until 19:00) and Saturday from 09:00 to 13:00. Excluding Bank Holidays. Calls may be recorded for monitoring and costs may vary depending on your service provider.</div>");$(".customerDetailsDiv").css("display","none");$(".primaryAction").css("display","none");}},setRadioButtonValues:function(radioName){var radioVal=$(".F056UpgradeClarificationRadioButton").find("[type=radio][name="+radioName+"]:checked").val();$("#"+radioName+"Hdn").val(radioVal);},defaultDateSelectionLoader:function(){var $dobField=$(".F056HiddenValues").find("#cwuDateOfBirthSelectorHdn");if($dobField.val()!=undefined&&$dobField.val()!=null&&$dobField.val()!=""){var dobArray=$dobField.val().split("/");var $dateYear=$(".cwuDateOfBirth").find(".slctYear");var $dateMonth=$(".cwuDateOfBirth").find(".slctMonth");var $dateDay=$(".cwuDateOfBirth").find(".slctDay");$("#cwuDateOfBirthDate").val($dobField.val());$dateYear.val(dobArray[2]);$dateMonth.val(dobArray[1]);$dateDay.val(dobArray[0]);}}};LBG.gformsCheckedReasons={init:function(){$(".reasonPorting").find(":checkbox").change(function(){if($(".reasonPorting").find(":checkbox").is(":checked")){$(".newMortgageNumber").show();}else{$(".newMortgageNumber").hide();}});}};LBG.errorMessagesAccessibilityIssue={init:function(){$(".infoMessageInner").find("p").each(function(){$(this).attr("aria-live","assertive");});$("#frmCanNotSuppress:tblAccountDetailsListUnsuccessfull tr:not(:first)").each(function(){$(this).find("td:not(:first-child)").each(function(){$(this).attr("aria-live","assertive");});});}};LBG.mcaCheckboxAccessible={init:function(){var confirmCheckboxATP=document.querySelector("[id$=confirmCheckboxATP]");if(confirmCheckboxATP){(document.attachEvent)?confirmCheckboxATP.attachEvent("onclick",function(){checkATP();}):confirmCheckboxATP.addEventListener("click",function(){checkATP();},false);}function checkATP(){if(confirmCheckboxATP.checked){$('[id$="confirmCheckboxATP"]').blur();document.querySelector("[id$=confirmCheckboxATP]").focus();$(":checkbox").attr("aria-checked","true");$(":checkbox").attr("aria-label","checkbox");$(":checkbox").attr("role","checkbox");}else{$('[id$="confirmCheckboxATP"]').blur();document.querySelector("[id$=confirmCheckboxATP]").focus();$(":checkbox").attr("aria-checked","false");$(":checkbox").attr("aria-label","checkbox");$(":checkbox").attr("role","checkbox");}}}};$(document).ready(function(){LBG.compareSavingsSelect.init();LBG.common.identJS();LBG.accordion.addOpenClass();LBG.oracleWebChatIssue.init();LBG.quickTransfer.init();LBG.mcaCheckboxAccessible.init();$("input[type=radio]").fixRadioChange();$(".preventDefault").click(function(e){e.preventDefault();});LBG.OTMalert.init();LBG.carPriceDepositCalc.init();LBG.carPriceDepositCalc.performDepositCalculation();LBG.miniStatement.init();LBG.scottishWidows.init();LBG.accordion.init();LBG.showHide.init();LBG.datePicker.init();LBG.help.init();LBG.ajaxPoweredAddressFinder.init();LBG.compareSelection.init();LBG.textAlerts.init();LBG.common.getNewWindowLinks();LBG.common.getNewWindowContinueActionLinks();LBG.common.tabbingInsideElem("#overlay");LBG.common.getPrintLinks();LBG.common.getHighlightElements();LBG.common.replaceLongStrings();LBG.selectHybrid.init();LBG.employmentShowHide.init();LBG.manageTransfers.init();LBG.linkedRadioAndTextFields.init();LBG.linkedSelectAndTextFields.init();LBG.linkedCheckBoxAndTextFields.init();LBG.linkedTextFieldAndCheckBox.init();LBG.converter.init();LBG.enhanceOverdraftDetails.init();LBG.autoTotal.init();LBG.beneficiariesChooser.init();LBG.submitOnChange.init();LBG.tableSorter.init();LBG.previousAddressRepeater.init();LBG.initAddressRepeaters.init();LBG.paymentCalculator.init();LBG.accountSwitcher.init();LBG.balanceTransfer.init();LBG.enrichedSelects();LBG.businessOverdraft();LBG.disableQuoteTabsOnLoad.init();LBG.statusToggle.init();LBG.scrollable.init();LBG.autoSelectRadioButton.init();LBG.setupPasscode.init();LBG.setupTextAlertsDailyFrequency();LBG.toggleFrequencyTerm.init();LBG.leapYearDayAdjust.init();LBG.successFadeOutDelay.init();LBG.warningFadeOutDelay.init();LBG.setFocus.init();LBG.rememberMe.init();LBG.internationalPayment.init();LBG.toggleRecipientAccount.init();LBG.toggleBankRouting.init();LBG.contentScrollerTabIndex();LBG.expandSelect.init();LBG.timedLogout.init();LBG.investmentsExpandingTable.init();LBG.expandingTableByLink.init();LBG.loanExpandingTable.init();LBG.accountStatementTableExpandPolicy.init();LBG.ticker.init();LBG.investmentsFund.init();LBG.ajaxFormContentLoader.init();LBG.dbtSetupModules.init();LBG.jumpList.init();LBG.ajaxLink.init();LBG.tabs.init();LBG.calculateFundAllocations();LBG.flashEmbed.init();LBG.doNotUpdateEmail.init();LBG.managePaperStatements();LBG.fixedHeadingHeight.init();LBG.youngSaverSTP.init();LBG.addressFinder.init();LBG.formAutoSubmit.init();LBG.alternateImageSrc();LBG.ajaxLoader.init();LBG.clearValuesOnHide.init();LBG.stpLoanCalculatorSlider.init();LBG.filterBy.init();LBG.radioButtonPanel.init();LBG.yourInbox.init();LBG.optionPanelDisable.init();LBG.checkboxSelectAll.init();LBG.preventPaste.init();LBG.branchFinder.init();LBG.beneficaryReference.init();LBG.isaTopUpReference.init();LBG.isaOvelay1Ref.init();LBG.isaOvelay2Ref.init();LBG.showMeOrientation.init();LBG.fatcaNationality.init();LBG.multichannel.init();LBG.avaRadioButtons.init();LBG.iadaUtilities.init();LBG.ajaxPoweredBankFinder.init();LBG.vefTable.init();LBG.appointmentBookings.init();LBG.oabShowHidePropertyBox.init();LBG.oabShowHideEmailPhoneReminderBoxes.init();LBG.oabSearchSelectBranchBoxes.init();LBG.LinkDropDownToToolTip_Hrefs.init();LBG.jsPrintButton.init();LBG.loanServicing.init();LBG.showNextOnChange.init();LBG.travelFlags.init();LBG.fixedTermDepositReinvestDropDown.init();LBG.dateShortcut.init();LBG.eloanUtils.init();LBG.altOverlay.init();
LBG.marmaladePhaseTwo.init();LBG.textNoSpace.init();LBG.iban.init();LBG.lostAndStolen.init();LBG.cssFixUtilities.init();LBG.browserSniffer.init();LBG.wtError.init();LBG.loans.init();LBG.inTNGA.init();LBG.selectAccountNew.init();LBG.ajaxSelect.init();LBG.emailModule.init();LBG.enableCheckbox.init();LBG.MiData.init();LBG.countryLookup.init();LBG.siblingVerticalCentering.init();LBG.IEemptyCells.init();LBG.appBanner.init();LBG.procedureIndicator.init();LBG.addRemoveRowsLRA.init();LBG.numericInputSupport.init();LBG.residentialStatusLRA.init();LBG.tsfTabs.init();LBG.tooltipNoID.init();LBG.showHidePanel.init();LBG.equalWidth.init();LBG.panelContentShowHide.init();LBG.sliderInputProgress.init();LBG.carFinanceTable.init();LBG.focusOnPageLoad.init();LBG.confimSavingsPayment.init();LBG.CommercialRBBSCardDetails.init();LBG.osrValidation.init();LBG.newWindow.init();LBG.statements.init();Autobinder.bind();LBG.inputKeyboard.init();LBG.clickableAreaForCheckbox.init();LBG.progressiveRevealForm.init();LBG.OPSSummaryData.init();LBG.RetailBaselinePJB();LBG.RetailBaselineCRS();LBG.VulnerableCustomers();LBG.unsecuredLoan.init();LBG.carDetailsDropDowns.init();LBG.filterList.init();LBG.dealerDetails.init();LBG.colleagueBar.init();LBG.penniesForPudsey();LBG.penniesForPudseyTCOverlayFocus();LBG.multiLevelAddressPanel();LBG.autoLogoutApp.init();LBG.mobile.init();LBG.lostStolenCheckbox.init();LBG.addInfoGenericLink.init();LBG.readAriaLabel.init();LBG.savingsCustomerSegmentedPricing.init();if($(".countdown").length>0){LBG.olympicCountdown.init($(".countdown"));}LBG.iccForm.init();LBG.iccForm.resetRadioPanal();LBG.gFormsPostCodeFinder.init();LBG.gFormsSortCodeFinder.init();LBG.gformCertOfInterest.init();LBG.gFormsClearExpiryDate.init();LBG.gformsConcatSortcode.init();LBG.gformsTransferExtractTitles.init();LBG.GformsSmsEmailUpdates.init();LBG.GformsEmailSmsVisibilityControl.init();LBG.GformsEmailSmsStateControl.init();LBG.GformsTitleSelection.init();LBG.GformsTokens.init();LBG.SortcodeTabHandeller.init();LBG.gFormssortcodeAccountNumberValidation.init();LBG.gFormsOnlyNumeric.init();LBG.gFormsSmoothScroll.init();LBG.gFormsDisplayFixedOr32gbp.init();LBG.gformsCalculateFixedTermDeposit.init();LBG.gforms32DayGPBCalculateReturn.init();LBG.gFormsCalendarDays.init();LBG.gFormsCreditCardNumberValidation.init();LBG.gFormsCalculateMonthlyPersonalNet.init();LBG.gFormsGenerateLoanReasonString.init();LBG.gFormsGetTotalMonths.init();LBG.gformsBusinessAddressControl.init();LBG.gFormsGetBusinessDate.init();LBG.gFormsConcatDate.init();LBG.gformsConcatenateReasonForLoan.init();LBG.gformsCheckboxStateToHiddenField.init();LBG.gformsTextboxStateToHiddenField.init();LBG.gformsresetInputsOnSelect.init();LBG.gFormsPopulatePostCodeDetails.init();LBG.gFormsPopulateHiddenAppointmentTime.init();LBG.gformsGetTermInMonths.init();LBG.gformsToggleOtherField.init();LBG.gFormsCheckInitiateAppAttr.init();LBG.gformsRadioValueToHiddenF044.init();LBG.showWithCheckBox.init();LBG.gFormsRibtForm42.init();LBG.overrideFocusIE11.init();LBG.promoboxImage.init();LBG.enhancedPaperlessInterstitial.init();LBG.makeTransferChooseAmount.init();LBG.ariaTagMISelect.init();LBG.overdraftFields.init();LBG.addInfoPersonalDetails.init();LBG.tabStateInbox.init();LBG.removeQuestionAddInfoAccessibility.init();LBG.gFormsDeselectOthers.init();LBG.ariaUpgradeAcc.init();LBG.noCalendarFocus.init();LBG.labelPlannedOverdraft.init();LBG.errorMessagesAccessibilityIssue.init();LBG.gformsCheckEmailTemplate.init();LBG.gFormsGenerateCustomerEmailString.init();LBG.gFormsBuildTEFields.init();LBG.gformsTransferExtractStringBuild.init();LBG.businessAppointmentDateSelect.init();LBG.validateClubWealthUpgrade.init();LBG.appointmentDateSelect.init();LBG.gformsCheckedReasons.init();$("#frmChangeDet input[id^='frmChangeDet:Remove']").attr("aria-label","Remove Additional nationality");$("#frmChangeDet a[id^='frmChangeDet:removeTaxResidency']").attr("aria-label","Remove Additional country of tax residency");$("#frmChangeDet").bind("DOMSubtreeModified",function(){if($(".formSubmitError").length){$(".formSubmitError").focus();}});$("body").click(function(event){if(event.altKey){if("console" in window){}}});$("#morepersonaldetails [name$=emplymentStatus]").change(function(){var selVal=$(this).val().trim().toLowerCase();if(selVal==="employed"||selVal==="employed part time"||selVal==="self employed"){$(".timeWithEmployer").parents(".fieldHelp").removeClass("hideJS");}else{$(".timeWithEmployer").parents(".fieldHelp").addClass("hideJS");}});var collectTravelMoney=$(".collectTravelMoney");collectTravelMoney.find(".radioGroup input:radio").change(function(e){var searchText=$("input[name='branchSearchText']",collectTravelMoney).val();var selectedLabel=$(this).next().text().trim();if(selectedLabel!=""){$(this).parents(".formField").next().find(".postit").text(searchText+" "+selectedLabel);}});$(".accessibleTabs").attr("role","tablist");$(".accessibleTabs li.current").attr({"role":"tab","aria-selected":"true","tabindex":"0"}).find(".tabInner").append("<span class='postit'>Selected</span>");$(".accessibleTabs li").not(".current").find("a").attr({"role":"tab","aria-selected":"false"});$(".accessibleTabs a").bind("keydown",function(event){var keyCode=$.ui.keyCode;if(event.keyCode==keyCode.SPACE){window.location=$(this).attr("href");}});var lastRadioBtn=$(".pat-702").find('input[type="radio"]:last');var calandarIcon=$(".pat-702 img.ui-datepicker-trigger").parent("a");$(".pat-702 img.ui-datepicker-trigger").parent("a").after('<span class="dummyicon">'+calandarIcon.html()+"</span>");$(".pat-702 .dummyicon img").attr("src",DI.themePath+"img/icons/budgeting_calendar.png");if(!lastRadioBtn.is(":checked")){lastRadioBtn.parent().find("select").attr("disabled",true);$(".pat-702 .dummyicon").css("display","inline");calandarIcon.hide();}$('.pat-702 input[type="radio"]').bind("change",function(e){if(lastRadioBtn.is(":checked")){$(this).parent().find("select").attr("disabled",false);$(".pat-702 .dummyicon").hide();calandarIcon.css("display","inline");}else{$(this).parents("li").next().find("select").attr("disabled",true);$(".pat-702 .dummyicon").css("display","inline");calandarIcon.hide();}});$(".m-hf-02-customer-bar div.m-hf-02-name .nav-title span.m-hf-02-name a:first").attr("role","presentation");$(".m-hf-02-customer-bar div.m-hf-02-name .nav-title span.m-hf-02-logged-in a:first").attr("role","region");});$(window).load(function(){LBG.overlay.init();LBG.equalisePanelHeights.init();LBG.flashLink.init();LBG.vcErrorAccessibility.init();});(function(){$(function(){if(!$("body").hasClass("isTabletInBranch")){return;}$(".cxtTrigger").click(function(e){var zIndex=(!$(this).hasClass("active"))?1:2;$("header.colleague").css("z-index",zIndex);});});})();(function(){$(function(){if($("body").hasClass("isTabletInBranch")){setTimeout(showHideColleagueBarTabContentForTiB,1100);}function showHideColleagueBarTabContentForTiB(){var showHideDiv=$(".m-513-colleague-header .clg-top-header .cgb-opaque");$(".m-513-colleague-header ul.clg-nav-links li a.link").live("click",function(){if($(showHideDiv).attr("aria-hidden")=="true"){$(showHideDiv).addClass("hideDivContainer").removeClass("showDivContainer").fadeIn(2000);}if($(showHideDiv).attr("aria-hidden")=="false"){$(showHideDiv).removeClass("hideDivContainer").addClass("showDivContainer").fadeIn(2000);}});}});})();LBG.accessibilityFixPCCDC={init:function(){if($("div.panelWrap").hasClass("pccdc_journey")){$(".pccdc_journey p.steps>strong").attr("tabindex",0).focus();$(".pccdc_journey .status_icon h2").parent("div").removeAttr("role").removeAttr("aria-label").prepend("<img alt='Image - Success Icon' style='top: -1000px; position: absolute;' />");
$(".pccdc_journey .status_icon h2").attr("tabindex",0);$(".pccdc_journey .status_icon.failure_page>div").removeAttr("role").removeAttr("aria-label").prepend("<img alt='Image - Failure Icon' style='top: -1000px; position: absolute;' />").find("h1").attr("tabindex",0).focus();$("#wrapper").prepend('<div class="skiplinkswpr"><div class="m-container"><div class="skiplinks"><a href="#ifCommercial:ifCustomerBar:outputLinkNavHome" class="skiplink">Jump to site navigation</a></div></div></div>');}if($("h1:contains('Step 1 of 3: Make a payment to your credit card')").length){$("#wrapper").prepend('<div class="skiplinkswpr"><div class="m-container"><div class="skiplinks"><a href="#ifCommercial:ifCustomerBar:outputLinkNavHome" class="skiplink">Jump to site navigation</a></div></div></div>');}else{$("div.formSubmitError:first").attr("tabindex",0).focus().attr("tabindex",-1);}if($(".formSubmitError").length==0){$("h1:contains('Step 1 of 3: Make a payment to your credit card')").attr("tabindex",0).focus();}$(".pccdc_journey .failure_info ul").prev().addClass("noMarginBottom");var bindEvent=true;$(".amountFieldAmount").bind("blur",function(){if($(".amountField").hasClass("error")&&bindEvent){$("span.error").attr("tabindex",0).focus();}});$(".submitAction").click(function(){if($(".amountField").hasClass("error")){$("span.error").attr("tabindex",0).focus();}});$(".amountFieldAmount").keydown(function(event){if(event.shiftKey&&event.keyCode==9){bindEvent=false;}else{if(event.keyCode==9){bindEvent=true;}}});$(".amountGroup").find("input[type='radio']").each(function(){var checkDisabled=$(this).attr("disabled");if(checkDisabled){$(this).attr("aria-label","Radio button disabled");}});function changeTextfieldStatus(){if($("input.amountFieldAmount").attr("disabled")){$("input.amountFieldAmount").attr("title","Amount Field - Disabled");}else{$("input.amountFieldAmount").attr("title","Amount Field");}}changeTextfieldStatus();$(".amountGroup").find("input[type='radio']").change(function(){changeTextfieldStatus();});if($("#fromUnActCC, #frmccpaperless, #frnactsuccess").length){$(".primaryWrap").addClass("activate_creditcard");}if($("#frmActivation, #frmCreditpaperless, #frmCreditcardActv").length){$(".primaryWrap").addClass("activate_creditcard_auth");}if($("#frmEnterDirectDebitDetails").length){$(".primaryWrap").addClass("set_up_dd");}if($("#frmCCActEnterDirectDebDetails").length){$("#ccnolloyds").attr("id","nolloyds");}if($("form#fromUnActCC").length){$(".pageWrap").addClass("unAuthActivateCreditCard");$("#footer").addClass("unAuthActivateCreditCardFooter");}}};$(window).load(function(){LBG.accessibilityFixPCCDC.init();});LBG.SPPATAccordion=new Class(".sp-pat-accordion-a",{init:function(element){element.attr("role","tablist");var mobileType="";var userAgent=navigator.userAgent||navigator.vendor||window.opera;if(/android/i.test(userAgent)){mobileType="Android";}else{if(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream){mobileType="iOS";}}var titles=$("> .sp-pat-accordion-a-title, .subHead",element);var contents=$("> .sp-pat-accordion-a-content, .showHideAccordion",element);var expandedAttributes={"aria-expanded":"false","aria-selected":"false"};var collapsedAttributes={"aria-expanded":"true","aria-selected":"true"};var roleTab={"role":"tab"};var roleTabpanel={"role":"tabpanel"};var hiddenTrue={"aria-hidden":"true"};var hiddenFalse={"aria-hidden":"false"};if(element.hasClass("m-825-d-products-and-services sp-pat-accordion-a accordion-dark need-javascript")){titles=$(".sp-pat-accordion-a-title, .subHead",element);contents=$(".sp-pat-accordion-a-content, .showHideAccordion",element);contents.each(function(){$(this).find("a").first().removeAttr("title");});}contents.hide();$(".m-featured-content").show();for(var i=0;i<titles.length;i++){var titleText=$(titles[i]).find("a").text();var isAttr=$(titles[i]).find("a").attr("title");if(isAttr===undefined){$(titles[i]).find("a").attr("title",titleText);}if($(titles[i]).hasClass("sp-pat-accordion-a-opened")){if(mobileType==="Android"){$(titles[i]).find("a").attr("aria-label","Expanded.Click to hide");}$(titles[i]).find("a").attr(collapsedAttributes).attr(roleTab);$(titles[i]).next().attr(hiddenFalse).attr(roleTabpanel).show();}else{if(mobileType==="Android"){$(titles[i]).find("a").attr("aria-label","Collapsed.Click to expand");}$(titles[i]).find("a").attr(expandedAttributes).attr(roleTab);$(titles[i]).next().attr(hiddenTrue).attr(roleTabpanel);}}titles.click(function(event){event.preventDefault();hideShowAccordion(this,titles,contents);});titles.click("keydown",function(event){var keyCode=$.ui.keyCode;if(event.keyCode==keyCode.SPACE){event.preventDefault();hideShowAccordion(this,titles,contents);}});hideShowAccordion=function(elem,titles,contents){var index=titles.index(elem);if($(elem).hasClass("sp-pat-accordion-a-opened")){$(elem).removeClass("sp-pat-accordion-a-opened").find("a").attr(expandedAttributes);if(mobileType==="Android"){$(elem).removeClass("sp-pat-accordion-a-opened").find("a").attr("aria-label","Collapsed.Click to expand");}$(elem).next().attr(hiddenTrue).attr("aria-live","off");contents.eq(index).slideUp();element.trigger("accordion-closed");}else{$(titles).removeClass("sp-pat-accordion-a-opened").find("a").removeAttr("aria-selected","aria-expanded").attr(expandedAttributes);contents.slideUp().attr(hiddenTrue).attr("aria-live","off");$(elem).addClass("sp-pat-accordion-a-opened").find("a").attr(collapsedAttributes);if(mobileType==="Android"){$(elem).addClass("sp-pat-accordion-a-opened").find("a").attr("aria-label","Expanded.Click to hide");$(titles).not($(elem)).find("a").attr("aria-label","Collapsed.Click to expand");}$(elem).next().attr(hiddenFalse).attr("aria-live","polite");contents.eq(index).slideDown();element.trigger("accordion-open");}};}});LBG.SPPatTabs=new Class(".sp-pat-tabs",{init:function(element){var $this=element;var container=$(".sp-pat-tabs-container",$this);var listitems=$("> li",container);listitems.addClass("sp-pat-tabs-"+listitems.length+"-col");container.css({visibility:"visible"});if($this.hasClass("sp-pat-tabs-switchable")){var contentitems=$this.find(".sp-pat-tabs-content");var contentitemsIndex=$this.find(".sp-pat-tabs-content").index();var contentItemWrapper=listitems.filter(".selected");var contentindex=listitems.filter(".selected").index();contentitems.hide();contentitems.eq(0).show();contentitems.eq(contentindex).show();listitems.click(function(e){e.preventDefault();var listItemIndex=$(this).parent("ul").find("li").index(this);listitems.removeClass("selected");$(this).addClass("selected");contentitems.hide();contentitems.eq(listItemIndex).show();contentitems.eq(listItemIndex).focus();});}}});LBG.smrboxBorderChange={singleBuisness:true,init:function(){if($("div").hasClass(".savings-product-placeholder")&&$("div").hasClass(".smrboxparent")){this.singleBuisness=false;}},applyBorder:function(){if($("div.inner").hasClass(".smrboxparent")){var smrboxParent=($(".smrboxparent").children())[0];if(smrboxParent){var smrboxParentChildren=$.makeArray(smrboxParent.children);var smrboxContainer=document.createElement("div");var smrboxDeclContainer=document.createElement("div");smrboxContainer.setAttribute("id","smrbox");smrboxDeclContainer.setAttribute("id","smrboxdecl");for(i=0;i<4;i++){smrboxParent.appendChild(smrboxParentChildren[i]);}for(i=4;i<30;i++){smrboxContainer.appendChild(smrboxParentChildren[i]);}smrboxParent.appendChild(smrboxContainer);smrboxDeclContainer.appendChild(smrboxParentChildren[30]);smrboxParent.appendChild(smrboxDeclContainer);
smrboxParent.appendChild(smrboxParentChildren[31]);smrboxParent.appendChild(smrboxParentChildren[32]);}}},};$(document).ready(function(){LBG.smrboxBorderChange.init();if(LBG.smrboxBorderChange.singleBuisness){LBG.smrboxBorderChange.applyBorder();}});$(document).ready(function(){if($(".pageWrap").find(".DDIC_journey").length){$(".waysToPayBtn").each(function(){var buttonText=$(this).text().trim().length;if(!buttonText){$(this).parent().remove();}});if($(".DDIC_journey").find(".DDIC_success").length){$("div.DDIC_journey").find("h1").attr("tabindex",0).parent("div.DDIC_success").prepend("<img alt='Image - Success Icon' style='top: -1000px; position: absolute;' />");}else{if($(".DDIC_journey").find(".DDIC_pending").length){$("div.DDIC_journey").find("h1").attr("tabindex",0).parent("div.DDIC_pending").prepend("<img alt='Image - Pending Icon' style='top: -1000px; position: absolute;' />");}}}else{if(!$(".DDIC_journey").length&&$(".DDIC_details").length){$("div.primary").addClass("DDIC_journey");}}if($("div.panelWrap").find("form#frmEnterDirectDebitDetails, form#frmAmendDirectDebitDetails, form#frmCCActEnterDirectDebDetails").length){if($("div.fixedAmount").css("display")=="block"){$("div.fixedAmount").hide();}if($("div.fixedPercentage").css("display")=="block"){$("div.fixedPercentage").hide();}}});var AttroneyPoa=new Class(".m-hf-02-customer-bar-poa",{init:function(element){if($.browser.ie){document.createElement("header");}var navbar=element,itemContainer=navbar.find(".m-hf-02-nav"),lis=navbar.find("li.m-hf-02-tab__poa"),areas=lis.find(".nav-content-poa"),styleTag1,className="m-hf-02-customer-bar-1",itemContainerHeight=0,customerBarMenuPollingRate=500;var mobileType="";var userAgent=navigator.userAgent||navigator.vendor||window.opera;if(/android/i.test(userAgent)){mobileType="Android";}else{if(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream){mobileType="iOS";}}$(".nav-title-poa").find("a[role='tab']").each(function(){if(!$(this).parents("li").hasClass("selected")){$(this).attr("aria-expanded","false");if(mobileType==="Android"){$(this).attr("aria-label","Collapsed.Click to expand");}}});$(".m-hf-02-customer-bar-poa div.m-hf-02-name .nav-title-poa span.m-hf-02-name a:first").attr("role","region");$(".m-hf-02-customer-bar-poa div.m-hf-02-name .nav-title-poa span.m-hf-02-logged-in a:first").attr("role","region");itemContainer.find(".sub-nav-toggle").click(function(e){e.preventDefault();var parent=$(this).parents("li");if(parent.hasClass("selected")){$(this).attr("aria-expanded",false);parent.removeClass("selected");if(mobileType==="Android"){$(this).attr("aria-label","Collapsed.Click to expand");}parent.find(".mobile-sub-nav").slideUp().attr("aria-hidden",true);}else{$(this).attr("aria-expanded",true);if(mobileType==="Android"){$(this).attr("aria-label","Expanded.Click to hide");}parent.addClass("selected");parent.find(".mobile-sub-nav").slideDown().attr("aria-hidden",false);}});navbar.addClass(className);var accountsLink=lis.find("a");accountsLink.bind("click",function(e){e.preventDefault();if(!lis.find("a").hasClass("loading-content")){var $this=$(this);var li=$this.parents("li");var index=lis.index(li);if(index>0){return;}var url=$this.attr("data-ajax-uri");showTab(index);LBG.isAnimating=true;if(li.hasClass("selected")){loadContent(index,url);}}});if(!LBG.isMobile){window.setInterval(customerBarMenuAdjustment,customerBarMenuPollingRate);}var navContent=$(".nav-content-poa");var navItems=$(".nav-title-poa a");function customerBarMenuAdjustment(){var depth=0;navItems.filter(":visible").each(function(){depth=Math.max(depth,$(this).position().top+$(this).height());});navContent.css("top",depth);}function showTab(index){var li=lis.eq(index);var anchor=li.find(".nav-title-poa a");if(li.hasClass("selected")){itemContainer.removeClass("open");lis.removeClass("selected");setHeights(false,index);anchor.attr("aria-expanded",false);if(mobileType==="Android"){anchor.attr("aria-label","Collapsed. Click to expand");}}else{lis.removeClass("selected");itemContainer.addClass("open");li.addClass("selected");setHeights(index);anchor.attr("aria-expanded",true);if(mobileType==="Android"){anchor.attr("aria-label","Expanded. Click to hide");}}}function setHeights(index,closingindex){if(typeof LBG.animationComplete!=="undefined"){LBG.animationComplete(750);}itemContainerHeight=itemContainerHeight||itemContainer.height();if(index===false||!lis.eq(index).hasClass("selected")){if(Modernizr.cssanimations){$(styleTag1).remove();}else{navbar.animate({height:50},750,function(){areas.eq(closingindex).css("visibility","hidden");});}areas.eq(closingindex).attr("aria-hidden",true).hide();return;}var height=areas.eq(index).height();height+=itemContainerHeight;if(Modernizr.cssanimations){var styleTag3=$("<style>"+".m-hf-02-customer-bar-1 .m-hf-02-nav {"+"height:"+height+"px !important"+"}"+"</style>");styleTag3.appendTo("body");if(styleTag1){$(styleTag1).remove();}styleTag1=styleTag3;}else{navbar.animate({height:height},750);areas.css("visibility","hidden");areas.eq(index).css("visibility","visible");}areas.eq(index).attr("aria-hidden",false);$.each(areas,function(){$(this).hide();});areas.eq(index).attr("aria-hidden",false).show();}function setMaxItems(area,max,index){var viewMoreEl=$(".mobile-view-more");var elements=area.find("ul").eq(0).children("li");if(elements.length<=max){return;}function truncateAccounts(){for(var i=max;i<elements.length;i++){elements.eq(i).addClass("hide-mobile");}viewMoreEl.removeClass("hide-mobile");}truncateAccounts();$(document.body).bind("MobileMenuClosed",function(){truncateAccounts();});}function loadContent(index,url){var li=lis.eq(index);var area=areas.eq(index);if(area.data("ajax-loaded")){return;}if(Modernizr.cssanimations){area.addClass("loading");navbar.addClass("loading");area.removeClass("fade-out").addClass("fade-in");}else{navbar.addClass("loading");navbar.animate({height:260},750);}li.find("a").addClass("loading-content");$.ajax({url:url,dataType:"html",cache:false,success:function(response){li.find("a").removeClass("loading-content");if(response!==""){area.html(response);if(area.attr("data-max-items")){setMaxItems(area,area.attr("data-max-items"),index);}var coserviced=$(".m-hf-02-your-accounts .coserviced",area);var accounts=$(".m-hf-02-your-accounts li",area);if(LBG.ieVersion>0&&LBG.ieVersion<7){accounts.find("> div > div").each(function(index){$(this).addClass("ie6-your-accounts-arrow-right");});}var rowItems=4;for(var i=0,j=accounts.length;i<j;i+=rowItems){$row=accounts.slice(i,i+rowItems);$row.find(">div>div").matchHeight(true);}var placeholders=$(".m-hf-02-your-accounts .placeholder",area);if(placeholders){var placeholder_height=$(placeholders[0]).parent("li").prev().find("> div").outerHeight(true);placeholders.height(placeholder_height);}var view_all=$(".m-hf-02-your-accounts .view-all",area);if(view_all){var view_all_height=$(view_all).parent("li").prev().find("> div").outerHeight(true);view_all.height(view_all_height);var view_all_link=view_all.find("> div");view_all_link.css({paddingTop:(view_all_height-view_all_link.outerHeight())/2});}if(area.find("> div").hasClass("error")){area.addClass("error");lis.eq(index).addClass("error");}else{area.removeClass("error");lis.eq(index).removeClass("error");}if(area.find("[data-wt-ac]").length>0){Autobinder.bind();}if((!LBG.isMobile&&!$.browser.safari)||$.fn.jquery=="1.3.2"){setTimeout(function(){area.css("height",area.height());},0);}area.data("ajax-loaded",true);area.removeClass("loading");navbar.removeClass("loading");
area.addClass("content-loaded");setHeights(index);}},error:function(){area.html(DI.lang.customerBar.ajaxError);area.addClass("error");area.removeClass("loading").removeClass("fade-in");area.addClass("content-loaded");navbar.removeClass("loading");li.addClass("error");setHeights(index);li.find("a").removeClass("loading-content");}});}}});var LBG=window.LBG||{};LBG.tags={ajax:{ajaxActions:[],addAjaxAction:function(id,target,source,event,type,href,params,paramsfields,onstart,onerror,oncomplete,replace,fade,spinner,disabledSrc,onsuccess,onfadedone){LBG.tags.ajax.ajaxActions.push({"id":id,"target":target,"source":source,"event":event,"type":type,"href":href,"params":params,"paramsfields":paramsfields,"onstart":onstart,"onerror":onerror,"oncomplete":oncomplete,"replace":replace,"fade":fade,"spinner":spinner,"disabledSrc":disabledSrc,"onsuccess":onsuccess,"onfadedone":onfadedone});},getAjaxAction:function(id){var actions=LBG.tags.ajax.ajaxActions;if(actions.length>0){for(var i=0,l=actions.length;i<l;i++){var aa=actions[i];if(aa.id===id){return aa;}}}return null;},getAjaxActionData:function(aa){var data,module,$module,$moduleInputs,inputVals=[];data=aa.id!=null?{"$aid":aa.id}:{};module=aa.target;$module=$(LBG.common.escapeSpecialCharsInId(module));$moduleDataCells=$module.find('table td:not(".first")');$moduleDataCells.each(function(){var isChecked;if($(this).find("input").length===1){var $thisInput=$(this).find("input");var thisInputId=$thisInput[0].id.split(":");isChecked=$thisInput.is(":checked");thisInputId=thisInputId[thisInputId.length-1];}else{isChecked=false;}inputVals.push(isChecked);});if(aa.type===2&&aa.params&&aa.paramsfields){var p=aa.params.split(",");var fp=aa.paramsfields.split(",");if(p.length==fp.length){for(var i=0;i<p.length;i++){var el=$(LBG.common.escapeSpecialCharsInId(fp[i]));if(el.length==0){data[p[i]]=fp[i];}else{if(el.parents(".formField").hasClass("error")){return -1;}if(el.is(":checkbox")){if(el.length==1){data[p[i]]=el.is(":checked");}else{if(!data[p[i]]){data[p[i]]=[];}el.each(function(){var id=el.attr("id").split(":");var target=data[p[i]];for(var e in id){if(id.hasOwnProperty(e)){if(!target[id[e]]){target[id[e]]=[];}target=target[id[e]];}}target=el.is(":checked");});}}else{data[p[i]]=el.val();}}}}}if(inputVals.length>0){data.checkedInputs=inputVals.join();}return data;},evalFunc:function(f){if(f){if(typeof f=="string"){eval(f);}else{f();}}},injectContent:function(aa,id,el,response){if(aa.fade!=true){if(aa.replace!=false){el.replaceWith(response);}else{el.html(response);}}else{el.fadeOut("slow",function(){if(aa.replace!=false){$(this).replaceWith($(response).hide());}else{$(this).html(response);}var e=$(id);var p;if(e.length==0&&(p=id.lastIndexOf(":"))>0){id=id.substring(p+1);e=$(LBG.common.escapeSpecialCharsInId(id));if(e.length==0){alert("Can't find element with id: "+id);}}e.fadeIn("slow",function(){LBG.tags.ajax.evalFunc(aa.onfadedone);});});}},ajaxActionHandler:function(event){var idx=event.data.idx;var aa=LBG.tags.ajax.ajaxActions[idx];var uri=LBG.common.ajax.tagUrl(aa.href);var id=LBG.common.escapeSpecialCharsInId(aa.target);var el=$(id);if(el.length==0){alert("Cannot find the target: "+aa.target+", element for the ajax call: "+uri);return;}var dat=LBG.tags.ajax.getAjaxActionData(aa);if(dat===-1){return;}var origImg;if(aa.disabledSrc){var sEl=$(LBG.common.escapeSpecialCharsInId(aa.source));origImg=sEl.attr("src");sEl.disabled=true;sEl.attr("src",aa.disabledSrc);}if(aa.spinner){$(LBG.common.escapeSpecialCharsInId(aa.spinner)).attr("style","display: block");}$.ajax({url:uri,data:dat,type:aa.type===1?"POST":"GET",success:function(response){var vh=LBG.Forms.Validation.Tools.getValidationHandlerObject(el);if(vh){var pel=el.parent();vh.removeChildren(el);LBG.tags.ajax.injectContent(aa,id,el,response);vh.hideError();vh.isValid=false;el=$(id);vh.findChildren(el.length==0?pel:el);}else{LBG.tags.ajax.injectContent(aa,id,el,response);}LBG.ajax.pageUpdated();LBG.tags.ajax.evalFunc(aa.onsuccess);},beforeSend:function(){LBG.tags.ajax.evalFunc(aa.onstart);},error:function(){LBG.tags.ajax.evalFunc(aa.onerror);},complete:function(){if(aa.spinner){$(LBG.common.escapeSpecialCharsInId(aa.spinner)).attr("style","display: none");}if(aa.disabledSrc){var sEl=$(LBG.common.escapeSpecialCharsInId(aa.source));sEl.disabled=false;sEl.attr("src",origImg);}LBG.tags.ajax.evalFunc(aa.oncomplete);}});return false;},init:function(){$(".ajaxAction").each(function(i,trigger){var jqEl=$(trigger);var meta=jqEl.metadata();LBG.tags.ajax.addAjaxAction(null,meta.target,jqEl.attr("id"),meta.event,2,meta.href,meta.params,meta.paramsfields,meta.onstart,meta.onerror,meta.oncomplete,meta.replace,meta.fade,meta.spinner,meta.disabledSrc,meta.onsuccess,meta.onfadedone);});var actions=LBG.tags.ajax.ajaxActions;if(actions.length>0){for(var i=0,l=actions.length;i<l;i++){var aa=actions[i];$(LBG.common.escapeSpecialCharsInId(aa.source)).bind(aa.event,{"idx":i},LBG.tags.ajax.ajaxActionHandler);}}}}};$(document).ready(function(){LBG.tags.ajax.init();});
/* dd: 2019-04-14__08-21-19 */
if(window["adrum-app-key"] != "AD-AAB-HCH-DUA" && window["adrum-app-key"] != "AD-AAB-HCH-DXS"){
	(function (exports) {
    "use strict";

    function getMetatagContent(name) {
        var elem = document.getElementsByName(name)[0];
        if (elem) {
            return elem.getAttribute('content');
        }
        return "";
    }

    exports.cdApi = {
        getCustomerSessionID: function (callback) {
            callback(getMetatagContent('dcconfsid'));
        },
        getCustomerConfigLocation: function (callback) {
            callback(getMetatagContent('wup_url'));
        }
    };
	})(self);
	
}/* version: 2.10.0.4882.9051aec7 Sun Mar 10 2019 15:48:20 */

new function a(){"use strict";var e,t,n,r,i,o,s,u,c,h,d,l,f,g,_,p,v,m,y,w,b,S,E,k,C,M,T,D,x,F,A,R,P,U,I,L,B,N,O,W,Q,H,q,z,j,V,Y,K,G,X,Z,J,$,ee,te,ne,ie,se,re,ae,oe,ue,ce,he,de,le,fe,ge,_e,pe,ve,me,ye,we,be,Se,Ee,ke,Ce,Me,Te,De,xe,Fe,Ae,Re,Pe,Ue,Ie,Le,Be,Ne,Oe,We,Qe,He,qe,ze,je,Ve,Ye,Ke,Ge,Xe,Ze,Je,$e,et,tt,nt,it,st,rt,at,ot,ut,ct,ht,dt,lt,ft,gt,_t,pt,vt,mt,yt,wt,bt,St,Et,kt,Ct,Mt,Tt,Dt,xt,Ft,At,Rt,Pt,Ut,It,Lt,Bt,Nt,Ot,Wt,Qt,Ht,qt,zt,jt,Vt,Yt,Kt,Gt,Xt,Zt,Jt,$t,en,tn,nn,sn,rn,an,on,un,cn,hn,dn,ln,fn,gn,_n,pn,vn=this,mn=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function wn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function bn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Sn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e=self,t=Date.now?Date.now():+new Date,n=e.performance||{},r=[],i={},o=function o(e,t){for(var n=0,i=r.length,s=[];n<i;n++)r[n][e]==t&&s.push(r[n]);return s},s=function s(e,t){for(var n,i=r.length;i--;)(n=r[i]).entryType!=e||void 0!==t&&n.name!=t||r.splice(i,1)},n.now||(n.now=n.webkitNow||n.mozNow||n.msNow||function(){return(Date.now?Date.now():+new Date)-t}),n.mark||(n.mark=n.webkitMark||function(e){var t={name:e,entryType:"mark",startTime:n.now(),duration:0};r.push(t),i[e]=t}),n.measure||(n.measure=n.webkitMeasure||function(e,t,n){t=i[t].startTime,n=i[n].startTime,r.push({name:e,entryType:"measure",startTime:t,duration:n-t})}),n.getEntriesByType||(n.getEntriesByType=n.webkitGetEntriesByType||function(e){return o("entryType",e)}),n.getEntriesByName||(n.getEntriesByName=n.webkitGetEntriesByName||function(e){return o("name",e)}),n.clearMarks||(n.clearMarks=n.webkitClearMarks||function(e){s("mark",e)}),n.clearMeasures||(n.clearMeasures=n.webkitClearMeasures||function(e){s("measure",e)}),e.performance=n,"function"==typeof define&&(define.amd||define.ajs)&&define("performance",[],function(){return n}),function(e){if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()){var s=Object.defineProperty;Object.defineProperty=function(e,t,n){if(s)try{return s(e,t,n)}catch(i){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in n&&Object.prototype.__defineGetter__.call(e,t,n.get),Object.prototype.__defineSetter__&&"set"in n&&Object.prototype.__defineSetter__.call(e,t,n.set),"value"in n&&(e[t]=n.value),e}}var t,u,n,i,c;"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(e,t){if(e!==Object(e))throw TypeError("Object.defineProperties called on non-object");var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&Object.defineProperty(e,n,t[n]);return e}),"function"!=typeof Object.create&&(Object.create=function(e,t){if("object"!==("undefined"==typeof e?"undefined":yn(e)))throw TypeError();function n(){}n.prototype=e;var i=new n;if(e&&(i.constructor=n),t!==undefined){if(t!==Object(t))throw TypeError();Object.defineProperties(i,t)}return i}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw TypeError("Object.keys called on non-object");var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,i;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),r=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(n=t),i=0;i<r;){var a;i in s&&(a=s[i],e.call(n,a,i,s)),i++}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw TypeError("Bind must be called on a function");var t=[].slice,n=t.call(arguments,1),i=this,s=function s(){return i.apply(this.prototype&&this instanceof r?this:e,n.concat(t.call(arguments)))};function r(){}return r.prototype=i.prototype,s.prototype=new r,s}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.from||(Array.from=(t=Object.prototype.toString,u=function u(e){return"function"==typeof e||"[object Function]"===t.call(e)},n=function n(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(0<t?1:-1)*Math.floor(Math.abs(t)):t},i=Math.pow(2,53)-1,c=function c(e){var t=n(e);return Math.min(Math.max(t,0),i)},function(e){var t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,i=1<arguments.length?arguments[1]:void undefined;if("undefined"!=typeof i){if(!u(i))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(n=arguments[2])}for(var s,r=c(t.length),a=u(this)?Object(new this(r)):new Array(r),o=0;o<r;)s=t[o],a[o]=i?"undefined"==typeof n?i(s,o):i.call(n,s,o):s,o+=1;return a.length=r,a})),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],s=0;s<n;){var r=t[s];if(e.call(i,r,s,t))return r;s++}return undefined},configurable:!0,writable:!0}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;for(var s,r,a=0|t,o=Math.max(0<=a?a:i-Math.abs(a),0);o<i;){if((s=n[o])===(r=e)||"number"==typeof s&&"number"==typeof r&&isNaN(s)&&isNaN(r))return!0;o++}return!1}}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])}return n},writable:!0,configurable:!0}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),self.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}(),function(e){if(!e.WeakMap){var s=Object.prototype.hasOwnProperty,r=function r(e,t,n){Object.defineProperty?Object.defineProperty(e,t,{configurable:!0,writable:!0,value:n}):e[t]=n};e.WeakMap=function(){function e(){if(void 0===this)throw new TypeError("Constructor WeakMap requires 'new'");if(r(this,"_id",function t(e){return e+"_"+n()+"."+n()}("_WeakMap")),0<arguments.length)throw new TypeError("WeakMap iterable is not supported")}function i(e,t){if(!a(e)||!s.call(e,"_id"))throw new TypeError(t+" method called on incompatible receiver "+("undefined"==typeof e?"undefined":yn(e)))}function n(){return Math.random().toString().substring(2)}return r(e.prototype,"delete",function(e){if(i(this,"delete"),!a(e))return!1;var t=e[this._id];return!(!t||t[0]!==e||(delete e[this._id],0))}),r(e.prototype,"get",function(e){if(i(this,"get"),a(e)){var t=e[this._id];return t&&t[0]===e?t[1]:void 0}}),r(e.prototype,"has",function(e){if(i(this,"has"),!a(e))return!1;var t=e[this._id];return!(!t||t[0]!==e)}),r(e.prototype,"set",function(e,t){if(i(this,"set"),!a(e))throw new TypeError("Invalid value used as weak map key");var n=e[this._id];return n&&n[0]===e?n[1]=t:r(e,this._id,[e,t]),this}),r(e,"_polyfill",!0),e}()}function a(e){return Object(e)===e}}("undefined"!=typeof self?self:"undefined"!=typeof window?window:undefined),u=vn,c=function(){function e(){Sn(this,e)}return mn(e,[{key:"create",value:function(e){var t=["(",e,")()"];if(window.Blob)return new window.Blob(t,{type:"application/javascript"});if(window.MSBlobBuilder){for(var n=new window.MSBlobBuilder,i=0;i<t.length;i++)n.append(t[i]);return n.getBlob("application/javascript")}throw new Error("Unable to create Blob. Neither Blob nor BlobBuilder are supported by the browser.")}}]),e}(),u.BlobFactory=c,h=vn,d=function(){function e(){Sn(this,e)}return mn(e,[{key:"create",value:function(e){var t=window.URL||window.webkitURL;if(t)return t.createObjectURL(e);throw new Error("Unable to create BlobUrl. Neither Url nor webkitUrl are supported by the browser")}}]),e}(),h.BlobUrlFactory=d,function(e){function t(){this._listeners=[]}e.CDEvent||(t.prototype={subscribe:function(e){this._listeners.push(e)},publish:function(e){for(var t=0,n=this._listeners.length;t<n;t++)this._listeners[t](e)},unsubscribe:function(e){for(var t=0,n=this._listeners.length;t<n;t++)if(e===this._listeners[t]){this._listeners.splice(t,1);break}}},e.CDEvent=t)}(vn),l=vn,f=function(){function e(){Sn(this,e),this._pairs=[],this.size=0}return mn(e,[{key:"has",value:function(e){return-1<this._indexOf(e)}},{key:"get",value:function(e){var t=this._indexOf(e);return-1<t?this._pairs[t][1]:undefined}},{key:"set",value:function(e,t){var n=this._indexOf(e);-1<n?this._pairs[n][1]=t:(this._pairs.push([e,t]),this.size++)}},{key:"delete",value:function(e){var t=this._indexOf(e);return-1<t&&(this._pairs.splice(t,1),this.size--,!0)}},{key:"forEach",value:function(e){for(var t=0;t<this._pairs.length;t++)e(this._pairs[t][1],this._pairs[t][0])}},{key:"clear",value:function(){this._pairs=[]}},{key:"_indexOf",value:function(e){for(var t=0;t<this._pairs.length;t++)if(this._pairs[t][0]===e)return t;return-1}}]),e}(),l.Map=self.Map||f,function(e){function t(e,t){this._portNativeWorker=e,this._useShared=t}t.prototype={start:function(){this._useShared&&this._portNativeWorker.port.start()},postMessage:function(){var e=this._portNativeWorker.port;this._useShared?e.postMessage.apply(e,arguments):this._portNativeWorker.postMessage.apply(this._portNativeWorker,arguments)},close:function(){this._useShared?this._portNativeWorker.port.close():this._portNativeWorker.terminate()},setonmessage:function(e){this._useShared?this._portNativeWorker.port.onmessage=e:this._portNativeWorker.onmessage=e}},e.CDPort=t}(vn),g=vn,_=function(){function e(){Sn(this,e),this._set=[],this.size=0}return mn(e,[{key:"add",value:function(e){return this._set.push(e),this.size++,this}},{key:"has",value:function(e){return-1<this._set.indexOf(e)}},{key:"delete",value:function(e){for(var t=0;t<this._set.length;t++)if(this._set[t]===e)return this._set.splice(t,1),this.size--,!0;return!1}},{key:"forEach",value:function(e){for(var t=0;t<this._set.length;t++)e(this._set[t])}},{key:"clear",value:function(){this._set=[]}}]),e}(),g.Set=self.Set||_,vn.DataMappingDefs={ELEMENT_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","length","elementValues","selected","hashedValue","relativeTime"],ELEMENT_MAP:["elementHash","tagName","id","name","type","leftPosition","topPosition","width","height","className","href","title","alt","selectValues","elementValue","checked","timestamp"],CLIPBOARD_EVENT_MAP:["eventSequence","timestamp","clipboardEventType","elementHash","copiedText"],KEY_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","charCode","character","keyComboType","isCtrl","isShift","isAlt","isMetaKey","keyLocation","code","key","isRepeat","keyRegion","relativeTime"],MOUSE_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","pageX","pageY","screenX","screenY","button","wheelDelta","clientX","clientY","eventDetail","buttonNew","relativeTime"],WINDOW_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","screenWidth","screenHeight","clientWidth","clientHeight","documentWidth","documentHeight","scrollTop","scrollLeft","windowInnerWidth","windowInnerHeight","windowOuterWidth","windowOuterHeight"],TOUCH_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","clientX","clientY","touchIndex","touchSizeMajor","touchSizeMinor","pageX","pageY","screenX","screenY","relativeTime"],PINCH_ZOOM_EVENT_MAP:["eventSequence","timestamp","focusX","focusY","scaleFactor"],ACCELEROMETER_EVENT_MAP:["eventSequence","timestamp","x","y","z"],GESTURE_EVENT_MAP:["eventSequence","timestamp","eventType","scale","rotation","pointerType","overallVelocity","direction","pageX","pageY","screenX","screenY","clientX","clientY"],GYRO_EVENT_MAP:["eventSequence","timestamp","absolute","alpha","beta","gamma"],ORIENTATION_EVENT_MAP:["eventSequence","timestamp","absolute","alpha","beta","gamma"],SCRIPT_EVENT_MAP:["eventSequence","timestamp","eventType","scriptId","namespaceURI","outerHTML","scriptSource","scriptType"],SCREEN_ORIENTATION_EVENT_MAP:["eventSequence","timestamp","orientation"],TAP_EVENT_MAP:["eventSequence","timestamp","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],LONGPRESS_EVENT_MAP:["eventSequence","timestamp","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],TAB_EVENT_MAP:["eventSequence","timestamp","type","id","href","referrer","currentTabsList"],NETINFO_EVENT_MAP:["eventSequence","timestamp","connectionType","effectiveType","downlinkMax","downlink","rtt","isSaveData"],STORAGE_EVENT_MAP:["eventSequence","timestamp","keys","action","tabsOpened"],PRINT_EVENT_MAP:["eventSequence","timestamp","printDialogState"],HISTORY_NAVIGATION_EVENT_MAP:["eventSequence","timestamp","navigationDirection"],AMBIENT_LIGHT_EVENT_MAP:["eventSequence","timestamp","illuminance"],BEFORE_INSTALL_PROMPT_EVENT_MAP:["eventSequence","timestamp","platforms","relativeTime"]},p=vn,v=function(){function n(e,t){Sn(this,n),this._cdUtils=e,this._scriptName=t,this._cdUtils.addEventListener(window,"error",this._handleException.bind(this))}return mn(n,[{key:"_handleException",value:function(e){if(this._scriptName&&this._scriptName===e.filename){var t=this._buildErrorMessage(e);log.error("caught unhandled exception. "+t)}}},{key:"_buildErrorMessage",value:function(e){if(!e.error)return e.message;var t=e.error.toString(),n=e.error.stack?e.error.stack:"";return t+", Line: "+e.lineno+", Column: "+e.colno+". Stacktrace: "+n}}]),n}(),p.GlobalExceptionHandler=v,m=vn,y=function(){function e(){Sn(this,e)}return mn(e,null,[{key:"create",value:function(){if(self.XMLHttpRequest&&Object.prototype.hasOwnProperty.call(XMLHttpRequest.prototype,"withCredentials"))return new XMLHttpRequest;if(self.XDomainRequest)return new XDomainRequest;if(self.XMLHttpRequest)return new XMLHttpRequest;throw new Error("There is no supported http request object")}}]),e}(),m.HttpRequestFactory=y,w=vn,b=function(){function t(e){if(Sn(this,t),!e)throw new Error("utils param must be defined");this._msgListeners=new w.Map,self.window&&e.addEventListener&&(this._windowId="Window_"+e.generateUUID(),e.addEventListener(self.window,"message",this._onMessageReceived.bind(this),!0))}return mn(t,[{key:"subscribe",value:function(e,t){var n=2<arguments.length&&arguments[2]!==undefined&&arguments[2],i=null;this._msgListeners.has(e)?i=this._msgListeners.get(e):(i=new w.Set,this._msgListeners.set(e,i)),i.add({callback:t,isOneTime:n})}},{key:"unsubscribe",value:function(e,t){if(e&&this._msgListeners.has(e)){var n=this._msgListeners.get(e);n&&n.forEach(function(e){t===e.callback&&n["delete"](e)}),0===n.size&&this._msgListeners["delete"](e)}}},{key:"publish",value:function(e,t){if(!e)throw new Error("invalid argument msgType must be defined");this._publishMessage(e,t)}},{key:"publishAsync",value:function(e,t){if(!e)throw new Error("invalid argument msgType must be defined");self.window&&self.window.postMessage({msgID:this._windowId,msgType:e,message:t},window.location.href)}},{key:"_publishMessage",value:function(e,t){var n=this._msgListeners.get(e);n&&n.forEach(function(e){e.callback(t),e.isOneTime&&n["delete"](e)})}},{key:"_onMessageReceived",value:function(e){e.data.msgID&&e.data.msgID===this._windowId&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),this._publishMessage(e.data.msgType,e.data.message))}}]),t}(),w.MessageBus=b,vn.MessageBusEventType={TouchEvent:"touchEvent",KeyEvent:"keyEvent",ConfigUpdatedEvent:"ConfigUpdatedEvent",NewSessionStartedEvent:"NewSessionStartedEvent",WupDispatchRateUpdatedEvent:"WupDispatchRateUpdatedEvent",ApiContextChangeEvent:"ApiContextChangeEvent",ApiResetSessionEvent:"ApiResetSessionEvent",ApiCustomerMetadataEvent:"ApiCustomerMetadataEvent",ApiChangeStateEvent:"ApiChangeStateEvent",ApiSetCsidEvent:"ApiSetCsidEvent",ApiSetPsidEvent:"ApiSetPsidEvent",ServerStateUpdatedEvent:"ServerStateUpdatedEvent"},S=vn,E=function(){function t(e){Sn(this,t),this._perfDataQ=e,this._now=window.performance&&window.performance.now?window.performance.now.bind(window.performance):S.CDUtils.dateNow.bind(Date),this._monitors=new S.Map}return mn(t,[{key:"startMonitor",value:function(e){log.debug("PerfMonitor:startMonitor on "+e),this._monitors.set(e,this._now())}},{key:"stopMonitor",value:function(e){var t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:"main";if(this._monitors.has(e)){var n=this._now()-this._monitors.get(e);this._perfDataQ.addToQueue("perf",{orig:t,name:e,val:n}),log.debug("PerfMonitor:stopMonitor on "+e+": time = "+n),this._monitors["delete"](e)}}},{key:"cancelMonitor",value:function(e){log.debug("PerfMonitor:cancelMonitor on "+e),this._monitors.has(e)&&this._monitors["delete"](e)}},{key:"reportMonitor",value:function(e,t){var n=2<arguments.length&&arguments[2]!==undefined?arguments[2]:"main";log.debug("PerfMonitor:reportMonitor on "+e),this._perfDataQ.addToQueue("perf",{orig:n,name:e,val:t})}}]),t}(),S.PerfMonitor=E,k=vn,C=function(){function e(){Sn(this,e),this._buffer=[]}return mn(e,[{key:"hasItems",value:function(){return 0<this.length()}},{key:"length",value:function(){return this._buffer.length}},{key:"enqueue",value:function(e){this._buffer.push(e)}},{key:"enqueueToHead",value:function(e){this._buffer.unshift(e)}},{key:"dequeue",value:function(e){return this._buffer.shift()}},{key:"getItem",value:function(e){return this._buffer[e]}}]),e}(),k.Queue=C,function(s){function e(){this._msgListeners=new s.Map}s.WorkerCommunicator||(e.prototype.setMessagingPort=function(e){this._messagePort=e;var s=this;e.setonmessage(function(e){var t=e.data,n=[],i=s._msgListeners.get(t.msgType);i&&i.forEach(function(e){e.callback(t.data),e.isOneTime&&n.push(e)}),n.forEach(function(e){i["delete"](e)})})},e.prototype.sendAsync=function(e,t,n,i,s){i&&n&&this.addMessageListener(n,i,s),this._messagePort.postMessage({msgType:e,data:t})},e.prototype.addMessageListener=function(e,t,n){var i=null;this._msgListeners.has(e)?i=this._msgListeners.get(e):(i=new s.Set,this._msgListeners.set(e,i)),i.add({callback:t,isOneTime:n})},s.WorkerCommunicator=e)}(vn),M=vn,T=function(){function n(e){Sn(this,n),this._nativeWorker=e;var t=!!window.SharedWorker&&this._nativeWorker instanceof window.SharedWorker;this.port=new M.CDPort(this._nativeWorker,t)}return mn(n,[{key:"close",value:function(){this.port&&this.port.close()}}]),n}(),M.WorkerWrapper=T,D=vn,x=function(){function e(){Sn(this,e)}return mn(e,[{key:"create",value:function(e){var t=new(window.Worker||window.SharedWorker)(e);return new D.WorkerWrapper(t)}}]),e}(),D.WorkerWrapperFactory=x,vn.EnumDefs={Events:{isTrusted:{"false":0,"true":1,undefined:2,"null":2},elementEventType:{input:0,initial:1,focus:2,blur:3,change:4,click:5,submit:6},clipboardEventType:{copy:0,paste:1,cut:2},keyEventType:{keyup:0,keydown:1,keypress:2},mouseEventType:{mousemove:0,mousedown:1,mouseup:2,click:3,dblclick:4,mouseleave:5,mouseenter:6,wheel:7,mouseout:8,mouseover:9},windowEventType:{DOMContentLoaded:0,scroll:1,resize:2,focus:3,blur:4,tabFocus:5,tabBlur:6},touchEventIEType:{pointerdown:"touchstart",pointerup:"touchend",pointermove:"touchmove",MSPointerDown:"touchstart",MSPointerUp:"touchend",MSPointerMove:"touchmove"},touchEventType:{touchstart:0,touchmove:1,touchend:2,touchcancel:3},pinchZoomEventType:{pointerdown:0,pointermove:1,pointerup:2},getstureEventType:{pinch:0,press:1,swipe:2,rotate:3},scriptEventType:{load:0},screenOrientationType:{undefined:0,"portrait-primary":1,"landscape-primary":2,"portrait-secondary":3,"landscape-secondary":4},tabEventType:{openTab:0,newTab:1,closeTab:2},storageEventType:{storage:0},printEventType:{printDialogOpened:1,printDialogClosed:0}},SNUM_CHANGE_TYPE:{none:"none",init:"init",configuration:"config",configurationFromSlave:"configFromSlave",customerApi:"customerApi",pageTimeout:"timeout",unknown:"unknown"},MasterSlaveMessage:{dataFromSlave:"dataFromSlave",registerSlave:"registerSlave",logPerfSlave:"logPerfSlave",updateSlaveConf:"updateSlaveConf",updateSlaveState:"updateSlaveState",updateMasterContext:"updateMasterContext",resetSessionTriggerFromSlave:"resetSessionTriggerFromSlave",mouseChallengeTriggerFromSlave:"mouseChallengeTriggerFromSlave"},SystemFrameName:{rtcframe:"cd__rtcframe",fontDetectionFrame:"cd__fontDetectionFrame"}},(F=vn).DomUtils={outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},onDocumentBody:function(e,t){e.document.body?t():(window.addEventListener?window.addEventListener("DOMContentLoaded",t,!0):window.attachEvent("onload",t),log.debug("DomUtils:onDocumentBody - no document body found, listening"))},onPageLoad:function(e,t){F.CDUtils.addEventListener(e,"load",t,!0),(e.contentWindow&&"complete"===e.contentWindow.document.readyState||e.document&&"complete"===e.document.readyState)&&t()},waitUntilDocumentIsReady:function(i){var s=this;return new Promise(function(e,t){try{s.onWindowDocumentReady(i,function(){return e()})}catch(n){t(n)}})},onWindowDocumentReady:function(e,t){var n=window.addEventListener?"DOMContentLoaded":"load";if("complete"===e.document.readyState||"interactive"===e.document.readyState)t();else{var i=function i(){F.CDUtils.removeEventListener(e,n,i,!0),t()};F.CDUtils.addEventListener(e,n,i,!0)}},isWindowDocumentReady:function(e){return e&&"complete"===e.document.readyState},canAccessIFrame:function(e){var t=null;try{t=(e.contentDocument||e.contentWindow.document).body.innerHTML}catch(n){}return null!==t},matches:function(e,t){return(e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n}).call(e,t)}},R=null,P=function(s,e,r){var a=function a(){return e};if(function t(){return-1<e.toString().indexOf("[native code]")}())r(a());else{var o=0,u=function u(){if(R.contentWindow){for(var e=R.contentWindow,t=s.split("."),n=e,i=0;i<t.length;i++)n=n[t[i]];r(n)}else o<45?(setTimeout(u,o),o++):r(a())};R||((R=document.createElement("IFRAME")).style.display="none",document.documentElement.appendChild(R)),u()}},(A=vn).CDUtils={scriptVersion:"2.10.0.4882.9051aec7",isPassiveSupported:function En(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(n){}return e}(),dateNow:Date.now,isUndefinedNull:function(e){return null===e||e===undefined||"undefined"==typeof e},addEventListener:function(e,t,n){var i=3<arguments.length&&arguments[3]!==undefined&&arguments[3],s=!(4<arguments.length&&arguments[4]!==undefined)||arguments[4],r=5<arguments.length&&arguments[5]!==undefined&&arguments[5];this.isPassiveSupported?e.addEventListener(t,n,{capture:i,passive:s,once:r}):e.addEventListener?e.addEventListener(t,n,i):e.attachEvent("on"+t,n)},matchRegEx:function(e,t){return new RegExp(e).test(t)},removeEventListener:function(e,t,n){var i=3<arguments.length&&arguments[3]!==undefined&&arguments[3];e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent("on"+t,n)},clearTextFromNumbers:function(e){return e?e.replace(/(\d)/g,"*"):""},maskText:function(e){return e.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d\u0000-\u0080]/g,"*")},getDropDownListValues:function(e){for(var t=[],n=0;n<e.length;n++){var i=e.options[n].text||e.options[n].value;t.push(A.CDUtils.maskText(i))}return t},getDocUrl:function(){var e=window.location;return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")+A.CDUtils.clearTextFromNumbers(e.pathname)},getHash:function(e){for(var t=0,n=0,i=e.length;n<i;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t},getTruncatedHash:function(e,t){return e?this.murmurhash3(e).toString().substring(t):""},murmurhash3:function(e,t){var n,i,s,r,a,o,u,c;for(n=3&e.length,i=e.length-n,s=t,a=3432918353,o=461845907,c=0;c<i;)u=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,s=27492+(65535&(r=5*(65535&(s=(s^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&e.charCodeAt(c+2))<<16;case 2:u^=(255&e.charCodeAt(c+1))<<8;case 1:s^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(c)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*o+(((u>>>16)*o&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0},generateUUID:function(){var n=A.CDUtils.dateNow();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},convertToArrayByMap:function(e,t){for(var n=[null],i=0,s=e.length;i<s;i++)n[i+1]=t[e[i]];return n},getMapCode:function(e){var t=String.fromCharCode(e);return/[0-9]/.test(t)?49:/[a-zA-Z]/.test(t)?65:/[^\u0000-\u0080]/.test(t)?66:e},getPostUrl:function(e,t,n,i,s,r,a){var o=A.HttpRequestFactory.create();o instanceof self.XMLHttpRequest?(o.open(t,e,!0),a!==undefined&&(o.timeout=a),o.withCredentials=!1!==r,"POST"===t&&o.setRequestHeader("Content-Type","application/json; charset=utf-8"),o.onreadystatechange=function(){if(4===o.readyState){if(204===o.status)return;200===o.status?i&&i(o.responseText):s&&s(o.responseText)}},o.ontimeout=function(){s&&s("timeout",n)},o.send(n)):(o.onload=function(){i&&i(o.responseText)},o.onerror=function(){s&&s()},o.onprogress=function(){},o.ontimeout=function(){},o.open(t,e,!0),setTimeout(function(){o.send(n)},0))},minutesToMilliseconds:function(e){return 60*e*1e3},cutDecimalPointDigits:function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},DomUtils:A.DomUtils,EnumDefs:A.EnumDefs,StorageUtils:{counter:0,getAndUpdateEventSequenceNumber:function(){return this.counter++},deserialize:function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(t){return e||null}},getFromLocalStorage:function(e,t){try{var n=this.deserialize(window.localStorage.getItem(e));return n?n.exp&&A.CDUtils.dateNow()-n.time>n.exp?null:t===undefined||t?n.val:n:null}catch(i){return null}},saveToLocalStorage:function(e,t,n){var i={val:t};n&&(i.exp=n,i.time=A.CDUtils.dateNow());try{window.localStorage.setItem(e,JSON.stringify(i))}catch(s){return null}return i},removeFromLocalStorage:function(e){try{window.localStorage.removeItem(e)}catch(t){return null}},getFromSessionStorage:function(e){try{var t=this.deserialize(window.sessionStorage.getItem(e));return t||null}catch(n){return null}},saveToSessionStorage:function(e,t){try{return t?(window.sessionStorage.setItem(e,JSON.stringify(t)),t):window.sessionStorage.removeItem(e)}catch(n){return null}},removeFromSessionStorage:function(e){try{window.sessionStorage.removeItem(e)}catch(t){return null}},getCookie:function(e){var t=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie);return t?decodeURIComponent(t[1]):""},setCookie:function(e,t,n){var i="";if(n){var s=new Date;s.setTime(s.getTime()+n),i="; expires="+s.toUTCString()}for(var r=0,a=location.hostname,o=a.split("."),u="",c=!1;r<=o.length-1&&!c;)"localhost"===(a=o.slice(-1-++r).join("."))?u="":""!==a&&(u="; domain=."+a),c=this.setCookieWithAttributes(e,t,i,u);return c||(u="; domain="+location.hostname,c=this.setCookieWithAttributes(e,t,i,u)),c},setCookieWithAttributes:function(e,t,n,i){return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+n+i+"; path=/",this.getCookie(e)==t},validateBcId:function(e){return/^([0-9]{13,}-)?[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)?e:null}},getNativeWindowFn:P,JQueryUtils:{isJQueryAvailable:function(){return window.jQuery!==undefined},addEventListener:function(e,t,n){jQuery(e).on(t,n)},removeEventListener:function(e,t,n){jQuery(e).off(t,n)}}},Date.now?P("Date.now",Date.now,function(e){A.CDUtils.dateNow=e}):A.CDUtils.dateNow=function(){return(new Date).getTime()},function(e){var t,n;if(!Function.prototype.cdCallAsync&&(Object.extend=function(e,t){if(e&&t&&"object"==("undefined"==typeof t?"undefined":yn(t)))for(var n in t)if(t.hasOwnProperty(n))try{""!=n&&Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}catch(i){e[n]=t[n]}return e},e.btoa=self.btoa?self.btoa.bind(self):function(e){for(var t,n,i=String(e),s="",r=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.charAt(0|r)||(a="=",r%1);s+=a.charAt(63&t>>8-r%1*8)){if(255<(n=i.charCodeAt(r+=.75)))throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return s},self.importScripts==undefined)){var a=(t=[],n="Window_"+e.CDUtils.generateUUID(),e.CDUtils.addEventListener(window,"message",function i(e){e.data==n&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),t.shift()())},!0),function(e){t.push(e),window.postMessage(n,self.location.href)});Function.prototype.cdCallAsync=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s=this;a(function(){s.apply(e||window,n)})},Function.prototype.cdCallAsyncWithErrorHandling=function(t,n){for(var e=arguments.length,i=Array(2<e?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];var r=this;a(function(){try{r.apply(t||window,i)}catch(e){n&&n(e)}})}}}(vn),function(e){if(!e.Logger){var t=function(){function n(e,t){Sn(this,n),this._logBridge=e,this._logLevel=t||n.LOG_LEVEL.INFO}return mn(n,[{key:"trace",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.DEBUG)}},{key:"debug",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.DEBUG)}},{key:"info",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.INFO)}},{key:"warn",value:function(e,t){this._sendToLogBridge(e,n.LOG_LEVEL.WARN,t)}},{key:"error",value:function(e,t){this._sendToLogBridge(e,n.LOG_LEVEL.ERROR,t)}},{key:"isDebug",value:function(){return this._logLevel==n.LOG_LEVEL.DEBUG}},{key:"updateLogConfig",value:function(e){this._logLevel=e.get("logLevel"
)||this._logLevel}},{key:"_sendToLogBridge",value:function(e,t,n){t>=this._logLevel&&(n&&n.stack&&(e+=" ;stack: "+n.stack),this._logBridge.log(e,t))}}]),n}();Object.extend(t,{LOG_LEVEL:{DEBUG:10,INFO:20,WARN:30,ERROR:40,CRITICAL:50,OFF:80}}),e.Logger=t,e.log={setLogger:function(e){this._logger=e},isDebug:function(){return this._logger.isDebug()},error:function(e,t){this._logger.error(e,t||null)},warn:function(e,t){this._logger.warn(e,t||null)},trace:function(e){this._logger.trace(e)},debug:function(e){this._logger.debug(e)},info:function(e){this._logger.info(e)}}}}(vn),vn.WorkerCommand={requestConfigurationsCommand:"requestConfigurationsCommand",startNewSessionCommand:"startNewSessionCommand",resumeSessionCommand:"resumeSessionCommand",changeContextCommand:"changeContextCommand",updateCsidCommand:"updateCsidCommand",updatePsidCommand:"updatePsidCommand",updateLogUrlCommand:"updateLogUrl",sendDataCommand:"sendDataCommand",sendLogCommand:"sendLogCommand"},vn.WorkerEvent={NewSessionStartedEvent:"NewSessionStartedEvent",ServerStateUpdatedEvent:"ServerStateUpdatedEvent"},U=vn,I=function(){function e(){Sn(this,e),this._onmessageSubscribers=[]}return mn(e,[{key:"start",value:function(){}},{key:"postMessage",value:function(e){for(var t=0;t<this._onmessageSubscribers.length;t++)this._onmessageSubscribers[t]({data:e})}},{key:"close",value:function(){this._onmessageSubscribers=[]}},{key:"setonmessage",value:function(e){this._onmessageSubscribers.push(e)}}]),e}(),U.UnsPort=I,L=vn,B=function(){function t(e){Sn(this,t),L.isUnsupportedMode=!0,this._unsPort=e,this._unsFrameHandler={startFeatures:function(){},startFeature:function(){},stopFeatures:function(){},stopFeature:function(){},updateFeatureConfig:function(){}}}return mn(t,[{key:"getUnsPort",value:function(){return this._unsPort}},{key:"getUnsFrameHandler",value:function(){return this._unsFrameHandler}},{key:"adjustFeatureList",value:function(e){function t(e){for(var t in e)e.hasOwnProperty(t)&&!e[t].runInUns&&delete e[t]}t(e.defaultFeatures),t(e.nonDefaultFeatures),t(e.perSessionFeatures),t(e.perContextFeatures),t(e.perPageReloadFeatures),t(e.nonDefaultFeatures),e.perSessionFeatures.IsUnsupportedFeature={configKey:"isUnsupportedReport",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){var e=function(e){function t(){return Sn(this,t),wn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return bn(t,L.AbstractFeature),mn(t,[{key:"startFeature",value:function(){this._dataQ.addToQueue("static_fields",["is_supported",!1],!1)}}]),t}();this._features.perSessionFeatures.IsUnsupportedFeature.instance=new e(this._dataQ)},instance:null}}}]),t}(),L.UnsupportedMgr=B,N=vn,O=function(){function n(e,t){Sn(this,n),this._dataQ=e,this._perfMonitor=t}return mn(n,[{key:"preFeature",value:function(e){this._perfMonitor.startMonitor(e)}},{key:"postFeature",value:function(e,t){this._perfMonitor.stopMonitor(e,t)}},{key:"cancelMonitor",value:function(e){this._perfMonitor.cancelMonitor(e)}},{key:"stopFeature",value:function(){}},{key:"updateFeatureConfig",value:function(){}}]),n}(),N.AbstractFeature=O,W=vn,Q=function(){function t(e){Sn(this,t),this._perfMonitor=e,this.isPassive=W.CDUtils.isPassiveSupported}return mn(t,[{key:"getEventTimestamp",value:function(){return W.CDUtils.dateNow()}},{key:"getTimestampFromEvent",value:function(e){return e.timeStamp?W.CDUtils.cutDecimalPointDigits(e.timeStamp,3):0}},{key:"handlerProlog",value:function(e){log.isDebug()&&this._perfMonitor.startMonitor(e)}},{key:"handlerEpilog",value:function(e){log.isDebug()&&this._perfMonitor.stopMonitor(e)}},{key:"handlerCancelog",value:function(e){log.isDebug()&&this._perfMonitor.cancelMonitor(e)}},{key:"updateFeatureConfig",value:function(){}}]),t}(),W.Events=Q,H=vn,q=function(e){function a(e,t,n,i,s){Sn(this,a);var r=wn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,s));return r._configMgr=e,r._utils=t,r._dataQueue=n,r._contextMgr=i,r._elementHashWMap=new WeakMap,r._collectPosition=!0,r._collectClassName=!0,r._collectTitle=!0,r._collectHref=!0,r._maxElemValLength=30,r._XPathHashProducer=new H.XPathHashProducer,r}return bn(a,H.Events),mn(a,[{key:"getElement",value:function(e){if(this._utils.isUndefinedNull(e)||e===document||e===document.body)return-1;var t=-1;if(this._elementHashWMap.has(e))t=this._elementHashWMap.get(e).hash;else{this.handlerProlog("t.E_get");var n=this._XPathHashProducer.produce(e);t=n?this._utils.getHash(n):-1,this._elementHashWMap.set(e,{hash:t,contextList:[this._contextMgr.contextName]}),this._sendElementToServer(e,t),this.handlerEpilog("t.E_get")}return t}},{key:"resendElementPerContext",value:function(e){if(this._elementHashWMap.has(e)){var t=this._elementHashWMap.get(e),n=t.hash;t.contextList.indexOf(this._contextMgr.contextName)<0&&(t.contextList.push(this._contextMgr.contextName),this._elementHashWMap.set(e,{hash:t.hash,contextList:t.contextList}),this._sendElementToServer(e,n))}else log.error("received for resendElementPerContext bad element, not in hash map. id="+e.id)}},{key:"isListed",value:function(e){return this._elementHashWMap.has(e)}},{key:"getElementData",value:function(e){return this._elementHashWMap.get(e)}},{key:"getElementContextList",value:function(e){return this._elementHashWMap.get(e).contextList}},{key:"_sendElementToServer",value:function(e,t){var n=this._collectPosition?e.getBoundingClientRect&&e.getBoundingClientRect():null,i=-1,s=-1,r=-1,a=-1;n&&(i=Math.round(n.left),s=Math.round(n.top),r=Math.round(n.right-n.left),a=Math.round(n.bottom-n.top));var o=this._verifyNoPrivateData(e.id||""),u=this._verifyNoPrivateData(e.name||""),c=this._collectClassName&&e.getAttribute&&this._verifyNoPrivateData(e.getAttribute("class"))||"",h=this._collectTitle&&this._verifyNoPrivateData(e.title)||"",d=this._verifyNoPrivateData(e.nodeName)||"",l=this._collectHref&&this._verifyNoPrivateData(e.href)||"";0<l.length&&(l=this._utils.clearTextFromNumbers(l));var f="";"SELECT"===e.nodeName&&(f=this._utils.getDropDownListValues(e).join(";"));var g=e.value||e.textContent||e.innerHTML||"";g=g.length>this._maxElemValLength?"":("string"!=typeof g&&(g=g.toString()),this._utils.maskText(g));var _=this._utils.isUndefinedNull(e.checked)?-1:e.checked?1:0,p=this.getEventTimestamp();this._dataQueue.addToQueue("elements",[this._contextMgr.contextId,t,d||"",o||"",u||"",e.type||"",i||0,s||0,r||0,a||0,c||"",l||"",h||"",e.alt||"",f||"",g||"",_,p],!1),log.isDebug()&&log.debug("adding element id:"+o+", name:"+u+", type:"+e.type+", width:"+r+", height:"+a+", left:"+i+", top:"+s+", hash: "+t)}},{key:"_verifyNoPrivateData",value:function(e){return/\d\d\d/.test(e)?this._utils.clearTextFromNumbers(e):e}},{key:"updateFeatureConfig",value:function(){this._collectPosition="boolean"==typeof this._configMgr.get("isElementsPosition")?this._configMgr.get("isElementsPosition"):this._collectPosition,this._collectClassName="boolean"==typeof this._configMgr.get("isElementsClassName")?this._configMgr.get("isElementsClassName"):this._collectClassName,this._collectTitle="boolean"==typeof this._configMgr.get("isElementsTitle")?this._configMgr.get("isElementsTitle"):this._collectTitle,this._collectHref="boolean"==typeof this._configMgr.get("isElementsHref")?this._configMgr.get("isElementsHref"):this._collectHref,this._maxElemValLength=this._configMgr.get("maxElValLen")?this._configMgr.get("maxElValLen"):this._maxElemValLength}}]),a}(),H.Elements=q,function(d){function e(e,t,n,i,s){var r,a=this;this._configMgr=e,this._utils=t,this._elements=n,this._dataQueue=i,this._perfMonitor=s;var o=function o(e){return t.dateNow()},u=a._utils.StorageUtils,c=d.EnumDefs.Events.mouseEventType,h=d.EnumDefs.Events.isTrusted;this.getMouseEvent=function(e){var t=e.which;"mouseup"===e.type?r=t:"click"===e.type&&0===t&&(t=r);var n=c[e.type];a._utils.isUndefinedNull(n)&&(n=-1);var i=e.deltaY||e.deltaX||e.deltaZ||e.wheelDelta||0,s=a.getTimestampFromEvent(e);a._dataQueue.addToQueue("mouse_events",[null,u.getAndUpdateEventSequenceNumber(),o(e),n,h[e.isTrusted],"mousemove"===e.type?0:a._elements.getElement(e.target),e.pageX?Math.round(e.pageX):-1,e.pageY?Math.round(e.pageY):-1,e.screenX?Math.round(e.screenX):-1,e.screenY?Math.round(e.screenY):-1,null===t||t===undefined?-1:t,Math.round(i),e.clientX?Math.round(e.clientX):-1,e.clientY?Math.round(e.clientY):-1,e.detail||0,null===e.button||e.button===undefined?-1:e.button,s])}}(e.prototype=Object.create(d.Events.prototype)).startFeature=function(e){var t=this;try{this._perfMonitor.stopMonitor("t.timeTillDataCollect"),e||(e=window.self);var n=e.document||e.contentDocument;this._utils.addEventListener(n,"mousemove",this.getMouseEvent,!0),this._utils.addEventListener(n,"mousedown",this.getMouseEvent,!0),this._utils.addEventListener(n,"mouseup",this.getMouseEvent,!0),this._utils.addEventListener(n,"click",this.getMouseEvent,!0),this._utils.addEventListener(n,"dblclick",this.getMouseEvent,!0),this._isIE=!!document.documentMode||/edge/.test(window.navigator.userAgent.toLowerCase()),this._isIE?d.CDUtils.DomUtils.onDocumentBody(e,function(){t._utils.addEventListener(n.body,"mouseleave",t.getMouseEvent),t._utils.addEventListener(n.body,"mouseenter",t.getMouseEvent)}):(this._utils.addEventListener(n,"mouseleave",this.getMouseEvent),this._utils.addEventListener(n,"mouseenter",this.getMouseEvent)),this._utils.addEventListener(n,"wheel",this.getMouseEvent,!0)}catch(i){log.error("MouseEvents:startFeature failed. msg:"+i.message,i)}},e.prototype.stopFeature=function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;this._utils.removeEventListener(t,"mousemove",this.getMouseEvent,!0),this._utils.removeEventListener(t,"mousedown",this.getMouseEvent,!0),this._utils.removeEventListener(t,"mouseup",this.getMouseEvent,!0),this._utils.removeEventListener(t,"click",this.getMouseEvent,!0),this._utils.removeEventListener(t,"dblclick",this.getMouseEvent,!0),this._isIE?(this._utils.removeEventListener(t.body,"mouseleave",this.getMouseEvent),this._utils.removeEventListener(t.body,"mouseenter",this.getMouseEvent)):(this._utils.removeEventListener(t,"mouseleave",this.getMouseEvent),this._utils.removeEventListener(t,"mouseenter",this.getMouseEvent)),this._utils.removeEventListener(t,"wheel",this.getMouseEvent,!0)}catch(n){log.error("MouseEvents:stopFeature failed. msg:"+n.message,n)}},d.MouseEvents=e}(vn),z=vn,j=function(e){function o(e,t,n,i,s,r){Sn(this,o);var a=wn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s));return a._configManager=e,a._utils=t,a._dataQ=i,a._elements=n,a._msgBus=r,a._onAllBrowsersTouchEventBinded=a._onAllBrowsersTouchEvent.bind(a),a}return bn(o,z.Events),mn(o,[{key:"startFeature",value:function(e){e||(e=window.self),this._bind(e)}},{key:"stopFeature",value:function(e){e||(e=window.self),this._unbind(e)}},{key:"_addToCommunicationQueue",value:function(e,t,n,i){e!==z.EnumDefs.Events.touchEventType.touchstart&&e!==z.EnumDefs.Events.touchEventType.touchend||this._msgBus.publish(z.MessageBusEventType.TouchEvent,{action:e});var s=this.getEventTimestamp(i),r=z.EnumDefs.Events.isTrusted[i.isTrusted],a=this._elements.getElement(i.target),o=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._utils.isUndefinedNull(e)&&(e=-1),this._utils.isUndefinedNull(t)&&(t=-1);var u=this.getTimestampFromEvent(i);this._dataQ.addToQueue("touch_events",z.CDUtils.convertToArrayByMap(z.DataMappingDefs.TOUCH_EVENT_MAP,{eventSequence:o,timestamp:s,eventType:e,isTrusted:r,elementHash:a,clientX:n.clientX?Math.round(n.clientX):0,clientY:n.clientY?Math.round(n.clientY):0,touchIndex:t,touchSizeMajor:n.radiusX?2*n.radiusX:0,touchSizeMinor:n.radiusY?2*n.radiusY:0,pageX:n.pageX||0,pageY:n.pageY||0,screenX:n.screenX||0,screenY:n.screenY||0,relativeTime:u}))}},{key:"_bind",value:function(e){var t=e.document||e.contentDocument,n=void 0;if(window.TouchEvent?n=["touchstart","touchmove","touchend","touchcancel"]:window.PointerEvent&&(n=["pointerdown","pointermove","pointerup"]),this._listeningToEvents=n,this._listeningToEvents)for(var i=0;i<this._listeningToEvents.length;i++)this._utils.addEventListener(t,this._listeningToEvents[i],this._onAllBrowsersTouchEventBinded)}},{key:"_unbind",value:function(e){var t=e.document||e.contentDocument;if(this._listeningToEvents)for(var n=0;n<this._listeningToEvents.length;n++)this._utils.removeEventListener(t,this._listeningToEvents[n],this._onAllBrowsersTouchEventBinded)}},{key:"_onAllBrowsersTouchEvent",value:function(e){return this.handlerProlog("t.TE"),this._onIeTouchEvent(e),this._onTouchEvent(e),this.handlerEpilog("t.TE"),!0}},{key:"_onTouchEvent",value:function(e){if((null===e.pointerType||e.pointerType===undefined)&&e.changedTouches!==undefined)for(var t=z.EnumDefs.Events.touchEventType[e.type],n=0;n<e.changedTouches.length;n++){var i=e.changedTouches[n],s=i.identifier%1e4;this._addToCommunicationQueue(t,s,i,e)}}},{key:"_onIeTouchEvent",value:function(e){if(null!=e.pointerType&&("touch"===e.pointerType||"pen"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH||e.pointerType===e.MSPOINTER_TYPE_PEN)){var t=z.EnumDefs.Events.touchEventIEType[e.type]||"touchcancel",n=e.pointerId?e.pointerId%1e4:0,i=z.EnumDefs.Events.touchEventType[t];this._addToCommunicationQueue(i,n,e,e)}}}]),o}(),z.TouchEvents=j,V=vn,Y=["clientX","clientY"],K=["screenX","screenY"],G=function G(t,n,s){function i(e,t){var n=t[s[0]]-e[s[0]],i=t[s[1]]-e[s[1]];return Math.sqrt(n*n+i*i)}return{getScale:function(){return function e(){return i(t[0],t[1])/i(n[0],n[1])}()},getFocusPoint:function(){return function n(e,t){return Object.assign({},{x:(e[s[0]]+t[s[0]])/2,y:(e[s[1]]+t[s[1]])/2})}(t[1],t[0])}}},X=function(e){function o(e,t,n,i,s,r){Sn(this,o);var a=wn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s));return a._configManager=e,a._utils=t,a._dataQ=i,a._elements=n,a._msgBus=r,a._evGesturesCache=[],a._prevEventDiff=-1,a._prevEvGestureSet=[],a._prevTouchEvents=[],a._onAllBrowsersPinchZoomEventBinded=a._onAllBrowsersPinchZoomEvent.bind(a),a}return bn(o,V.Events),mn(o,[{key:"startFeature",value:function(e){e||(e=window.self),this._bind(e),this._isReady=!0}},{key:"stopFeature",value:function(e){e||(e=window.self),this._unbind(e)}},{key:"_addToCommunicationQueue",value:function(e,t,n,i){e!==V.EnumDefs.Events.pinchZoomEventType.pointerdown&&e!==V.EnumDefs.Events.pinchZoomEventType.pointerup||this._msgBus.publish("pinchEvent",{action:e});var s=this.getEventTimestamp(i),r=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQ.addToQueue("pinch_events",V.CDUtils.convertToArrayByMap(V.DataMappingDefs.PINCH_ZOOM_EVENT_MAP,{eventSequence:r,timestamp:s,focusX:n.x,focusY:n.y,scaleFactor:t}))}},{key:"_bind",value:function(e){var t=e.document||e.contentDocument,n=void 0;if(window.PointerEvent?n=["pointerdown","pointermove","pointerup"]:window.TouchEvent&&(n=["touchstart","touchend","touchcancel","touchmove"]),this._listeningToEvents=n,this._listeningToEvents)for(var i=0;i<this._listeningToEvents.length;i++)this._utils.addEventListener(t,this._listeningToEvents[i],this._onAllBrowsersPinchZoomEventBinded)}},{key:"_unbind",value:function(e){var t=e.document||e.contentDocument;if(this._listeningToEvents)for(var n=0;n<this._listeningToEvents.length;n++)this._utils.removeEventListener(t,this._listeningToEvents[n],this._onAllBrowsersPinchZoomEventBinded);this._evGesturesCache=[],this._prevEventDiff=-1}},{key:"_onAllBrowsersPinchZoomEvent",value:function(e){switch(this.handlerProlog("t.TE"),e.type){case"pointerdown":this._onPointerDownEvent(e);break;case"pointermove":this._onPointerMoveEvent(e);break;case"pointerup":this._onPointerUpEvent(e);break;case"touchstart":this._onTouchStartEvent(e);break;case"touchend":this._onTouchEndEvent(e);break;case"touchmove":this._onTouchMoveEvent(e)}return this.handlerEpilog("t.TE"),!0}},{key:"_onPointerDownEvent",value:function(e){this._evGesturesCache.push(e)}},{key:"_onPointerMoveEvent",value:function(e){for(var t=0;t<this._evGesturesCache.length;t++)if(e.pointerId==this._evGesturesCache[t].pointerId){this._evGesturesCache[t]=e;break}if(2==this._evGesturesCache.length&&this._evGesturesCache[0].pointerId!=this._evGesturesCache[1].pointerId){var n=Math.abs(this._evGesturesCache[0].clientX-this._evGesturesCache[1].clientX);if(0<this._prevEventDiff&&(this._prevEventDiff,this._prevEventDiff,2==this._prevEvGestureSet.length)){var i=G(this._evGesturesCache,this._prevEvGestureSet,Y),s=i.getScale();this._addToCommunicationQueue(V.EnumDefs.Events.pinchZoomEventType[e.type],s,i.getFocusPoint(),e)}this._prevEventDiff=n,this._prevEvGestureSet=this._evGesturesCache.slice(0)}else 2<this._evGesturesCache.length&&(this._evGesturesCache=[],this._prevEvGestureSet=[])}},{key:"_onPointerUpEvent",value:function(e){for(var t=0;t<this._evGesturesCache.length;t++)if(this._evGesturesCache[t].pointerId==e.pointerId){this._evGesturesCache.splice(t,1);break}this._evGesturesCache.length<2&&(this._prevEventDiff=-1,this._prevEvGestureSet=[])}},{key:"_onTouchStartEvent",value:function(e){this._prevTouchEvents[0]=e.touches.item(0),this._prevTouchEvents[1]=e.touches.item(1)}},{key:"_onTouchEndEvent",value:function(e){this._prevTouchEvents=[]}},{key:"_onTouchCancelEvent",value:function(e){}},{key:"_onTouchMoveEvent",value:function(e){if(2==e.touches.length){if(2==this._prevTouchEvents.length){var t=[e.touches.item(0),e.touches.item(1)],n=G(t,this._prevTouchEvents.splice(0),K),i=n.getScale();this._addToCommunicationQueue(V.EnumDefs.Events.pinchZoomEventType[e.type],i,n.getFocusPoint(),e)}this._prevTouchEvents[0]=e.touches.item(0),this._prevTouchEvents[1]=e.touches.item(1)}}}]),o}(),V.PinchZoomEvents=X,Z=vn,J=function(e){function o(e,t,n,i,s,r){Sn(this,o);var a=wn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s));return a._configManager=e,a._utils=t,a._dataQ=i,a._elements=n,a._msgBus=r,a._onAllStorageEventBinded=a._onAllStorageEvent.bind(a),a}return bn(o,Z.Events),mn(o,[{key:"startFeature",value:function(e){e||(e=window.self),this._bind(e)}},{key:"stopFeature",value:function(e){e||(e=window.self),this._unbind(e)}},{key:"_addToCommunicationQueue",value:function(e,t,n,i,s){e===Z.EnumDefs.Events.storageEventType.storage&&this._msgBus.publish("storageEvent",{action:e});var r=this.getEventTimestamp(s),a=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQ.addToQueue("storage_events",Z.CDUtils.convertToArrayByMap(Z.DataMappingDefs.STORAGE_EVENT_MAP,{eventSequence:a,timestamp:r,keys:t,action:n,tabsOpened:i}))}},{key:"_bind",value:function(e){var t=void 0;if((e.localStorage||e.sessionStorage)&&(t=["storage"]),this._listeningToEvents=t,0<this._listeningToEvents.length)for(var n=0;n<this._listeningToEvents.length;n++)this._utils.addEventListener(e,this._listeningToEvents[n],this._onAllStorageEventBinded,!0)}},{key:"_unbind",value:function(e){if(this._listeningToEvents)for(var t=0;t<this._listeningToEvents.length;t++)this._utils.removeEventListener(e,this._listeningToEvents[t],this._onAllStorageEventBinded,!0)}},{key:"_onAllStorageEvent",value:function(e){switch(e.type){case"storage":this._onStorageEvent(e)}return!0}},{key:"_onStorageEvent",value:function(e){var t=!1,n=null,i=null;null===e.key&&(n=null),i="string"==typeof e.key&&null===e.newValue?(n=e.key,"delete"):(n=e.key,"update");var s=this._utils.StorageUtils.getFromLocalStorage("cdTabList");s&&"object"===yn(s[0])&&(t=!0),t=t?1:0,this._addToCommunicationQueue(e.type,n,i,t,e)}}]),o}(),Z.StorageEvents=J,$=vn,ee=function(e){function g(e,t,n,i,s,r){Sn(this,g);var a=wn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,s));return a._configMgr=e,a._utils=t,a._elements=n,a._dataQueue=i,a._perfMonitor=s,a._msgBus=r,a.comboCode=[67,86,65,88,90,80,83],a._onKeyEvent=a._onKeyEvent.bind(a),a._onTestKeyEvent=a._onTestKeyEvent.bind(a),a}return bn(g,$.Events),mn(g,[{key:"startFeature",value:function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;this._bind(t,this._onKeyEvent,!1),this._configMgr.get("isCaptureKeyEvents")&&this._bind(t,this._onTestKeyEvent,!0)}catch(n){log.error("KeyEvents:startFeature failed, msg: "+n.message,n)}}},{key:"stopFeature",value:function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;this._unbind(t,this._onKeyEvent,!1),this._configMgr.get("isCaptureKeyEvents")&&this._unbind(t,this._onTestKeyEvent,!0)}catch(n){log.error("KeyEvents:stopFeature failed, msg: "+n.message,n)}}},{key:"_maskKeyAndCode",value:function(e){if(1===e.key.length){var t=this._utils.getMapCode(e.key.charCodeAt(0));e.key=String.fromCharCode(t)}-1!==e.code.indexOf("Numpad")?e.code="Numpad":-1!==e.code.indexOf("Digit")?e.code="Digit":-1!==e.code.indexOf("Key")&&(e.code="Key")}},{key:"_analyzeKey",value:function(e){var t=-1;return t="keypress"!==e.type&&95<e.which?e.which<106?96:e.which||e.keyCode:this._utils.getMapCode(e.which||e.keyCode),this._utils.isUndefinedNull(t)&&(t=-1),t}},{key:"updateFeatureConfig",value:function(e){try{if(this._configMgr.get("isCaptureKeyEvents")){e||(e=window.self);var t=e.document||e.contentDocument;this._unbind(t,this._onTestKeyEvent,!0),this._bind(t,this._onTestKeyEvent,!0)}}catch(n){log.error("KeyEvents:startFeature failed, msg: "+n.message,n)}}},{key:"_bind",value:function(e,t,n){e.addEventListener("keyup",t,n),e.addEventListener("keydown",t,n),e.addEventListener("keypress",t,n)}},{key:"_unbind",value:function(e,t,n){e.removeEventListener("keyup",t,n),e.removeEventListener("keydown",t,n),e.removeEventListener("keypress",t,n)}},{key:"_onTestKeyEvent",value:function(e){this._handleKeyEvent(e,"test_key_events")}},{key:"_onKeyEvent",value:function(e){this.handlerProlog("t.KE");var t=$.EnumDefs.Events.keyEventType[e.type];t!==$.EnumDefs.Events.keyEventType.keydown&&t!==$.EnumDefs.Events.keyEventType.keyup||this._msgBus.publish($.MessageBusEventType.KeyEvent,{action:t}),this._handleKeyEvent(e,"key_events"),this.handlerEpilog("t.KE")}},{key:"_handleKeyEvent",value:function(e,t){var n=this._analyzeKey(e),i=$.EnumDefs.Events.isTrusted[e.isTrusted],s=this.getEventTimestamp(e),r=-1===n||"keypress"!==e.type?"":String.fromCharCode(n),a=this._elements.getElement(e.target),o=$.EnumDefs.Events.keyEventType[e.type];this._utils.isUndefinedNull(o)&&(o=-1);var u=e.ctrlKey&&"keyup"!==e.type||e.metaKey?this.comboCode.indexOf(e.which):-1,c="Meta"===e.key||"OS"===e.key||"Win"===e.key||e.metaKey||91===e.keyCode||92===e.keyCode,h=this._utils.StorageUtils.getAndUpdateEventSequenceNumber(),d={key:e.key||"",code:e.code||""};this._maskKeyAndCode(d);var l="-1";this._configMgr.get($.ConfigurationFields.collectKeyRegionValue)&&(l=g._getKeyRegion(e)),log.isDebug()&&log.trace("onKeyEvent: got event: "+o+", at time:"+s+", key: "+d.key+", code:"+d.code+", old charCode:"+n);var f=this.getTimestampFromEvent(e);this._dataQueue.addToQueue(t,$.CDUtils.convertToArrayByMap($.DataMappingDefs.KEY_EVENT_MAP,{eventType:o,eventSequence:h,timestamp:s,charCode:n,character:r||"",elementHash:a,keyComboType:u,isTrusted:i,isCtrl:e.ctrlKey||!1,isShift:e.shiftKey||!1,isAlt:e.altKey||!1,isMetaKey:c||!1,keyLocation:e.location||0,code:d.code||"",key:d.key||"",location:e.location||"",isRepeat:e.repeat||!1,keyRegion:l,relativeTime:f}))}}],[{key:"_getKeyRegion",value:function(e){var t=e.which||e.keyCode;for(var n in $.KeyRegionsTable)if($.KeyRegionsTable.hasOwnProperty(n)&&-1<$.KeyRegionsTable[n].indexOf(t))return n;return"-1"}}]),g}(),$.KeyEvents=ee,vn.KeyRegionsTable={0:[192,49,50,51],1:[52,53,54,55],2:[56,57,48],3:[81,87,69,65,83,68,90,88,67],4:[82,84,70,71,86,66],5:[89,85,72,74,78,77],6:[73,79,80,75,76,188,190],7:[186,189,187,191,219,220,221,222]},te=vn,ne=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,n));return i._utils=e,i._dataQueue=t,i._addToEventQueueFunc=i._addToEventQueue.bind(i),i._myAfterPrintFunc=i._myAfterPrint.bind(i),i}return bn(s,te.Events),mn(s,[{key:"_myAfterPrint",value:function(){this._addToEventQueueFunc(te.EnumDefs.Events.printEventType.printDialogClosed),window.removeEventListener("focus",this._myAfterPrintFunc)}},{key:"_onBeforePrintEvent",value:function(e){this._addToEventQueueFunc(te.EnumDefs.Events.printEventType.printDialogOpened),te.CDUtils.addEventListener(window,"focus",this._myAfterPrintFunc.bind(this))}},{key:"_addToEventQueue",value:function(e){var t=this.getEventTimestamp(),n=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQueue.addToQueue("print_events",te.CDUtils.convertToArrayByMap(te.DataMappingDefs.PRINT_EVENT_MAP,{eventSequence:n,timestamp:t,printDialogState:e}))}},{key:"startFeature",value:function(){te.CDUtils.addEventListener(window,"beforeprint",this._onBeforePrintEvent.bind(this))}},{key:"stopFeature",value:function(){te.CDUtils.removeEventListener(window,"beforeprint",this._onBeforePrintEvent.bind(this),!0)}}]),s}(),te.PrintEvents=ne,ie=vn,se=function(e){function i(e,t){Sn(this,i);var n=wn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return n._dataQueue=e,n._historyHandlerModernFunc=n._historyHandlerModern.bind(n),n._addHistoryEventFunc=n._addHistoryEventToQueue.bind(n),n}return bn(i,ie.Events),mn(i,[{key:"_historyHandlerModern",value:function(){var e=sessionStorage.getItem("stateLastUrl"),t=window.location.href,n=history.state;if(null!==e){var i=void 0,s=0;if(null===n){var r=history.length-1;i=1,n=String(r),history.replaceState(n,"")}else{var a=sessionStorage.getItem("stateLastShown"),o=Number(a);i=0==(s=Number(n)-o)?0:s/Math.abs(s)}sessionStorage.setItem("stateLastShown",n),0<Math.abs(i)&&0<Math.abs(s)&&this._addHistoryEventFunc(i)}sessionStorage.setItem("stateLastUrl",t)}},{key:"_addHistoryEventToQueue",value:function(e){log.debug("HistoryNavigationEvents:addHistoryEventToQueue");var t=this.getEventTimestamp(),n=ie.CDUtils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQueue.addToQueue("history_navigation_events",ie.CDUtils.convertToArrayByMap(ie.DataMappingDefs.HISTORY_NAVIGATION_EVENT_MAP,{eventSequence:n,timestamp:t,navigationDirection:e}))}},{key:"startFeature",value:function(){ie.CDUtils.addEventListener(window,"hashchange",this._historyHandlerModernFunc),this._historyHandlerModernFunc()}},{key:"stopFeature",value:function(){ie.CDUtils.removeEventListener(window,"hashchange",this._historyHandlerModernFunc)}}]),i}(),ie.HistoryNavigationEvents=se,function(o){function e(e,t,n,i){this.onWindowEvent=function(e){a.handlerProlog("t.WE");var t=void 0,n=o.EnumDefs.Events.isTrusted[undefined];"DOMContentLoaded"===e.type?t=(new Date).getTime():(t=a.getEventTimestamp(e),n=o.EnumDefs.Events.isTrusted[e.isTrusted]),log.isDebug()&&(log.trace("got event "+e.type+" at time "+t),log.trace("adding to queue - screen(width,height): "+screen.width+","+screen.height+" window(width,height): "+window.innerWidth+","+window.innerHeight));var i=a._utils.StorageUtils.getAndUpdateEventSequenceNumber(),s="visibilitychange"!==e.type?e.type:"hidden"===document.visibilityState?"tabBlur":"tabFocus",r=o.EnumDefs.Events.windowEventType[s];return null!=r&&r!==undefined||(r=-1),a._dataQueue.addToQueue("window_events",o.CDUtils.convertToArrayByMap(o.DataMappingDefs.WINDOW_EVENT_MAP,{eventType:r,eventSequence:i,timestamp:t,screenWidth:screen.width?Math.round(screen.width):-1,screenHeight:screen.height?Math.round(screen.height):-1,clientWidth:window.innerWidth?Math.round(window.innerWidth):-1,clientHeight:window.innerHeight?Math.round(window.innerHeight):-1,documentWidth:document.body&&document.body.clientWidth?Math.round(document.body.clientWidth):-1,documentHeight:document.body&&document.body.clientHeight?Math.round(document.body.clientHeight):-1,scrollTop:document.body&&document.body.scrollTop?Math.round(document.body.scrollTop):0,scrollLeft:document.body&&document.body.scrollLeft?Math.round(document.body.scrollLeft):0,windowInnerWidth:window.innerWidth?Math.round(window.innerWidth):-1,windowInnerHeight:window.innerHeight?Math.round(window.innerHeight):-1,windowOuterWidth:window.outerWidth?Math.round(window.outerWidth):-1,windowOuterHeight:window.outerHeight?Math.round(window.outerHeight):-1,isTrusted:n})),a.handlerEpilog("t.WE"),!0};var a=this;this._configMgr=e,this._utils=t,this._dataQueue=n,this._perfMonitor=i}(e.prototype=Object.create(o.Events.prototype)).startFeature=function(e){try{e||(e=window.self),this._utils.addEventListener(e,"resize",this.onWindowEvent,!1,!0),this._utils.addEventListener(e,"focus",this.onWindowEvent,!1,!0),this._utils.addEventListener(e,"blur",this.onWindowEvent,!1,!0),this._utils.addEventListener(window.document,"DOMContentLoaded",this.onWindowEvent),this._utils.addEventListener(e.document,"visibilitychange",this.onWindowEvent,!1,!0),this._configMgr.get("isScrollCollect")&&this._utils.addEventListener(e,"scroll",this.onWindowEvent,!1,!0)}catch(t){log.error("WindowEvents:startFeature failed, msg: "+t.message,t)}},e.prototype.stopFeature=function(e){try{e||(e=window.self),this._utils.removeEventListener(e,"resize",this.onWindowEvent),this._utils.removeEventListener(e,"focus",this.onWindowEvent),this._utils.removeEventListener(e,"blur",this.onWindowEvent),this._utils.removeEventListener(window.document,"DOMContentLoaded",this.onWindowEvent),this._utils.removeEventListener(e.document,"visibilitychange",this.onWindowEvent),this._configMgr.get("isScrollCollect")&&this._utils.removeEventListener(e,"scroll",this.onWindowEvent)}catch(t){log.error("WindowEvents:stopFeature failed, msg: "+t.message,t)}},e.prototype.updateFeatureConfig=function(e){e||(e=window.self),this._configMgr.get("isScrollCollect")?this._configMgr.get("isScrollCollect")&&this._utils.addEventListener(e,"scroll",this.onWindowEvent):this._utils.removeEventListener(e,"scroll",this.onWindowEvent)},o.WindowEvents=e}(vn),re=vn,ae=function(e){function r(e,t,n,i){Sn(this,r);var s=wn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i));return s._configMgr=e,s._utils=t,s._dataQueue=n,s._storageUtils=s._utils.StorageUtils,s._samplePeriod=s._configMgr.get("accelerometerEventsSamplePeriod")||0,s._samplePeriodGyro=s._configMgr.get("gyroEventsSamplePeriod")||0,s._lastX=0,s._lastY=0,s._lastZ=0,s._lastTime=0,s._lastAlpha=0,s._lastBeta=0,s._lastGamma=0,s._lastTimeGyro=0,s._onAccelerometerventFunc=s._onAccelerometerEvent.bind(s),s}return bn(r,re.Events),mn(r,[{key:"_onAccelerometerEvent",value:function(e){var t=this._utils.dateNow();if(e&&e.accelerationIncludingGravity&&t-this._lastTime>this._samplePeriod){var n=e.accelerationIncludingGravity.x,i=e.accelerationIncludingGravity.y,s=e.accelerationIncludingGravity.z;if(!(this._utils.isUndefinedNull(n)&&this._utils.isUndefinedNull(i)&&this._utils.isUndefinedNull(s)||(n=this._utils.isUndefinedNull(n)?-1:this._utils.cutDecimalPointDigits(n,4),i=this._utils.isUndefinedNull(i)?-1:this._utils.cutDecimalPointDigits(i,4),s=this._utils.isUndefinedNull(s)?-1:this._utils.cutDecimalPointDigits(s,4),n===this._lastX&&i===this._lastY&&s===this._lastZ))){var r=this._storageUtils.getAndUpdateEventSequenceNumber();this._lastTime=t,this._lastX=n,this._lastY=i,this._lastZ=s,this._dataQueue.addToQueue("accelerometer_events",[null,r,t,n,i,s]),log.isDebug()&&log.debug("AccelerometerEvents:_onAccelerometerEvent, sending data: timestamp:"+t+" x,y,z:"+n+","+i+","+s+", prevTime:"+this._lastTime)}}if(e&&e.rotationRate&&t-this._lastTimeGyro>this._samplePeriodGyro){var a=e.rotationRate.alpha,o=e.rotationRate.beta,u=e.rotationRate.gamma;if(!this._utils.isUndefinedNull(a)||!this._utils.isUndefinedNull(o)||!this._utils.isUndefinedNull(u)){var c=e.absolute||!1;if(a=this._utils.isUndefinedNull(a)?0:this._utils.cutDecimalPointDigits(a,4),o=this._utils.isUndefinedNull(o)?0:this._utils.cutDecimalPointDigits(o,4),u=this._utils.isUndefinedNull(u)?0:this._utils.cutDecimalPointDigits(u,4),a!==this._lastAlpha||o!==this._lastBeta||u!==this._lastGamma){this._lastTimeGyro=t,this._lastAlpha=a,this._lastBeta=o,this._lastGamma=u;var h=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQueue.addToQueue("gyro_events",[null,h,t,c,a,o,u]),log.isDebug()&&log.debug("GyroEvents:_onGyroEvent, sending data: timestamp:"+t+" alpha,betta,gamma:"+a+","+o+","+u+", prevTime:"+this._lastTimeGyro)}}}
return!0}},{key:"startFeature",value:function(){window.DeviceMotionEvent&&this._utils.addEventListener(window,"devicemotion",this._onAccelerometerventFunc)}},{key:"stopFeature",value:function(){window.DeviceMotionEvent&&this._utils.removeEventListener(window,"devicemotion",this._onAccelerometerventFunc)}},{key:"updateFeatureConfig",value:function(){this._samplePeriod=this._configMgr.get("accelerometerEventsSamplePeriod")!==undefined?this._configMgr.get("accelerometerEventsSamplePeriod"):this._samplePeriod,this._samplePeriodGyro=this._configMgr.get("gyroEventsSamplePeriod")!==undefined?this._configMgr.get("gyroEventsSamplePeriod"):this._samplePeriodGyro}}]),r}(),re.AccelerometerEvents=ae,oe=vn,ue=function(e){function r(e,t,n,i){Sn(this,r);var s=wn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,i));return s._dataQ=n,s._configMgr=e,s._utils=t,s._lastScreenOrientation=oe.EnumDefs.Events.screenOrientationType.undefined,s._onScreenOrientationEventFunc=s._onScreenOrientationEvent.bind(s),screen.mozOrientation&&screen.addEventListener?(s._eventTarget=screen,s._eventName="mozorientationchange"):screen.msOrientation&&screen.addEventListener?(s._eventTarget=screen,s._eventName="msorientationchange"):(s._eventTarget=window,s._eventName="orientationchange"),s}return bn(r,oe.Events),mn(r,[{key:"startFeature",value:function(){this._utils.addEventListener(this._eventTarget,this._eventName,this._onScreenOrientationEventFunc),this._handleScreenOrientationEvent(screen)}},{key:"stopFeature",value:function(){this._utils.removeEventListener(this._eventTarget,this._eventName,this._onScreenOrientationEventFunc)}},{key:"_onScreenOrientationEvent",value:function(e){var t=void 0;t=e&&e.target?e.target.screen||e.target:screen,this._handleScreenOrientationEvent(t)}},{key:"_handleScreenOrientationEvent",value:function(e){var t=e.mozOrientation||e.msOrientation||e.orientation;if(t!==undefined){var n=t.type||t,i=oe.EnumDefs.Events.screenOrientationType[n];if(i!==undefined){if(this._lastScreenOrientationType!=i){var s=this.getEventTimestamp(),r=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._lastScreenOrientationType=i,log.trace("onScreenOrientationEvent: Orientation changed to "+i+" at time "+s),this._dataQ.addToQueue("screen_orientation",oe.CDUtils.convertToArrayByMap(oe.DataMappingDefs.SCREEN_ORIENTATION_EVENT_MAP,{eventSequence:r,timestamp:s,orientation:i}))}}else log.error("onScreenOrientationEvent: Unknown orientation "+n+" value.")}else log.debug("onScreenOrientationEvent: Unable to find orientation data.")}}]),r}(),oe.ScreenOrientationEvents=ue,ce=vn,he=function(e){function a(e,t,n,i,s){Sn(this,a);var r=wn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,s));return r._configManager=e,r._utils=t,r._dataQ=i,r._elements=n,r._activeTouchActions={},r._tapMaxSlop=r._configManager.get("tapEventsTapMaxSlop")||20,r._longPressTimeout=r._configManager.get("tapEventsLongPressTimeout")||500,r._handleStartEventBind=r._handleStartEvent.bind(r),r._handleMoveEventBind=r._handleMoveEvent.bind(r),r._handleEndEventBind=r._handleEndEvent.bind(r),r._handleCancelEventBind=r._handleCancelEvent.bind(r),r._eventDefinitions=a.getSupportedTouchEvents(),r}return bn(a,ce.Events),mn(a,[{key:"startFeature",value:function(e){e||(e=window.self),this._bind(e)}},{key:"stopFeature",value:function(e){e||(e=window.self),this._unbind(e)}},{key:"updateFeatureConfig",value:function(){this._tapMaxSlop=this._configManager.get("tapEventsTapMaxSlop")!==undefined?this._configManager.get("tapEventsTapMaxSlop"):this._tapMaxSlop,this._longPressTimeout=this._configManager.get("tapEventsLongPressTimeout")!==undefined?this._configManager.get("tapEventsLongPressTimeout"):this._longPressTimeout}},{key:"_bind",value:function(e){if(this._eventDefinitions){var t=e.document||e.contentDocument;this._utils.addEventListener(t,this._eventDefinitions.startEvent,this._handleStartEventBind),this._utils.addEventListener(t,this._eventDefinitions.moveEvent,this._handleMoveEventBind),this._utils.addEventListener(t,this._eventDefinitions.endEvent,this._handleEndEventBind),this._utils.addEventListener(t,this._eventDefinitions.cancelEvent,this._handleCancelEventBind)}else log.debug("TapEvents:_bind - No event definitions. Might be a legacy browser. Aborting bind operation.")}},{key:"_unbind",value:function(e){if(this._eventDefinitions){var t=e.document||e.contentDocument;this._utils.removeEventListener(t,this._eventDefinitions.startEvent,this._handleStartEventBind),this._utils.removeEventListener(t,this._eventDefinitions.moveEvent,this._handleMoveEventBind),this._utils.removeEventListener(t,this._eventDefinitions.endEvent,this._handleEndEventBind),this._utils.removeEventListener(t,this._eventDefinitions.cancelEvent,this._handleCancelEventBind)}}},{key:"_handleStartEvent",value:function(e){this.handlerProlog("t.TapStartE");for(var t=this._getEventData(e),n=0;n<t.length;n++)this._activeTouchActions[t[n].identifier]={startTime:this.getEventTimestamp(),startX:t[n].touchData.pageX,startY:t[n].touchData.pageY,offsetX:0,offsetY:0};this.handlerEpilog("t.TapStartE")}},{key:"_handleMoveEvent",value:function(e){this.handlerProlog("t.TapMoveE");for(var t=this._getEventData(e),n=0;n<t.length;n++){var i=this._activeTouchActions[t[n].identifier];i.offsetX=Math.abs(t[n].touchData.pageX-i.startX),i.offsetY=Math.abs(t[n].touchData.pageY-i.startY)}this.handlerEpilog("t.TapMoveE")}},{key:"_handleEndEvent",value:function(e){this.handlerProlog("t.TapEndE");for(var t=this._getEventData(e),n=0;n<t.length;n++){var i=this._activeTouchActions[t[n].identifier];i.offsetX<this._tapMaxSlop&&i.offsetY<this._tapMaxSlop&&(this.getEventTimestamp()-i.startTime<this._longPressTimeout?this._sendEvent("tap_events",ce.DataMappingDefs.TAP_EVENT_MAP,t[n].identifier,t[n].touchData,t[n].eventArgs):this._sendEvent("longpress_events",ce.DataMappingDefs.LONGPRESS_EVENT_MAP,t[n].identifier,t[n].touchData,t[n].eventArgs)),delete this._activeTouchActions[t[n].identifier]}this.handlerEpilog("t.TapEndE")}},{key:"_handleCancelEvent",value:function(e){this.handlerProlog("t.TapCancelE");for(var t=this._getEventData(e),n=0;n<t.length;n++)delete this._activeTouchActions[t[n].identifier];this.handlerEpilog("t.TapCancelE")}},{key:"_getEventData",value:function(e){if(e.changedTouches==undefined)return null==e.pointerType||"touch"!=e.pointerType&&"pen"!=e.pointerType&&e.pointerType!=e.MSPOINTER_TYPE_TOUCH&&e.pointerType!=e.MSPOINTER_TYPE_PEN?[]:[{identifier:e.pointerId?e.pointerId:0,touchData:e,eventArgs:e}];for(var t=[],n=0;n<e.changedTouches.length;n++){var i=e.changedTouches[n],s=i.identifier;t.push({identifier:s,touchData:i,eventArgs:e})}return t}},{key:"_sendEvent",value:function(e,t,n,i,s){var r=this.getEventTimestamp(),a=ce.EnumDefs.Events.isTrusted[s.isTrusted],o=this._elements.getElement(s.target),u=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._utils.isUndefinedNull(n)&&(n=0),this._dataQ.addToQueue(e,ce.CDUtils.convertToArrayByMap(t,{eventSequence:u,timestamp:r,screenX:i.screenX?Math.round(i.screenX):0,screenY:i.screenY?Math.round(i.screenY):0,pageX:i.pageX||0,pageY:i.pageY||0,clientX:i.clientX||0,clientY:i.clientY||0,isTrusted:a,elementHash:o,touchIndex:n%1e4,touchSizeMajor:i.radiusX?2*i.radiusX:0,touchSizeMinor:i.radiusY?2*i.radiusY:0}))}}],[{key:"getSupportedTouchEvents",value:function(){return window.TouchEvent?{startEvent:"touchstart",moveEvent:"touchmove",endEvent:"touchend",cancelEvent:"touchcancel"}:window.PointerEvent?{startEvent:"pointerdown",moveEvent:"pointermove",endEvent:"pointerup",cancelEvent:"pointercancel"}:void log.debug("TapEvents:_createEventsToListenList - No touch support for browser.")}}]),a}(),ce.TapEvents=he,de=vn,le=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,n));return i._onScriptExecuteEventFunc=i._onScriptExecuteEvent.bind(i),i._dataQueue=t,i._utils=e,i}return bn(s,de.Events),mn(s,[{key:"_onScriptExecuteEvent",value:function(e){if(e&&e.target&&("load"!==e.type||"script"===e.target.nodeName.toLowerCase()))try{this.handlerProlog("t.SE_E");var t=this.getEventTimestamp(e),n=this._utils.StorageUtils.getAndUpdateEventSequenceNumber(),i=de.EnumDefs.Events.scriptEventType[e.type];this._utils.isUndefinedNull(i)&&(i=-1),log.isDebug()&&log.trace("got event "+e.type+", "+i+", scriptSrc: "+e.target.src+" at time "+t),this._dataQueue.addToQueue("script_events",de.CDUtils.convertToArrayByMap(de.DataMappingDefs.SCRIPT_EVENT_MAP,{eventSequence:n,timestamp:t,eventType:i,scriptId:e.target.id||"",namespaceURI:e.target.namespaceURI||"",outerHTML:e.target.outerHTML||"",scriptSource:e.target.src||"",scriptType:e.target.type||""})),this.handlerEpilog("t.SE_E")}catch(s){this.handlerCancelog("t.SE_E"),log.error("error on getScriptExecuteEvent "+s.toString())}}},{key:"startFeature",value:function(){this._utils.addEventListener(document,"load",this._onScriptExecuteEventFunc,!0)}},{key:"stopFeature",value:function(){this._utils.removeEventListener(document,"load",this._onScriptExecuteEventFunc,!0)}}]),s}(),de.ScriptEvents=le,fe=vn,ge=function(){function i(e,t,n){Sn(this,i),this._historyBuffer=[],this._isTouchInProgress=!1,this._touchStartCount=0,this._isPostTouch=!1,this._touchEndTime=0,this._dataQueue=t,this._configMgr=e,this._msgBus=n,this._msgBus.subscribe(fe.MessageBusEventType.TouchEvent,this._onTouch.bind(this)),this._msgBus.subscribe(fe.MessageBusEventType.KeyEvent,this._onTouch.bind(this)),this._isMotionAroundTouchEnabled=this._configMgr.get("isMotionAroundTouchEnabled")===undefined||this._configMgr.get("isMotionAroundTouchEnabled"),this._aroundTouchInterval=this._configMgr.get("motionPaddingAroundTouchMSec")!==undefined?this._configMgr.get("motionPaddingAroundTouchMSec"):1e3}return mn(i,[{key:"addToQueue",value:function(e,t,n,i){var s=fe.CDUtils.dateNow();if(this._isPostTouch&&s-this._touchEndTime>this._aroundTouchInterval&&(log.debug("SensorsDataQueue: stopped post touch events, time has passed ("+this._aroundTouchInterval+" millisec)"),this._isPostTouch=!1),!this._isMotionAroundTouchEnabled||this._isTouchInProgress||this._isPostTouch)this._dataQueue.addToQueue(e,t,n,i);else{this._historyBuffer.push({name:e,data:t,addCtxId:n,isImmediateWup:i,timestamp:s});for(var r=0,a=this._historyBuffer.length;r<a&&s-this._historyBuffer[0].timestamp>this._aroundTouchInterval;r++)this._historyBuffer.shift()}}},{key:"onConfigUpdate",value:function(){this._aroundTouchInterval=this._configMgr.get("motionPaddingAroundTouchMSec")!==undefined?this._configMgr.get("motionPaddingAroundTouchMSec"):this._aroundTouchInterval,this._isMotionAroundTouchEnabled=this._configMgr.get("isMotionAroundTouchEnabled")!==undefined?this._configMgr.get("isMotionAroundTouchEnabled"):this._isMotionAroundTouchEnabled}},{key:"_sendBuffer",value:function(){var e=fe.CDUtils.dateNow();log.debug("sending history sensors buffer ts="+e);for(var t=0,n=this._historyBuffer.length;t<n;t++)e-this._historyBuffer[t].timestamp<=this._aroundTouchInterval&&this._dataQueue.addToQueue(this._historyBuffer[t].name,this._historyBuffer[t].data,this._historyBuffer[t].addCtxId,this._historyBuffer[t].isImmediateWup);this._historyBuffer=[]}},{key:"_onTouch",value:function(e){return this._isMotionAroundTouchEnabled&&(this._isTouchInProgress||e.action!==fe.EnumDefs.Events.touchEventType.touchstart&&e.action!==fe.EnumDefs.Events.keyEventType.keydown?e.action===fe.EnumDefs.Events.touchEventType.touchend||e.action===fe.EnumDefs.Events.keyEventType.keyup?(this._touchStartCount--,this._touchStartCount<=0&&(this._isTouchInProgress=!1,this._isPostTouch=!0,this._touchEndTime=fe.CDUtils.dateNow(),log.debug("stopped touch event in sensors data q ts="+fe.CDUtils.dateNow()))):e.action!==fe.EnumDefs.Events.touchEventType.touchstart&&e.action!==fe.EnumDefs.Events.keyEventType.keydown||this._touchStartCount++:(log.debug("Started touch event in sensors data q ts="+fe.CDUtils.dateNow()),this._isTouchInProgress=!0,this._touchStartCount=1,this._sendBuffer())),!1}}]),i}(),fe.SensorsDataQueue=ge,_e=vn,pe=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,n));return i._dataQueue=t,i._utils=e,i._connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection,i}return bn(s,_e.Events),mn(s,[{key:"onChangeNetworkInfo",value:function(){log.debug("NetInfoEvents:onChangeNetworkInfo");var e=this._utils.isUndefinedNull(this._connection.saveData)?"":this._connection.saveData.toString(),t=this.getEventTimestamp(),n=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQueue.addToQueue("net_info_events",_e.CDUtils.convertToArrayByMap(_e.DataMappingDefs.NETINFO_EVENT_MAP,{eventSequence:n,timestamp:t,connectionType:this._connection.type?this._connection.type:"",effectiveType:this._connection.effectiveType?this._connection.effectiveType:"",downlinkMax:this._connection.downlinkMax?this._connection.downlinkMax.toString():"",downlink:this._connection.downlink?this._connection.downlink.toString():"",rtt:this._connection.rtt?this._connection.rtt.toString():"",isSaveData:e}))}},{key:"startFeature",value:function(){this._connection&&(this._connection.addEventListener("change",this.onChangeNetworkInfo.bind(this),!0),this.onChangeNetworkInfo())}},{key:"stopFeature",value:function(){this._connection&&this._connection.removeEventListener("change",this.onChangeNetworkInfo.bind(this))}}]),s}(),_e.NetInfoEvents=pe,ve=vn,me=function(e){function i(e,t){Sn(this,i);var n=wn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n._utils=e,n._currState=null,n._dataQueue=t,n._tabData={id:"",openTabTS:0},n}return bn(i,ve.Events),mn(i,[{key:"startFeature",value:function(){log.info("Starting tab events feature"),this._initTabInfo(),ve.CDUtils.addEventListener(window,"beforeunload",this._onUnloadTab.bind(this))}},{key:"stopFeature",value:function(){log.info("Stopping tab events feature"),this._utils.removeEventListener(window,"beforeunload",this._onUnloadTab.bind(this))}},{key:"_initTabInfo",value:function(){var e=this._utils.StorageUtils.getFromLocalStorage("cdTabList");e||(e=[]);var t=ve.EnumDefs.Events.tabEventType.openTab;this._tabData=this._utils.StorageUtils.getFromSessionStorage("cdTabData")||this._tabData.id,this._tabData||(this._updateTabData(),t=ve.EnumDefs.Events.tabEventType.newTab);for(var n=-1,i=0,s=e.length;i<s;i++)if(e[i][0]===this._tabData.id){n=i;break}-1!==n&&n!==e.length||(e.push([this._tabData.id,this._tabData.openTabTS]),this._utils.StorageUtils.saveToLocalStorage("cdTabList",e),log.debug("added tab to list. "+this._tabData.id+", tab index="+e.length));var r=this._utils.getDocUrl(),a=this._utils.StorageUtils.getAndUpdateEventSequenceNumber(),o=JSON.stringify(e);this._dataQueue.addToQueue("tab_events",ve.CDUtils.convertToArrayByMap(ve.DataMappingDefs.TAB_EVENT_MAP,{eventSequence:a,timestamp:this._tabData.openTabTS,type:t,id:this._tabData.id||"",href:r||"",referrer:ve.CDUtils.clearTextFromNumbers(document.referrer),currentTabsList:o||""}))}},{key:"_onUnloadTab",value:function(e){var t=this._utils.StorageUtils.getFromLocalStorage("cdTabList");t||(t=[]);var n=this.getEventTimestamp(),i=this._utils.StorageUtils.getAndUpdateEventSequenceNumber(),s=this._utils.getDocUrl(),r=ve.EnumDefs.Events.tabEventType.closeTab,a=JSON.stringify(t);log.debug("removing tab from list. id:"+this._tabData.id+", timestamp:"+n),this._dataQueue.addToQueue("tab_events",ve.CDUtils.convertToArrayByMap(ve.DataMappingDefs.TAB_EVENT_MAP,{eventSequence:i,timestamp:n,type:r,id:this._tabData.id||"",href:s||"",referrer:ve.CDUtils.clearTextFromNumbers(document.referrer),currentTabsList:a||""}),!0,!0);for(var o=0,u=t.length;o<u;o++)if(t[o][0]===this._tabData.id){t.splice(o,1);break}this._utils.StorageUtils.saveToLocalStorage("cdTabList",t)}},{key:"_updateTabData",value:function(){this._tabData={},this._tabData={id:this._utils.generateUUID(),openTabTS:this.getEventTimestamp()},log.debug("initialize tab data: id:"+this._tabData.id+", timestamp:"+this._tabData.openTabTS),this._utils.StorageUtils.saveToSessionStorage("cdTabData",this._tabData)}}]),i}(),ve.TabsEvents=me,ye=vn,we=function(e){function i(e,t){Sn(this,i);var n=wn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n._dataQueue=e,n._configManager=t,n._eventThreshold=n._configManager.get("lightSensorEventThreshold")||5e3,n._lastTime=0,n}return bn(i,ye.Events),mn(i,[{key:"_onReadingSensor",value:function(){var e=this.getEventTimestamp();if(e-this._lastTime>this._eventThreshold){var t=ye.CDUtils.StorageUtils.getAndUpdateEventSequenceNumber();this._lastTime=e,this._dataQueue.addToQueue("ambient_light_level",ye.CDUtils.convertToArrayByMap(ye.DataMappingDefs.AMBIENT_LIGHT_EVENT_MAP,{eventSequence:t,timestamp:e,illuminance:this._sensor.illuminance}))}}},{key:"startFeature",value:function(){window.AmbientLightSensor?(log.info("AmbientLightSensor exists and collected"),this._sensor=new AmbientLightSensor,ye.CDUtils.addEventListener(this._sensor,"reading",this._onReadingSensor.bind(this)),ye.CDUtils.addEventListener(this._sensor,"error",i._onSensorError),this._sensor.start()):log.debug("LightSensor does not exist, not collecting")}},{key:"stopFeature",value:function(){this._sensor&&(ye.CDUtils.removeEventListener(this._sensor,"reading",this._onReadingSensor.bind(this)),ye.CDUtils.removeEventListener(this._sensor,"error",i._onSensorError),this._sensor=null)}},{key:"updateFeatureConfig",value:function(){this._eventThreshold=this._configManager.get("lightSensorEventThreshold")?this._configManager.get("lightSensorEventThreshold"):this._eventThreshold}}],[{key:"_onSensorError",value:function(e){log.debug("Error connecting LightSensor "+e.error)}}]),i}(),ye.LightSensorEvents=we,be=vn,Se=function(){function e(){Sn(this,e),this._initialize()}return mn(e,[{key:"_initialize",value:function(){this._nodeParentHash=new WeakMap,this._nodeNameOccurencesPerParent=[],this._nodeNameOccurencesPerParent.push({})}},{key:"getUniqueElementName",value:function(e){return e.nodeName.toLowerCase()+(e.id||"")+(e.name||"")+(e.href||"")+(e.getAttribute&&e.getAttribute("class")||"")+(e.title||"")}},{key:"produce",value:function(e){var t=[],n=e,i=(e.id||"")+(e.name||"")+(e.nodeName||"")+(e.className||"")+(e.title||"")+(e.href||""),s=!1;if(e.parentNode&&this._nodeParentHash.has(e.parentNode)){var r=e.nodeName.toLowerCase(),a=this._nodeParentHash.get(e.parentNode),o=a.occurrencesIndex,u=0;return this._nodeNameOccurencesPerParent[o]&&("undefined"!=typeof this._nodeNameOccurencesPerParent[o][r]?u=this._nodeNameOccurencesPerParent[o][r]=++this._nodeNameOccurencesPerParent[o][r]:this._nodeNameOccurencesPerParent[o][r]=0),i+=a.hash+","+this.getUniqueElementName(e)+(u||"")}s=!!e.parentNode&&e.parentNode;for(var c=0;e&&1===e.nodeType;e=e.parentNode){for(var h=0,d=e.previousSibling;d;d=d.previousSibling)d.nodeType!==Node.DOCUMENT_TYPE_NODE&&d.nodeName===e.nodeName&&(c=++h);var l=this.getUniqueElementName(e),f=h||"";t.splice(0,0,l+f)}i+=t.length?"/"+t.join():"";var g=[];if(0<t.length&&(g=t.slice(0,t.length-1)),s){var _={};_[n.nodeName.toLowerCase()]=c;var p=this._nodeNameOccurencesPerParent.push(_)-1;this._nodeParentHash.set(s,{hash:"/"+g.join(),occurrencesIndex:p})}return i}}]),e}(),be.XPathHashProducer=Se,Ee=vn,ke=function(e){function t(){return Sn(this,t),wn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return bn(t,Ee.AbstractFeature),mn(t,[{key:"startFeature",value:function(){this.preFeature("dnt");var e=navigator.doNotTrack;e===undefined&&(e=window.doNotTrack)===undefined&&(e=navigator.msDoNotTrack),e=null===e||"unspecified"===e||"0"===e?0:"1"===e?1:2,this._dataQ.addToQueue("static_fields",["dnt",e],!1),this.postFeature("dnt")}}]),t}(),Ee.DoNotTrackFeature=ke,Ce=vn,Me=function(e){function c(e,t,n,i,s){Sn(this,c);var r=wn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e,t));return r._pointerHoverDetector=n,r._utils=i,r._configMgr=s,r}return bn(c,Ce.AbstractFeature),mn(c,[{key:"startFeature",value:function(){var t=this;log.info("Collecting Browser Props"),this.preFeature("BrowserPropsFeature"),this._dataQ.addToQueue("static_fields",["version_client",Ce.CDUtils.scriptVersion],!1),this._dataQ.addToQueue("static_fields",["device_source","js"],!1),log.info("SDK Version is "+Ce.CDUtils.scriptVersion);var e=void 0;(e=c.getLanguage())&&(this._configMgr.get("browserPropsShouldHashLanguageField")&&(log.debug("Hashing language field according to configuration"),e=this._utils.getHash(e).toString()),this._dataQ.addToQueue("static_fields",["main_lang",e],!1)),this._dataQ.addToQueue("static_fields",["os",window.navigator.platform],!1);var n=c.getOperatingSystem();this._dataQ.addToQueue("static_fields",["os_version",n.version],!1),this._dataQ.addToQueue("static_fields",["os_family",n.name],!1);var i=this._pointerHoverDetector.getPointerHover();if(this._dataQ.addToQueue("static_fields",["input_mech",[i.pointer,i.hover]],!1),this._dataQ.addToQueue("static_fields",["cores",window.navigator.hardwareConcurrency||0],!1),navigator.languages){var s=navigator.languages;this._configMgr.get("browserPropsShouldHashLanguageField")&&(log.debug("Hashing languages field according to configuration"),s=Array.from(s,function(e){return t._utils.getHash(e).toString()})),this._dataQ.addToQueue("static_fields",["languages",s],!1)}var r=c.getPlugins();r&&0<r.length&&this._dataQ.addToQueue("static_fields",["plugins",r],!1),this._dataQ.addToQueue("static_fields",["js_ua",navigator.userAgent],!1);var a=-1*(new Date).getTimezoneOffset();this._dataQ.addToQueue("static_fields",["time_zone",a],!1);var o=c.checkCookie();this._dataQ.addToQueue("static_fields",["cookie_enabled",o],!1);var u=navigator.deviceMemory||0;this._dataQ.addToQueue("static_fields",["device_memory",u],!1),log.info("Browser Props collected"),this.postFeature("BrowserPropsFeature")}}],[{key:"getLanguage",value:function(){if(navigator){if(navigator.language)return navigator.language;if(navigator.userLanguage)return navigator.userLanguage}return undefined}},{key:"getPlugins",value:function(){try{var e=[];if(window.navigator.plugins&&0<window.navigator.plugins.length)for(var t=0,n=window.navigator.plugins.length;t<n;t++)e.push([navigator.plugins[t].name,navigator.plugins[t].filename,navigator.plugins[t].description,navigator.plugins[t].version?navigator.plugins[t].version:""]);else if(window.navigator.mimeTypes&&0<window.navigator.mimeTypes.length)for(var i=0;i<window.navigator.mimeTypes.length;i++)e.push([window.navigator.mimeTypes[i].type,"",window.navigator.mimeTypes[i].description,""]);return e}catch(s){log.warn("getPlugins error: "+s.message+" e:"+s)}}},{key:"checkCookie",value:function(){var e=navigator.cookieEnabled;return e||(Ce.CDUtils.StorageUtils.setCookie("testcookie","1",6e4),e=-1!=document.cookie.indexOf("testcookie")),e}},{key:"getOperatingSystem",value:function(){for(var e=[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],t=[navigator.platform,navigator.oscpu||navigator.appVersion].join(" "),n="",i="Unknown",s=void 0,r=void 0,a=0;a<e.length;a++)if(new RegExp(e[a].value,"i").test(t)){if(s=new RegExp(e[a].version+"[- /:;]([\\d._]+)","i"),r=t.match(s)){r[1]&&(r=r[1]),r=r.split(/[._]+/);for(var o=0;o<r.length;o++)n+=0===o?r[o]+".":r[o]}i=e[a].name;break}return{version:parseFloat(n)||null,name:i}}}]),c}(),Ce.BrowserPropsFeature=Me,Te=vn,De=function(){function r(){Sn(this,r)}return mn(r,[{key:"detectPrivateMode",value:function(t){var n;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){n=!1},function(e){n=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var i;try{var e=indexedDB||window.indexedDB;(i=e.open("test")).onerror=function(e){n=!0}}catch(s){n=!0}"undefined"==typeof n&&r.retry(function(){return"done"===i.readyState},function(e){e||(n=i.result===undefined||"undefined"===i.result||null===i.result)})}else if(r.isIE10OrLater(window.navigator.userAgent)){n=!1;try{window.indexedDB||(n=!0)}catch(s){n=!0}}else window.localStorage&&/Safari/.test(window.navigator.userAgent)&&(n=this._isPrivateBrowsingOnSafari());r.retry(function(){return!!n},function(e){t(n)})}},{key:"_isPrivateBrowsingOnSafari",value:function(){var e=void 0;try{window.openDatabase(null,null,null,null)}catch(t){e=!0}try{window.localStorage.setItem("test",1)}catch(t){e=!0}return e||(e=!1,window.localStorage.removeItem("test")),e}}],[{key:"retry",value:function(e,t){var n=0,i=!1,s=window.setInterval(function(){e()&&(window.clearInterval(s),t(i)),50<n++&&(window.clearInterval(s),t(i=!0))},10)}},{key:"isIE10OrLater",value:function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);if(n&&10<=parseInt(n[1],10))return!0;if(1==(n="documentElement"in document&&("filters"in document.documentElement||"documentMode"in document))&&document.documentMode&&10<=parseFloat((t.match(/.+(?:ie|rv)[\/: ]([\d.]+)/)||[])[1]))return!0;n=/edge/.test(t);var i=!!t.match(/trident\/7\./);return!!((n||i)&&10<=parseFloat((t.match(/.+(?:edge|rv)[\/: ]([\d.]+)/)||[])[1]))}}]),r}(),Te.PrivateBrowsingDetector=De,xe=vn,Fe=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return i._privateBrowsingDetector=n,i}return bn(s,xe.AbstractFeature),mn(s,[{key:"startFeature",value:function(){var t=this;this.preFeature("is_private_browsing"),this._privateBrowsingDetector.detectPrivateMode(function(e){t._dataQ.addToQueue("static_fields",["is_private_browsing",e],!1),t.postFeature("is_private_browsing")})}}]),s}(),xe.IsPrivateBrowsingFeature=Fe,Ae=vn,Re=function(){function n(){Sn(this,n)}return mn(n,null,[{key:"getPointerHover",value:function(){var e={pointer:n.POINTER_TYPE.NOT_SUPPORTED,hover:n.POINTER_TYPE.NOT_SUPPORTED};if(window.matchMedia){var t=window.matchMedia;t("( any-pointer: fine )").matches?e.pointer=n.POINTER_TYPE.FINE:t("( any-pointer: coarse )").matches?e.pointer=n.POINTER_TYPE.COARSE:t("( any-pointer: none )").matches?e.pointer=n.POINTER_TYPE.NONE:t("( any-pointer )").matches&&(e.pointer=n.POINTER_TYPE.ANY),t("( any-hover: hover )").matches?e.hover=n.HOVER_TYPE.HOVER:t("( any-hover: on-demand )").matches?e.hover=n.HOVER_TYPE.ON_DEMAND:t("( any-hove: none )").matches?e.hover=n.HOVER_TYPE.NONE:window.matchMedia("( any-hover )").matches&&(e.hover=n.HOVER_TYPE.ANY)}return e}}]),n}(),Object.extend(Re,{POINTER_TYPE:{FINE:1,COARSE:2,NONE:3,ANY:4,NOT_SUPPORTED:5},HOVER_TYPE:{HOVER:1,ON_DEMAND:2,NONE:3,ANY:4,NOT_SUPPORTED:5}}),Ae.PointerHoverDetector=Re,Pe=vn,Ue=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return i._configMgr=n,i._addrsLocal={"0.0.0.0":!1,"127.0.0.1":!1},i._addrsGlobal={},i._ip_regex=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/,i}return bn(s,Pe.AbstractFeature),mn(s,[{key:"startFeature",value:function(){var n=this;Pe.CDUtils.DomUtils.onDocumentBody(window,function(){n.preFeature("lg_ips");try{n._calculateIps()}catch(e){log.error("Unable to collect ip information. "+e)}n._timer=setTimeout(function(){n._rtcIframe&&(document.body.removeChild(n._rtcIframe),n._rtcIframe=null);var e=n._getLocalIps();0<e.length&&n._dataQ.addToQueue("static_fields",["l_ips",e],!1);var t=n._getGlobalIps();0<t.length&&n._dataQ.addToQueue("static_fields",["g_ips",t],!1),n.postFeature("lg_ips")},n._configMgr.get(Pe.ConfigurationFields.ipDetectorTimeout))})}},{key:"stopFeature",value:function(){this._timer&&clearTimeout(this._timer)}},{key:"_calculateIps",value:function(){var n=this,e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!e){this._rtcIframe=document.createElement("iframe"),this._rtcIframe.sandbox="allow-same-origin allow-scripts",this._rtcIframe.id=Pe.EnumDefs.SystemFrameName.rtcframe,this._rtcIframe.style.display="none",this._rtcIframe.style.position="absolute",this._rtcIframe.style.zIndex="-1",this._rtcIframe.height=0,this._rtcIframe.width=0,document.body.appendChild(this._rtcIframe);var t=this._rtcIframe.contentWindow;e=t.RTCPeerConnection||t.mozRTCPeerConnection||t.webkitRTCPeerConnection}if(!e)return log.info("Browser has no RTC support. Unable to detect IP."),document.body.removeChild(this._rtcIframe),void(this._rtcIframe=null);var i=new e({iceServers:[{url:"stun:stun.l.google.com:19302",urls:"stun:stun.l.google.com:19302"}],sdpSemantics:"plan-b"},{optional:[{RtpDataChannels:!0}]});i.createDataChannel&&i.createDataChannel("");var s=function s(e){var t=n._ip_regex.exec(e);t&&t[1]&&n._addIpToList(t[1])};i.onicecandidate=function(e){e.candidate&&s(e.candidate.candidate)},this._createOffer(i)}},{key:"_createOffer",value:function(t){try{t.createOffer().then(function(e){return t.setLocalDescription(e)})["catch"](function(e){log.warn("LocalIpDetect, offer failed "+e.message,e)})}catch(e){t.createOffer(function(e){t.setLocalDescription(e,function(){},function(){})},function(e){log.warn("LocalIpDetect, offer failed "+e.message,e)})}}},{key:"_getLocalIps",value:function(){var t=this;return Object.keys(this._addrsLocal).filter(function(e){return t._addrsLocal[e]})}},{key:"_getGlobalIps",value:function(){return Object.keys(this._addrsGlobal)}},{key:"_addIpToList",value:function(e){e in this._addrsLocal||e in this._addrsGlobal||(e.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?this._addrsLocal[e]=!0:this._addrsGlobal[e]=!0)}}]),s}(),Pe.IpDetectorFeature=Ue,Ie=vn,Le=function(){function e(){Sn(this,e),this._baseFonts=["monospace","sans-serif","serif"],this._testString="mmmmmmmmmmlli",this._testSize="72px",this._chunkSize=30,this._defaultWidth={},this._defaultHeight={},this._body=null,this._iframe=null,this._spanArray=null,this._allFontsDiffs=[]}return mn(e,[{key:"clear",value:function(){this._body.removeChild(this._iframe),this._iframe=null,this._spanArray=null,this._allFontsDiffs=[]}},{key:"init",value:function(e){if(this._body=document.body,!this._body)return"";this._iframe=document.createElement("iframe"),this._iframe.id=Ie.EnumDefs.SystemFrameName.fontDetectionFrame,this._iframe.style.visibility="hidden",this._iframe.style.zIndex="-1",this._iframe.style.width=0,this._iframe.style.height=0,this._body.appendChild(this._iframe),this._iframe.contentDocument.body||(this._iframe.style.width=null,this._iframe.style.height=null,this._iframe.contentDocument.appendChild(document.createElement("body")));var t=this;Ie.CDUtils.DomUtils.onWindowDocumentReady(this._iframe.contentWindow,function(){t._createCalculationElements(e)})}},{key:"_createCalculationElements",value:function(e){var t=document.createElement("span");t.style.fontSize=this._testSize,t.style.visibility="hidden",t.style.position="absolute",t.style.zIndex="-1",t.style.lineHeight="normal",t.innerHTML=this._testString;for(var n=0;n<this._baseFonts.length;n++)t.style.fontFamily=this._baseFonts[n],this._iframe.contentDocument.body.appendChild(t),this._defaultWidth[this._baseFonts[n]]=t.offsetWidth,this._defaultHeight[this._baseFonts[n]]=t.offsetHeight,this._iframe.contentDocument.body.removeChild(t);log.debug("FontsDetector:init - base fonts width: \n                "+this._baseFonts[0]+":"+this._defaultWidth[this._baseFonts[0]]+";\n                "+this._baseFonts[1]+":"+this._defaultWidth[this._baseFonts[1]]+";\n                "+this._baseFonts[2]+":"+this._defaultWidth[this._baseFonts[2]]),log.debug(
"FontsDetector:init - base fonts height: \n                "+this._baseFonts[0]+":"+this._defaultHeight[this._baseFonts[0]]+";\n                "+this._baseFonts[1]+":"+this._defaultHeight[this._baseFonts[1]]+";\n                "+this._baseFonts[2]+":"+this._defaultHeight[this._baseFonts[2]]),this._createSpanArray(),e()}},{key:"_createSpanArray",value:function(){var e=document.createElement("div");e.id="currentDiv",e.style.position="absolute",e.style.visibility="hidden";for(var t=0;t<this._chunkSize;t++){var n=document.createElement("span");n.style.lineHeight="normal",n.style.position="absolute",n.style.zIndex="-1",n.style.fontSize=this._testSize,n.innerHTML=this._testString,e.appendChild(n);var i=document.createElement("br");e.appendChild(i)}this._iframe.contentDocument.body.appendChild(e),this._spanArray=e}},{key:"detectByChunksWithIndex",value:function(e,t,n){var i=[],s=0,r=0;if(!this._spanArray)return i;for(var a=this._spanArray.getElementsByTagName("span"),o=this._defaultWidth[this._baseFonts[t]],u=this._defaultHeight[this._baseFonts[t]],c=0;c<e.length;c++){if(r>=this._chunkSize)for(var h=r=0;h<a.length;h++){var d=Math.abs(a[h].offsetWidth-o),l=Math.abs(a[h].offsetHeight-u);this._allFontsDiffs.push([a[h].id,d,l]),(1<d||1<l)&&(i[s]=a[h].id,s++)}a[r].style.fontFamily=e[c]+","+this._baseFonts[t],a[r].id=e[c],r++}n(i)}},{key:"getAllFontsDiffs",value:function(){return this._allFontsDiffs}}]),e}(),Ie.FontsDetector=Le,Be=vn,Ne=function(e){function r(e,t,n,i){Sn(this,r);var s=wn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n));return s._utils=e,s._fontDetectorCtor=i,s._storageKeyName="detectedFonts_2.1.5",s._legacyStorageKeyName="detectedFonts",s._serif_fonts=["adobe jenson","adobe text","albertus","aldus","alexandria","algerian","american typewriter","antiqua","arno","aster","aurora","baskerville","bell","bembo","bembo schoolbook","benguiat","berkeley old style","bernhard modern","bodoni","book antiqua","bookman","bordeaux roman","californian fb","calisto","capitals","cambria","cartier","caslon","caslon antique","catull","centaur","century old style","century schoolbook","new century schoolbook","chaparral","charis sil","cheltenham","clearface","cochin","colonna","computer modern","concrete roman","constantia","cooper black","corona","dejavu fonts","ecotype","elephant","espy serif","excelsior","fairfield","ff scala","footlight","freeserif","friz quadrata","garamond","gentium","georgia","gloucester","goudy old style","goudy schoolbook","goudy pro font","granjon","heather","hercules","high tower text","hiroshige","hoefler text","humana serif","imprint","ionic no. 5","janson","jenson","joanna","korinna","kursivschrift","legacy serif","lexicon","liberation fonts","linux libertine","literaturnaya","lucida","melior","memphis","miller","minion","didone","mona lisa","mrs eaves","ms serif","new york","nimbus roman","nps rawlinson roadway","ocr a extended","palatino","perpetua","plantin","plantin schoolbook","playbill","poor richard","rawlinson roadway","renault","requiem","roman","rotis serif","sabon","seagull","sistina","souvenir","stix","stone informal","stone serif","sylfaen","times new roman","times","trajan","trinité","trump mediaeval","utopia","vale type","bitstream vera","versailles","wanted","weiss","wide latin","windsor","xits","apex","archer","athens","city","cholla slab","clarendon","courier","egyptienne","guardian egyptian","lexia","museo slab","rockwell","nilland","skeleton antique","tower"],s._sans_serif_fonts=["abadi","agency fb","akzidenz grotesk","aptifer","arial","arial unicode ms","avant garde","avenir","bank gothic","barmeno","bauhaus","bell centennial","bell gothic","benguiat gothic","berlin sans","beteckna","brandon grotesque","cabin","cafeteria","calibri","century gothic","charcoal","chicago","clearface gothic","clearview","co headline","co text","compacta","corbel","ff dax","dotum","droid","dyslexie","ecofont","eras","espy sans","nu sans","eurocrat","eurostile","ff meta","flama","formata","freesans","franklin gothic","frutiger","futura","geneva","gill sans","gill sans schoolbook","gotham","handel gothic","denmark","haettenschweiler","hei","helvetica","helvetica neue","swiss 721","highway gothic","hiroshige sans","hobo","impact","industria","interstate","johnston","kabel","lato","legacy sans","lexia readable","meiryo","microgramma","motorway","ms sans serif","museo sans","myriad","neutraface","neuzeit s","news gothic","nimbus sans l","nina","optima","parisine","pricedown","prima sans","pt sans","rail alphabet","revue","roboto","rotis sans","ff scala sans","segoe","skia","souvenir gothic","stone sans","syntax","tahoma","template gothic","tiresias","trade gothic","transport alphabet","trebuchet ms","trump gothic","tw cen","twentieth century","ubuntu font family","univers","zurich","verdana","virtue"],s._monospace_fonts=["andale mono","anonymous","consolas","courierhp","courier new","courierps","fontcraft courier","everson mono","fedra mono","fixed","fixedsys","fixedsys excelsior","inconsolata","hyperfont","letter gothic","magnetic ink character recognition","menlo","miriam fixed","monaco","monofur","monospace","ms gothic","ms mincho","nimbus mono l","ocr-a","ocr-b","orator","ormaxx","pragmatapro","prestige elite","profont","proggy programming fonts","small fonts","sydnie","terminal","tex gyre cursor","um typewriter","william monospace","balloon","brush script","dragonwick","choc","dom casual","mistral","papyrus","tempus sans","amazone","ams euler","apple chancery","aristocrat","bickley script","civitype","codex","edwardian script","forte","french script","kuenstler script","monotype corsiva","old english text mt","palace script","park avenue","scriptina","shelley volante","vivaldi","vladimir script","zapf chancery","zapfino","andy","ashley script","chalkboard","comic sans","cezanne","fontoon","irregularis","jefferson","kristen","lucida handwriting","rage italic","rufscript","scribble","soupbone","tekton","alecko","cinderella","cupola","curlz","magnificat","script","american text","cloister black","fraktur","goudy text","old english text","wedding text","aegyptus","aharoni","aisha","amienne","batak script","chandas","hanacaraka","japanese gothic typeface","jomolhari","kochi font","lontara script","maiola","minchō","mona font","nassim","nastaliq navees","neacademia","perpetua greek","simsun","skolar","skolar devanagari","sundanese unicode","sutturah","tai le valentinium","tengwar","tibetan machine uni","tunga","wadalab","apple symbols","bookshelf symbol 7","braille","commercial pi","corel","erler dingbats","hm phonetic","mathematical pi","morse code","opensymbol","richstyle","symbol","symbolps","wingdings","wingdings 2","wingdings 3","webdings","zapf dingbats","abracadabra","ad lib","allegro","andreas","arnold böcklin","astur","balloon pop outlaw black","banco","beat","braggadocio","broadway","ellington","exablock","exocet","fig script","gigi","harlow solid","harrington","horizon","jim crow","jokerman","juice","lo-type","magneto","megadeth","neuland","peignot","ravie","san francisco","showcard gothic","snap","stencil","umbra","westminster","willow","bagel","lithos","aldhabi","andalus","angsana new","angsanaupc","aparajita","arabic typesetting","arial black","arial narrow","arial rounded mt bold","baskerville old face","batang","batangche","bauhaus 93","bell mt","berlin sans fb","berlin sans fb demi","bernard mt condensed","blackadder itc","bodoni mt","bodoni mt black","bodoni mt condensed","bodoni mt poster compressed","bookman old style","bradley hand itc","britannic bold","browallia new","browalliaupc","brush script mt","buxton sketch","calibri light","calisto mt","cambria math","candara","castellar","century","chiller","colonna mt","comic sans ms","copperplate gothic bold","copperplate gothic light","cordia new","cordiaupc","curlz mt","daunpenh","david","dfkai-sb","dilleniaupc","dokchampa","dotumche","ebrima","edwardian script itc","engravers mt","eras bold itc","eras demi itc","eras light itc","eras medium itc","estrangelo edessa","eucrosiaupc","euphemia","fangsong","felix titling","footlight mt light","franklin gothic book","franklin gothic demi","franklin gothic demi cond","franklin gothic heavy","franklin gothic medium","franklin gothic medium cond","frankruehl","freesiaupc","freestyle script","french script mt","gabriola","gadugi","gautami","gill sans mt","gill sans mt condensed","gill sans mt ext condensed bold","gill sans ultra bold","gill sans ultra bold condensed","gisha","gloucester mt extra condensed","goudy stout","gulim","gulimche","gungsuh","gungsuhche","harlow solid italic","imprint mt shadow","informal roman","irisupc","iskoola pota","jasmineupc","javanese text","juice itc","kaiti","kalinga","kartika","khmer ui","kodchiangupc","kokila","kristen itc","kunstler script","lao ui","latha","leelawadee","leelawadee ui","leelawadee ui semilight","levenim mt","lilyupc","lucida bright","lucida calligraphy","lucida console","lucida fax","lucida sans","lucida sans typewriter","lucida sans unicode","maiandra gd","malgun gothic","mangal","marlett","matura mt script capitals","meiryo ui","microsoft himalaya","microsoft jhenghei","microsoft jhenghei light","microsoft jhenghei ui","microsoft jhenghei ui light","microsoft new tai lue","microsoft phagspa","microsoft sans serif","microsoft tai le","microsoft uighur","microsoft yahei","microsoft yahei light","microsoft yahei ui","microsoft yahei ui light","microsoft yi baiti","mingliu","mingliu-extb","mingliu_hkscs","mingliu_hkscs-extb","miriam","modern","modern no. 20","mongolian baiti","moolboran","ms outlook","ms pgothic","ms pmincho","ms reference sans serif","ms reference specialty","ms ui gothic","mt extra","mv boli","myanmar text","narkisim","niagara engraved","niagara solid","nirmala ui","nirmala ui semilight","nsimsun","nyala","onyx","palace script mt","palatino linotype","parchment","perpetua titling mt","plantagenet cherokee","pmingliu","pmingliu-extb","pristina","raavi","rockwell condensed","rockwell extra bold","rod","sakkal majalla","script mt bold","segoe marker","segoe print","segoe script","segoe ui","segoe ui black","segoe ui emoji","segoe ui light","segoe ui semibold","segoe ui semilight","segoe ui symbol","shonar bangla","shruti","simhei","simplified arabic","simplified arabic fixed","simsun-extb","sitka banner","sitka display","sitka heading","sitka small","sitka subheading","sitka text","sketchflow print","snap itc","system","tempus sans itc","traditional arabic","tw cen mt","tw cen mt condensed","tw cen mt condensed extra bold","urdu typesetting","utsaah","vani","vijaya","viner hand itc","vrinda","yu gothic","yu gothic light","yu mincho","yu mincho demibold","yu mincho light"],s}return bn(r,Be.AbstractFeature),mn(r,[{key:"startFeature",value:function(){var t=this;log.info("Collecting Fonts"),this.preFeature("fonts");var n=this._utils.StorageUtils.getFromLocalStorage(this._storageKeyName);n||(n=this._utils.StorageUtils.getFromLocalStorage(this._legacyStorageKeyName));var i=this._utils.StorageUtils.getFromLocalStorage(this._legacyStorageKeyName,!1);i&&log.info("Detected legacy fonts data in the local storage. Will send them to server."),n&&this._utils.StorageUtils.saveToLocalStorage(this._storageKeyName,n),this._detectFonts(function(e){(!n||600<=n.split(",").length)&&(n=e,t._utils.StorageUtils.saveToLocalStorage(t._storageKeyName,n)),t._updateFonts(n,e,i),log.info("Fonts collected")})}},{key:"_detectFonts",value:function(r){var e=this;Be.CDUtils.DomUtils.onDocumentBody(window,function(){var s=new e._fontDetectorCtor;s.init(function(){var n=e,i=void 0;s.detectByChunksWithIndex.cdCallAsync(s,n._serif_fonts,2,function(e){i=e,s.detectByChunksWithIndex.cdCallAsync(s,n._sans_serif_fonts,1,function(e){i=i.concat(e),s.detectByChunksWithIndex.cdCallAsync(s,n._monospace_fonts,0,function(e){if(600<=(i=i.concat(e)).length){var t=s.getAllFontsDiffs();n._dataQ.addToQueue("static_fields",["problematic_fonts",t],!1),n.cancelMonitor("fonts")}else r(i.toString());s.clear()})})})})})}},{key:"_updateFonts",value:function(e,t,n){this._dataQ.addToQueue("static_fields",["fonts",e],!1),this._dataQ.addToQueue("static_fields",["fonts_not_cached",t],!1),n&&this._dataQ.addToQueue("static_fields",["legacy_fonts",n],!1),this.postFeature("fonts")}}]),r}(),Be.FontsDetectionFeature=Ne,Oe=vn,We=function(e){function i(e,t){Sn(this,i);var n=wn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,t));return n.canvasId="cd_canvas",n}return bn(i,Oe.AbstractFeature),mn(i,[{key:"startFeature",value:function(){this.preFeature("grph_card");try{this._getMappedRenderInfo()}catch(e){log.error("Failed collecting Graphic Card information. "+e)}}},{key:"_getMappedRenderInfo",value:function(){log.info("Collecting Graphic Card props");var e={renderer:"unknown",vendor:"",version:"unknown"};if(window.WebGLRenderingContext||window.WebGL2RenderingContext){var t=document.createElement("canvas");t.id=this.canvasId;var n=t.getContext("experimental-webgl");if(n){var i=n.getExtension("WEBGL_debug_renderer_info");if(null!=i&&(e.renderer=n.getParameter(i.UNMASKED_RENDERER_WEBGL),e.vendor=n.getParameter(i.UNMASKED_VENDOR_WEBGL),-1<e.renderer.indexOf("Intel")&&-1<e.renderer.indexOf("HD Graphics"))){var s=e.renderer.match(/\d+/g);if(s){var r=s[0];500<r&&r<599&&(e.version="SKL (6th gen core)"),5300<r&&r<6999&&(e.version="BDW (5th gen core)")}}}}this._dataQ.addToQueue("static_fields",["grph_card",[e.renderer,e.vendor,e.version]],!1),log.info("Graphic Card props collected"),this.postFeature("grph_card")}}]),i}(),Oe.GraphicDetectFeature=We,Qe=vn,He=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,n));return i._utils=e,i.audioCtx=window.AudioContext||window.webkitAudioContext?new(window.AudioContext||window.webkitAudioContext):null,i}return bn(s,Qe.AbstractFeature),mn(s,[{key:"startFeature",value:function(){var t=this;this.audioCtx&&this.audioCtx.createGain?Qe.CDUtils.DomUtils.onDocumentBody(window,function(){log.info("Starting AudioFeature");var e=document.createElement("canvas");e.id="cdCanvas",t.context=e.getContext("2d"),t.counter=3,t.getAudioInfo(),t.getPxiSum(),t.getHybridOscFp()}):log.info("AudioFeature is unsupported")}},{key:"getAudioInfo",value:function(){var e=void 0;this.preFeature("au_info");try{if(this.audioCtx){var t=this.audioCtx,n=t.createAnalyser();e=s.getOutput({},t,"ac-"),e=s.getOutput(e,t.destination,"ac-"),e=s.getOutput(e,t.listener,"ac-"),e=s.getOutput(e,n,"an-"),e=window.JSON.stringify(e)}else e="Not available";this._dataQ.addToQueue("static_fields",["au_context_info",e],!1)}catch(i){log.error("AudioContext.getAudioInfo failed: "+i.message)}this.postFeature("au_info")}},{key:"getPxiSum",value:function(){this.preFeature("au_osc_sum");var n=void 0,i=this;try{var e=window.OfflineAudioContext||window.webkitOfflineAudioContext?new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,44100,44100):null;if(!e)return void i.cancelMonitor("au_osc_sum");var t=e.createOscillator();t.type="triangle",t.frequency.setTargetAtTime(1e4,this.audioCtx.currentTime,1e-7);var s=e.createDynamicsCompressor();s.threshold&&s.threshold.setValueAtTime(-50,this.audioCtx.currentTime),s.knee&&s.knee.setValueAtTime(40,this.audioCtx.currentTime),s.ratio&&s.ratio.setValueAtTime(12,this.audioCtx.currentTime),s.reduction&&(s.reduction.value=-20),s.attack&&s.attack.setValueAtTime(0,this.audioCtx.currentTime),s.release&&s.release.setValueAtTime(.25,this.audioCtx.currentTime),t.connect(s),s.connect(e.destination),t.start(0),e.startRendering(),e.oncomplete=function(e){n=0;for(var t=4500;t<5e3;t++)n+=Math.abs(e.renderedBuffer.getChannelData(0)[t]);s.disconnect(),i._dataQ.addToQueue("static_fields",["au_osc_sum",n],!1),i.postFeature("au_osc_sum")}}catch(r){i.cancelMonitor("au_osc_sum"),log.error("AudioContext.getPxiResult failed: "+r.message)}}},{key:"getHybridOscFp",value:function(){this.preFeature("au_osc");var n=this,i=[],s=void 0;if(this.audioCtx){var e=this.audioCtx.createOscillator(),r=this.audioCtx.createAnalyser(),a=this.audioCtx.createGain(),o=this.audioCtx.createScriptProcessor(4096,1,1),t=this.audioCtx.createDynamicsCompressor();t.threshold&&t.threshold.setValueAtTime(-50,this.audioCtx.currentTime),t.knee&&t.knee.setValueAtTime(40,this.audioCtx.currentTime),t.ratio&&t.ratio.setValueAtTime(12,this.audioCtx.currentTime),t.reduction&&(t.reduction.value=-20),t.attack&&t.attack.setValueAtTime(0,this.audioCtx.currentTime),t.release&&t.release.setValueAtTime(.25,this.audioCtx.currentTime),a.gain.setValueAtTime(0,this.audioCtx.currentTime),e.type="triangle",e.connect(t),t.connect(r),r.connect(o),o.connect(a),a.connect(this.audioCtx.destination),o.onaudioprocess=function(e){e=new Float32Array(r.frequencyBinCount),r.getFloatFrequencyData(e);for(var t=0;t<e.length;t+=1)i.push(e[t]);r.disconnect(),o.disconnect(),a.disconnect(),i=i.slice(0,30),s=n._utils.getHash(i.toString()),n._dataQ.addToQueue("static_fields",["au_osc_output",i],!1),n._dataQ.addToQueue("static_fields",["au_osc_output_hash",s],!1),log.info("Calculated AudioFeature au_osc_output (length="+i.length+"), au_osc_output_hash fields"),n.postFeature("au_osc")},e.start(0)}else n.cancelMonitor("au_osc")}}],[{key:"getOutput",value:function(e,t,n){for(var i in t)"dopplerFactor"===i||"speedOfSound"===i||"currentTime"===i||"number"!=typeof t[i]&&"string"!=typeof t[i]||(e[(n||"")+i]=t[i]);return e}}]),s}(),Qe.AudioFeature=He,qe=vn,ze=function(e){function n(e,t){return Sn(this,n),wn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t))}return bn(n,qe.AbstractFeature),mn(n,[{key:"startFeature",value:function(){this.preFeature("browser_spoof");var e=!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),t="undefined"!=typeof InstallTrigger,n=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),i=!!document.documentMode,s=!i&&!!window.StyleMedia,r=!!window.chrome&&!!window.chrome.webstore,a=(r||e)&&!!window.CSS;this._dataQ.addToQueue("static_fields",["browser_spoofing",[r,t,s,i,n,e,a]],!1),this.postFeature("browser_spoof")}}]),n}(),qe.BrowserDetect=ze,je=vn,Ve=function(e){function s(e,t){var n=2<arguments.length&&arguments[2]!==undefined?arguments[2]:window.navigator;Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return i._permDefs={granted:1,prompt:2,denied:3,"true":1,"false":3},i._permissions=["geolocation","midi","notifications","push"],i._navigator=n,i}return bn(s,je.AbstractFeature),mn(s,[{key:"startFeature",value:function(){this._reportQueryPermissions(),this._reportStoragePermission(),this._reportMicCameraPermissions()}},{key:"_reportQueryPermissions",value:function(){var i=this;if(this._navigator.permissions&&this._navigator.permissions.query)for(var t=function t(e){var n=i._permissions[e];i._navigator.permissions.query({name:n}).then(function(e){var t=i._permDefs[e.state]||-1;i._dataQ.addToQueue("static_fields",["per_"+n,t],!1)})["catch"](function(e){log.debug("Failed to query permissions "+e.message)})},e=0;e<this._permissions.length;e++)t(e)}},{key:"_reportStoragePermission",value:function(){var t=this;this._navigator.storage&&this._navigator.storage.persisted&&this._navigator.storage.persisted().then(function(e){t._dataQ.addToQueue("static_fields",["per_storage",t._permDefs[e]||-1],!1)})["catch"](function(e){log.debug("Failed to check storage persisted: "+e.message)})}},{key:"_reportMicCameraPermissions",value:function(){var r=this,a={audio:!1,video:!1};this._navigator.mediaDevices&&this._navigator.mediaDevices.enumerateDevices&&this._navigator.mediaDevices.enumerateDevices().then(function(e){e.forEach(function(e){if(!function i(e){return e.includes("audio")&&a.audio||e.includes("video")&&a.video}(e.kind)){var t=function s(e){return e.includes("audio")?(a.audio=!0,"audio"):e.includes("video")?(a.video=!0,"video"):void 0}(e.kind),n=""!==e.label?r._permDefs.granted:r._permDefs.denied;r._dataQ.addToQueue("static_fields",["per_"+t,n],!1)}})})["catch"](function(e){log.debug("UserPermissions:startFeature failed to enumerateDevices: "+e.message)})}}]),s}(),je.UserPermissions=Ve,Ye=vn,Ke=function(e){function s(e,t){var n=2<arguments.length&&arguments[2]!==undefined?arguments[2]:window.navigator;Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return i._navigator=n,i._metric="MediaDevicesFeature",i}return bn(s,Ye.AbstractFeature),mn(s,[{key:"startFeature",value:function(){var t=this;this.preFeature(this._metric),this._navigator.mediaDevices&&this._navigator.mediaDevices.enumerateDevices&&this._navigator.mediaDevices.enumerateDevices().then(function(e){var n=[];e.forEach(function(e){var t=[e.kind||"",e.label||"",e.deviceId||"",e.groupId||""];n.push(t)}),t._dataQ.addToQueue("static_fields",["media_devices",n],!1),t.postFeature(t._metric)})["catch"](function(e){t.cancelMonitor(t._metric),log.error("MediaDevicesFeature:startFeature failed to enumerateDevices: "+e.message)})}}]),s}(),Ye.MediaDevicesFeature=Ke,Ge=vn,Xe=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return i._utils=n,i}return bn(s,Ge.AbstractFeature),mn(s,[{key:"startFeature",value:function(){var e,t;this.preFeature("contextPropsFeature"),self.screen&&(e=t=window.devicePixelRatio?window.devicePixelRatio:-1,this._dataQ.addToQueue("static_fields",["display",[screen.colorDepth,screen.width,screen.height,screen.availHeight||-1,screen.availWidth||-1,e,t]],!1)),this.reportPageLoadTime(),this.postFeature("contextPropsFeature")}},{key:"reportPageLoadTime",value:function(){var e=this;if(window.performance&&window.performance.timing){var t=function t(){window.performance.timing.loadEventEnd&&window.performance.timing.navigationStart&&e._perfMonitor.reportMonitor("t.timeTillPageLoad",window.performance.timing.loadEventEnd-window.performance.timing.navigationStart)};window.performance.timing.loadEventEnd?t():this._utils.DomUtils.onPageLoad(self,t)}}}]),s}(),Ge.ContextPropsFeature=Xe,Ze=vn,Je=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,n));return i._timeoutValue=1e3,i._scriptsRepository=t,i._runDetectionLoopBinded=i._runDetectionLoop.bind(i),i}return bn(s,Ze.AbstractFeature),mn(s,[{key:"_checkScriptsData",value:function(){for(var e=document.scripts,t=0;t<e.length;t++){var n={src:e[t].src,text:e[t].text};this._scriptsRepository.exists(n)||(this._scriptsRepository.add(n),this._dataQ.addToQueue("scripts",[null,n.src,n.textHash]))}}},{key:"_runDetectionLoop",value:function(){this._checkScriptsData(),this._timer=setTimeout(this._runDetectionLoopBinded,this._timeoutValue),this._timeoutValue<536870911&&(this._timeoutValue*=4)}},{key:"startFeature",value:function(){this.preFeature("scripts"),this._runDetectionLoop(),this.postFeature("scripts")}},{key:"stopFeature",value:function(){this._timer&&clearTimeout(this._timer)}}]),s}(),Ze.ScriptsFeature=Je,$e=vn,et=function(){function t(e){Sn(this,t),this._utils=e,this._scriptList=[]}return mn(t,[{key:"count",value:function(){return this._scriptList.length}},{key:"exists",value:function(e){/\d\d\d/.test(e.src)&&(e.src=this._utils.clearTextFromNumbers(e.src));for(var t=this._utils.getHash(e.text),n=0;n<this._scriptList.length;n++)if(e.src&&e.src===this._scriptList[n].src||t&&t===this._scriptList[n].textHash)return!0;return!1}},{key:"add",value:function(e){e.textHash=this._utils.getHash(e.text),/\d\d\d/.test(e.src)&&(e.src=this._utils.clearTextFromNumbers(e.src)),this._scriptList.push({src:e.src,textHash:e.textHash})}}]),t}(),$e.ScriptsRepository=et,tt=vn,nt=function(e){function r(e,t,n,i){Sn(this,r);var s=wn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n));return s._confMgr=e,s._metaDataSiteMapper=i,s._metaDataSiteMapper.updateObserver(s.onSiteMapperMatch.bind(s)),s}return bn(r,tt.AbstractFeature),mn(r,[{key:"startFeature",value:function(){this._metaDataSiteMapper.initTracking()}},{key:"stopFeature",value:function(){this._metaDataSiteMapper.stopTracking()}},{key:"onSiteMapperMatch",value:function(e){log.debug("Metadata Collector mapper match - "+JSON.stringify(e)),e.metaVal&&this._dataQ.addToQueue("metadata_map",[null,e.metaVal,tt.CDUtils.dateNow()])}},{key:"updateFeatureConfig",value:function(){this._metaDataSiteMapper.onConfigUpdate(this._confMgr)}}]),r}(),tt.MetadataCollector=nt,it=vn,st=function(e){function a(e,t,n,i,s){Sn(this,a);var r=wn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,null,s));return r._utils=t,r._configMgr=e,r._sessionMgr=n,r._muidMgr=i,r}return bn(a,it.AbstractFeature),mn(a,[{key:"getFiles",value:function(){if(this._customerId&&this._muid&&this._sid&&this._addrList&&0<this._addrList.length)for(var e=void 0,t=0;t<this._addrList.length;t++)e=this._addrList[t]+"?cid="+this._customerId+"&snum="+this._sid+"&muid="+this._muid,this._utils.getPostUrl(e,"GET",null,null,null),this._isSent=!0;this.postFeature("get_files")}},{key:"startFeature",value:function(){this.preFeature("get_files"),this._isSent=!1;try{this._addrList=JSON.parse(this._configMgr.get("getAddrList"))}catch(e){this._addrList=""}this._customerId=this._configMgr._cid||"",this._muid=this._muidMgr.muid||"",this._sid=this._sessionMgr.sessionId||"",this.getFiles()}},{key:"updateFeatureConfig",value:function(){try{this._addrList=JSON.parse(this._configMgr.get("getAddrList"))}catch(e){this._addrList=""}this._customerId=this._configMgr._cid||"",this._muid=this._muidMgr.muid||"",this._sid=this._sessionMgr.sessionId||"",this._isSent||this.getFiles()}}]),a}(),it.FilesFeature=st,rt=vn,at=function(e){function r(e,t,n,i){Sn(this,r);var s=wn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,n,null));return s._utils=t,s._timers={},s._isRunning=!1,s._challengeSiteMapper=i,s._challengeSiteMapper.updateObserver(s._onSiteMapperMatch.bind(s)),s._onMouseEventBinded=s._onMouseEvent.bind(s),s._onKeyEventBinded=s._onKeyEvent.bind(s),s._configMgr=e,s}return bn(r,rt.AbstractFeature),mn(r,[{key:"startFeature",value:function(){this._challengeSiteMapper.initTracking()}},{key:"stopFeature",value:function(){this._challengeSiteMapper.stopTracking(),this._stopHiding("featureStopped")}},{key:"updateFeatureConfig",value:function(){this._challengeSiteMapper.onConfigUpdate(this._configMgr)}},{key:"startHiding",value:function(e){try{log.info("Mouse Challenge starting to hide on: "+rt.CDUtils.dateNow()),this._timers=e,this._dataQ.addToQueue("challenge",[null,"invisible_mouse","start","",rt.CDUtils.dateNow()]),this._isRunning=!0,this._runFuncForFrames(top,r.createDiv),this._runFuncForFrames(top,this._hideMouse.bind(this))}catch(t){log.error("Mouse Challenge error occurred - "+t.message,t)}}},{key:"_runFuncForFrames",value:function(e,t){if(e){t(e);try{for(var n=0;n<e.frames.length;n++){var i=e.frames[n];this._runFuncForFrames(i,t)}}catch(s){log.error("Mouse Challenge error occurred - "+s.message,s)}}}},{key:"_stopHiding",value:function(e){this._isRunning&&(this._isRunning=!1,this._runFuncForFrames(top,r.removeDiv.bind(this)),log.info("Mouse Challenge stopHiding sending message time="+rt.CDUtils.dateNow()),this._dataQ.addToQueue("challenge",[null,"invisible_mouse","stop",e,rt.CDUtils.dateNow()]))}},{key:"_stopListening",value:function(e){var t=e.document||e.contentDocument;this._utils.removeEventListener(t,"mousemove",this._onMouseEventBinded,!0,!0,!0),this._utils.removeEventListener(t,"keydown",this._onKeyEventBinded,!0,!0,!0)}},{key:"_hideMouse",value:function(e){var t=this,n=e.document||e.contentDocument;n.getElementById("coverDivMouse").style.visibility="visible",this._timers.mouseTimer&&this._utils.addEventListener(n,"mousemove",this._onMouseEventBinded,!0,!0,!0),this._timers.keyTimer&&this._utils.addEventListener(document,"keydown",this._onKeyEventBinded,!0,!0,!0),this._timers.time&&setTimeout(function(){log.info("Mouse Challenge timeout timer occurred time="+rt.CDUtils.dateNow()),t._runFuncForFrames(top,t._stopListening.bind(t)),t._stopHiding("timeout")},this._timers.time)}},{key:"_onMouseEvent",value:function(e){var t=this;this._runFuncForFrames(top,this._stopListening.bind(this)),setTimeout(function(){log.info("Mouse Challenge mouse event timeout occurred"),t._stopHiding("mouseEvent")},this._timers.mouseTimer)}},{key:"_onKeyEvent",value:function(e){var t=this;this._runFuncForFrames(top,this._stopListening.bind(this)),setTimeout(function(){log.info("Mouse Challenge key event timeout occurred"),t._stopHiding("keyEvent")},this._timers.keyTimer)}},{key:"_onSiteMapperMatch",value:function(e){log.debug("Mouse challenge mapper match - "+JSON.stringify(e)),e.timers&&this.startHiding(e.timers)}}],[{key:"createDiv",value:function(e){var t=e.document||e.contentDocument,n=t.createElement("div");n.id="coverDivMouse",n.style.cursor="none",n.style.position="fixed",n.style.top=0,n.style.left=0,n.style.width="100%",n.style.height="100%",n.style.zIndex=2147483647,n.style.visibility="hidden";var i=t.body.firstChild;t.body.insertBefore(n,i)}},{key:"removeDiv",value:function(e){var t=e.document||e.contentDocument,n=t.getElementById("coverDivMouse");n&&t.body.removeChild(n)}}]),r}(),rt.MouseChallengeFeature=at,ot=vn,ut=function(e){function a(e,t,n,i,s){Sn(this,a);var r=wn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,i));return r._configMgr=e,r._dataQueue=n,r._utils=t,r._onVideoPausedCallback=r._onVideoPauseEvent.bind(r),r._onVideoStartedCallback=r._onVideoStartedEvent.bind(r),r._onTouchCallback=r._onTouchEvent.bind(r),r._video=null,r._msgBus=s,r}return bn(a,ot.Events),mn(a,[{key:"startFeature",value:function(){var e=this._configMgr.get("videoSource")||"",t=this._configMgr.get("videoUserAgentFilter")||"",n=this._configMgr.get("maxAllowedVideoDurationSec")||5;this._shouldStartVideo(t)&&(this._video=this._createVideoElement(e,n),this._video&&(this._utils.addEventListener(this._video,"pause",this._onVideoPausedCallback),this._utils.addEventListener(this._video,"play",this._onVideoStartedCallback),this._msgBus.subscribe(ot.MessageBusEventType.TouchEvent,this._onTouchCallback)))}},{key:"stopFeature",value:function(){this._video&&this._video.parentNode===document.body&&(this._utils.removeEventListener(this._video,"pause",this._onVideoPausedCallback),this._utils.removeEventListener(this._video,"play",this._onVideoStartedCallback),document.body.removeChild(this._video),this._video=null)}},{key:"_shouldStartVideo",value:function(e){return this._utils.matchRegEx(e,navigator.userAgent)}},{key:"_onVideoStartedEvent",value:function(){this._reportVideoEvent(!0)}},{key:"_onVideoPauseEvent",value:function(){this._reportVideoEvent(!1)}},{key:"_reportVideoEvent",value:function(e){var t=this._utils.dateNow(),n=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQueue.addToQueue("video_events",[n,t,e])}},{key:"_createVideoElement",value:function(e,t){var n=document.createElement("video");return n.style.height=0,n.style.width=0,n.style.visibility="hidden",n.src=e,n.zIndex=-1,n.display="none",n.loop=!0,n.muted=!0,n.setAttribute("playsinline","true"),n.duration>t&&(log.warn("video duration of "+n.duration+" is higher the maximum of "+t),n=null),n}},{key:"_onTouchEvent",value:function(e){if(null!==this._video&&e.action===ot.EnumDefs.Events.touchEventType.touchstart){this._msgBus.unsubscribe(ot.MessageBusEventType.TouchEvent,this._onTouchCallback),document.body.appendChild(this._video),this._video.play();var t=this._configMgr.get("videoPlaybackDurationSec")||5;setTimeout(this.stopFeature.bind(this),1e3*t)}}}]),a}(),ot.VideoEvents=ut,ct=vn,ht=function(){function i(e,t,n){Sn(this,i),this._framesCache=e,this._framesDetector=t,this._framesDetector.frameAdded.subscribe(this._onFrameAdded.bind(this)),this._framesDetector.frameRemoved.subscribe(this._onFrameRemoved.bind(this)),this._framesDetector.frameInaccessible.subscribe(this._onFrameInaccessible.bind(this)),this._featuresList=[],this._cdUtils=n,this._framesDetector.addToIgnoreList(ct.EnumDefs.SystemFrameName.rtcframe),
this._framesDetector.addToIgnoreList(ct.EnumDefs.SystemFrameName.fontDetectionFrame),this._framesDetector.start(window.self),this._buildFramesCache()}return mn(i,[{key:"startFeatures",value:function(e){try{if(this._buildFeaturesMap(e),0===this._featuresList.length)return;log.debug("startFeatures:Running features on "+this._framesCache.count+" frames"),this._startFeaturesOnFrames(this._framesCache.frames,e)}catch(t){log.debug("Failed to start features in FrameHandler.startFeatures: "+t.message,t)}}},{key:"startFeature",value:function(e){try{this._featuresList.push(e),e.isRunning=!0,this._startFeaturesOnFrames(this._framesCache.frames,[e])}catch(t){log.debug("Failed to start feature in FrameHandler.startFeature: "+t.message,t)}}},{key:"stopFeatures",value:function(e){try{this._stopFeaturesOnFrames(e,this._framesCache.frames)}catch(t){log.debug("Failed to stop features in FrameHandler.stopFeatures: "+t.message,t)}}},{key:"stopFeature",value:function(e){try{e.isRunning=!1,this._stopFeaturesOnFrames([e],this._framesCache.frames)}catch(t){log.debug("Failed to stop feature in FrameHandler.stopFeature: "+t.message,t)}}},{key:"updateFeatureConfig",value:function(e){e.instance.updateFeatureConfig&&this._updateFeaturesConfigOnFrames([e],this._framesCache.frames)}},{key:"_onFrameAdded",value:function(e){try{log.debug("Frame:"+e.name+", id:"+e.id+". was loaded."),this._framesCache.exists(e)?this._framesCache.unRegisterFrameFeatures(e,this._featuresList):this._framesCache.add(e),this._startFeaturesOnFrames([e],this._featuresList)}catch(t){log.warn("Failed to start features on frame "+e.id+": "+t.message,t)}}},{key:"_onFrameRemoved",value:function(e){try{log.debug("Frame:"+e.name+", id:"+e.id+". was removed."),this._stopFeaturesOnFrames(this._featuresList,[e])}catch(t){log.warn("Failed to stop features on frame "+e.id+": "+t.message,t)}}},{key:"_onFrameInaccessible",value:function(e){log.debug("Frame:"+e.name+", id:"+e.id+". was detected as inaccessible.")}},{key:"_buildFeaturesMap",value:function(e){var t=this;this._featuresList=[],e.forEach(function(e){t._featuresList.push(e)})}},{key:"_buildFramesCache",value:function(){var t=this;this._framesDetector.frames.forEach(function(e){t._framesCache.exists(e)||t._framesCache.add(e)})}},{key:"_startFeaturesOnFrames",value:function(e,s){var r=this;e.forEach(function(e){try{if(!r._cdUtils.DomUtils.canAccessIFrame(e))return;for(var t=0;t<s.length;t++){var n=s[t];n.shouldRun&&!r._framesCache.hasFeature(e,n)&&(r._framesCache.registerFrameFeature(e,n),ct.CDUtils.DomUtils.isWindowDocumentReady(e.contentWindow)&&(log.debug("_startFeaturesOnFrames: run feature on frame:"+e.name+", id:"+e.id+". feature:"+n.configKey),r._runFeatureOnFrame.cdCallAsync(r,e,n),n.isRunning=!0))}}catch(i){log.error("An error has occurred while starting features on frame "+e.name+" with id: "+e.id+". Error: "+i.message,i)}})}},{key:"_runFeatureOnFrame",value:function(e,t){try{this._cdUtils.DomUtils.canAccessIFrame(e)?t.instance.startFeature(e.contentWindow):log.debug("Not starting features on frame "+e.name+" with id: "+e.id+" as it is not accessible")}catch(n){log.error("An error has occurred while starting feature "+t.configKey+" on frame "+e.name+" with id: "+e.id+". Error: "+n.message,n)}}},{key:"_stopFeaturesOnFrames",value:function(s,e){var r=this;try{e.forEach(function(e){try{if(!r._cdUtils.DomUtils.canAccessIFrame(e))return;if(e.contentWindow&&e.contentWindow.document)for(var t=0,n=s.length;t<n;t++)r._framesCache.hasFeature(e,s[t])&&r._stopFeatureOnFrame.cdCallAsync(r,e,s[t]),s[t].isRunning=!1}catch(i){log.error("An error has occurred while stopping features on frame "+e.name+" with id: "+e.id+". Error: "+i.message,i)}r._framesCache.exists(e)&&r._framesCache.unRegisterFrameFeatures(e,s),r._framesCache.remove(e)})}catch(t){log.warn("Failed stopping features on frames "+t.message,t)}}},{key:"_stopFeatureOnFrame",value:function(e,t){try{this._cdUtils.DomUtils.canAccessIFrame(e)?t.instance.stopFeature(e.contentWindow):log.debug("Not stopping feature "+t.configKey+" on frame "+e.name+" with id: "+e.id+" as it is not accessible")}catch(n){log.error("An error has occurred while stopping feature "+t.configKey+" "+func+" on frame "+e.name+" with id: "+e.id+". Error: "+n.message,n)}}},{key:"_updateFeaturesConfigOnFrames",value:function(s,e){var r=this;e.forEach(function(e){try{if(!r._cdUtils.DomUtils.canAccessIFrame(e))return;for(var t=0,n=s.length;t<n;t++)r._framesCache.hasFeature(e,s[t])&&r._updateFeatureConfigOnFrame.cdCallAsync(r,e,s[t])}catch(i){log.error("An error has occurred while updating features configuration on frame "+e.name+" with id: "+e.id+". Error: "+i.message,i)}})}},{key:"_updateFeatureConfigOnFrame",value:function(e,t){try{this._cdUtils.DomUtils.canAccessIFrame(e)?t.instance.updateFeatureConfig(e.contentWindow):log.debug("Not updating feature "+t.configKey+" config on frame "+e.name+" with id: "+e.id+" as it is not accessible")}catch(n){log.error("An error has occurred while updating feature "+t.configKey+" config on frame "+e.name+" with id: "+e.id+". Error: "+n.message,n)}}}]),i}(),ct.FramesHandler=ht,dt=vn,lt=function(){function e(){Sn(this,e),this._frames=new dt.Map}return mn(e,[{key:"add",value:function(e){this._frames.set(e,{registered:!0,features:new dt.Map})}},{key:"remove",value:function(e){this.exists(e)&&0===this._frames.get(e).features.size&&this._frames["delete"](e)}},{key:"get",value:function(e){return this._frames.get(e)}},{key:"exists",value:function(e){return this._frames.has(e)&&this._frames.get(e).registered}},{key:"registerFrameFeature",value:function(e,t){this.exists(e)&&this._frames.get(e).features.set(t.configKey,!0)}},{key:"unRegisterFrameFeature",value:function(e,t){this.exists(e,t)&&this._frames.get(e).features["delete"](t.configKey)}},{key:"unRegisterFrameFeatures",value:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];this.unRegisterFrameFeature(e,i)}}},{key:"hasFeature",value:function(e,t){return this.exists(e)&&this._frames.get(e).features.has(t.configKey)}},{key:"frames",get:function(){var n=[];return this._frames.forEach(function(e,t){n.push(t)}),n}},{key:"count",get:function(){return this._frames.size}}]),e}(),dt.FramesCache=lt,ft=vn,gt=function(){function n(e,t){Sn(this,n),this._mutationObserverFactory=e,this._cdUtils=t,this._windowMutationObservers=new ft.Map,this._loadedFrames=new ft.Map,this._framesToIgnore=new ft.Set,this._frameSelector="frame, iframe",this._frameLoadedCallback=this._onFrameLoad.bind(this),this.frameAdded=new ft.CDEvent,this.frameRemoved=new ft.CDEvent,this.frameInaccessible=new ft.CDEvent}return mn(n,[{key:"start",value:function(e){var t=this;this._monitorWindow(e),this._findFrames(e.document).forEach(function(e){t._processNewFrame(e)})}},{key:"stop",value:function(){this._windowMutationObservers.forEach(function(e){e.disconnect()}),this._windowMutationObservers.clear(),this._loadedFrames.clear(),this._framesToIgnore.clear()}},{key:"addToIgnoreList",value:function(e){this._framesToIgnore.add(e)}},{key:"_monitorWindow",value:function(e){if(!this._windowMutationObservers.has(e)){var t=new this._mutationObserverFactory(this._mutationObserved.bind(this));t.observe(e.document,{childList:!0,subtree:!0}),this._windowMutationObservers.set(e,t)}}},{key:"_unMonitorWindow",value:function(e){var t=this._windowMutationObservers.get(e);t&&t.disconnect(),this._windowMutationObservers["delete"](e)}},{key:"_mutationObserved",value:function(e){var t=this;e.forEach(function(e){t._processMutation(e)})}},{key:"_processMutation",value:function(e){this._processAddedNodes(e.addedNodes),this._processRemovedNodes(e.removedNodes)}},{key:"_processAddedNodes",value:function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(this._cdUtils.DomUtils.matches(i,this._frameSelector))this._processNewFrame(i);else{if(!i.hasChildNodes())continue;this._findFrames(i).forEach(function(e){t._processNewFrame(e)})}}}},{key:"_processNewFrame",value:function(e){this._framesToIgnore.has(e.id)||this._loadedFrames.has(e)||(this._cdUtils.addEventListener(e,"load",this._frameLoadedCallback),this._cdUtils.DomUtils.canAccessIFrame(e)?this._cdUtils.DomUtils.isWindowDocumentReady(e.contentWindow)&&this._addFrame(e):this.frameInaccessible.publish(e))}},{key:"_addFrame",value:function(e){var t=this;this._monitorWindow(e.contentWindow),this._findFrames(e.contentWindow.document).forEach(function(e){t._processNewFrame(e)}),this._loadedFrames.set(e,e.contentDocument),this.frameAdded.publish(e)}},{key:"_processRemovedNodes",value:function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(this._cdUtils.DomUtils.matches(i,this._frameSelector))this._removeFrame(i);else{if(!i.hasChildNodes())continue;this._findFrames(i).forEach(function(e){t._removeFrame(e)})}}}},{key:"_removeFrame",value:function(e){this._unMonitorWindow(e.contentWindow),this._cdUtils.removeEventListener(e,"load",this._frameLoadedCallback),this._loadedFrames["delete"](e)&&this.frameRemoved.publish(e)}},{key:"_onFrameLoad",value:function(e){var t=e.target;this._loadedFrames.has(t)&&this._removeFrame(t),this._processNewFrame(t)}},{key:"_findFrames",value:function(e){for(var t=[],n=[],i=e.querySelectorAll(this._frameSelector),s=0;s<i.length;s++)n.push(i[s]);for(var r=0;r<n.length;r++){var a,o=n[r];t.push(o),this._cdUtils.DomUtils.canAccessIFrame(o)?0<(a=this._findFrames(o.contentWindow.document)).length&&(t=t.concat(a)):this.frameInaccessible.publish(o)}return t}},{key:"frames",get:function(){var n=[];return this._loadedFrames.forEach(function(e,t){n.push(t)}),n}}]),n}(),ft.FramesDetector=gt,(_t=vn).FeaturesList={defaultFeatures:{MouseEvents:{configKey:"isMouseEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.MouseEvents.instance=new _t.MouseEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null},KeyEvents:{configKey:"isKeyEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.KeyEvents.instance=new _t.KeyEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},WindowEvents:{configKey:"isWindowEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.defaultFeatures.WindowEvents.instance=new _t.WindowEvents(this._configMgr,this._utils,this._dataQ,this._perfMonitor)},instance:null},TouchEvents:{configKey:"isTouchEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.TouchEvents.instance=new _t.TouchEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},MetadataCollector:{configKey:"isMetadataCollect",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){var e=new _t.SiteMapper(MutationObserver,this._utils,this._perfMonitor,"metadataConfig",null,!1);this._features.defaultFeatures.MetadataCollector.instance=new _t.MetadataCollector(this._configMgr,this._dataQ,this._perfMonitor,e)},instance:null},TabsEvents:{configKey:"isTabsEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.defaultFeatures.TabsEvents.instance=new _t.TabsEvents(this._utils,this._dataQ)},instance:null}},perSessionFeatures:{DoNotTrack:{configKey:"isDoNotTrack",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.DoNotTrack.instance=new _t.DoNotTrackFeature(this._dataQ,this._perfMonitor)},instance:null},BrowserProps:{configKey:"collectBrowserProps",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.BrowserProps.instance=new _t.BrowserPropsFeature(this._dataQ,this._perfMonitor,_t.PointerHoverDetector,this._utils,this._configMgr)},instance:null},IsPrivateBrowsing:{configKey:"isPrivateBrowsing",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.IsPrivateBrowsing.instance=new _t.IsPrivateBrowsingFeature(this._dataQ,this._perfMonitor,new _t.PrivateBrowsingDetector)},instance:null},IpDetectorFeature:{configKey:"isIpCollection",shouldRun:!0,isFrameRelated:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.IpDetectorFeature.instance=new _t.IpDetectorFeature(this._dataQ,this._perfMonitor,this._configMgr)},instance:null},FontsDetectionFeature:{configKey:"isFonts",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.FontsDetectionFeature.instance=new _t.FontsDetectionFeature(this._utils,this._dataQ,this._perfMonitor,_t.FontsDetector)},instance:null},GraphicDetectFeature:{configKey:"isVMDetection",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.GraphicDetectFeature.instance=new _t.GraphicDetectFeature(this._dataQ,this._perfMonitor)},instance:null},AudioFeature:{configKey:"isAudioDetection",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.AudioFeature.instance=new _t.AudioFeature(this._utils,this._dataQ,this._perfMonitor)},instance:null},BrowserDetect:{configKey:"isBrowserDetect",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.BrowserDetect.instance=new _t.BrowserDetect(this._dataQ,this._perfMonitor)},instance:null},FilesFeature:{configKey:"isFilesFeature",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.FilesFeature.instance=new _t.FilesFeature(this._configMgr,this._utils,this._sessionMgr,this._muidMgr,this._perfMonitor)},instance:null},UserPermissions:{configKey:"isUserPermissions",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.UserPermissions.instance=new _t.UserPermissions(this._dataQ,this._perfMonitor)},instance:null},MediaDevicesFeature:{configKey:"isMediaDevices",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.MediaDevicesFeature.instance=new _t.MediaDevicesFeature(this._dataQ,this._perfMonitor)},instance:null}},perContextFeatures:{ContextPropsFeature:{configKey:"isContextPropsFeature",shouldRun:!0,isFrameRelated:!1,isRunning:!1,runInUns:!0,init:function(){this._features.perContextFeatures.ContextPropsFeature.instance=new _t.ContextPropsFeature(this._dataQ,this._perfMonitor,this._utils)},instance:null},ScriptsFeature:{configKey:"isScriptsFeature",shouldRun:!0,isFrameRelated:!1,isRunning:!1,runInUns:!0,init:function(){this._features.perContextFeatures.ScriptsFeature.instance=new _t.ScriptsFeature(this._dataQ,this._scriptsRepository,this._perfMonitor)},instance:null}},perPageReloadFeatures:{},nonDefaultFeatures:{AccelerometerEvents:{configKey:"isAccelerometerEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.AccelerometerEvents.instance=new _t.AccelerometerEvents(this._configMgr,this._utils,this._sensorDataQ,this._perfMonitor)},instance:null},PinchZoomEvents:{configKey:"isPinchZoomEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.nonDefaultFeatures.PinchZoomEvents.instance=new _t.PinchZoomEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},ScriptEvents:{configKey:"isScriptExecuteEve",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.ScriptEvents.instance=new _t.ScriptEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},MouseChallengeFeature:{configKey:"isChallengeFeature",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){var e=new _t.SiteMapper(MutationObserver,this._utils,this._perfMonitor,"challengeConfig");this._features.nonDefaultFeatures.MouseChallengeFeature.instance=new _t.MouseChallengeFeature(this._configMgr,this._utils,this._dataQ,e)},instance:null},NetInfoEvents:{configKey:"isNetInfoEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.NetInfoEvents.instance=new _t.NetInfoEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},ScreenOrientationEvents:{configKey:"isScreenOrientationEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.ScreenOrientationEvents.instance=new _t.ScreenOrientationEvents(this._configMgr,this._utils,this._dataQ,this._perfMonitor)},instance:null},TapEvents:{configKey:"isTapEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.nonDefaultFeatures.TapEvents.instance=new _t.TapEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null},VideoEvents:{configKey:"isVideoEvents",shouldRun:!1,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.VideoEvents.instance=new _t.VideoEvents(this._configMgr,this._utils,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},StorageEvents:{configKey:"isStorageEvents",shouldRun:!1,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.StorageEvents.instance=new _t.StorageEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},PrintEvents:{configKey:"isPrintEvents",shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.PrintEvents.instance=new _t.PrintEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},HistoryNavigationEvents:{configKey:"isHistoryNavigationEvent",shouldRun:!1,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.HistoryNavigationEvents.instance=new _t.HistoryNavigationEvents(this._dataQ,this._perfMonitor)},instance:null},LightSensorEvents:{configKey:"isLightSensor",shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.LightSensorEvents.instance=new _t.LightSensorEvents(this._dataQ,this._configMgr)},instance:null}}},function(a){function e(e,t,n){this._collectFrameRelated=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e[n].isFrameRelated&&t.push(e[n]);return t},this._runFeatures=function(e,t){var n=this;for(var i in e)e.hasOwnProperty(i)&&e[i].shouldRun&&!e[i].isFrameRelated&&(e[i].instance.startFeature.cdCallAsync(e[i].instance,window.self),e[i].isRunning=!0);if(t){for(var s=0,r=t.length;s<r;s++)t[s].shouldRun&&(t[s].instance.startFeature.cdCallAsync(t[s].instance,window.self),t[s].isRunning=!0);this._frameHandler.startFeatures(t),a.CDUtils.DomUtils.onPageLoad(window,function(){n._frameHandler.startFeatures(t)})}},this._stopFeatures=function(e,t){for(var n in e)e.hasOwnProperty(n)&&(e[n].isFrameRelated||(e[n].instance.stopFeature&&e[n].instance.stopFeature.cdCallAsync(e[n].instance),e[n].isRunning=!1));if(t){for(var i=0,s=t.length;i<s;i++)t[i].instance.stopFeature.cdCallAsync(t[i].instance),t[i].isRunning=!1;this._frameHandler.stopFeatures(t)}},this._actOnFeature=function(e,t){e.isFrameRelated&&this._frameHandler[t](e),e.instance[t]&&e.instance[t].cdCallAsync(e.instance)},this._updateFeatures=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],s=t.get(i.configKey);"boolean"==typeof s&&(i.shouldRun=s),i.isRunning&&!i.shouldRun?(this._actOnFeature(i,"stopFeature"),i.isRunning=!1):!i.isRunning&&i.shouldRun&&(this._actOnFeature(i,"startFeature"),i.isRunning=!0),i.isRunning&&this._actOnFeature(i,"updateFeatureConfig")}},this._features=e,this._frameHandler=t,this._configManager=n,this._frameRelatedDefaultFeatures=this._collectFrameRelated(e.defaultFeatures),this._frameRelatedNonDefaultFeatures=this._collectFrameRelated(e.nonDefaultFeatures)}e.prototype.runDefault=function(){log.info("Running default features"),this._runFeatures(this._features.defaultFeatures,this._frameRelatedDefaultFeatures)},e.prototype.stopDefault=function(){log.info("Stopping default features"),this._stopFeatures(this._features.defaultFeatures,this._frameRelatedDefaultFeatures)},e.prototype.runPerSessionFeatures=function(){log.info("Running per session features"),this._configManager.isConfigurationUpdatedFromServer()?this._runFeatures(this._features.perSessionFeatures):log.info("We didn't receive configurations from the server yet. Skipping per session features start until configuration arrives.")},e.prototype.stopPerSessionFeatures=function(){log.info("Stopping per session features"),this._stopFeatures(this._features.perSessionFeatures)},e.prototype.runNonDefault=function(){log.info("Running non default features"),this._configManager.isConfigurationUpdatedFromServer()?this._runFeatures(this._features.nonDefaultFeatures,this._frameRelatedNonDefaultFeatures):log.info("We didn't receive configurations from the server yet. Skipping non default features start until configuration arrives.")},e.prototype.stopNonDefault=function(){log.info("Stopping non default features"),this._stopFeatures(this._features.nonDefaultFeatures,this._frameRelatedNonDefaultFeatures)},e.prototype.runPerContextFeatures=function(e){log.info("Running per context features"),this._configManager.isConfigurationUpdatedFromServer()?(this._runFeatures(this._features.perContextFeatures),"cd_auto"!==e.name&&this._frameRelatedDefaultFeatures&&this._frameHandler.startFeatures(this._frameRelatedDefaultFeatures)):log.info("We didn't receive configurations from the server yet. Skipping per context features start until configuration arrives.")},e.prototype.stopPerContextFeatures=function(){log.info("Stopping per context features"),this._stopFeatures(this._features.perContextFeatures)},e.prototype.stopAllFeatures=function(){log.info("Stopping all features"),this.stopDefault(),this.stopNonDefault(),this.stopPerSessionFeatures(),this.stopPerContextFeatures()},e.prototype.updateRunByConfig=function(e){log.info("Updating features configuration"),this._updateFeatures(this._features.defaultFeatures,e),this._updateFeatures(this._features.nonDefaultFeatures,e),this._updateFeatures(this._features.perContextFeatures,e),this._updateFeatures(this._features.perSessionFeatures,e)},a.FeatureManager=e}(vn),function(e){function i(e,t,n,i,s,r,a,o,u,c,h,d){this._configMgr=t,this._utils=n,this._elements=i,this._mutationObserver=s,this._dataQ=r,this._features=e,this._sessionMgr=a,this._muidMgr=o,this._perfMonitor=u,this._sensorDataQ=c,this._msgBus=h,this._scriptsRepository=d}Object.extend(i,{BUILD_DEFAULT_ONLY:1,BUILD_NON_DEFAULT_ONLY:2,BUILD_PER_SESSION_ONLY:4,BUILD_PER_PAGE_RELOAD_ONLY:8,BUILD_PER_CONTEXT_ONLY:16}),i.BUILD_ALL=i.BUILD_DEFAULT_ONLY|i.BUILD_NON_DEFAULT_ONLY|i.BUILD_PER_SESSION_ONLY|i.BUILD_PER_PAGE_RELOAD_ONLY|i.BUILD_PER_CONTEXT_ONLY,i.prototype.buildFeatures=function(e){function t(e){for(var t in e)e.hasOwnProperty(t)&&e[t].init.apply(n)}var n=this;e&i.BUILD_DEFAULT_ONLY&&t(this._features.defaultFeatures),e&i.BUILD_PER_SESSION_ONLY&&t(this._features.perSessionFeatures),e&i.BUILD_NON_DEFAULT_ONLY&&t(this._features.nonDefaultFeatures),e&i.BUILD_PER_PAGE_RELOAD_ONLY&&t(this._features.perPageReloadFeatures),e&i.BUILD_PER_CONTEXT_ONLY&&t(this._features.perContextFeatures)},e.FeaturesBuilder=i}(vn),pt=vn,vt=function(){function i(e,t,n){Sn(this,i),this._utils=e,this._contextSiteMapper=t,this.contextName="",this.referrer="",this.historyLen=-1,this.changeTimestamp=0,this.onContextChange=new pt.CDEvent,this._contextSiteMapper.updateObserver(this.onSiteMapperMatch.bind(this)),this._workerComm=n}return mn(i,[{key:"contextData",value:function(){return{contextId:this.contextId,url:this.url,name:this.contextName,referrer:this.referrer,hLength:this.historyLen,timestamp:this.timestamp}}},{key:"setContext",value:function(e){this.contextName=e.name,this._genContext(),this.url=e.url,this.referrer=e.referrer,this.historyLen=e.hLength,this.timestamp=e.timestamp,this._publishContext()}},{key:"changeContext",value:function(e){e?e!==this.contextName?(this.contextName=e,this._updateContext(),this._publishContext(),log.info("Context changed to "+e)):log.warn("Received context "+e+" but this is already the current context. Aborting operation."):log.error("Received an invalid context name "+e+". Aborting context change operation")}},{key:"onSiteMapperMatch",value:function(e){e.contextName!==this.contextName&&this.changeContext(e.contextName)}},{key:"_updateContext",value:function(){this._genContext(),this.url=this._utils.getDocUrl(),this.referrer=pt.CDUtils.clearTextFromNumbers(document.referrer),this.historyLen=window.history.length,this.timestamp=this._utils.dateNow()}},{key:"_genContext",value:function(){this.contextId=this._utils.StorageUtils.getCookie("cdContextId"),this.contextId?this.contextId=parseInt(this.contextId):this.contextId=0,this._utils.StorageUtils.setCookie("cdContextId",this.contextId+1)}},{key:"_publishContext",value:function(){var e={contextName:this.contextName};this._workerComm.sendAsync(pt.WorkerCommand.changeContextCommand,e),this.onContextChange.publish(this.contextData())}},{key:"initContextHandling",value:function(){this._contextSiteMapper.initTracking()}},{key:"clearContextHandling",value:function(){this._contextSiteMapper.stopTracking()}},{key:"onConfigUpdate",value:function(e){this._contextSiteMapper.onConfigUpdate(e)}},{key:"onSessionReset",value:function(){this._publishContext()}}]),i}(),pt.ContextMgr=vt,mt=vn,(yt=function(){function n(e,t){Sn(this,n),this._contextMgr=e,this._dataQ=t,this._contextMgr.onContextChange.subscribe(this.sendContextToServer.bind(this)),this.handleContextChange({context:"cd_auto"})}return mn(n,[{key:"handleContextChange",value:function(e){this._contextMgr.changeContext(e.context||e.activityType)}},{key:"sendContextToServer",value:function(e){e&&this._dataQ.addToQueue("contextChange",[null,e.url,e.name,e.timestamp,e.referrer,e.hLength])}}]),n}()).apiName="ContextChange",mt.ContextApiHandler=yt,wt=vn,(bt=function(e){function s(e,t,n){Sn(this,s);var i=wn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,n));return i._confMgr=e,i._isEnabled=i._confMgr.get("isCustMetadata"),i}return bn(s,wt.AbstractFeature),mn(s,[{key:"onCustomerMetadata",value:function(e){this._isEnabled!=undefined&&null!=this._isEnabled&&1!=this._isEnabled||(log.debug("HandleMetadata:onCustomerMetadata. data="+JSON.stringify(e.data)),e.data&&this._dataQ.addToQueue("customer_metadata",[null,e.data]))}},{key:"onConfigUpdate",value:function(){this._isEnabled=this._confMgr.get("isCustMetadata")}}]),s}()).apiName="cdCustomerMetadata",wt.HandleMetadata=bt,St=vn,Et=function(){function n(e,t){Sn(this,n),this._pauseResumeMgr=e,this._messageBus=t,this._createCommandToBusMessageMapping()}return mn(n,[{key:"enableApi",value:function(){log.info("Enabling api calls"),this._onApiMessageBinded=this._onApiMessage.bind(this),St.CDUtils.addEventListener(window,"message",this._onApiMessageBinded,!0)}},{key:"disableApi",value:function(){log.info("Disabling api calls"),St.CDUtils.removeEventListener(window,"message",this._onApiMessageBinded,!0)}},{key:"getCustomerSessionID",value:function(t){St.CustomerApiBridge._getFromApiOrEmpty("getCustomerSessionID",function(e){t(e)})}},{key:"getLogServerAddress",value:function(t){St.CustomerApiBridge._getFromApiOrEmpty("getLogServerAddress",function(e){t(e)})}},{key:"getServerAddress",value:function(s){St.CustomerApiBridge._getFromApiOrEmpty("getCustomerConfigLocation",function(e){!e||-1<e.indexOf("wup")?s(e):(log.debug("CustomerApiBridge:getServerAddress: getting customer configuration file, url= "+e),St.CDUtils.getPostUrl(e,"GET",null,function(e){try{var t=JSON.parse(e),n=t.serverAddress;n?n.indexOf("cid")<0&&(n+="cid="+t.customerId):(log.error("CustomerApiBridge:getServerAddress - no server address in response"),n=""),s(n)}catch(i){log.error("CustomerApiBridge:getServerAddress - error getting server address: "+i.message)}},function(){log.error("CustomerApiBridge:getServerAddress - failed getting configuration file"),s("")},!1))})}},{key:"notifySessionReset",value:function(e){this._pauseResumeMgr.isCustomerApiEnabled()&&window.postMessage({type:"SNumNotification",cdSNum:e},window.location.href)}},{key:"isApiAvailable",value:function(e){return!!window.cdApi&&!!window.cdApi[e]}},{key:"_onApiMessage",value:function(e){var t=e.data,n=t.type;if(n===undefined)try{n=(t=JSON.parse(t)).type}catch(i){}(n===St.ApiCommandType.ChangeStateCommand||this._pauseResumeMgr.isCustomerApiEnabled()&&this._apiCommandToBusMessageMapping[n])&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),this._messageBus.publish(this._apiCommandToBusMessageMapping[n],t))}},{key:"_createCommandToBusMessageMapping",value:function(){this._apiCommandToBusMessageMapping={},this._apiCommandToBusMessageMapping[St.ApiCommandType.ContextChangeCommand]=St.MessageBusEventType.ApiContextChangeEvent,this._apiCommandToBusMessageMapping[St.ApiCommandType.ResetSessionCommand]=St.MessageBusEventType.ApiResetSessionEvent,this._apiCommandToBusMessageMapping[St.ApiCommandType.CustomerMetadataCommand]=St.MessageBusEventType.ApiCustomerMetadataEvent,this._apiCommandToBusMessageMapping[St.ApiCommandType.ChangeStateCommand]=St.MessageBusEventType.ApiChangeStateEvent,this._apiCommandToBusMessageMapping[St.ApiCommandType.SetCsidCommand]=St.MessageBusEventType.ApiSetCsidEvent,this._apiCommandToBusMessageMapping[St.ApiCommandType.SetPsidCommand]=St.MessageBusEventType.ApiSetPsidEvent}}],[{key:"_getFromApiOrEmpty",value:function(e,t){var n=2<arguments.length&&arguments[2]!==undefined?arguments[2]:0;if(!window.cdApi)return 20<=n?void log.error("Failed getting cdApi after all retries."):(0===n&&log.warn("cdApi not found in retry "+n),n++,void setTimeout(this._getFromApiOrEmpty.bind(this,e,t,n),100));if(!window.cdApi[e])return log.warn("User did not implement cdApi method: "+e),void t("");try{window.cdApi[e](t)}catch(i){throw log.error("An error has occurred while calling cdApi "+e+" function. Exception was thrown from client implementation.",i),i}}}]),n}(),St.CustomerApiBridge=Et,vn.ApiCommandType={ContextChangeCommand:"ContextChange",ResetSessionCommand:"ResetSession",CustomerMetadataCommand:"cdCustomerMetadata",ChangeStateCommand:"cdChangeState",SetCsidCommand:"cdSetCsid",SetPsidCommand:"cdSetPsid"},function(h){function e(e){if(!e)throw new Error("messageBus param must be defined");this._requireParseFields=new h.Map,this._requireParseFields.set(h.ConfigurationFields.dataWupDispatchRateSettings,h.ConfigurationFields.dataWupDispatchRateSettings),this._requireParseFields.set(h.ConfigurationFields.logWupDispatchRateSettings,h.ConfigurationFields.logWupDispatchRateSettings),this._requireParseFields.set(h.ConfigurationFields.serverCommunicationSettings,h.ConfigurationFields.serverCommunicationSettings),this._configurationList={},this.configDefault={logLevel:h.Logger.LOG_LEVEL.INFO,orientationEventsSamplePeriod:300,orientationEventsThreshold:1,stateChangeEnabled:!1,accelerometerEventsSamplePeriod:0,dataQPassWorkerInterval:500,gyroEventsSamplePeriod:0,gyroEventsThreshold:.3,isContextPropsFeature:!0,isEnabled:!0,isResetEveryLoad:!1,isScrollCollect:!0,isUnsupportedReport:!0,isVMDetection:!0,isAudioDetection:!0,isHistoryNavigationEvent:!1,wupStatisticsLogIntervalMs:3e4,resetSessionApiThreshold:2e4,wupMessageRequestTimeout:3e3,logMessageRequestTimeout:3e3,forceDynamicDataWupDispatchSettings:!0,dataWupDispatchRateSettings:h.ConfigurationDefaultTemplates.defaultDynamicWupDispatchRateConfiguration,logWupDispatchRateSettings:{type:"constant",initialRateValueMs:2500},serverCommunicationSettings:{sendRetryRate:1e3,queueLoadThreshold:100},ipDetectorTimeout:2e3,collectKeyRegionValue:!1},this._cid="",this._messageBus=e,this.updateConfiguration(this.configDefault)}h.ConfigManager||(h.ConfigurationFields={
resetSessionApiThreshold:"resetSessionApiThreshold",dataWupDispatchRateSettings:"dataWupDispatchRateSettings",logWupDispatchRateSettings:"logWupDispatchRateSettings",forceDynamicDataWupDispatchSettings:"forceDynamicDataWupDispatchSettings",wupStatisticsLogIntervalMs:"wupStatisticsLogIntervalMs",serverCommunicationSettings:"serverCommunicationSettings",wupResponseTimeout:"wupResponseTimeout",wupMessageRequestTimeout:"wupMessageRequestTimeout",logMessageRequestTimeout:"logMessageRequestTimeout",collectKeyRegionValue:"collectKeyRegionValue",ipDetectorTimeout:"ipDetectorTimeout"},h.ConfigurationDefaultTemplates={defaultDynamicWupDispatchRateConfiguration:{type:"dynamic"},defaultIncrementalWupDispatchRateConfiguration:{type:"incremental",initialRateValueMs:500,incrementStepMs:500,incrementStopMs:5e3,incrementStartWupSendCount:20}},e.prototype.isConfigurationUpdatedFromServer=function(){return!this._isDefaultConfiguration},e.prototype.updateConfiguration=function(e){for(var t in this._isDefaultConfiguration=e===this.configDefault,e)if(e.hasOwnProperty(t)){var n=e[t];if(this._requireParseFields.has(t)){var i=this.tryParseConfigurationValue(n);i&&(n=i)}this._configurationList[t]=n}this._messageBus.publish(h.MessageBusEventType.ConfigUpdatedEvent,this)},e.prototype.tryParseConfigurationValue=function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(t){}return null},e.prototype.updateLogUrlToWorker=function(e,t,n,i){if(i&&(this._configurationList.logAddress=i),this._configurationList.logAddress){var s={logAddress:this._configurationList.logAddress+"?cid="+this._cid+"&cdsnum="+e+"&csid="+t+"&ds=js&sdkVer="+h.CDUtils.scriptVersion};n.sendAsync(h.WorkerCommand.updateLogUrlCommand,s)}},e.prototype.getServerConfig=function(e,t,n,i){var s=this;function r(e){log.warn("Config Manager received an error response for Init request from Worker."),s.updateConfiguration(s.configDefault),i&&i(e)}this._configurationList.serverAddress=t.serverAddress;var a=t.serverAddress.indexOf("cid=")+4,o=t.serverAddress.indexOf("&",a);o=-1==o?undefined:o,this._cid=t.serverAddress.substring(a,o);var u={serverAddress:t.serverAddress,csid:t.csid,psid:t.psid,cdsnum:t.sessionId,muid:t.muid,context_name:t.context_name,serverState:t.serverState};log.info("Config Manager is requesting configuration from Worker."),e.addMessageListener("initCommFailed",r,!0),e.sendAsync(h.WorkerCommand.requestConfigurationsCommand,u,"initCommSuccess",function c(e){log.info("Config Manager received Init response from Worker."),e?(log.info("Updating received configuration and notifying on the change."),s.updateConfiguration(e),n&&n(e)):r(e)},!0)},e.prototype.get=function(e){return this._configurationList[e]},e.prototype.setSingleConfiguration=function(e,t){this._configurationList[e]=t},e.prototype.getAllConfigs=function(){return this._configurationList},h.ConfigManager=e)}(vn),kt=vn,(Ct=function(){function l(e,t,n,i,s,r,a,o,u,c,h,d){Sn(this,l),this._messageBus=e,this._configMgr=t,this._utils=n,this._workerComm=i,this._contextMgr=s,this._muidMgr=r,this._serverStateMgr=a,this._resetSessionSiteMapper=o,this._sidRepository=u,this._csidService=c,this._csidCache=h,this._psidCache=d,this.lastExternalResetCallTime=null,this.sessionId=null,this._resetSessionSiteMapper.updateObserver(this._onSiteMapperMatch.bind(this)),i.addMessageListener(kt.WorkerEvent.NewSessionStartedEvent,this._onNewSessionStartedEvent.bind(this))}return mn(l,[{key:"resumeOrStartSession",value:function(){var e=this._getSessionId();e&&!this._configMgr.get("isResetEveryLoad")?this._resumeSession(e):this._startNewSession()}},{key:"onConfigUpdate",value:function(e){this._resetSessionSiteMapper.onConfigUpdate(e),this._configMgr._configurationList.logAddress&&this._configMgr.updateLogUrlToWorker(this.sessionId,this._csidCache.get(),this._workerComm)}},{key:"resetSession",value:function(e){this.onResetSession(e)}},{key:"onResetSession",value:function(e){var t=e.resetReason?e.resetReason:kt.EnumDefs.SNUM_CHANGE_TYPE.unknown;kt.EnumDefs.SNUM_CHANGE_TYPE.hasOwnProperty(t)||(t=kt.EnumDefs.SNUM_CHANGE_TYPE.customerApi),log.info("Received a Reset Session event, reason: "+t),this._utils.dateNow()-this.lastExternalResetCallTime>this._configMgr.get(kt.ConfigurationFields.resetSessionApiThreshold)?(this._startNewSession(),this._configMgr.updateLogUrlToWorker(this.sessionId,this._csidCache.get(),this._workerComm),this.lastExternalResetCallTime=this._utils.dateNow()):log.info("Ignoring external reset session call since resetSessionApiThreshold hasn't passed")}},{key:"_startNewSession",value:function(){log.info("Starting a new session. Previous session was "+this.sessionId),this.sessionId=null,this._csidCache.set(null),this._psidCache.set(null),this._serverStateMgr.onSessionIdChange(),this._onStartedNewSession()}},{key:"_resumeSession",value:function(e){log.info("Resuming an existing session with sid "+e),this.sessionId=e,this._saveSidToStorage(this.sessionId),this._onResumedSession(),this._handleCsid()}},{key:"_getSessionId",value:function(){var e;return log.info("Attempting to get sid from storage"),(e=this._sidRepository.get())&&log.info("Read sid "+e+" from storage"),e}},{key:"_saveSidToStorage",value:function(e){log.info("Saving sid "+e+" to storage"),this._sidRepository.set(e)}},{key:"_onStartedNewSession",value:function(){if(this._configMgr.get("serverAddress")){var e={serverAddress:this._configMgr.get("serverAddress"),csid:this._csidCache.get(),psid:this._psidCache.get(),cdsnum:this.sessionId,muid:this._muidMgr.muid,context_name:this._contextMgr.contextName};this._workerComm.sendAsync(kt.WorkerCommand.startNewSessionCommand,e),this._configMgr.updateLogUrlToWorker(this.sessionId,this._csidCache.get(),this._workerComm)}}},{key:"_onResumedSession",value:function(){if(this._configMgr.get("serverAddress")){var e=this._serverStateMgr.getServerState(this.sessionId),t={serverAddress:this._configMgr.get("serverAddress"),csid:this._csidCache.get(),psid:this._psidCache.get(),cdsnum:this.sessionId,muid:this._muidMgr.muid,context_name:this._contextMgr.contextName,serverState:e};this._workerComm.sendAsync(kt.WorkerCommand.resumeSessionCommand,t),this._configMgr.updateLogUrlToWorker(this.sessionId,this._csidCache.get(),this._workerComm)}}},{key:"_handleCsid",value:function(){var e=this;this._utils.DomUtils.onDocumentBody(self,function(){log.debug("SessionManager:_sessionIdRegeneration, onDocumentBody callback: cdSNum: "+e.sessionId),e._csidService.get(function(){log.info("Received csid from client. csid: "+e._csidCache.get()+", sid:"+e.sessionId),e._sendCsidToServer()})})}},{key:"_sendCsidToServer",value:function(){this._configMgr.get("serverAddress")&&(log.info("Sending csid to worker. csid: "+this._csidCache.get()+", sid:"+this.sessionId),this._workerComm.sendAsync(kt.WorkerCommand.updateCsidCommand,{csid:this._csidCache.get()}),this._configMgr.updateLogUrlToWorker(this.sessionId,this._csidCache.get(),this._workerComm))}},{key:"_onSiteMapperMatch",value:function(){this.onResetSession({resetReason:kt.EnumDefs.SNUM_CHANGE_TYPE.configuration})}},{key:"_onNewSessionStartedEvent",value:function(e){this.sessionId=e,this._saveSidToStorage(this.sessionId),this._configMgr.updateLogUrlToWorker(this.sessionId,this._csidCache.get(),this._workerComm),this._notifyNewSessionStarted(),this._handleCsid(),log.info("A new session "+e+" has started")}},{key:"_notifyNewSessionStarted",value:function(){this._messageBus.publish(kt.MessageBusEventType.NewSessionStartedEvent,this.sessionId)}}]),l}()).apiName="ResetSession",kt.SessionManager=Ct,Mt=vn,Tt=function(){function n(e,t){Sn(this,n),this.sidKey="cdSNum",this._utils=e,this._configManager=t,this.COOKIE_EXPIRATION_IN_MILLISECONDS=this._utils.minutesToMilliseconds(525600)}return mn(n,[{key:"get",value:function(){var e=this._utils.StorageUtils.getCookie(this.sidKey),t=this._validateSid(e);if(!t){log.info("Sid was not found in cookie. Trying to get it from the local storage.");var n=this._utils.StorageUtils.getFromLocalStorage(this.sidKey);if(!(t=this._validateSid(n)))return log.info("Sid was not found in local storage."),null}return t}},{key:"set",value:function(e){var t=e;(t=this._validateSid(t))?(this._utils.StorageUtils.saveToLocalStorage(this.sidKey,t)||log.error("Failed saving sid "+e+" to local storage."),this._utils.StorageUtils.setCookie(this.sidKey,t,this.COOKIE_EXPIRATION_IN_MILLISECONDS)||log.error("Failed saving sid "+e+" to cookie.")):log.error("Sid "+e+" is invalid. Will not save it.")}},{key:"_validateSid",value:function(e){return e||null}}]),n}(),Mt.SidRepository=Tt,Dt=vn,xt=function(){function i(e,t,n){Sn(this,i),this._customerApi=e,this._csidCache=t,this._workerCommunicator=n}return mn(i,[{key:"set",value:function(e){if(e===undefined)throw new Error("Invalid csid value of undefined");this._csidCache.set(e),this._workerCommunicator.sendAsync(Dt.WorkerCommand.updateCsidCommand,{csid:e})}},{key:"get",value:function(e){this._customerApi.isApiAvailable("getCustomerSessionID")?this._getCsidWithRetries(0,e):log.debug("getCustomerSessionID API is unavailable. Hopefully this is because the setCustomerSessionId API is being used")}},{key:"_getCsidWithRetries",value:function(t,n){var i=this;try{this._customerApi.getCustomerSessionID(function(e){if(!e)return 20<=t?void log.error("Failed getting csid after all retries. Received csid is empty"):(0===t&&log.warn("Received csid was empty in retry "+t),t++,void setTimeout(i._getCsidWithRetries.bind(i,t,n),200));log.info("Got csid after "+t+" retries. csid: "+e),i._csidCache.set(e),n()})}catch(e){log.error("Failed to get csid: "+e.message+". retryCount: "+t+".",e),++t<=20&&setTimeout(this._getCsidWithRetries.bind(this,t,n),200)}}}]),i}(),Dt.CsidService=xt,Ft=vn,At=function(){function e(){Sn(this,e),this._csid=null}return mn(e,[{key:"get",value:function(){return this._csid}},{key:"set",value:function(e){if(e===undefined)throw new Error("Invalid csid value of undefined");this._csid=e}}]),e}(),Ft.CsidCache=At,Rt=vn,Pt=function(){function n(e,t){Sn(this,n),this._psidCache=e,this._workerCommunicator=t}return mn(n,[{key:"set",value:function(e){if(e===undefined)throw new Error("Invalid psid value of undefined");this._psidCache.set(e),this._workerCommunicator.sendAsync(Rt.WorkerCommand.updatePsidCommand,{psid:e})}}]),n}(),Rt.PsidService=Pt,Ut=vn,It=function(){function e(){Sn(this,e),this._psid=null}return mn(e,[{key:"get",value:function(){return this._psid}},{key:"set",value:function(e){if(e===undefined)throw new Error("Invalid psid value of undefined");this._psid=e}}]),e}(),Ut.PsidCache=It,Lt=vn,Bt=function(){function n(e,t){Sn(this,n),this.muid=null,this._utils=e,this._dataQ=t,this.EXPIRATION=e.minutesToMilliseconds(525600)}return mn(n,[{key:"initMuid",value:function(){var e=this._utils.StorageUtils.getCookie("bmuid"),t=this._utils.StorageUtils.getFromLocalStorage("bmuid");this.muid=t||e,this.muid=this._utils.StorageUtils.validateBcId(this.muid),this.muid||(this.muid=this._utils.dateNow()+"-"+this._utils.generateUUID().toUpperCase(),log.info("Generated a new muid: "+this.muid)),this._utils.StorageUtils.setCookie("bmuid",this.muid,this.EXPIRATION),this._utils.StorageUtils.saveToLocalStorage("bmuid",this.muid),this._dataQ.addToQueue("static_fields",["muid",this.muid],!1),log.info("Muid is: "+this.muid)}}]),n}(),Lt.MuidManager=Bt,Nt=vn,Ot=function(){function n(e,t){Sn(this,n),this._workerComm=e,this._utils=t,this._currState=null,e.addMessageListener(Nt.WorkerEvent.ServerStateUpdatedEvent,this._onStateUpdateFromWorker.bind(this)),Nt.CDUtils.addEventListener(window,"storage",this._onStateUpdateFromStorage.bind(this),!0)}return mn(n,[{key:"getServerState",value:function(e){if(this._utils.isUndefinedNull(e))throw new Error("Invalid sid param of "+e);return this._currState=this._currState||this._utils.StorageUtils.getFromLocalStorage("cdSrvrState"),this._currState&&this._currState.sid!==e?null:this._currState}},{key:"onSessionIdChange",value:function(){this._utils.StorageUtils.removeFromLocalStorage("cdSrvrState"),this._currState=null}},{key:"_onStateUpdateFromWorker",value:function(e){this._updateServerState(e)}},{key:"_updateServerState",value:function(e){this._currState=e,this._utils.StorageUtils.saveToLocalStorage("cdSrvrState",e)}},{key:"_onStateUpdateFromStorage",value:function(e){if(e&&e.storageArea&&e.storageArea.cdSrvrState){var t=JSON.parse(e.storageArea.cdSrvrState);this._workerComm.sendAsync("stateUpdateFromStorage",{requestId:t.val.requestId,sts:t.val.sts,std:t.val.std})}}}]),n}(),Nt.ServerStateMgr=Ot,(Wt=vn).startSloth=function(e,n){var t=this;function i(e){log.info("Got configuration from server successfully."),o.stopMonitor("t.timeTillSrvrConf"),n&&n(e.isEnabled)}function s(e){o.cancelMonitor("t.timeTillSrvrConf");var t="first wup failure: "+(e&&e.message?e.message:"")+" state: "+(e&&e.nextState?e.nextState:"");log.error(t),n&&n(!1)}this.callback=n,Wt.CDWPTCD["default"].setExport(Wt);var r=new Wt.CDWPTCD["default"].Application,a=new Wt.SystemLoader;(Wt.sysLoader=a).loadSystem(Wt.getServerWorkerCode(),Wt.FeaturesList,Wt.log);var o=a.getPerfMonitor();return o.startMonitor("t.timeTillSrvrConf"),o.startMonitor("t.timeTillDataCollect"),this.confManager=a.getConfigManager(),this.sessionMgr=a.getSessionManager(),this.sessionMgr.resumeOrStartSession(),r.initialize("undefined"!=typeof a.getUnsupportedMgr()),a.getFeatureBuilder().buildFeatures(Wt.FeaturesBuilder.BUILD_ALL),a.getFeatureManager().runDefault(),a.getApiBridge().enableApi(),a.getContextMgr().initContextHandling(),a.registerPostLoadEvents(Wt.FeaturesList),a.getApiBridge().getLogServerAddress(function(e){e&&t.confManager.updateLogUrlToWorker(t.sessionMgr.sessionId,a.getCsidCache().get(),a.getServerWorkerCommunicator(),e),log.info("Started default features collection"),a.getApiBridge().getServerAddress(function(e){if(!e)throw log.error("startSloth.getServerAddress: error getting URL"),new Error("Unable to complete the startup. Missing server url");log.info("Got server address: "+e),a.getMuidMgr().initMuid(),t.confManager.getServerConfig(a.getServerWorkerCommunicator(),{serverAddress:e,sessionId:t.sessionMgr.sessionId,muid:a.getMuidMgr().muid,csid:a.getCsidCache().get(),psid:a.getPsidCache().get(),scriptVersion:Wt.CDUtils.scriptVersion,context_name:a.getContextMgr().contextName,serverState:t.sessionMgr.sessionId?a.getServerStateMgr().getServerState(t.sessionMgr.sessionId):null},i,s)})}),a},function(a){function e(e,t,n,i,s){var r=this;this._sendQToServerWorker=function(){try{this._Q.length&&(this._serverWorkerCommunicator.sendAsync(this._msgToWorker,this._Q),this._Q=[])}catch(e){log.error("Failed sending data to worker. "+e),this._sendQInSingleMessagesToServerWorker()}},this._sendQInSingleMessagesToServerWorker=function(){for(var e=0;e<this._Q.length;e++)try{this._serverWorkerCommunicator.sendAsync(this._msgToWorker,this._Q[e])}catch(t){log.error("Failed sending single message data to worker. "+t)}this._Q=[]},this._onUnload=function(){this._Q.push({eventName:"flushData"}),this._sendQToServerWorker()},this._serverWorkerCommunicator=e,this._contextManager=t,this._passToWorkerInterval=s||0,this._intervalConfigKey=n,this._msgToWorker=i,this._Q=[],this._passToWorkerInterval&&(this._intervalId=setInterval(this._sendQToServerWorker.bind(this),this._passToWorkerInterval)),a.CDUtils.addEventListener(window,"beforeunload",function(){r._onUnload()},!0)}e.prototype.addToQueue=function(e,t,n,i){(n=!(n!==undefined&&null!==n&&!0!==n))&&t.push&&(t[0]=this._contextManager.contextId),0!==this._passToWorkerInterval?(this._Q.push({eventName:e,data:t,shouldFlush:i}),i&&this._sendQToServerWorker()):this._serverWorkerCommunicator.sendAsync(this._msgToWorker,{eventName:e,data:t,shouldFlush:i})},e.prototype.updateWithConfig=function(e){var t=e.get(this._intervalConfigKey);t!==undefined&&t!==this._passToWorkerInterval&&(this._passToWorkerInterval=t,clearInterval(this._intervalId),this._intervalId=null,0!==this._passToWorkerInterval&&(this._intervalId=setInterval(this._sendQToServerWorker.bind(this),this._passToWorkerInterval)))},a.DataQ=e}(vn),Qt=vn,Ht=function(){function i(e,t,n){Sn(this,i),this._featureMgr=e,this._dataQ=n,this._confMgr=t,this._pauseResumeEnabled=t.get("stateChangeEnabled")||!1,this._sdkState=i.STATE.RUNNING}return mn(i,[{key:"onResume",value:function(){this._sdkState===i.STATE.PAUSED?(log.info("Resuming JS SDK"),this._featureMgr.updateRunByConfig(this._confMgr),this._sdkState=i.STATE.RUNNING):log.warn("PauseResumeManager:onResume - resume api called when SDK already running")}},{key:"onPause",value:function(){this._sdkState===i.STATE.RUNNING?(log.info("Pausing JS SDK"),this._featureMgr.stopAllFeatures(),this._sdkState=i.STATE.PAUSED):log.warn("Pause api called when SDK already paused")}},{key:"onStateChange",value:function(e){e.toState&&this._verifyApiAllowed(e.toState)&&("pause"===e.toState?this.onPause():"run"===e.toState?this.onResume():log.warn("stateChange api called with non valid toState: "+e.toState))}},{key:"isCustomerApiEnabled",value:function(){return this._sdkState===i.STATE.RUNNING}},{key:"_verifyApiAllowed",value:function(e){return!!this._pauseResumeEnabled||(this._dataQ.addToQueue("forbidden_api_call",[null,e]),!1)}},{key:"onConfigUpdate",value:function(){this._pauseResumeEnabled=this._confMgr.get("stateChangeEnabled")||!1,!1===this._confMgr.get("isEnabled")&&this.onPause()}}]),i}(),Object.extend(Ht,{STATE:{RUNNING:0,PAUSED:1}}),Qt.PauseResumeManager=Ht,qt=vn,zt=function(){function a(e,t,n,i,s){var r=!(5<arguments.length&&arguments[5]!==undefined)||arguments[5];Sn(this,a),this._mutationObserver=e,this._siteMapKey=i,this._keyUrl=i+"_isUrlNonMasked",this._perfMonitor=n,this._stopOnFirstMappingMatch=r,this._siteMap=null,this._observers=[],this._utils=t,this._onMatchCB=s,this._maxMappings=200,this._maxTriggers=10}return mn(a,[{key:"updateObserver",value:function(e){this._onMatchCB=e}},{key:"_observeChange",value:function(e,t){if(e)try{var n=window.document.querySelector(e);if(n){var i=new this._mutationObserver(function(e){0<e.length&&t()});i.observe(n,{childList:!0,characterData:!0,attributes:!0,subtree:!0}),this._observers.push(i)}else log.error("Selector:"+JSON.stringify(e)+" not found on page. Check "+this._siteMapKey+" configuration")}catch(s){log.error("SiteMapper._observeChange: "+s.message,s)}}},{key:"initTracking",value:function(){var s=this,r=function r(){try{s._perfMonitor.startMonitor("siteMapperTrack_"+s._siteMapKey);for(var e=0;e<s._siteMap.mappings.length;e++){var t=s._siteMap.mappings[e];if(!t.url||-1<s._url.indexOf(t.url))if(t.selector){var n=window.document.querySelector(t.selector);if(n)if(t.byText){if((n.innerText!==undefined&&-1!==n.innerText.indexOf(t.byText)||n.value===t.byText||n.textContent===t.byText)&&(s._perfMonitor.stopMonitor("siteMapperTrack_"+s._siteMapKey),s._onMatchCB(t),s._stopOnFirstMappingMatch))return}else if(s._perfMonitor.stopMonitor("siteMapperTrack_"+s._siteMapKey),s._onMatchCB(t),s._stopOnFirstMappingMatch)return}else if(-1<s._url.indexOf(t.url)&&(s._perfMonitor.stopMonitor("siteMapperTrack_"+s._siteMapKey),s._onMatchCB(t),s._stopOnFirstMappingMatch))return}}catch(i){s._perfMonitor.cancelMonitor("siteMapperTrack_"+s._siteMapKey),log.error("SiteMapper:testQuerySelector failed. ex:"+i.message,i)}};if(!this._siteMap){var e=this._utils.StorageUtils.getFromSessionStorage(this._siteMapKey);e&&e.triggers.length<=this._maxTriggers&&e.mappings.length<=this._maxMappings&&(this._siteMap=e),this._isNonMaskedUrl=this._utils.StorageUtils.getFromSessionStorage(this._keyUrl)}this._siteMap&&(this._url=this._isNonMaskedUrl?window.document.location.href:this._utils.getDocUrl(),this._utils.DomUtils.onDocumentBody(window,function(){s._mutationObserver&&s._siteMap.triggers.forEach(function(e){(!e.url||-1<s._url.indexOf(e.url))&&s._observeChange(e.selector,r)}),r()}))}},{key:"onConfigUpdate",value:function(e){try{if(!this._siteMap&&e.get(this._siteMapKey)){this.stopTracking();var t=e.get(this._siteMapKey)&&JSON.parse(e.get(this._siteMapKey));this._isNonMaskedUrl=e.get("useNonMaskedUrlInMappings"),t&&t.triggers.length<=this._maxTriggers&&t.mappings.length<=this._maxMappings?(this._siteMap=t,this._utils.StorageUtils.saveToSessionStorage(this._siteMapKey,this._siteMap),this._utils.StorageUtils.saveToSessionStorage(this._keyUrl,this._isNonMaskedUrl),this.initTracking()):log.warn("Configuration "+this._siteMapKey+" contains an illegal amount of triggers or mappings. Max Allowed Triggers: "+this._maxTriggers+", Max Allowed Mappings: "+this._maxMappings)}}catch(n){log.error("SiteMapper:onConfigUpdate: "+n.message,n)}}},{key:"stopTracking",value:function(){for(var e=0;e<this._observers.length;e++)this._observers[e].disconnect();this._observers=[],this._siteMap=null}}]),a}(),qt.SiteMapper=zt,(jt=vn).SlaveListener=function(){function a(e,t,n,i,s,r){Sn(this,a),this._slaves=[],this._dataQ=e,this._configMgr=t,this._utils=n,this._logPerfDataQ=i,this._contextMgr=s,this._sessionManager=r,this.onResetSessionTrigger=new jt.CDEvent,this.onMouseChallengeTrigger=new jt.CDEvent,this._msgRouter={dataFromSlave:this._onDataFromSlave,registerSlave:this._onRegisterSlave,logPerfSlave:this._onLogPerfSlave,updateMasterContext:this._onUpdateMasterContext,resetSessionTriggerFromSlave:this._onResetSessionTriggerFromSlave,mouseChallengeTriggerFromSlave:this._onMouseChallengeTriggerFromSlave}}return mn(a,[{key:"listen",value:function(){var n=this;log.debug("SlaveListener:listen"),this._utils.addEventListener(window,"message",function(e){var t=e.data.msgType;t&&n._msgRouter[t]&&n._msgRouter[t].call(n,e)})}},{key:"sendToSlaves",value:function(t,n){log.debug("SlaveListener:sendToSlaves"),this._slaves.forEach(function(e){e.source.postMessage({msgType:t,data:n},e.origin)})}},{key:"onConfigUpdate",value:function(){log.debug("SlaveListener:onConfigUpdate, updating "+this._slaves.length+" slaves"),this.sendToSlaves(jt.EnumDefs.MasterSlaveMessage.updateSlaveConf,this._configMgr.getAllConfigs())}},{key:"notifyStateChange",value:function(e){log.info("SlaveListener:notifyStateChange, updating "+this._slaves.length+" slaves that the new state is "+e.toState),this.sendToSlaves(jt.EnumDefs.MasterSlaveMessage.updateSlaveState,e)}},{key:"_onDataFromSlave",value:function(e){var t=e.data;"flushData"!==t.data.eventName&&t.data.eventName&&this._dataQ.addToQueue(t.data.eventName,t.data.data)}},{key:"_onRegisterSlave",value:function(e){log.info("SlaveListener:_onRegisterSlave - slave registered, origin "+e.origin),this._slaves.push({source:e.source,origin:e.origin}),e.source.postMessage({msgType:"updateSlaveConf",data:this._configMgr.getAllConfigs()},e.origin)}},{key:"_onLogPerfSlave",value:function(e){var t=e.data;"flushData"!==t.data.eventName&&t.data.eventName&&this._logPerfDataQ.addToQueue(t.data.eventName,t.data.data)}},{key:"_onUpdateMasterContext",value:function(e){log.debug("SlaveListener:_onUpdateMasterContext");var t=e.data;this._contextMgr.setContext(t.data)}},{key:"_onResetSessionTriggerFromSlave",value:function(e){log.debug("SlaveListener:_onResetSessionTriggerFromSlave");var t=e.data;this.onResetSessionTrigger.publish(t.data)}},{key:"_onMouseChallengeTriggerFromSlave",value:function(e){log.debug("SlaveListener:_onMouseChallengeTriggerFromSlave");var t=e.data;this.onMouseChallengeTrigger.publish(t.data)}}]),a}(),function(_){function e(){this._serverWorker=null,this._serverWorkerCommunicator=null,this._configManager=null,this._featureBuilder=null,this._featureManager=null,this._dataQ=null,this._frameHandler=null,this._eventHandlers=[],this._runWorker=function(e){var t=(new _.BlobFactory).create(e),n=(new _.BlobUrlFactory).create(t);return(new _.WorkerWrapperFactory).create(n)}}e.prototype.loadSystem=function(e,t,n){var i="";try{e&&(this.runServerWorker(e),this._serverWorkerCommunicator=new _.WorkerCommunicator,this._serverWorkerCommunicator.setMessagingPort(this._serverWorker.port))}catch(g){i=g.message,this._unsupportedMgr=new _.UnsupportedMgr(new _.UnsPort),_.executeServerWorkerCodeInMain(),this._serverWorkerCommunicator=new _.WorkerCommunicator,this._serverWorkerCommunicator.setMessagingPort(this._unsupportedMgr.getUnsPort()),this._unsupportedMgr.adjustFeatureList(t)}var s=new _.DataQ(this._serverWorkerCommunicator,null,"logPerfQPassWorkerInterval",_.WorkerCommand.sendLogCommand),r=this._perfMonitor=new _.PerfMonitor(s),a=new _.SiteMapper(self.MutationObserver,_.CDUtils,r,"contextConfiguration"),o=this._contextMgr=new _.ContextMgr(_.CDUtils,a,this._serverWorkerCommunicator),u=new(function(){function e(){Sn(this,e)}return mn(e,[{key:"log",value:function log(e,t){s.addToQueue("log",{msg:e,url:o.url,level:t,sn:this.sn++})}}]),e}());u.sn=0;var c=new _.Logger(u);n.setLogger(c),this._currScriptName=document.currentScript?document.currentScript.src:"",this._globalexceptionHandler=new _.GlobalExceptionHandler(_.CDUtils,this._currScriptName),this._msgBus=new _.MessageBus(_.CDUtils),this._dataQ=new _.DataQ(this._serverWorkerCommunicator,this._contextMgr,"dataQPassWorkerInterval",_.WorkerCommand.sendDataCommand),this._serverStateMgr=new _.ServerStateMgr(this._serverWorkerCommunicator,_.CDUtils),this._configManager=new _.ConfigManager(this._msgBus),this._sensorDataQ=new _.SensorsDataQueue(this._configManager,this._dataQ,this._msgBus),this._unsupportedMgr?log.warn("moving to unsupported mode since workers were not able to be loaded. error="+i):this._elementsUtils=new _.Elements(this._configManager,_.CDUtils,this._dataQ,this._contextMgr,r),this._framesCache=new _.FramesCache,this._framesDetector=new _.FramesDetector(self.MutationObserver,_.CDUtils),this._frameHandler=this._unsupportedMgr?this._unsupportedMgr.getUnsFrameHandler():new _.FramesHandler(this._framesCache,this._framesDetector,_.CDUtils),this._featureManager=new _.FeatureManager(t,this._frameHandler,this._configManager),this._pauseResumeMgr=new _.PauseResumeManager(this._featureManager,this._configManager,this._dataQ),this._customerApiBridge=new _.CustomerApiBridge(this._pauseResumeMgr,this._msgBus),this._muidManager=new _.MuidManager(_.CDUtils,this._dataQ),this._psidCache=new _.PsidCache;var h=new _.PsidService(this._psidCache,this._serverWorkerCommunicator),d=new _.SiteMapper(self.MutationObserver,_.CDUtils,r,"resetSessionConfig"),l=new _.SidRepository(_.CDUtils,this._configManager);this._csidCache=new _.CsidCache;var f=new _.CsidService(this._customerApiBridge,this._csidCache,this._serverWorkerCommunicator);this._sessionManager=new _.SessionManager(this._msgBus,this._configManager,_.CDUtils,this._serverWorkerCommunicator,this._contextMgr,this._muidManager,this._serverStateMgr,d,l,f,this._csidCache,this._psidCache),this._handleMetadata=new _.HandleMetadata(this._configManager,this._dataQ,r),this._scriptsRepository=new _.ScriptsRepository(_.CDUtils),this._slaveListener=new _.SlaveListener(this._dataQ,this._configManager,_.CDUtils,s,o),this._slaveListener.listen(),this._featureBuilder=new _.FeaturesBuilder(t,this._configManager,_.CDUtils,this._elementsUtils,self.MutationObserver,this._dataQ,this._sessionManager,this._muidManager,r,this._sensorDataQ,this._msgBus,this._scriptsRepository),this._contextApiHandler=new _.ContextApiHandler(this._contextMgr,this._dataQ),this._contextMgr.onContextChange.subscribe(this._featureManager.runPerContextFeatures.bind(this._featureManager)),this._eventHandlers.push(new _.ApiContextChangeEventHandler(this._msgBus,this._contextMgr)),this._eventHandlers.push(new _.ApiResetSessionEventHandler(this._msgBus,this._sessionManager)),this._eventHandlers.push(new _.ApiCustomerMetadataEventHandler(this._msgBus,this._handleMetadata)),this._eventHandlers.push(new _.ApiChangeStateEventHandler(this._msgBus,this._pauseResumeMgr,this._slaveListener)),this._eventHandlers.push(new _.ApiSetCsidEventHandler(this._msgBus,f)),this._eventHandlers.push(new _.ApiSetPsidEventHandler(this._msgBus,h)),this._eventHandlers.push(new _.ConfigUpdatedEventHandler(this._msgBus,this._featureManager,this._dataQ,this._pauseResumeMgr,this._handleMetadata,c,this._contextMgr,this._sessionManager,this._sensorDataQ,this._slaveListener)),this._eventHandlers.push(new _.NewSessionStartedEventHandler(this._msgBus,this._featureManager,this._customerApiBridge,this._contextMgr))},e.prototype.runServerWorker=function(e){this._serverWorker=this._runWorker(e)},e.prototype.registerPostLoadEvents=function(e){if(e.nonDefaultFeatures.MouseChallengeFeature){var t=e.nonDefaultFeatures.MouseChallengeFeature.instance;this._slaveListener.onMouseChallengeTrigger.subscribe(t.startHiding.bind(t))}this._slaveListener.onResetSessionTrigger.subscribe(this._sessionManager.resetSession.bind(this._sessionManager))},e.prototype.getServerWorkerCommunicator=function(){return this._serverWorkerCommunicator},e.prototype.getFeatureBuilder=function(){return this._featureBuilder},e.prototype.getFeatureManager=function(){return this._featureManager},e.prototype.getConfigManager=function(){return this._configManager},e.prototype.getSessionManager=function(){return this._sessionManager},e.prototype.getContextMgr=function(){return this._contextMgr},e.prototype.getMuidMgr=function(){return this._muidManager},e.prototype.getApiBridge=function(){return this._customerApiBridge},e.prototype.getUnsupportedMgr=function(){return this._unsupportedMgr},e.prototype.getPerfMonitor=function(){return this._perfMonitor},e.prototype.getServerStateMgr=function(){return this._serverStateMgr},e.prototype.getMessageBus=function(){return this._msgBus},e.prototype.getCsidCache=function(){return this._csidCache},e.prototype.getPsidCache=function(){return this._psidCache},_.SystemLoader=e}(vn),Vt=vn,Yt=function(){function h(e,t,n,i,s,r,a,o,u,c){Sn(this,h),this._messageBus=e,this._featureManager=t,this._dataQ=n,this._pauseResumeMgr=i,this._handleMetadata=s,this._logger=r,this._contextMgr=a,this._sessionManager=o,this._sensorDataQ=u,this._slaveListener=c,this._messageBus.subscribe(Vt.MessageBusEventType.ConfigUpdatedEvent,this._handle.bind(this))}return mn(h,[{key:"_handle",value:function(e){this._featureManager.updateRunByConfig(e),this._dataQ.updateWithConfig(e),this._pauseResumeMgr.onConfigUpdate(e),this._handleMetadata.onConfigUpdate(e),this._logger.updateLogConfig(e),this._contextMgr.onConfigUpdate(e),this._sessionManager.onConfigUpdate(e),this._sensorDataQ.onConfigUpdate(e),this._slaveListener.onConfigUpdate(e)}}]),h}(),Vt.ConfigUpdatedEventHandler=Yt,Kt=vn,Gt=function(){function s(e,t,n,i){Sn(this,s),this._messageBus=e,this._featureManager=t,this._customerApiBridge=n,this._contextMgr=i,this._messageBus.subscribe(Kt.MessageBusEventType.NewSessionStartedEvent,this._handle.bind(this))}return mn(s,[{key:"_handle",value:function(e){this._featureManager.runPerSessionFeatures(),this._customerApiBridge.notifySessionReset(e),this._contextMgr.onSessionReset()}}]),s}(),Kt.NewSessionStartedEventHandler=Gt,Xt=vn,Zt=function(){function i(e,t,n){Sn(this,i),this._messageBus=e,this._pauseResumeManager=t,this._slaveListener=n,this._messageBus.subscribe(Xt.MessageBusEventType.ApiChangeStateEvent,this._handle.bind(this))}return mn(i,[{key:"_handle",value:function(e){this._pauseResumeManager.onStateChange(e),this._slaveListener.notifyStateChange(e)}}]),i}(),Xt.ApiChangeStateEventHandler=Zt,Jt=vn,$t=function(){function n(e,t){Sn(this,n),this._messageBus=e,this._contextMgr=t,this._messageBus.subscribe(Jt.MessageBusEventType.ApiContextChangeEvent,this._handle.bind(this))}return mn(n,[{key:"_handle",value:function(e){this._contextMgr.changeContext(e.context||e.activityType)}}]),n}(),Jt.ApiContextChangeEventHandler=$t,en=vn,tn=function(){function n(e,t){Sn(this,n),this._messageBus=e,this._handleMetadata=t,this._messageBus.subscribe(en.MessageBusEventType.ApiCustomerMetadataEvent,this._handle.bind(this))}return mn(n,[{key:"_handle",value:function(e){this._handleMetadata.onCustomerMetadata(e)}}]),n}(),en.ApiCustomerMetadataEventHandler=tn,nn=vn,sn=function(){function n(e,t){Sn(this,n),this._messageBus=e,this._sessionManager=t,this._messageBus.subscribe(nn.MessageBusEventType.ApiResetSessionEvent,this._handle.bind(this))}return mn(n,
[{key:"_handle",value:function(e){this._sessionManager.onResetSession(e)}}]),n}(),nn.ApiResetSessionEventHandler=sn,rn=vn,an=function(){function n(e,t){Sn(this,n),this._messageBus=e,this._csidService=t,this._messageBus.subscribe(rn.MessageBusEventType.ApiSetCsidEvent,this._handle.bind(this))}return mn(n,[{key:"_handle",value:function(e){e.csid?this._csidService.set(e.csid):log.warn("Received an invalid csid of "+e.csid+". Ignoring api call")}}]),n}(),rn.ApiSetCsidEventHandler=an,on=vn,un=function(){function n(e,t){Sn(this,n),this._messageBus=e,this._psidService=t,this._messageBus.subscribe(on.MessageBusEventType.ApiSetPsidEvent,this._handle.bind(this))}return mn(n,[{key:"_handle",value:function(e){e.psid?this._psidService.set(e.psid):log.warn("Received an invalid psid of "+e.psid+". Ignoring api call")}}]),n}(),on.ApiSetPsidEventHandler=un,cn=vn,hn=null,dn=function dn(e){return null===hn&&(hn=new ln(e)),hn},ln=function(){function t(e){Sn(this,t),this._utils=e,this.handle=this._handle.bind(this),this.subscribers=[],this.subscribe=this.subscribe.bind(this),this._selector=null,this._elementBindingWMap=new WeakMap}return mn(t,[{key:"start",value:function(e,n){var i=this,t=(n=n||window.self).document||n.contentDocument;this._selector=e,Array.from(t.querySelectorAll(e)).forEach(function(e){if(i.hasjQueryAutoTab(e,n)){if(i._elementBindingWMap.get(e))return;var t=function t(e){i.handle(e,n)};i._utils.addEventListener(e,"keypress",t),i._elementBindingWMap.set(e,{isBinded:!0,listener:t})}})}},{key:"_stop",value:function(e){var n=this,t=(e=e||window.self).document||e.contentDocument;Array.from(t.querySelectorAll(this._selector)).forEach(function(e){var t=n._elementBindingWMap.get(e);t&&t.isBinded&&(n._utils.removeEventListener(e,"keypress",t.listener),n._elementBindingWMap["delete"](e))})}},{key:"stop",value:function(e){return this._stop(e),!0}},{key:"subscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)if(this.subscribers[t].handler===e)return;this.subscribers.push({handler:e})}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)this.subscribers[t].handler===e&&delete this.subscribers[t]}},{key:"hasjQueryAutoTab",value:function(e,t){if(!t.jQuery||!t.jQuery._data)return!1;if("undefined"==typeof t.jQuery._data(e,"events"))return!1;for(var n=Object.keys(t.jQuery._data(e,"events")),i=0;i<n.length;i++)if(-1!==n[i].indexOf("autotab"))return!0;return!1}},{key:"_handle",value:function(e,t){var n=this.hasjQueryAutoTab(e.target,t)?"autotab":"";if("autotab"===n){var i="insertText",s=e.key;if(8!=e.keyCode||(i="deleteContentBackward",s=null,"autotab"!==n))for(var r=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:s,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:i,isComposing:!1,isTrusted:!0,jQueryMask:n,returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timestamp:e.timestamp,type:"input",view:null,which:0}),a=0;a<this.subscribers.length;a++)this.subscribers[a].handler(r)}}}]),t}(),cn.CustomInputFieldsEventHandler=dn,fn=vn,gn=null,_n=function _n(e){return null===gn&&(gn=new pn(e)),gn},pn=function(){function t(e){Sn(this,t),this._utils=e,this.handle=this._handle.bind(this),this.subscribers=[],this.subscribe=this.subscribe.bind(this),this._selector=null,this._elementBindingWMap=new WeakMap}return mn(t,[{key:"start",value:function(e,n){var i=this,t=(n=n||window.self).document||n.contentDocument;this._selector=e,Array.from(t.querySelectorAll(e)).forEach(function(e){if(i.hasUnmaskEvent(e,n)){if(i._elementBindingWMap.get(e))return;var t=function t(e){i.handle(e,n)};i._utils.addEventListener(e,"keypress",t),i._elementBindingWMap.set(e,{isBinded:!0,listener:t})}})}},{key:"_stop",value:function(e){var n=this,t=(e=e||window.self).document||e.contentDocument;Array.from(t.querySelectorAll(this._selector)).forEach(function(e){var t=n._elementBindingWMap.get(e);t&&t.isBinded&&(n._utils.removeEventListener(e,"keypress",t.listener),n._elementBindingWMap["delete"](e))})}},{key:"stop",value:function(e){return this._stop(e),!0}},{key:"subscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)if(this.subscribers[t].handler===e)return;this.subscribers.push({handler:e})}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)this.subscribers[t].handler===e&&delete this.subscribers[t]}},{key:"hasUnmaskEvent",value:function(e,t){if(!t.jQuery||!t.jQuery._data)return!1;var n=t.jQuery._data(e,"events");if("undefined"==typeof n)return!1;for(var i=Object.keys(n),s=0;s<i.length;s++)if("unmask"===i[s])return!0;return!1}},{key:"_handle",value:function(e,t){var n=this.hasUnmaskEvent(e.target,t)?"maskedInput":"";if("maskedInput"===n)for(var i=e.key,s=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:i,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:"insertText",isComposing:!1,isTrusted:!0,jQueryMask:n,returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timestamp:e.timestamp,type:"input",view:null,which:0}),r=0;r<this.subscribers.length;r++)this.subscribers[r].handler(s)}}]),t}(),fn.CustomMaskedInputFieldsEventHandler=_n,vn.CDWPTCD=function(n){var r={};function __webpack_require__(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,__webpack_require__),t.l=!0,t.exports}return __webpack_require__.m=n,__webpack_require__.c=r,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)__webpack_require__.d(n,r,function(e){return t[e]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e["default"]}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=29)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serviceContainer=undefined,t.inject=function inject(e){var t="service:"+e;return i.lookup(t)};var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(4));var i=null;t.serviceContainer=function x(e){i||(i=e)};var s=function s(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var t="service:"+e;return i.lookup(t)||(i.register(t,this),(0,r["default"])(this)),i.lookup(t)};t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();var o=!1;!function(){try{var e=Object.defineProperty({},"passive",{get:function get(){o=!0}});window.addEventListener("test",null,e)}catch(t){}}();var i=function(){function EventAggregator(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,EventAggregator)}return r(EventAggregator,null,[{key:"addEventListener",value:function addEventListener(e,t,n){var r=3<arguments.length&&arguments[3]!==undefined&&arguments[3],i=!(4<arguments.length&&arguments[4]!==undefined)||arguments[4],s=5<arguments.length&&arguments[5]!==undefined&&arguments[5];o?e.addEventListener(t,n,{capture:r,passive:i,once:s}):e.addEventListener?e.addEventListener(t,n,r):e.attachEvent("on"+t,n)}},{key:"removeEventListener",value:function removeEventListener(e,t,n){var r=3<arguments.length&&arguments[3]!==undefined&&arguments[3];e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent("on"+t,n)}}]),EventAggregator}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=n(4);var o=function(){function Event(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Event),this._perfMonitor=e,this.session=(0,i.inject)("Session")}return r(Event,[{key:"getEventTimestamp",value:function getEventTimestamp(e){return this.getExports().CDUtils.dateNow()}},{key:"getTimestampFromEvent",value:function getTimestampFromEvent(e){return e.timeStamp?this.getExports().CDUtils.cutDecimalPointDigits(e.timeStamp,3):0}},{key:"handlerProlog",value:function handlerProlog(e){log.isDebug()&&this._perfMonitor.startMonitor(e)}},{key:"handlerEpilog",value:function handlerEpilog(e){log.isDebug()&&this._perfMonitor.stopMonitor(e)}},{key:"handlerCancelog",value:function handlerCancelog(e){log.isDebug()&&this._perfMonitor.cancelMonitor(e)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){}}]),Event}();t["default"]=(0,s.WithExportsMixin)(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(2));var s=function(e){function DataCollector(e){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DataCollector),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(DataCollector.__proto__||Object.getPrototypeOf(DataCollector)).call(this,e))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(DataCollector,i["default"]),r(DataCollector,[{key:"startFeature",value:function startFeature(){}},{key:"stopFeature",value:function stopFeature(){}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){}},{key:"sendToQueue",value:function sendToQueue(){}}]),DataCollector}();t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();var i={};t.injectExports=function db(e){i=e},t.WithExportsMixin=function eb(t){return function(e){function _class2(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_class2),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(_class2.__proto__||Object.getPrototypeOf(_class2)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(_class2,t),r(_class2,[{key:"getExports",value:function getExports(){return i}}]),_class2}()};t["default"]=function(e){e.exports=i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=_interopRequireDefault(n(17)),i=_interopRequireDefault(n(12)),s=_interopRequireDefault(n(7)),o=_interopRequireDefault(n(10)),a=_interopRequireDefault(n(2)),u=_interopRequireDefault(n(6)),l=_interopRequireDefault(n(3)),c=_interopRequireDefault(n(11)),f=_interopRequireDefault(n(8)),p=_interopRequireDefault(n(9)),d=_interopRequireDefault(n(13));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var v={};v.Index=r["default"],v.OrientationEvents=i["default"],v.InputEvents=s["default"],v.FormEvents=o["default"],v.Event=a["default"],v.ElementEvents=u["default"],v.DataCollector=l["default"],v.ClipboardEvents=c["default"],v.ClickEvents=f["default"],v.ChangeEvents=p["default"],v.BeforeInstallPromptEvents=d["default"];var h={defaultFeatures:[{name:"ClipboardEvents",className:v.ClipboardEvents,init:function init(){return function(){this._features.defaultFeatures.ClipboardEvents.instance=new v.ClipboardEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor)}}},{name:"ElementEvents",className:v.ElementEvents,init:function init(t){return function(){var e=new t.SiteMapper(MutationObserver,this._utils,this._perfMonitor,"jQueryElementListenerConfig",null,!1);this._features.defaultFeatures.ElementEvents.instance=new v.ElementEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor,e)}}}],perContextFeatures:[{name:"ElementEvents",className:v.ElementEvents,init:function init(){this._features.perContextFeatures.ElementEvents.instance=this._features.defaultFeatures.ElementEvents.instance}}],nonDefaultFeatures:[{name:"OrientationEvents",className:v.OrientationEvents,init:function init(){return function(){this._features.nonDefaultFeatures.OrientationEvents.instance=new v.OrientationEvents(this._configMgr,this._utils,this._sensorDataQ,this._perfMonitor)}}},{name:"BeforeInstallPromptEvents",className:v.BeforeInstallPromptEvents,init:function init(){return function(){this._features.nonDefaultFeatures.BeforeInstallPromptEvents.instance=new v.BeforeInstallPromptEvents(this._dataQ,this._utils)}}}]};t["default"]=function(i){h.defaultFeatures.forEach(function(e){var t="defaultFeatures",n=e.className.getDefaultSettings()[t],r=e.name;n.init=e.init(i),i.FeaturesList[t][r]=n}),h.perContextFeatures.forEach(function(e){var t="perContextFeatures",n=e.className.getDefaultSettings()[t],r=e.name;n.init=e.init,i.FeaturesList[t][r]=n}),h.nonDefaultFeatures.forEach(function(e){var t="nonDefaultFeatures",n=e.className.getDefaultSettings()[t],r=e.name;n.init=e.init(i),i.FeaturesList[t][r]=n})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),a=n(0),i=_interopRequireDefault(n(3)),u=n(7),l=_interopRequireDefault(u),c=n(8),f=_interopRequireDefault(c),p=n(9),d=_interopRequireDefault(p),v=n(10),h=_interopRequireDefault(v),_=_interopRequireDefault(n(18));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var s={defaultFeatures:{configKey:"isElementsEvent",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,instance:null},perContextFeatures:{configKey:"isElementsEvent",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!0,instance:null}},o=function(e){function ElementEvents(e,t,n,r,i,s){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ElementEvents);var o=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ElementEvents.__proto__||Object.getPrototypeOf(ElementEvents)).call(this,i));return o.mutationMessageHandler=function(e){e.frame&&(o._inputEvents.addOnLoadInputData(e.frame,!0),o._inputEvents.bind(e.frame),o._clickEvents.bind(e.frame),o._changeEvents.bind(e.frame),o._formEvents.bind(e.frame))},o.startFeature=function(e){e||(e=window.self),o._inputEvents.addOnLoadInputData(e,!1),o._inputEvents.bind(e),o._clickEvents.bind(e),o._changeEvents.bind(e),o._formEvents.bind(e),o._configManager.get("isMutationObserver")&&o._mutationEmitter&&(o._mutationEmitter.startObserver(e),o._jQueryElementListenerSiteMapper.initTracking())},o._onSiteMapperMatch=function(e){var t=e.selector;if(t)try{var n=window.document.querySelector(t);if(!n)return void log.error("ElementEvents._onSiteMapperMatch - selector:"+JSON.stringify(t)+" not found on page");if(o._utils.DomUtils.matches(n,u.inputSelectors))o._jqueryEventHandler.bindInputEvents(n);else if(o._utils.DomUtils.matches(n,c.onClickSelectors))o._jqueryEventHandler.bindOnClickEvents(n);else if(o._utils.DomUtils.matches(n,p.onChangeSelectors))o._jqueryEventHandler.bindOnChangeEvents(n);else{if(!o._utils.DomUtils.matches(n,v.onFormSelectors))return void log.error("ElementEvents._onSiteMapperMatch - Unable to match the element with selector:"+JSON.stringify(t)+" to any selectors group. Aborting jQuery element listening process.");o._jqueryEventHandler.bindOnFormsEvents(n)}}catch(r){log.error("ElementEvents._onSiteMapperMatch - "+r.message,r)}else log.warn("ElementEvents._onSiteMapperMatch - No selector defined for match. Aborting jQuery element listening process.")},o._configManager=e,o._utils=t,o._dataQ=r,o._perfMonitor=i,o._elements=n,o._jQueryElementListenerSiteMapper=s,o._jQueryElementListenerSiteMapper.updateObserver(o._onSiteMapperMatch),o._messageBus=(0,a.inject)("MessageBus"),o._mutationEmitter=(0,a.inject)("MutationEmitter"),o._messageBus.subscribe(o._messageBus.getChannels().MUTATIONSINGLE,o.mutationMessageHandler),o._inputEvents=new l["default"](o._perfMonitor,o._elements,o.sendToQueue.bind(o)),o._clickEvents=new f["default"](o._perfMonitor,o.sendToQueue.bind(o)),o._changeEvents=new d["default"](o._perfMonitor,o.sendToQueue.bind(o)),o._formEvents=new h["default"](o._perfMonitor,o.sendToQueue.bind(o)),o._jqueryEventHandler=(0,_["default"])(),o._maxElemValLength=200,o._isHashedValue=o._configManager.get("isElementHashedValue")||!1,o._hashTruncationLength=o._configManager.get("elementHashTruncationLength")||2,o}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ElementEvents,i["default"]),r(ElementEvents,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return s}}]),r(ElementEvents,[{key:"stopFeature",value:function stopFeature(e){e||(e=window.self),this._inputEvents.unbind(e),this._clickEvents.unbind(e),this._changeEvents.unbind(e),this._formEvents.unbind(e),this._jQueryElementListenerSiteMapper.stopTracking(),this._mutationEmitter.stopObserver(e)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(e){e||(e=window.self),this._configManager.get("isMutationObserver")&&this._mutationEmitter&&(this._mutationEmitter.startObserver(e),this._jQueryElementListenerSiteMapper.onConfigUpdate(this._configManager)),this._isHashedValue=this._configManager.get("isElementHashedValue")!==undefined?this._configManager.get("isElementHashedValue"):this._isHashedValue,this._hashTruncationLength=this._configManager.get("elementHashTruncationLength")!==undefined?this._configManager.get("elementHashTruncationLength"):this._hashTruncationLength,this._elements.updateFeatureConfig()}},{key:"sendToQueue",value:function sendToQueue(e,t){var n=this.getExports().EnumDefs.Events.isTrusted[e.isTrusted],r=this.getEventTimestamp(e),i=this.getTimestampFromEvent(e),s=this.getExports().EnumDefs.Events.elementEventType[e.type];this._utils.isUndefinedNull(s)&&(s=-1);var o=this._elements.getElement(e.target),a=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();(t=t||{}).elementValues&&t.elementValues.length>this._maxElemValLength&&(t.elementValues="");var u=(this._isHashedValue?e.target.value||e.target.innerHTML:"")?this._utils.getTruncatedHash(e.target.value,this._hashTruncationLength):"";Object.extend(t,{eventType:s,eventSequence:a,timestamp:r,elementHash:o,isTrusted:n,hashedValue:u,relativeTime:i}),this._dataQ.addToQueue("element_events",this._utils.convertToArrayByMap(this.getExports().DataMappingDefs.ELEMENT_EVENT_MAP,t),!0)}}]),ElementEvents}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inputSelectors=undefined;var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(2)),s=n(0);var o=t.inputSelectors="input:not([type='color']):not([type='hidden']):not([type='file']):not([type='image']):not([type='button']):not([type='radio']):not([type='checkbox']), textarea",a=function a(s){return{applyAction:function _applyAction(e,t){if(!["start","stop"].includes(t))return!1;for(var n=[],r=((e=e||window.self).document||e.contentDocument).querySelectorAll(o),i=0;i<r.length;i++)n.push(r[i]);0<n.length&&s[t](n,e)}}},u=function(e){function InputEvents(e,t,n){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,InputEvents);var r=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(InputEvents.__proto__||Object.getPrototypeOf(InputEvents)).call(this,e));return r.handleInputEvents=function(e){"InputEvent"===e.constructor.name&&r._inputEventsPerElement.set(e.target,{}),r.handlerProlog("t.EE_InputChange");var t=e.target.value||"";""!==t&&(t=r.getExports().CDUtils.maskText(t)),r._sendToQueue(e,{length:t?t.length:0,elementValues:t,selected:-1}),r.handlerEpilog("t.EE_InputChange")},r.handleFocusBlurEvents=function(e){r.handlerProlog("t.EE_FocusBlurChange"),r._sendToQueue(e,{length:0,selected:-1,elementValues:""}),r.handlerEpilog("t.EE_FocusBlurChange")},r.handleSyntheticInputEvents=function(e){if(!r._inputEventsPerElement.has(e.target)||"undefined"!=typeof e.jQueryMask&&"autotab"===e.jQueryMask){r.handlerProlog("t.EE_InputChangeSynthetic");var t=e.target.value||"";""!==t&&(t=r.getExports().CDUtils.maskText(t)),r._sendToQueue(e,{length:t?t.length:0,elementValues:t,selected:-1}),r.handlerEpilog("t.EE_InputChangeSynthetic")}},r._elements=t,r._sendToQueue=n,r._messageBus=(0,s.inject)("MessageBus"),r._StandardInputEventsEmitter=(0,s.inject)("StandardInputEventsEmitter"),r._SyntheticMaskInputEventsHandler=(0,s.inject)("SyntheticMaskInputEventsHandler"),r._SyntheticAutotabInputEventsHandler=(0,s.inject)("SyntheticAutotabInputEventsHandler"),r._inputEventsPerElement=new WeakMap,r}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(InputEvents,i["default"]),r(InputEvents,[{key:"bind",value:function bind(e){e=e||window.self,this._messageBus.subscribe(this._messageBus.getChannels().STANDARDINPUTEVENTINPUT,this.handleInputEvents),this._messageBus.subscribe(this._messageBus.getChannels().STANDARDINPUTEVENTFOCUS,this.handleFocusBlurEvents),this._messageBus.subscribe(this._messageBus.getChannels().STANDARDINPUTEVENTBLUR,this.handleFocusBlurEvents),this._messageBus.subscribe(this._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,this.handleSyntheticInputEvents),a(this._StandardInputEventsEmitter).applyAction(e,"start"),a(this._SyntheticMaskInputEventsHandler).applyAction(e,"start"),a(this._SyntheticAutotabInputEventsHandler).applyAction(e,"start")}},{key:"unbind",value:function unbind(e){e=e||window.self,a(this._StandardInputEventsEmitter).applyAction(e,"stop"),a(this._SyntheticMaskInputEventsHandler).applyAction(e,"stop"),a(this._SyntheticAutotabInputEventsHandler).applyAction(e,"stop"),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDINPUTEVENTINPUT,this.handleInputEvents),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDINPUTEVENTFOCUS,this.handleFocusBlurEvents),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDINPUTEVENTBLUR,this.handleFocusBlurEvents),this._messageBus.unsubscribe(this._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,this.handleSyntheticInputEvents)}},{key:"addOnLoadInputData",value:function addOnLoadInputData(e,t){this.handlerProlog("t.EE_OnLoad");for(var n=(e=e||window.self).document.querySelectorAll(o),r=0;r<n.length;r++){var i=n[r];this._elements.isListed(i)?t||this._elements.resendElementPerContext(i):this._elements.getElement(i,!1)}this.handlerEpilog("t.EE_OnLoad")}}]),InputEvents}();t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onClickSelectors=undefined;var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(2)),s=n(0);var o=t.onClickSelectors="input[type='button'], input[type='radio'], input[type='checkbox'], button",a=function(e){function ClickEvents(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ClickEvents);var r=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ClickEvents.__proto__||Object.getPrototypeOf(ClickEvents)).call(this,e));return r.handleOnClickEvents=function(e){r.handlerProlog("t.EE_Click");var t=e.target,n=t.value||t.innerHTML;n=r.getExports().CDUtils.clearTextFromNumbers(n),r._sendToQueue(e,{length:n.length,elementValues:n,selected:t.checked===undefined?-1:t.checked?1:0}),r.handlerEpilog("t.EE_Click")},r._perfMonitor=e,r._sendToQueue=t,r._messageBus=(0,s.inject)("MessageBus"),r._StandardOnClickEventsEmitter=(0,s.inject)("StandardOnClickEventsEmitter"),r}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ClickEvents,i["default"]),r(ClickEvents,[{key:"bind",value:function bind(e){var t=(e=e||window.self).document||e.contentDocument;this._messageBus.subscribe(this._messageBus.getChannels().STANDARDONCLICKEVENT,this.handleOnClickEvents),this.addListenersBySelector(t)}},{key:"unbind",value:function unbind(e){for(var t=[],n=((e=e||window.self).document||e.contentDocument).querySelectorAll(o),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnClickEventsEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDONCLICKEVENT,this.handleOnClickEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],n=e.querySelectorAll(o),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnClickEventsEmitter.start(t)}}]),ClickEvents}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onChangeSelectors=undefined;var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(2)),s=n(0);var o=t.onChangeSelectors="select",a=function(e){function ChangeEvents(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ChangeEvents);var i=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ChangeEvents.__proto__||Object.getPrototypeOf(ChangeEvents)).call(this,e));return i.handleOnChangeEvents=function(e){i.handlerProlog("t.EE_Change");var t=i.getExports().CDUtils.getDropDownListValues(e.target).join(";");t=i.getExports().CDUtils.clearTextFromNumbers(t);var n=e.target.selectedIndex,r=e.target.value.length;i._sendToQueue(e,{length:r,selected:n,elementValues:t}),i.handlerEpilog("t.EE_Change")},i._perfMonitor=e,i._sendToQueue=t,i._messageBus=(0,s.inject)("MessageBus"),i._StandardOnChangeEventsEmitter=(0,s.inject)("StandardOnChangeEventsEmitter"),i}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ChangeEvents,i["default"]),r(ChangeEvents,[{key:"bind",value:function bind(e){var t=(e=e||window.self).document||e.contentDocument;this._messageBus.subscribe(this._messageBus.getChannels().STANDARDONCHANGEEVENT,this.handleOnChangeEvents),this.addListenersBySelector(t)}},{key:"unbind",value:function unbind(e){for(var t=[],n=((e=e||window.self).document||e.contentDocument).querySelectorAll(o),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnChangeEventsEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDONCHANGEEVENT,this.handleOnChangeEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],n=e.querySelectorAll(o),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnChangeEventsEmitter.start(t)}}]),ChangeEvents}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onFormSelectors=undefined;var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(2)),s=n(0);var o=t.onFormSelectors="form",a=function(e){function FormEvents(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FormEvents);var n=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(FormEvents.__proto__||Object.getPrototypeOf(FormEvents)).call(this,e));return n.handleOnFormEvents=function(e){log.trace("ElementEvents:_onFormSubmitEvent"),n._sendToQueue(e,{length:0,selected:-1,elementValues:""})},n._perfMonitor=e,n._sendToQueue=t,n._messageBus=(0,s.inject)("MessageBus"),n._StandardOnFormEventsEmitter=(0,s.inject)("StandardOnFormEventsEmitter"),n}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(FormEvents,i["default"]),r(FormEvents,[{key:"bind",value:function bind(e){var t=(e=e||window.self).document||e.contentDocument;this._messageBus.subscribe(this._messageBus.getChannels().STANDARDONFORMSUBMITEVENT,this.handleOnFormEvents),this.addListenersBySelector(t)}},{key:"unbind",value:function unbind(e){for(var t=[],n=((e=e||window.self).document||e.contentDocument).querySelectorAll(o),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnFormEventsEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDONFORMSUBMITEVENT,this.handleOnFormEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],n=e.querySelectorAll(o),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnFormEventsEmitter.start(t)}}]),FormEvents}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),s=n(0),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(3));var o={defaultFeatures:{configKey:"isClipboardEvent",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,instance:null}},a=function(e){function ClipboardEvents(e,t,n,r,i){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ClipboardEvents);var u=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ClipboardEvents.__proto__||Object.getPrototypeOf(ClipboardEvents)).call(this,i));return u.startFeature=function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;u._cutEventEmitter.start(t),u._messageBus.subscribe(u._messageBus.getChannels().CUTEVENT,u._handleClipboardEvent),u._copyEventEmitter.start(t),u._messageBus.subscribe(u._messageBus.getChannels().COPYEVENT,u._handleClipboardEvent),u._pasteEventEmitter.start(t),u._messageBus.subscribe(u._messageBus.getChannels().PASTEEVENT,u._handleClipboardEvent)}catch(n){log.error("Failed starting the ClipboardEvents feature. msg: "+n.message,n)}},u._handleClipboardEvent=function(e){u._sendToQueue(e)},u._sendToQueue=function(e,t){u.handlerProlog("t.CE");try{var n=u.getEventTimestamp(e),r=u._elements.getElement(e.target),i=u._utils.StorageUtils.getAndUpdateEventSequenceNumber(),s=e.clipboardData?e.clipboardData.getData("text"):window.clipboardData?window.clipboardData.getData("text"):"";""!==(s=s||"")&&(s=s.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d]/g,"*"));var o=u.getExports().EnumDefs.Events.clipboardEventType[e.type];u._utils.isUndefinedNull(o)&&(o=-1),u._dataQueue.addToQueue("clipboard_events",u.getExports().CDUtils.convertToArrayByMap(u.getExports().DataMappingDefs.CLIPBOARD_EVENT_MAP,{eventSequence:i,timestamp:n,elementHash:r,copiedText:s,clipboardEventType:o}))}catch(a){log.error("Failed handling ClipboardEvent. msg: "+a.message,a)}u.handlerEpilog("t.CE")},u._configManager=e,u._utils=t,u._dataQueue=r,u._perfMonitor=i,u._elements=n,u._messageBus=(0,s.inject)("MessageBus"),u._cutEventEmitter=(0,s.inject)("CutEventEmitter"),u._copyEventEmitter=(0,s.inject)("CopyEventEmitter"),u._pasteEventEmitter=(0,s.inject)("PasteEventEmitter"),u}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ClipboardEvents,i["default"]),r(ClipboardEvents,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return o}}]),r(ClipboardEvents,[{key:"stopFeature",value:function stopFeature(e){try{e||(e=window.self);var t=e.document||e.contentDocument;this._cutEventEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().CUTEVENT,this._handleClipboardEvent),this._copyEventEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().COPYEVENT,this._handleClipboardEvent),this._pasteEventEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().PASTEEVENT,this._handleClipboardEvent)}catch(n){log.error("Failed stopping the ClipboardEvents feature. msg: "+n.message,n)}}}]),ClipboardEvents}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(3));var o={nonDefaultFeatures:{configKey:"isOrientationEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,instance:null}},a=function(e){function OrientationEvents(e,t,n,r){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,OrientationEvents);var a=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(OrientationEvents.__proto__||Object.getPrototypeOf(OrientationEvents)).call(this,r));return a._handleDeviceOrientationEvent=function(e){var t=a._utils.dateNow();if(e&&t-a._lastTime>a._samplePeriod){var n=e.absolute||!1,r=a._utils.isUndefinedNull(e.alpha)?0:a._utils.cutDecimalPointDigits(e.alpha,4),i=a._utils.isUndefinedNull(e.beta)?0:a._utils.cutDecimalPointDigits(e.beta,4),s=a._utils.isUndefinedNull(e.gamma)?0:a._utils.cutDecimalPointDigits(e.gamma,4);if(r!==a._lastAlpha||i!==a._lastBeta||s!==a._lastGamma){log.isDebug()&&log.debug("OrientationEvents:_onOrientationEvent, sending data: timestamp:"+t+" alpha,betta,gamma:"+r+","+i+","+s+", prevTime:"+a._lastTime),a._lastTime=t,a._lastAlpha=r,a._lastBeta=i,a._lastGamma=s;var o=a._utils.StorageUtils.getAndUpdateEventSequenceNumber();a._dataQ.addToQueue("orientation_events",[null,o,t,n,r,i,s])}}},a._dataQ=n,a._configMgr=e,a._utils=t,a._samplePeriod=a._configMgr.get("orientationEventsSamplePeriod")||0,a._lastAlpha=0,a._lastBeta=0,a._lastGamma=0,a._lastTime=0,a._messageBus=(0,i.inject)("MessageBus"),a._deviceOrientationEventEmitter=(0,i.inject)("DeviceOrientationEventEmitter"),a}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(OrientationEvents,s["default"]),r(OrientationEvents,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return o}}]),r(OrientationEvents,[{key:"startFeature",value:function startFeature(){window.DeviceOrientationEvent&&(this._deviceOrientationEventEmitter.start(),this._messageBus.subscribe(this._messageBus.getChannels().DEVICEORIENATIONEVENT,this._handleDeviceOrientationEvent))}},{key:"stopFeature",value:function stopFeature(){window.DeviceOrientationEvent&&(this._deviceOrientationEventEmitter.stop(),this._messageBus.unsubscribe(this._messageBus.getChannels().DEVICEORIENATIONEVENT,this._handleDeviceOrientationEvent))}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){var e=this._configMgr.get("orientationEventsSamplePeriod");this._samplePeriod=e!==undefined?e:this._samplePeriod}}]),OrientationEvents}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(3)),o=n(0);var s={nonDefaultFeatures:{configKey:"isBeforeInstallPrompt",shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,instance:null}},a=function(e){function BeforeInstallPromptEvents(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,BeforeInstallPromptEvents);var s=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(BeforeInstallPromptEvents.__proto__||Object.getPrototypeOf(BeforeInstallPromptEvents)).call(this));return s._onBeforeInstallPrompt=function(e){var t=s._utils.StorageUtils.getAndUpdateEventSequenceNumber(),n=s.getEventTimestamp(),r=s.getTimestampFromEvent(e),i=e.platforms?e.platforms.join(","):"";s._dataQueue.addToQueue("before_install_prompt",s.getExports().CDUtils.convertToArrayByMap(s.getExports().DataMappingDefs.BEFORE_INSTALL_PROMPT_EVENT_MAP,{eventSequence:t,timestamp:n,platforms:i,relativeTime:r}))},s._messageBus=(0,o.inject)("MessageBus"),s._eventEmitter=(0,o.inject)("BeforeInstallPromptEventEmitter"),s._dataQueue=e,s._utils=t,s}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(BeforeInstallPromptEvents,i["default"]),r(BeforeInstallPromptEvents,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return s}}]),r(BeforeInstallPromptEvents,[{key:"startFeature",value:function startFeature(){this._eventEmitter.start(),this._messageBus.subscribe(this._messageBus.getChannels().BEFOREINSTALLPROMPTEVENT,this._onBeforeInstallPrompt)}},{key:"stopFeature",value:function stopFeature(){this._eventEmitter.stop(),this._messageBus.unsubscribe(this._messageBus.getChannels().BEFOREINSTALLPROMPTEVENT,this._onBeforeInstallPrompt)}}]),BeforeInstallPromptEvents}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(15));var s=null,o=function(){function Container(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Container),s=Object.create(e)}return r(Container,[{key:"register",value:function register(e,t){var n=this.normalize(e);if(s.hasOwnProperty(n))throw new i["default"](n+" has already been registered");s[n]=t}},{key:"keys",value:function keys(){return Object.keys(s)}},{key:"lookup",value:function lookup(e){var t=this.normalize(e);return s.hasOwnProperty(t)?s[t]:null}},{key:"normalize",value:function normalize(e){return e.toLowerCase()}},{key:"toString",value:function toString(){return this.keys().join(",")}}]),Container}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function AppError(){var e;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AppError);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=AppError.__proto__||Object.getPrototypeOf(AppError)).call.apply(e,[this].concat(n)))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(AppError,Error),AppError}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);Object.defineProperty(t,"FeaturesListInitializer",{enumerable:!0,get:function get(){return function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(r)["default"]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);Object.defineProperty(t,"ElementEvents",{enumerable:!0,get:function get(){return _interopRequireDefault(r)["default"]}});var i=n(11);Object.defineProperty(t,"ClipboardEvents",{enumerable:!0,get:function get(){return _interopRequireDefault(i)["default"]}});var s=n(12);Object.defineProperty(t,"OrientationEvents",{enumerable:!0,get:function get(){return _interopRequireDefault(s)["default"]}});var o=n(13);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"BeforeInstallPromptEvents",{enumerable:!0,get:function get(){return _interopRequireDefault(o)["default"]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function JqueryElementsHandler(){return i=(0,r.inject)("StandardInputEventsEmitter"),s=(0,r.inject)("StandardOnClickEventsEmitter"),o=(0,r.inject)("StandardOnChangeEventsEmitter"),a=(0,r.inject)("StandardOnFormEventsEmitter"),{bindInputEvents:_bindInputEvents,bindOnClickEvents:_bindOnClickEvents,bindOnChangeEvents:_bindOnChangeEvents,bindOnFormsEvents:_bindOnFormsEvents}};var r=n(0),i=null,s=null,o=null,a=null;function _bindInputEvents(e){i.removeElementEvents(e),i.addElementEvents(e,!0)}function _bindOnClickEvents(e){s.removeElementEvents(e),s.addElementEvents(e,!0)}function _bindOnChangeEvents(e){o.removeElementEvents(e),o.addElementEvents(e,!0)}function _bindOnFormsEvents(e){a.removeElementEvents(e),a.addElementEvents(e,!0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),s=n(0),i=_interopRequireDefault(s),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function a(e){return!(!e.jQuery||!e.jQuery._data)},u=function(e){function SyntheticMaskInputEventsHandler(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SyntheticMaskInputEventsHandler);var i=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(SyntheticMaskInputEventsHandler.__proto__||Object.getPrototypeOf(SyntheticMaskInputEventsHandler)).call(this,"SyntheticMaskInputEventsHandler"));return i.handleKeypressEvents=function(e,t){if(a(t)&&i.hasMaskEventSupported(e.target,t)){var n=e.key,r=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:n,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:"insertText",isComposing:!1,isTrusted:!0,jQueryMask:"maskedInput",returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timestamp:e.timestamp,type:"input",view:null,which:0});i._messageBus.publish(i._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,r)}},i._messageBus=(0,s.inject)("MessageBus"),i._elementBindingWMap=new WeakMap,i._utils=i.exports.CDUtils,i.defaultEventListener=[{event:"keypress",handler:i.handleKeypressEvents}],i}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(SyntheticMaskInputEventsHandler,i["default"]),r(SyntheticMaskInputEventsHandler,[{key:"start",value:function start(e,i){var t=this;i=i||window.self,e.forEach(function(e){if(a(i)&&t.hasMaskEventSupported(e,i)&&!t._elementBindingWMap.has(e)){var r={};t.defaultEventListener.forEach(function(t){var n=function n(e){t.handler(e,i)};r[t.event]=n,o["default"].addEventListener(e,t.event,n)}),t._elementBindingWMap.set(e,{isBinded:!0,listeners:r})}})}},{key:"stop",value:function stop(e,t){var r=this;e.forEach(function(t){var n=r._elementBindingWMap.get(t);n&&n.isBinded&&(r.defaultEventListener.forEach(function(e){o["default"].removeEventListener(t,e.event,n.listeners[e.event])}),r._elementBindingWMap["delete"](t))})}},{key:"hasMaskEventSupported",value:function hasMaskEventSupported(e,t){var n=t.jQuery._data(e,"events");if(void 0===n)return!1;for(var r=Object.keys(n),i=0;i<r.length;i++)if("unmask"===r[i])return!0;return!1}}]),SyntheticMaskInputEventsHandler}();t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function a(e){return!(!e.jQuery||!e.jQuery._data)},u=function(e){function SyntheticAutotabInputEventsHandler(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SyntheticAutotabInputEventsHandler);var s=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(SyntheticAutotabInputEventsHandler.__proto__||Object.getPrototypeOf(SyntheticAutotabInputEventsHandler)).call(this,"SyntheticAutotabInputEventsHandler"));return s.handleKeypressEvents=function(e,t){if(a(t)&&s.hasjQueryAutoTab(e.target,t)){var n="insertText",r=e.key;if(8==e.keyCode)return n="deleteContentBackward",void(r=null);var i=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:r,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:n,isComposing:!1,isTrusted:!0,jQueryMask:"autotab",returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timestamp:e.timestamp,type:"input",view:null,which:0});s._messageBus.publish(s._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,i)}},s._messageBus=(0,i.inject)("MessageBus"),s._elementBindingWMap=new WeakMap,s._utils=s.exports.CDUtils,s.defaultEventListener=[{event:"keypress",handler:s.handleKeypressEvents}],s}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(SyntheticAutotabInputEventsHandler,s["default"]),r(SyntheticAutotabInputEventsHandler,[{key:"start",value:function start(e,i){var t=this;i=i||window.self,e.forEach(function(e){if(a(i)&&t.hasjQueryAutoTab(e,i)&&!t._elementBindingWMap.has(e)){var r={};t.defaultEventListener.forEach(function(t){var n=function n(e){t.handler(e,i)};r[t.event]=n,o["default"].addEventListener(e,t.event,n)}),t._elementBindingWMap.set(e,{isBinded:!0,listeners:r})}})}},{key:"stop",value:function stop(e){var r=this;e.forEach(function(t){var n=r._elementBindingWMap.get(t);n&&n.isBinded&&(r.defaultEventListener.forEach(function(e){o["default"].removeEventListener(t,e.event,n.listeners[e.event])}),r._elementBindingWMap["delete"](t))})}},{key:"hasjQueryAutoTab",value:function hasjQueryAutoTab(e,t){if(void 0===t.jQuery._data(e,"events"))return!1;for(var n=Object.keys(t.jQuery._data(e,"events")),r=0;r<n.length;r++)if(-1!==n[r].indexOf("autotab"))return!0;return!1}}]),SyntheticAutotabInputEventsHandler}();t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function StandardOnFormEventsEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardOnFormEventsEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(StandardOnFormEventsEmitter.__proto__||Object.getPrototypeOf(StandardOnFormEventsEmitter)).call(this,"StandardOnFormEventsEmitter"));return t.handleOnFormSubmitEvents=function(e){t._messageBus.publish(t._messageBus.getChannels().STANDARDONFORMSUBMITEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t._elementBindingWMap=new WeakMap,t._utils=t.exports.CDUtils,t.defaultOnFormEventListener=[{event:"submit",handler:t.handleOnFormSubmitEvents}],t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(StandardOnFormEventsEmitter,s["default"]),r(StandardOnFormEventsEmitter,[{key:"start",value:function start(e){var n=this;e.forEach(function(t){n._elementBindingWMap.has(t)||(n.defaultOnFormEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)}),n._elementBindingWMap.set(t,{isBinded:!0,listeners:[n.handleOnFormSubmitEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultOnFormEventListener.forEach(function(e){o["default"].removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultOnFormEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultOnFormEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleOnFormSubmitEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultOnFormEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultOnFormEventListener.forEach(function(e){o["default"].removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardOnFormEventsEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function StandardOnClickEventsEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardOnClickEventsEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(StandardOnClickEventsEmitter.__proto__||Object.getPrototypeOf(StandardOnClickEventsEmitter)).call(this,"StandardOnClickEventsEmitter"));return t.handleOnClickEvents=function(e){t._messageBus.publish(t._messageBus.getChannels().STANDARDONCLICKEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t._elementBindingWMap=new WeakMap,t._utils=t.exports.CDUtils,t.defaultOnClickEventListener=[{event:"click",handler:t.handleOnClickEvents}],t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(StandardOnClickEventsEmitter,s["default"]),r(StandardOnClickEventsEmitter,[{key:"start",value:function start(e){var n=this;e.forEach(function(t){n._elementBindingWMap.has(t)||(n.defaultOnClickEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)}),n._elementBindingWMap.set(t,{isBinded:!0,listeners:[n.handleOnClickEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultOnClickEventListener.forEach(function(e){o["default"].removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultOnClickEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultOnClickEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleOnClickEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultOnClickEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultOnClickEventListener.forEach(function(e){o["default"].removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardOnClickEventsEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function StandardOnChangeEventsEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardOnChangeEventsEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(StandardOnChangeEventsEmitter.__proto__||Object.getPrototypeOf(StandardOnChangeEventsEmitter)).call(this,"StandardOnChangeEventsEmitter"));return t.handleOnChangeEvents=function(e){t._messageBus.publish(t._messageBus.getChannels().STANDARDONCHANGEEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t._elementBindingWMap=new WeakMap,t._utils=t.exports.CDUtils,t.defaultOnChangeEventListener=[{event:"change",handler:t.handleOnChangeEvents}],t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(StandardOnChangeEventsEmitter,s["default"]),r(StandardOnChangeEventsEmitter,[{key:"start",value:function start(e){var n=this;e.forEach(function(t){n._elementBindingWMap.has(t)||(n.defaultOnChangeEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)}),n._elementBindingWMap.set(t,{isBinded:!0,listeners:[n.handleOnChangeEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultOnChangeEventListener.forEach(function(e){o["default"].removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultOnChangeEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultOnChangeEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleOnChangeEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultOnChangeEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultOnChangeEventListener.forEach(function(e){o["default"].removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardOnChangeEventsEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function StandardInputEventsEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardInputEventsEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(StandardInputEventsEmitter.__proto__||Object.getPrototypeOf(StandardInputEventsEmitter)).call(this,"StandardInputEventsEmitter"));return t.handleInputEvents=function(e){t._messageBus.publish(t._messageBus.getChannels().STANDARDINPUTEVENTINPUT,e)},t.handleFocusEvents=function(e){t._messageBus.publish(t._messageBus.getChannels().STANDARDINPUTEVENTFOCUS,e)},t.handleBlurEvents=function(e){t._messageBus.publish(t._messageBus.getChannels().STANDARDINPUTEVENTBLUR,e)},t._messageBus=(0,i.inject)("MessageBus"),t._elementBindingWMap=new WeakMap,t._utils=t.exports.CDUtils,t.defaultInputEventListener=[{event:"input",handler:t.handleInputEvents},{event:"focus",handler:t.handleFocusEvents},{event:"blur",handler:t.handleBlurEvents}],t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(StandardInputEventsEmitter,s["default"]),r(StandardInputEventsEmitter,[{key:"start",value:function start(e){var n=this;e.forEach(function(t){n._elementBindingWMap.has(t)||(n.defaultInputEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)}),n._elementBindingWMap.set(t,{isBinded:!0,listeners:[n.handleInputEvents,n.handleFocusEvents,n.handleBlurEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultInputEventListener.forEach(function(e){o["default"].removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultInputEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultInputEventListener.forEach(function(e){o["default"].addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleInputEvents,this.handleFocusEvents,this.handleBlurEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultInputEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultInputEventListener.forEach(function(e){o["default"].removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardInputEventsEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(26));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function MutationEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MutationEmitter);var n=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(MutationEmitter.__proto__||Object.getPrototypeOf(MutationEmitter)).call(this,"MutationEmitter"));return n.handleMutationEvent=function(e,t){return e&&t&&n._messageBus.publish(n._messageBus.getChannels().MUTATIONSINGLE,{mutation:e,frame:t})},n._messageBus=(0,i.inject)("MessageBus"),n._documentObservers=new WeakMap,n}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MutationEmitter,s["default"]),r(MutationEmitter,[{key:"startObserver",value:function startObserver(i){var s=this;i||(i=window.self);var e=i.document||i.contentDocument;if(!this._documentObservers.has(e)){var t=new window.MutationObserver(function(e){try{for(var t=0;t<e.length;t++){var n=e[t];if(0<n.addedNodes.length){s.handleMutationEvent(n,i);break}}}catch(r){log.error("An error has occurred: "+r.message)}});t.observe(e,{childList:!0,subtree:!0}),this._documentObservers.set(e,{instance:t})}}},{key:"stopObserver",value:function stopObserver(e){e||(e=window.self);var t=e.document||e.contentDocument,n=void 0;this._documentObservers.has(t)&&(n=this._documentObservers.get(t))&&(n.instance&&n.instance.disconnect(),this._documentObservers["delete"](t))}}]),MutationEmitter}();t["default"]=(0,o["default"])(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();t["default"]=function(t){return function(e){function _class2(){var e;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_class2);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=_class2.__proto__||Object.getPrototypeOf(_class2)).call.apply(e,[this].concat(n)));return i._frameInstances=new WeakMap,i}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(_class2,t),r(_class2,[{key:"hasInstance",value:function hasInstance(e){}},{key:"getInstance",value:function getInstance(e){}},{key:"deleteInstance",value:function deleteInstance(e){}}]),_class2}()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=_interopRequireDefault(n(28)),s=_interopRequireDefault(n(0));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var o=function(e){function MessageBus(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MessageBus),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(MessageBus.__proto__||Object.getPrototypeOf(MessageBus)).call(this,"MessageBus"))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(MessageBus,s["default"]),r(MessageBus,[{key:"init",value:function init(){this.subscribers=new this.exports.Map}},{key:"getChannels",value:function getChannels(){return i["default"]}},{key:"subscribe",value:function subscribe(e,t){var n=2<arguments.length&&arguments[2]!==undefined&&arguments[2],r=null,i=!1;this.subscribers.has(e)?(r=this.subscribers.get(e))&&r.forEach(function(e){t===e.handler&&(i=!0)}):(r=new this.exports.Set,this.subscribers.set(e,r)),i||r.add({handler:t,isOneTime:n})}},{key:"unsubscribe",value:function unsubscribe(e,t){if(e&&this.subscribers.has(e)){var n=this.subscribers.get(e);n&&n.forEach(function(e){t===e.handler&&n["delete"](e)}),0===n.size&&this.subscribers["delete"](e)}}},{key:"publish",value:function publish(e,t){this.notifySubscribers({channel:e,data:t})}},{key:"notifySubscribers",value:function notifySubscribers(t){var e=t.channel;if(e&&this.subscribers.has(e)){var n=this.subscribers.get(e);n&&n.forEach(function(e){e.handler(t.data),e.isOneTime&&n["delete"](e)})}}}]),MessageBus}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={MUTATIONSINGLE:"mutation:single",MUTATIONALL:"mutation:all",CONFIGUPDATED:"config:updated",CONFIGFAILED:"config:failed",STANDARDINPUTEVENTINPUT:"events:standardinputeventinput",STANDARDINPUTEVENTFOCUS:"events:standardinputeventfocus",STANDARDINPUTEVENTBLUR:"events:standardinputeventblur",STANDARDONCLICKEVENT:"events:standardonclickevent",STANDARDONCHANGEEVENT:"events:standardonchangeevent",STANDARDONFORMSUBMITEVENT:"events:standardoformsubmiteevent",SYNTHETICINPUTMASKEVENT:"events:syntheticinputmaskevent",CUTEVENT:"events:cutevent",COPYEVENT:"events:copyevent",PASTEEVENT:"events:pasteevent",DEVICEORIENATIONEVENT:"events:deviceorientationevent",BEFOREINSTALLPROMPTEVENT:"events:beforeinstallpromptevent"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(r);t["default"]={setExport:r.setExport,Application:i["default"]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();t.setExport=function setExport(e){P=e,(0,o.injectExports)(P)};var i=n(0),s=_interopRequireDefault(n(14)),o=n(4),a=_interopRequireDefault(n(16)),u=_interopRequireDefault(n(5)),l=_interopRequireDefault(n(19)),c=_interopRequireDefault(n(20)),f=_interopRequireDefault(n(21)),p=_interopRequireDefault(n(22)),d=_interopRequireDefault(n(23)),v=_interopRequireDefault(n(24)),h=_interopRequireDefault(n(31)),_=_interopRequireDefault(n(32)),E=_interopRequireDefault(n(25)),b=_interopRequireDefault(n(27)),m=_interopRequireDefault(n(33)),g=_interopRequireDefault(n(34)),y=_interopRequireDefault(n(35)),O=_interopRequireDefault(n(36)),C=_interopRequireDefault(n(37));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var w={};w.Index=a["default"],w.FeaturesList=u["default"];var P={};var j=function(){function Application(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Application),this.configurations={},this.APP_CONTAINER=new s["default"],(0,i.serviceContainer)(this.APP_CONTAINER),"function"==typeof t&&t(this),Object.getOwnPropertyNames(w).forEach(function(e){"function"==typeof w[e]&&w[e](P)})}return r(Application,[{key:"initialize",value:function initialize(e){if(e)return this._unSupportedMode();this.registerServices()}},{key:"_unSupportedMode",value:function _unSupportedMode(){(new b["default"]).init();new h["default"]}},{key:"registerServices",value:function registerServices(){(new b["default"]).init();var e=new h["default"],t=(new E["default"],new m["default"]);new y["default"],new O["default"],new _["default"],new g["default"],new v["default"],new p["default"],new d["default"],new f["default"],new l["default"],new c["default"],new C["default"];t.init(P.FeaturesList,P.sysLoader.getFeatureManager()),e.init(),t.runFeatures()}},{key:"lookup",value:function lookup(e){return this.APP_CONTAINER.lookup(e)}}]),Application}();t["default"]=j},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(i);var o=function(e){function Session(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Session);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Session.__proto__||Object.getPrototypeOf(Session)).call(this,"Session"));return e.init=e.init.bind(e),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Session,s["default"]),r(Session,[{key:"init",value:function init(){return this.messageBus=(0,i.inject)("MessageBus"),!!this.exports.sysLoader&&this.exports.sysLoader.getSessionManager()}}]),Session}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function PasteEventEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PasteEventEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(PasteEventEmitter.__proto__||Object.getPrototypeOf(PasteEventEmitter)).call(this,"PasteEventEmitter"));return t.handlePasteEvent=function(e){t._messageBus.publish(t._messageBus.getChannels().PASTEEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(PasteEventEmitter,s["default"]),r(PasteEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");o["default"].addEventListener(e,"paste",this.handlePasteEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");o["default"].removeEventListener(e,"paste",this.handlePasteEvent)}}]),PasteEventEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.features=undefined;var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(i);t.features=[],function runFeatures(){0<arguments.length&&arguments[0]!==undefined&&arguments[0]},function stopFeatures(){0<arguments.length&&arguments[0]!==undefined&&arguments[0]},function runFeatureMethod(e,t){},function updateFeatures(){0<arguments.length&&arguments[0]!==undefined&&arguments[0],arguments[1]},function runFeature(e){},function stopFeature(e){};var o=function(e){function FeatureManager(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FeatureManager);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(FeatureManager.__proto__||Object.getPrototypeOf(FeatureManager)).call(this,"FeatureManager"));return e.featuresList=[],e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(FeatureManager,s["default"]),r(FeatureManager,[{key:"init",value:function init(e,t){this.featuresList=e,this.featureManager=t,this.messageBus=(0,i.inject)("MessageBus"),this.messageBus.subscribe("test",function(){})}},{key:"runDefault",value:function runDefault(){}},{key:"runFeatures",value:function runFeatures(){0<arguments.length&&arguments[0]!==undefined&&arguments[0]}}]),FeatureManager}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function DeviceOrientationEventEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DeviceOrientationEventEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(DeviceOrientationEventEmitter.__proto__||Object.getPrototypeOf(DeviceOrientationEventEmitter)).call(this,"DeviceOrientationEventEmitter"));return t.handleDeviceOrientationEvent=function(e){t._messageBus.publish(t._messageBus.getChannels().DEVICEORIENATIONEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(DeviceOrientationEventEmitter,s["default"]),r(DeviceOrientationEventEmitter,[{key:"start",value:function start(){o["default"].addEventListener(window,"deviceorientation",this.handleDeviceOrientationEvent)}},{key:"stop",value:function stop(){o["default"].removeEventListener(window,"deviceorientation",this.handleDeviceOrientationEvent)}}]),DeviceOrientationEventEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function CutEventEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CutEventEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(CutEventEmitter.__proto__||Object.getPrototypeOf(CutEventEmitter)).call(this,"CutEventEmitter"));return t.handleCutEvent=function(e){t._messageBus.publish(t._messageBus.getChannels().CUTEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(CutEventEmitter,s["default"]),r(CutEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");o["default"].addEventListener(e,"cut",this.handleCutEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");o["default"].removeEventListener(e,"cut",this.handleCutEvent)}}]),CutEventEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function CopyEventEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CopyEventEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(CopyEventEmitter.__proto__||Object.getPrototypeOf(CopyEventEmitter)).call(this,"CopyEventEmitter"));return t.handleCopyEvent=function(e){t._messageBus.publish(t._messageBus.getChannels().COPYEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(CopyEventEmitter,s["default"]),r(CopyEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");o["default"].addEventListener(e,"copy",this.handleCopyEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");o["default"].removeEventListener(e,"copy",this.handleCopyEvent)}}]),CopyEventEmitter}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),i=n(0),s=_interopRequireDefault(i),o=_interopRequireDefault(n(1));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function BeforeInstallPromptEventEmitter(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,BeforeInstallPromptEventEmitter);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(BeforeInstallPromptEventEmitter.__proto__||Object.getPrototypeOf(BeforeInstallPromptEventEmitter)).call(this,"BeforeInstallPromptEventEmitter"));return t.handleBeforeInstallPrompt=function(e){t._messageBus.publish(t._messageBus.getChannels().BEFOREINSTALLPROMPTEVENT,e)},t._messageBus=(0,i.inject)("MessageBus"),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(BeforeInstallPromptEventEmitter,s["default"]),r(BeforeInstallPromptEventEmitter,[{key:"start",value:function start(){o["default"].addEventListener(window,"beforeinstallprompt",this.handleBeforeInstallPrompt)}},{key:"stop",value:function stop(){o["default"].removeEventListener(window,"beforeinstallprompt",this.handleBeforeInstallPrompt)}}]),BeforeInstallPromptEventEmitter}();t["default"]=a}]),function(fe){function e(){var e,t,n,i,s,r,a,o,u,c,h,d,l,f,g,_,p,v,m,y,w,b,S,E,k,C,M,T,D,x,F,A,R,P,U,I,L,B,N,O,W,Q,H,q,z,j,V,Y,K,G,X,Z,J,$,ee,te,ne,ie,se,re,ae,oe,ue,ce,he=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(function(e){var t,n;if(!Function.prototype.cdCallAsync&&(Object.extend=function(e,t){if(e&&t&&"object"==("undefined"==typeof t?"undefined":de(t)))for(var n in t)if(t.hasOwnProperty(n))try{""!=n&&Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}catch(i){e[n]=t[n]}return e},e.btoa=self.btoa?self.btoa.bind(self):function(e){for(var t,n,i=String(e),s="",r=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.charAt(0|r)||(a="=",r%1);s+=a.charAt(63&t>>8-r%1*8)){if(255<(n=i.charCodeAt(r+=.75)))throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return s},self.importScripts==undefined)){var a=(t=[],n="Window_"+e.CDUtils.generateUUID(),e.CDUtils.addEventListener(window,"message",function i(e){e.data==n&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),t.shift()())},!0),function(e){t.push(e),window.postMessage(n,self.location.href)});Function.prototype.cdCallAsync=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s=this;a(function(){s.apply(e||window,n)})},Function.prototype.cdCallAsyncWithErrorHandling=function(t,n){for(var e=arguments.length,i=Array(2<e?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];var r=this;a(function(){try{r.apply(t||window,i)}catch(e){n&&n(e)}})}}})(e="undefined"==typeof fe?self:fe),function(e){function t(e,t){this._portNativeWorker=e,this._useShared=t}t.prototype={start:function(){this._useShared&&this._portNativeWorker.port.start()},postMessage:function(){var e=this._portNativeWorker.port;this._useShared?e.postMessage.apply(e,arguments):this._portNativeWorker.postMessage.apply(this._portNativeWorker,arguments)},close:function(){this._useShared?this._portNativeWorker.port.close():this._portNativeWorker.terminate()},setonmessage:function(e){this._useShared?this._portNativeWorker.port.onmessage=e:this._portNativeWorker.onmessage=e}},e.CDPort=t}(e),t=e,n=function(){function e(){le(this,e),this._pairs=[],this.size=0}return he(e,[{key:"has",value:function(e){return-1<this._indexOf(e)}},{key:"get",value:function(e){var t=this._indexOf(e);return-1<t?this._pairs[t][1]:undefined}},{key:"set",value:function(e,t){var n=this._indexOf(e);-1<n?this._pairs[n][1]=t:(this._pairs.push([e,t]),this.size++)}},{key:"delete",value:function(e){var t=this._indexOf(e);return-1<t&&(this._pairs.splice(t,1),this.size--,!0)}},{key:"forEach",value:function(e){for(var t=0;t<this._pairs.length;t++)e(this._pairs[t][1],this._pairs[t][0])}},{key:"clear",value:function(){this._pairs=[]}},{key:"_indexOf",value:function(e){for(var t=0;t<this._pairs.length;t++)if(this._pairs[t][0]===e)return t;return-1}}]),e}(),t.Map=self.Map||n,i=e,s=function(){function e(){le(this,e),this._set=[],this.size=0}return he(e,[{key:"add",value:function(e){return this._set.push(e),this.size++,this}},{key:"has",value:function(e){return-1<this._set.indexOf(e)}},{key:"delete",value:function(e){for(var t=0;t<this._set.length;t++)if(this._set[t]===e)return this._set.splice(t,1),this.size--,!0;return!1}},{key:"forEach",value:function(e){for(var t=0;t<this._set.length;t++)e(this._set[t])}},{key:"clear",value:function(){this._set=[]}}]),e}(),i.Set=self.Set||s,function(s){function e(){this._msgListeners=new s.Map}s.WorkerCommunicator||(e.prototype.setMessagingPort=function(e){this._messagePort=e;var s=this;e.setonmessage(function(e){var t=e.data,n=[],i=s._msgListeners.get(t.msgType);i&&i.forEach(function(e){e.callback(t.data),e.isOneTime&&n.push(e)}),n.forEach(function(e){i["delete"](e)})})},e.prototype.sendAsync=function(e,t,n,i,s){i&&n&&this.addMessageListener(n,i,s),this._messagePort.postMessage({msgType:e,data:t})},e.prototype.addMessageListener=function(e,t,n){var i=null;this._msgListeners.has(e)?i=this._msgListeners.get(e):(i=new s.Set,this._msgListeners.set(e,i)),i.add({callback:t,isOneTime:n})},s.WorkerCommunicator=e)}(e),r=e,a=function(){function t(e){if(le(this,t),!e)throw new Error("utils param must be defined");this._msgListeners=new r.Map,self.window&&e.addEventListener&&(this._windowId="Window_"+e.generateUUID(),e.addEventListener(self.window,"message",this._onMessageReceived.bind(this),!0))}return he(t,[{key:"subscribe",value:function(e,t){var n=2<arguments.length&&arguments[2]!==undefined&&arguments[2],i=null;this._msgListeners.has(e)?i=this._msgListeners.get(e):(i=new r.Set,this._msgListeners.set(e,i)),i.add({callback:t,isOneTime:n})}},{key:"unsubscribe",value:function(e,t){if(e&&this._msgListeners.has(e)){var n=this._msgListeners.get(e);n&&n.forEach(function(e){t===e.callback&&n["delete"](e)}),0===n.size&&this._msgListeners["delete"](e)}}},{key:"publish",value:function(e,t){if(!e)throw new Error("invalid argument msgType must be defined");this._publishMessage(e,t)}},{key:"publishAsync",value:function(e,t){if(!e)throw new Error("invalid argument msgType must be defined");self.window&&self.window.postMessage({msgID:this._windowId,msgType:e,message:t},window.location.href)}},{key:"_publishMessage",value:function(e,t){var n=this._msgListeners.get(e);n&&n.forEach(function(e){e.callback(t),e.isOneTime&&n["delete"](e)})}},{key:"_onMessageReceived",value:function(e){e.data.msgID&&e.data.msgID===this._windowId&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),this._publishMessage(e.data.msgType,e.data.message))}}]),t}(),r.MessageBus=a,e.MessageBusEventType={TouchEvent:"touchEvent",KeyEvent:"keyEvent",ConfigUpdatedEvent:"ConfigUpdatedEvent",NewSessionStartedEvent:"NewSessionStartedEvent",WupDispatchRateUpdatedEvent:"WupDispatchRateUpdatedEvent",ApiContextChangeEvent:"ApiContextChangeEvent",ApiResetSessionEvent:"ApiResetSessionEvent",ApiCustomerMetadataEvent:"ApiCustomerMetadataEvent",ApiChangeStateEvent:"ApiChangeStateEvent",ApiSetCsidEvent:"ApiSetCsidEvent",ApiSetPsidEvent:"ApiSetPsidEvent",ServerStateUpdatedEvent:"ServerStateUpdatedEvent"},o=e,u=function(){function e(){le(this,e),this._buffer=[]}return he(e,[{key:"hasItems",value:function(){return 0<this.length()}},{key:"length",value:function(){return this._buffer.length}},{key:"enqueue",value:function(e){this._buffer.push(e)}},{key:"enqueueToHead",value:function(e){this._buffer.unshift(e)}},{key:"dequeue",value:function(e){return this._buffer.shift()}},{key:"getItem",value:function(e){return this._buffer[e]}}]),e}(),o.Queue=u,c=e,h=function(){function e(){le(this,e)}return he(e,null,[{key:"create",value:function(){if(self.XMLHttpRequest&&Object.prototype.hasOwnProperty.call(XMLHttpRequest.prototype,"withCredentials"))return new XMLHttpRequest;if(self.XDomainRequest)return new XDomainRequest;if(self.XMLHttpRequest)return new XMLHttpRequest;throw new Error("There is no supported http request object")}}]),e}(),c.HttpRequestFactory=h,d=e,l=function(){function t(e){le(this,t),this._wupServerSessionState=e,this.reset()}return he(t,[{key:"add",value:function(e){var t=e.eventName,n=e.data;if(!t)throw new Error("Unable to add data message. Missing eventName field");if(!n)throw new Error("Unable to add data message. Missing data field");this._isEmpty=!1,this._dataObj[t]=this._dataObj[t]||[],this._dataObj[t].push(n)}},{key:"take",value:function(){this._isEmpty||this._dataObj.static_fields.push(["requestId",this._wupServerSessionState.incrementRequestId()]);var e=this._dataObj;return this.reset(),e}},{key:"reset",value:function(){this._isEmpty=!0,this._dataObj=this.getFreshDataObj()}},{key:"isEmpty",value:function(){return this._isEmpty}},{key:"getFreshDataObj",value:function(){return{static_fields:[],key_events:[],mouse_events:[]}}}]),t}(),d.DataAggregator=l,f=e,g=function(){function e(){le(this,e),this.reset()}return he(e,[{key:"add",value:function(e){var t=e.data;if(!t)throw new Error("Unable to add log message. Missing data field");this._Q.push(t)}},{key:"take",value:function(){var e=this._Q;return this.reset(),e}},{key:"reset",value:function(){this._Q=[]}},{key:"isEmpty",value:function(){return 0===this._Q.length}}]),e}(),f.LogAggregator=g,_=e,p=function(){function t(e){le(this,t),this._statisticsLogIntervalMs=e,this.resetCounters(),this._setPeriodicStatisticsLog()}return he(t,[{key:"getSentWupsCount",value:function(){return this._sentWupsCount}},{key:"incrementSentWupCount",value:function(){this._sentWupsCount++,this._sentWupsInCurrentIntervalCount++}},{key:"updateSettings",value:function(e){this._statisticsLogIntervalMs=e,this._setPeriodicStatisticsLog()}},{key:"resetCounters",value:function(){this._sentWupsCount=0,this._sentWupsInCurrentIntervalCount=0}},{key:"stop",value:function(){this._stopPeriodicStatisticsLog()}},{key:"_writeStatisticsLog",value:function(){0!==this._sentWupsInCurrentIntervalCount&&(log.info("Sent "+this._sentWupsInCurrentIntervalCount+" wup in the last "+this._statisticsLogIntervalMs+" ms. Sent a total of "+this._sentWupsCount+" in the session"),this._sentWupsInCurrentIntervalCount=0)}},{key:"_stopPeriodicStatisticsLog",value:function(){this._periodicLogIntervalId&&clearInterval(this._periodicLogIntervalId)}},{key:"_setPeriodicStatisticsLog",value:function(){this._stopPeriodicStatisticsLog(),this._periodicLogIntervalId=setInterval(this._writeStatisticsLog.bind(this),this._statisticsLogIntervalMs)}}]),t}(),_.WupStatisticsService=p,e.WupDispatchRateType={incremental:"incremental",constant:"constant",dynamic:"dynamic"},v=e,m=function(){function n(e,t){le(this,n),this._wupStatisticsService=t,this.updateSettings(e)}return he(n,[{key:"getRate",value:function(){if(this._wupStatisticsService.getSentWupsCount()<this._incrementStartWupSendCount)return this._currentRate;var e=this._currentRate+this._incrementStepMs;return e<=this._incrementStopMs&&(this._currentRate=e),this._currentRate}},{key:"updateSettings",value:function(e){if(e.type!==v.WupDispatchRateType.incremental)throw new Error("Invalid settings provided to incremental calculator");this._currentRate=e.initialRateValueMs,this._incrementStepMs=e.incrementStepMs,this._incrementStopMs=e.incrementStopMs,this._incrementStartWupSendCount=e.incrementStartWupSendCount}}]),n}(),v.WupDispatchIncrementalRateCalculator=m,y=e,w=function(){function t(e){le(this,t),this.updateSettings(e)}return he(t,[{key:"getRate",value:function(){return this._currentRate}},{key:"updateSettings",value:function(e){if(e.type!==y.WupDispatchRateType.constant)throw new Error("Invalid settings provided to constant calculator");this._currentRate=e.initialRateValueMs}}]),t}(),y.WupDispatchConstantRateCalculator=w,b=e,S=function(){function t(e){le(this,t),this._wupServerSessionState=e}return he(t,[{key:"getRate",value:function(){return this._wupServerSessionState.getWupDispatchRate()}},{key:"updateSettings",value:function(){}}]),t}(),b.WupDispatchDynamicRateCalculator=S,E=e,k=function(){function n(e,t){le(this,n),this._wupStatisticsService=e,this._wupServerSessionState=t}return he(n,[{key:"create",value:function(e){if(e.type===E.WupDispatchRateType.constant)return new E.WupDispatchConstantRateCalculator(e);if(e.type===E.WupDispatchRateType.incremental)return new E.WupDispatchIncrementalRateCalculator(e,this._wupStatisticsService);if(e.type===E.WupDispatchRateType.dynamic)return new E.WupDispatchDynamicRateCalculator(this._wupServerSessionState);throw new Error("Unsupported dispatch rate type "+e.type)}}]),n}(),E.WupDispatchRateCalculatorFactory=k,C=e,M=function(){function s(e,t,n,i){le(this,s),this._serverClient=e,this._aggregator=t,this._wupDispatchRateCalculatorFactory=n,this._wupDispatchRateSettings=i,this._wupDispatchRateCalculator=this._wupDispatchRateCalculatorFactory.create(this._wupDispatchRateSettings),this._sendToServerInterval=this._wupDispatchRateCalculator.getRate(),this._setDispatchInterval(this._sendToServerInterval)}return he(s,[{key:"add",value:function(e){this._aggregator.add(e)}},{key:"sendIfRequired",value:function(){var e=0<arguments.length&&arguments[0]!==undefined&&arguments[0];(0==this._sendToServerInterval||e)&&this._sendToServer(e)}},{key:"updateByConfig",value:function(e){e&&(e.type!==this._wupDispatchRateSettings.type?this._wupDispatchRateCalculator=this._wupDispatchRateCalculatorFactory.create(e):this._wupDispatchRateCalculator.updateSettings(e),this._sendToServerInterval=this._wupDispatchRateCalculator.getRate(),this._setDispatchInterval(this._sendToServerInterval),this._wupDispatchRateSettings=e)}},{key:"scheduleNextDispatching",value:function(){var e=this._wupDispatchRateCalculator.getRate();e!==this._sendToServerInterval&&(this._sendToServerInterval=e,this._setDispatchInterval(this._sendToServerInterval))}},{key:"_sendToServer",value:function(){var e=0<arguments.length&&arguments[0]!==undefined&&arguments[0];log.debug("Message dispatcher is sending the message to the server"),this._serverClient.isReady()?this._aggregator.isEmpty()||(this._serverClient.sendData(this._aggregator.take(),e),this.scheduleNextDispatching()):log.info(this._serverClient.constructor.name+" is not ready. Message dispatcher will not send message")}},{key:"_setDispatchInterval",value:function(e){this._sendIntervalId&&(clearInterval(this._sendIntervalId),this._sendIntervalId=null),0!==e&&(this._sendIntervalId=setInterval(this._sendToServer.bind(this),e))}}]),s}(),C.WupDispatcher=M,T=e,D=function(){function t(e){le(this,t),this._wupDispatcher=e}return he(t,[{key:"process",value:function(e){if(!e)throw new Error("Invalid message received for processing.");var t=!1;if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t=this._processSingleMessage(e[n])||t;else t=this._processSingleMessage(e)||t;this._wupDispatcher.sendIfRequired(t)}},{key:"_processSingleMessage",value:function(e){if(this._isEmptyFlushMessage(e))return!0;var t=!1;if(e.shouldFlush&&(t=!0),this._isDataValid(e))return this._wupDispatcher.add(e),t;var n="Received a message with invalid structure. Missing eventName or Data fields";throw log.error(n),new Error(n)}},{key:"_isEmptyFlushMessage",value:function(e){return"flushData"===e.eventName}},{key:"_isDataValid",value:function(e){return e.eventName&&e.data}}]),t}(),T.MessageProcessor=D,function(e){if(!e.Logger){var t=function(){function n(e,t){le(this,n),this._logBridge=e,this._logLevel=t||n.LOG_LEVEL.INFO}return he(n,[{key:"trace",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.DEBUG)}},{key:"debug",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.DEBUG)}},{key:"info",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.INFO)}},{key:"warn",value:function(e,t){this._sendToLogBridge(e,n.LOG_LEVEL.WARN,t)}},{key:"error",value:function(e,t){this._sendToLogBridge(e,n.LOG_LEVEL.ERROR,t)}},{key:"isDebug",value:function(){return this._logLevel==n.LOG_LEVEL.DEBUG}},{key:"updateLogConfig",value:function(e){this._logLevel=e.get("logLevel")||this._logLevel}},{key:"_sendToLogBridge",value:function(e,t,n){t>=this._logLevel&&(n&&n.stack&&(e+=" ;stack: "+n.stack),this._logBridge.log(e,t))}}]),n}();Object.extend(t,{LOG_LEVEL:{DEBUG:10,INFO:20,WARN:30,ERROR:40,CRITICAL:50,OFF:80}}),e.Logger=t,e.log={setLogger:function(e){this._logger=e},isDebug:function(){return this._logger.isDebug()},error:function(e,t){this._logger.error(e,t||null)},warn:function(e,t){this._logger.warn(e,t||null)},trace:function(e){this._logger.trace(e)},debug:function(e){this._logger.debug(e)},info:function(e){this._logger.info(e)}}}}(e),function(h){function e(e){if(!e)throw new Error("messageBus param must be defined");this._requireParseFields=new h.Map,this._requireParseFields.set(h.ConfigurationFields.dataWupDispatchRateSettings,h.ConfigurationFields.dataWupDispatchRateSettings),this._requireParseFields.set(h.ConfigurationFields.logWupDispatchRateSettings,h.ConfigurationFields.logWupDispatchRateSettings),this._requireParseFields.set(h.ConfigurationFields.serverCommunicationSettings,h.ConfigurationFields.serverCommunicationSettings),this._configurationList={},this.configDefault={logLevel:h.Logger.LOG_LEVEL.INFO,orientationEventsSamplePeriod:300,orientationEventsThreshold:1,stateChangeEnabled:!1,accelerometerEventsSamplePeriod:0,dataQPassWorkerInterval:500,gyroEventsSamplePeriod:0,gyroEventsThreshold:.3,isContextPropsFeature:!0,isEnabled:!0,isResetEveryLoad:!1,isScrollCollect:!0,isUnsupportedReport:!0,isVMDetection:!0,isAudioDetection:!0,isHistoryNavigationEvent:!1,wupStatisticsLogIntervalMs:3e4,resetSessionApiThreshold:2e4,wupMessageRequestTimeout:3e3,logMessageRequestTimeout:3e3,forceDynamicDataWupDispatchSettings:!0,dataWupDispatchRateSettings:h.ConfigurationDefaultTemplates.defaultDynamicWupDispatchRateConfiguration,logWupDispatchRateSettings:{type:"constant",initialRateValueMs:2500},serverCommunicationSettings:{sendRetryRate:1e3,queueLoadThreshold:100},ipDetectorTimeout:2e3,collectKeyRegionValue:!1},this._cid="",this._messageBus=e,this.updateConfiguration(this.configDefault)}h.ConfigManager||(h.ConfigurationFields={resetSessionApiThreshold:"resetSessionApiThreshold",dataWupDispatchRateSettings:"dataWupDispatchRateSettings",logWupDispatchRateSettings:"logWupDispatchRateSettings",forceDynamicDataWupDispatchSettings:"forceDynamicDataWupDispatchSettings",wupStatisticsLogIntervalMs:"wupStatisticsLogIntervalMs",serverCommunicationSettings:"serverCommunicationSettings",wupResponseTimeout:"wupResponseTimeout",wupMessageRequestTimeout:"wupMessageRequestTimeout",logMessageRequestTimeout:"logMessageRequestTimeout",collectKeyRegionValue:"collectKeyRegionValue",ipDetectorTimeout:"ipDetectorTimeout"},h.ConfigurationDefaultTemplates={defaultDynamicWupDispatchRateConfiguration:{type:"dynamic"},defaultIncrementalWupDispatchRateConfiguration:{type:"incremental",initialRateValueMs:500,incrementStepMs:500,incrementStopMs:5e3,incrementStartWupSendCount:20}},e.prototype.isConfigurationUpdatedFromServer=function(){return!this._isDefaultConfiguration},e.prototype.updateConfiguration=function(e){for(var t in this._isDefaultConfiguration=e===this.configDefault,e)if(e.hasOwnProperty(t)){var n=e[t];if(this._requireParseFields.has(t)){var i=this.tryParseConfigurationValue(n);i&&(n=i)}this._configurationList[t]=n}this._messageBus.publish(h.MessageBusEventType.ConfigUpdatedEvent,this)},e.prototype.tryParseConfigurationValue=function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(t){}return null},e.prototype.updateLogUrlToWorker=function(e,t,n,i){if(i&&(this._configurationList.logAddress=i),this._configurationList.logAddress){var s={logAddress:this._configurationList.logAddress+"?cid="+this._cid+"&cdsnum="+e+"&csid="+t+"&ds=js&sdkVer="+h.CDUtils.scriptVersion};n.sendAsync(h.WorkerCommand.updateLogUrlCommand,s)}},e.prototype.getServerConfig=function(e,t,n,i){var s=this;function r(e){log.warn("Config Manager received an error response for Init request from Worker."),s.updateConfiguration(s.configDefault),i&&i(e)}this._configurationList.serverAddress=t.serverAddress;var a=t.serverAddress.indexOf("cid=")+4,o=t.serverAddress.indexOf("&",a);o=-1==o?undefined:o,this._cid=t.serverAddress.substring(a,o);var u={serverAddress:t.serverAddress,csid:t.csid,psid:t.psid,cdsnum:t.sessionId,muid:t.muid,context_name:t.context_name,serverState:t.serverState};log.info("Config Manager is requesting configuration from Worker."),e.addMessageListener("initCommFailed",r,!0),e.sendAsync(h.WorkerCommand.requestConfigurationsCommand,u,"initCommSuccess",function c(e){log.info("Config Manager received Init response from Worker."),e?(log.info("Updating received configuration and notifying on the change."),s.updateConfiguration(e),n&&n(e)):r(e)},!0)},e.prototype.get=function(e){return this._configurationList[e]},e.prototype.setSingleConfiguration=function(e,t){this._configurationList[e]=t},e.prototype.getAllConfigs=function(){return this._configurationList},h.ConfigManager=e)}(e),function(e){function t(){this._listeners=[]}e.CDEvent||(t.prototype={subscribe:function(e){this._listeners.push(e)},publish:function(e){for(var t=0,n=this._listeners.length;t<n;t++)this._listeners[t](e)},unsubscribe:function(e){for(var t=0,n=this._listeners.length;t<n;t++)if(e===this._listeners[t]){this._listeners.splice(t,1);break}}},e.CDEvent=t)}(e),function(e){("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).msgpack=function h(r,a,o){function u(n,e){if(!a[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var s=a[n]={exports:{}};r[n][0].call(s.exports,function(e){var t=r[n][1][e];return u(t||e)},s,s.exports,h,r,a,o)}return a[n].exports}for(var c="function"==typeof require&&require,e=0;e<o.length;e++)u(o[e]);return u}({1:[function(e,t,n){n.encode=e("./encode").encode,n.decode=e("./decode").decode,n.Encoder=e("./encoder").Encoder,n.Decoder=e("./decoder").Decoder,n.createCodec=e("./ext").createCodec,n.codec=e("./codec").codec},{"./codec":10,"./decode":12,"./decoder":13,"./encode":15,"./encoder":16,"./ext":20}],2:[function(e,n,t){(function(e){function t(e){return e&&e.isBuffer&&e}n.exports=t("undefined"!=typeof e&&e)||t(this.Buffer)||t("undefined"!=typeof window&&window.Buffer)||this.Buffer}).call(this,e("buffer").Buffer)},{buffer:29}],3:[function(e,t,n){n.copy=function a(e,t,n,i){var s;n||(n=0),i||0===i||(i=this.length),t||(t=0);var r=i-n;if(e===this&&n<t&&t<i)for(s=r-1;0<=s;s--)e[s+t]=this[s+n];else for(s=0;s<r;s++)e[s+t]=this[s+n];return r},n.toString=function o(e,t,n){var i=this,s=0|t;n||(n=i.length);for(var r="",a=0;s<n;)(a=i[s++])<128?r+=String.fromCharCode(a):(192==(224&a)?a=(31&a)<<6|63&i[s++]:224==(240&a)?a=(15&a)<<12|(63&i[s++])<<6|63&i[s++]:240==(248&a)&&(a=(7&a)<<18|(63&i[s++])<<12|(63&i[s++])<<6|63&i[s++]),65536<=a?(a-=65536,r+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):r+=String.fromCharCode(a));return r},n.write=function u(e,t){for(var n=this,i=t||(t|=0),s=e.length,r=0,a=0;a<s;)r=e.charCodeAt(a++),n[i++]=r<128?r:(n[i++]=r<2048?192|r>>>6:(n[i++]=r<55296||57343<r?224|r>>>12:(r=65536+(r-55296<<10|e.charCodeAt(a++)-56320),n[i++]=240|r>>>18,128|r>>>12&63),128|r>>>6&63),128|63&r);return i-t}},{}],4:[function(e,t,n){function i(e){return new Array(e)}var s=e("./bufferish"),n=t.exports=i(0);n.alloc=i,n.concat=s.concat,n.from=function r(e){if(!s.isBuffer(e)&&s.isView(e))e=s.Uint8Array.from(e);else if(s.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return s.from.call(n,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return Array.prototype.slice.call(e)}},{"./bufferish":8}],5:[function(e,t,n){function i(e){return new r(e)}var s=e("./bufferish"),r=s.global,n=t.exports=s.hasBuffer?i(0):[];n.alloc=s.hasBuffer&&r.alloc||i,n.concat=s.concat,n.from=function a(e){if(!s.isBuffer(e)&&s.isView(e))e=s.Uint8Array.from(e);else if(s.isArrayBuffer(e))e=new Uint8Array(e);else{if("string"==typeof e)return s.from.call(n,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return r.from&&1!==r.from.length?r.from(e):new r(e)}},{"./bufferish":8}],6:[function(e,t,n){function s(e,t,n,i){var s=c.isBuffer(this),r=c.isBuffer(e);if(s&&r)return this.copy(e,t,n,i);if(h||s||r||!c.isView(this)||!c.isView(e))return u.copy.call(this,e,t,n,i);var a=n||null!=i?o.call(this,n,i):this;return e.set(a,t),a.length}function o(e,t){var n=this.slice||!h&&this.subarray;if(n)return n.call(this,e,t);var i=c.alloc.call(this,t-e);return s.call(this,i,0,e,t),i}var u=e("./buffer-lite");n.copy=s,n.slice=o,n.toString=function a(e,t,n){return(!r&&c.isBuffer(this)?this.toString:u.toString).apply(this,arguments)},n.write=function d(e){function t(){return(this[e]||u[e]).apply(this,arguments)}return t}("write");var c=e("./bufferish"),i=c.global,r=c.hasBuffer&&"TYPED_ARRAY_SUPPORT"in i,h=r&&!i.TYPED_ARRAY_SUPPORT},{"./buffer-lite":3,"./bufferish":8}],7:[function(e,t,i){function n(e){return new Uint8Array(e)}var s=e("./bufferish"),i=t.exports=s.hasArrayBuffer?n(0):[];i.alloc=n,i.concat=s.concat,i.from=function r(e){if(s.isView(e)){var t=e.byteOffset,n=e.byteLength;(e=e.buffer).byteLength!==n&&(e.slice?e=e.slice(t,t+n):(e=new Uint8Array(e)).byteLength!==n&&(e=Array.prototype.slice.call(e,t,t+n)))}else{if("string"==typeof e)return s.from.call(i,e);if("number"==typeof e)throw new TypeError('"value" argument must not be a number')}return new Uint8Array(e)}},{"./bufferish":8}],8:[function(e,t,o){function u(e){return i(this).alloc(e)}function n(e){var t=3*e.length,n=u.call(this,t),i=v.write.call(n,e);return t!==i&&(n=v.slice.call(n,0,i)),n}function i(e){return l(e)?_:f(e)?p:d(e)?g:c?_:h?p:g}function s(){return!1}function r(t,n){return t="[object "+t+"]",function(e){return null!=e&&{}.toString.call(n?e[n]:e)===t}}var a=o.global=e("./buffer-global"),c=o.hasBuffer=a&&!!a.isBuffer,h=o.hasArrayBuffer="undefined"!=typeof ArrayBuffer,d=o.isArray=e("isarray");o.isArrayBuffer=h?function y(e){return e instanceof ArrayBuffer||m(e)}:s;var l=o.isBuffer=c?a.isBuffer:s,f=o.isView=h?ArrayBuffer.isView||r("ArrayBuffer","buffer"):s;o.alloc=u,o.concat=function w(e,t){function n(e){t+=e.length}function i(e){a+=v.copy.call(e,r,a)}t||(t=0,Array.prototype.forEach.call(e,n));var s=this!==o&&this||e[0],r=u.call(s,t),a=0;return Array.prototype.forEach.call(e,i),r},o.from=function b(e){return"string"==typeof e?n.call(this,e):i(this).from(e)};var g=o.Array=e("./bufferish-array"),_=o.Buffer=e("./bufferish-buffer"),p=o.Uint8Array=e("./bufferish-uint8array"),v=o.prototype=e("./bufferish-proto"),m=r("ArrayBuffer")},{"./buffer-global":2,"./bufferish-array":4,"./bufferish-buffer":5,"./bufferish-proto":6,"./bufferish-uint8array":7,isarray:34}],9:[function(e,t,n){function i(e){return this instanceof i?(this.options=e,void this.init()):new i(e)}function s(e,t){return e&&t?function n(){return e.apply(this,arguments),t.apply(this,arguments)}:e||t}function r(t){function n(e,t){return t(e)}return t=t.slice(),function(e){return t.reduce(n,e)}}function a(e){return new i(e)}var o=e("isarray");n.createCodec=a,n.install=function c(e){for(var t in e
)i.prototype[t]=s(i.prototype[t],e[t])},n.filter=function h(e){return o(e)?r(e):e};var u=e("./bufferish");i.prototype.init=function(){var e=this.options;return e&&e.uint8array&&(this.bufferish=u.Uint8Array),this},n.preset=a({preset:!0})},{"./bufferish":8,isarray:34}],10:[function(e,t,n){e("./read-core"),e("./write-core"),n.codec={preset:e("./codec-base").preset}},{"./codec-base":9,"./read-core":22,"./write-core":25}],11:[function(e,t,n){function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e).codec){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}n.DecodeBuffer=i;var s=e("./read-core").preset,r=e("./flex-buffer").FlexDecoder;r.mixin(i.prototype),i.prototype.codec=s,i.prototype.fetch=function(){return this.codec.decode(this)}},{"./flex-buffer":21,"./read-core":22}],12:[function(e,t,n){n.decode=function s(e,t){var n=new i(t);return n.write(e),n.read()};var i=e("./decode-buffer").DecodeBuffer},{"./decode-buffer":11}],13:[function(e,t,n){function i(e){return this instanceof i?void r.call(this,e):new i(e)}n.Decoder=i;var s=e("event-lite"),r=e("./decode-buffer").DecodeBuffer;i.prototype=new r,s.mixin(i.prototype),i.prototype.decode=function(e){arguments.length&&this.write(e),this.flush()},i.prototype.push=function(e){this.emit("data",e)},i.prototype.end=function(e){this.decode(e),this.emit("end")}},{"./decode-buffer":11,"event-lite":31}],14:[function(e,t,n){function i(e){if(!(this instanceof i))return new i(e);if(e&&(this.options=e).codec){var t=this.codec=e.codec;t.bufferish&&(this.bufferish=t.bufferish)}}n.EncodeBuffer=i;var s=e("./write-core").preset,r=e("./flex-buffer").FlexEncoder;r.mixin(i.prototype),i.prototype.codec=s,i.prototype.write=function(e){this.codec.encode(this,e)}},{"./flex-buffer":21,"./write-core":25}],15:[function(e,t,n){n.encode=function s(e,t){var n=new i(t);return n.write(e),n.read()};var i=e("./encode-buffer").EncodeBuffer},{"./encode-buffer":14}],16:[function(e,t,n){function i(e){return this instanceof i?void r.call(this,e):new i(e)}n.Encoder=i;var s=e("event-lite"),r=e("./encode-buffer").EncodeBuffer;i.prototype=new r,s.mixin(i.prototype),i.prototype.encode=function(e){this.write(e),this.emit("data",this.read())},i.prototype.end=function(e){arguments.length&&this.encode(e),this.flush(),this.emit("end")}},{"./encode-buffer":14,"event-lite":31}],17:[function(e,t,n){n.ExtBuffer=function s(e,t){return this instanceof s?(this.buffer=i.from(e),void(this.type=t)):new s(e,t)};var i=e("./bufferish")},{"./bufferish":8}],18:[function(t,e,n){function i(e){return o||(o=t("./encode").encode),o(e)}function s(e){return e.valueOf()}function r(e){(e=RegExp.prototype.toString.call(e).split("/")).shift();var t=[e.pop()];return t.unshift(e.join("/")),t}function a(e){var t={};for(var n in d)t[n]=e[n];return t}n.setExtPackers=function l(e){e.addExtPacker(14,Error,[a,i]),e.addExtPacker(1,EvalError,[a,i]),e.addExtPacker(2,RangeError,[a,i]),e.addExtPacker(3,ReferenceError,[a,i]),e.addExtPacker(4,SyntaxError,[a,i]),e.addExtPacker(5,TypeError,[a,i]),e.addExtPacker(6,URIError,[a,i]),e.addExtPacker(10,RegExp,[r,i]),e.addExtPacker(11,Boolean,[s,i]),e.addExtPacker(12,String,[s,i]),e.addExtPacker(13,Date,[Number,i]),e.addExtPacker(15,Number,[s,i]),"undefined"!=typeof Uint8Array&&(e.addExtPacker(17,Int8Array,h),e.addExtPacker(18,Uint8Array,h),e.addExtPacker(19,Int16Array,h),e.addExtPacker(20,Uint16Array,h),e.addExtPacker(21,Int32Array,h),e.addExtPacker(22,Uint32Array,h),e.addExtPacker(23,Float32Array,h),"undefined"!=typeof Float64Array&&e.addExtPacker(24,Float64Array,h),"undefined"!=typeof Uint8ClampedArray&&e.addExtPacker(25,Uint8ClampedArray,h),e.addExtPacker(26,ArrayBuffer,h),e.addExtPacker(29,DataView,h)),u.hasBuffer&&e.addExtPacker(27,c,u.from)};var o,u=t("./bufferish"),c=u.global,h=u.Uint8Array.from,d={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./encode":15}],19:[function(t,e,n){function i(e){return u||(u=t("./decode").decode),u(e)}function s(e){return RegExp.apply(null,e)}function r(i){return function(e){var t=new i;for(var n in d)t[n]=e[n];return t}}function a(t){return function(e){return new t(e)}}function o(e){return new Uint8Array(e).buffer}n.setExtUnpackers=function l(e){e.addExtUnpacker(14,[i,r(Error)]),e.addExtUnpacker(1,[i,r(EvalError)]),e.addExtUnpacker(2,[i,r(RangeError)]),e.addExtUnpacker(3,[i,r(ReferenceError)]),e.addExtUnpacker(4,[i,r(SyntaxError)]),e.addExtUnpacker(5,[i,r(TypeError)]),e.addExtUnpacker(6,[i,r(URIError)]),e.addExtUnpacker(10,[i,s]),e.addExtUnpacker(11,[i,a(Boolean)]),e.addExtUnpacker(12,[i,a(String)]),e.addExtUnpacker(13,[i,a(Date)]),e.addExtUnpacker(15,[i,a(Number)]),"undefined"!=typeof Uint8Array&&(e.addExtUnpacker(17,a(Int8Array)),e.addExtUnpacker(18,a(Uint8Array)),e.addExtUnpacker(19,[o,a(Int16Array)]),e.addExtUnpacker(20,[o,a(Uint16Array)]),e.addExtUnpacker(21,[o,a(Int32Array)]),e.addExtUnpacker(22,[o,a(Uint32Array)]),e.addExtUnpacker(23,[o,a(Float32Array)]),"undefined"!=typeof Float64Array&&e.addExtUnpacker(24,[o,a(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&e.addExtUnpacker(25,a(Uint8ClampedArray)),e.addExtUnpacker(26,o),e.addExtUnpacker(29,[o,a(DataView)])),c.hasBuffer&&e.addExtUnpacker(27,a(h))};var u,c=t("./bufferish"),h=c.global,d={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1}},{"./bufferish":8,"./decode":12}],20:[function(e,t,n){e("./read-core"),e("./write-core"),n.createCodec=e("./codec-base").createCodec},{"./codec-base":9,"./read-core":22,"./write-core":25}],21:[function(e,t,n){function i(){if(!(this instanceof i))return new i}function s(){if(!(this instanceof s))return new s}function r(){throw new Error("method not implemented: write()")}function a(){throw new Error("method not implemented: fetch()")}function o(){var e=this.buffers&&this.buffers.length;return e?(this.flush(),this.pull()):this.fetch()}function u(e){var t=this.buffers||(this.buffers=[]);t.push(e)}function c(){var e=this.buffers||(this.buffers=[]);return e.shift()}function h(n){return function i(e){for(var t in n)e[t]=n[t];return e}}n.FlexDecoder=i,n.FlexEncoder=s;var d=e("./bufferish"),l="BUFFER_SHORTAGE";i.mixin=h(function f(){function e(e){var t=this.offset?d.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=t?e?this.bufferish.concat([t,e]):t:e,this.offset=0}function t(){for(;this.offset<this.buffer.length;){var e,t=this.offset;try{e=this.fetch()}catch(e){if(e&&e.message!=l)throw e;this.offset=t;break}this.push(e)}}function n(e){var t=this.offset,n=t+e;if(n>this.buffer.length)throw new Error(l);return this.offset=n,t}return{bufferish:d,write:e,fetch:a,flush:t,push:u,pull:c,read:o,reserve:n,offset:0}}()),i.mixin(i.prototype),s.mixin=h(function g(){function e(){var e=this.start;if(e<this.offset){var t=this.start=this.offset;return d.prototype.slice.call(this.buffer,e,t)}}function t(){for(;this.start<this.offset;){var e=this.fetch();e&&this.push(e)}}function n(){var e=this.buffers||(this.buffers=[]),t=1<e.length?this.bufferish.concat(e):e[0];return e.length=0,t}function i(e){var t=0|e;if(this.buffer){var n=this.buffer.length,i=0|this.offset,s=i+t;if(s<n)return this.offset=s,i;this.flush(),e=Math.max(e,Math.min(2*n,this.maxBufferSize))}return e=Math.max(e,this.minBufferSize),this.buffer=this.bufferish.alloc(e),this.start=0,this.offset=t,0}function s(e){var t=e.length;if(t>this.minBufferSize)this.flush(),this.push(e);else{var n=this.reserve(t);d.prototype.copy.call(e,this.buffer,n)}}return{bufferish:d,write:r,fetch:e,flush:t,push:u,pull:n,read:o,reserve:i,send:s,maxBufferSize:65536,minBufferSize:2048,offset:0,start:0}}()),s.mixin(s.prototype)},{"./bufferish":8}],22:[function(e,t,n){function i(){var e=this.options;return this.decode=function n(e){function t(e){var t=a(e),n=i[t];if(!n)throw new Error("Invalid type: "+(t?"0x"+t.toString(16):t));return n(e)}var i=o.getReadToken(e);return t}(e),e&&e.preset&&r.setExtUnpackers(this),this}var s=e("./ext-buffer").ExtBuffer,r=e("./ext-unpacker"),a=e("./read-format").readUint8,o=e("./read-token"),u=e("./codec-base");u.install({addExtUnpacker:function c(e,t){(this.extUnpackers||(this.extUnpackers=[]))[e]=u.filter(t)},getExtUnpacker:function h(t){function e(e){return new s(e,t)}return(this.extUnpackers||(this.extUnpackers=[]))[t]||e},init:i}),n.preset=i.call(u.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-unpacker":19,"./read-format":23,"./read-token":24}],23:[function(e,t,n){function i(e,t){var n,i={},s=new Array(t),r=new Array(t),a=e.codec.decode;for(n=0;n<t;n++)s[n]=a(e),r[n]=a(e);for(n=0;n<t;n++)i[s[n]]=r[n];return i}function s(e,t){var n,i=new Map,s=new Array(t),r=new Array(t),a=e.codec.decode;for(n=0;n<t;n++)s[n]=a(e),r[n]=a(e);for(n=0;n<t;n++)i.set(s[n],r[n]);return i}function r(e,t){for(var n=new Array(t),i=e.codec.decode,s=0;s<t;s++)n[s]=i(e);return n}function a(e,t){var n=e.reserve(t),i=n+t;return D.toString.call(e.buffer,"utf-8",n,i)}function o(e,t){var n=e.reserve(t),i=n+t,s=D.slice.call(e.buffer,n,i);return T.from(s)}function u(e,t){var n=e.reserve(t),i=n+t,s=D.slice.call(e.buffer,n,i);return T.Uint8Array.from(s).buffer}function c(e,t){var n=e.reserve(t+1),i=e.buffer[n++],s=n+t,r=e.codec.getExtUnpacker(i);if(!r)throw new Error("Invalid ext type: "+(i?"0x"+i.toString(16):i));var a=D.slice.call(e.buffer,n,s);return r(a)}function h(e){var t=e.reserve(1);return e.buffer[t]}function d(e){var t=e.reserve(1),n=e.buffer[t];return 128&n?n-256:n}function l(e){var t=e.reserve(2),n=e.buffer;return n[t++]<<8|n[t]}function f(e){var t=e.reserve(2),n=e.buffer,i=n[t++]<<8|n[t];return 32768&i?i-65536:i}function g(e){var t=e.reserve(4),n=e.buffer;return 16777216*n[t++]+(n[t++]<<16)+(n[t++]<<8)+n[t]}function _(e){var t=e.reserve(4),n=e.buffer;return n[t++]<<24|n[t++]<<16|n[t++]<<8|n[t]}function p(n,i){return function(e){var t=e.reserve(n);return i.call(e.buffer,t,F)}}function v(e){return new C(this,e).toNumber()}function m(e){return new M(this,e).toNumber()}function y(e){return new C(this,e)}function w(e){return new M(this,e)}function b(e){return E.read(this,e,!1,23,4)}function S(e){return E.read(this,e,!1,52,8)}var E=e("ieee754"),k=e("int64-buffer"),C=k.Uint64BE,M=k.Int64BE;n.getReadFormat=function A(e){var t=T.hasArrayBuffer&&e&&e.binarraybuffer,n=e&&e.int64;return{map:x&&e&&e.usemap?s:i,array:r,str:a,bin:t?u:o,ext:c,uint8:h,uint16:l,uint32:g,uint64:p(8,n?y:v),int8:d,int16:f,int32:_,int64:p(8,n?w:m),float32:p(4,b),float64:p(8,S)}},n.readUint8=h;var T=e("./bufferish"),D=e("./bufferish-proto"),x="undefined"!=typeof Map,F=!0},{"./bufferish":8,"./bufferish-proto":6,ieee754:32,"int64-buffer":33}],24:[function(e,t,n){function i(e){var t,n=new Array(256);for(t=0;t<=127;t++)n[t]=r(t);for(t=128;t<=143;t++)n[t]=o(t-128,e.map);for(t=144;t<=159;t++)n[t]=o(t-144,e.array);for(t=160;t<=191;t++)n[t]=o(t-160,e.str);for(n[192]=r(null),n[193]=null,n[194]=r(!1),n[195]=r(!0),n[196]=a(e.uint8,e.bin),n[197]=a(e.uint16,e.bin),n[198]=a(e.uint32,e.bin),n[199]=a(e.uint8,e.ext),n[200]=a(e.uint16,e.ext),n[201]=a(e.uint32,e.ext),n[202]=e.float32,n[203]=e.float64,n[204]=e.uint8,n[205]=e.uint16,n[206]=e.uint32,n[207]=e.uint64,n[208]=e.int8,n[209]=e.int16,n[210]=e.int32,n[211]=e.int64,n[212]=o(1,e.ext),n[213]=o(2,e.ext),n[214]=o(4,e.ext),n[215]=o(8,e.ext),n[216]=o(16,e.ext),n[217]=a(e.uint8,e.str),n[218]=a(e.uint16,e.str),n[219]=a(e.uint32,e.str),n[220]=a(e.uint16,e.array),n[221]=a(e.uint32,e.array),n[222]=a(e.uint16,e.map),n[223]=a(e.uint32,e.map),t=224;t<=255;t++)n[t]=r(t-256);return n}function s(e){var t,n=i(e).slice();for(n[217]=n[196],n[218]=n[197],n[219]=n[198],t=160;t<=191;t++)n[t]=o(t-160,e.bin);return n}function r(e){return function(){return e}}function a(n,i){return function(e){var t=n(e);return i(e,t)}}function o(t,n){return function(e){return n(e,t)}}var u=e("./read-format");n.getReadToken=function c(e){var t=u.getReadFormat(e);return e&&e.useraw?s(t):i(t)}},{"./read-format":23}],25:[function(e,t,n){function i(){var e=this.options;return this.encode=function n(e){function t(e,t){var n=i["undefined"==typeof t?"undefined":de(t)];if(!n)throw new Error('Unsupported type "'+("undefined"==typeof t?"undefined":de(t))+'": '+t);n(e,t)}var i=r.getWriteType(e);return t}(e),e&&e.preset&&s.setExtPackers(this),this}var o=e("./ext-buffer").ExtBuffer,s=e("./ext-packer"),r=e("./write-type"),u=e("./codec-base");u.install({addExtPacker:function c(t,e,n){function i(e){return n&&(e=n(e)),new o(e,t)}n=u.filter(n);var s=e.name;if(s&&"Object"!==s){var r=this.extPackers||(this.extPackers={});r[s]=i}else{var a=this.extEncoderList||(this.extEncoderList=[]);a.unshift([e,i])}},getExtPacker:function h(e){var t=this.extPackers||(this.extPackers={}),n=e.constructor,i=n&&n.name&&t[n.name];if(i)return i;for(var s=this.extEncoderList||(this.extEncoderList=[]),r=s.length,a=0;a<r;a++){var o=s[a];if(n===o[0])return o[1]}},init:i}),n.preset=i.call(u.preset)},{"./codec-base":9,"./ext-buffer":17,"./ext-packer":18,"./write-type":27}],26:[function(e,t,n){function i(){var e=p.slice();return e[196]=s(196),e[197]=r(197),e[198]=a(198),e[199]=s(199),e[200]=r(200),e[201]=a(201),e[202]=o(202,4,b.writeFloatBE||h,!0),e[203]=o(203,8,b.writeDoubleBE||d,!0),e[204]=s(204),e[205]=r(205),e[206]=a(206),e[207]=o(207,8,u),e[208]=s(208),e[209]=r(209),e[210]=a(210),e[211]=o(211,8,c),e[217]=s(217),e[218]=r(218),e[219]=a(219),e[220]=r(220),e[221]=a(221),e[222]=r(222),e[223]=a(223),e}function s(s){return function(e,t){var n=e.reserve(2),i=e.buffer;i[n++]=s,i[n]=t}}function r(s){return function(e,t){var n=e.reserve(3),i=e.buffer;i[n++]=s,i[n++]=t>>>8,i[n]=t}}function a(s){return function(e,t){var n=e.reserve(5),i=e.buffer;i[n++]=s,i[n++]=t>>>24,i[n++]=t>>>16,i[n++]=t>>>8,i[n]=t}}function o(i,s,r,a){return function(e,t){var n=e.reserve(s+1);e.buffer[n++]=i,r.call(e.buffer,t,n,a)}}function u(e,t){new g(this,t,e)}function c(e,t){new _(this,t,e)}function h(e,t){l.write(this,e,t,!1,23,4)}function d(e,t){l.write(this,e,t,!1,52,8)}var l=e("ieee754"),f=e("int64-buffer"),g=f.Uint64BE,_=f.Int64BE,p=e("./write-uint8").uint8,v=e("./bufferish"),m=v.global,y=v.hasBuffer&&"TYPED_ARRAY_SUPPORT"in m,w=y&&!m.TYPED_ARRAY_SUPPORT,b=v.hasBuffer&&m.prototype||{};n.getWriteToken=function S(e){return e&&e.uint8array?((n=i())[202]=o(202,4,h),n[203]=o(203,8,d),n):w||v.hasBuffer&&e&&e.safe?((t=p.slice())[196]=o(196,1,m.prototype.writeUInt8),t[197]=o(197,2,m.prototype.writeUInt16BE),t[198]=o(198,4,m.prototype.writeUInt32BE),t[199]=o(199,1,m.prototype.writeUInt8),t[200]=o(200,2,m.prototype.writeUInt16BE),t[201]=o(201,4,m.prototype.writeUInt32BE),t[202]=o(202,4,m.prototype.writeFloatBE),t[203]=o(203,8,m.prototype.writeDoubleBE),t[204]=o(204,1,m.prototype.writeUInt8),t[205]=o(205,2,m.prototype.writeUInt16BE),t[206]=o(206,4,m.prototype.writeUInt32BE),t[207]=o(207,8,u),t[208]=o(208,1,m.prototype.writeInt8),t[209]=o(209,2,m.prototype.writeInt16BE),t[210]=o(210,4,m.prototype.writeInt32BE),t[211]=o(211,8,c),t[217]=o(217,1,m.prototype.writeUInt8),t[218]=o(218,2,m.prototype.writeUInt16BE),t[219]=o(219,4,m.prototype.writeUInt32BE),t[220]=o(220,2,m.prototype.writeUInt16BE),t[221]=o(221,4,m.prototype.writeUInt32BE),t[222]=o(222,2,m.prototype.writeUInt16BE),t[223]=o(223,4,m.prototype.writeUInt32BE),t):i();var t,n}},{"./bufferish":8,"./write-uint8":28,ieee754:32,"int64-buffer":33}],27:[function(e,t,n){var w=e("isarray"),i=e("int64-buffer"),b=i.Uint64BE,S=i.Int64BE,E=e("./bufferish"),k=e("./bufferish-proto"),C=e("./write-token"),M=e("./write-uint8").uint8,T=e("./ext-buffer").ExtBuffer,D="undefined"!=typeof Uint8Array,x="undefined"!=typeof Map,F=[];F[1]=212,F[2]=213,F[4]=214,F[8]=215,F[16]=216,n.getWriteType=function A(e){function t(e,t){g[t?195:194](e,t)}function n(e,t){var n=0|t;return t!==n?void g[203](e,t):void g[-32<=n&&n<=127?255&n:0<=n?n<=255?204:n<=65535?205:206:-128<=n?208:-32768<=n?209:210](e,n)}function i(e){return e<32?1:e<=255?2:e<=65535?3:5}function s(e){return e<32?1:e<=65535?3:5}function r(h){function e(e,t){var n=t.length,i=5+3*n;e.offset=e.reserve(i);var s=e.buffer,r=h(n),a=e.offset+r;n=k.write.call(s,t,a);var o=h(n);if(r!==o){var u=a+o-r,c=a+n;k.copy.call(s,s,u,a,c)}g[1===o?160+n:o<=3?215+o:219](e,n),e.offset+=n}return e}function a(e,t){if(null===t)return l(e,t);if(v(t))return m(e,t);if(w(t))return f(e,t);if(b.isUint64BE(t))return n=e,i=t,void g[207](n,i.toArray());var n,i,s,r;if(S.isInt64BE(t))return s=e,r=t,void g[211](s,r.toArray());var a,o,u,c,h,d=e.codec.getExtPacker(t);return d&&(t=d(t)),t instanceof T?(a=e,u=(o=t).buffer,c=u.length,h=F[c]||(c<255?199:c<=65535?200:201),g[h](a,c),M[o.type](a),void a.send(u)):void y(e,t)}function o(e,t){return v(t)?(n=e,s=(i=t).length,g[s<32?160+s:s<=65535?218:219](n,s),void n.send(i)):void a(e,t);var n,i,s}function l(e,t){g[192](e,t)}function f(e,t){var n=t.length;g[n<16?144+n:n<=65535?220:221](e,n);for(var i=e.codec.encode,s=0;s<n;s++)i(e,t[s])}function u(e,t){var n=t.length,i=n<255?196:n<=65535?197:198;g[i](e,n),e.send(t)}function c(e,t){u(e,new Uint8Array(t))}function h(t,n){var e=Object.keys(n),i=e.length,s=i<16?128+i:i<=65535?222:223;g[s](t,i);var r=t.codec.encode;e.forEach(function(e){r(t,e),r(t,n[e])})}function d(i,e){if(!(e instanceof Map))return h(i,e);var t=e.size;g[t<16?128+t:t<=65535?222:223](i,t);var s=i.codec.encode;e.forEach(function(e,t,n){s(i,t),s(i,e)})}var g=C.getWriteToken(e),_=e&&e.useraw,p=D&&e&&e.binarraybuffer,v=p?E.isArrayBuffer:E.isBuffer,m=p?c:u,y=x&&e&&e.usemap?d:h;return{"boolean":t,"function":l,number:n,object:_?o:a,string:r(_?s:i),symbol:l,undefined:l}}},{"./bufferish":8,"./bufferish-proto":6,"./ext-buffer":17,"./write-token":26,"./write-uint8":28,"int64-buffer":33,isarray:34}],28:[function(e,t,n){function i(n){return function(e){var t=e.reserve(1);e.buffer[t]=n}}for(var s=n.uint8=new Array(256),r=0;r<=255;r++)s[r]=i(r)},{}],29:[function(N,e,O){(function(e){function n(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=d.prototype:(null===e&&(e=new d(t)),e.length=t),e}function d(e,t,n){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(e,t,n);if("number"!=typeof e)return i(this,e,t,n);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return s(this,e)}function i(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function s(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),d.TYPED_ARRAY_SUPPORT?(e=t).__proto__=d.prototype:e=u(e,t),e}(e,t,n,i):"string"==typeof t?function r(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!d.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|h(t,n),s=(e=o(e,i)).write(t,n);return s!==i&&(e=e.slice(0,s)),e}(e,t,n):function a(e,t){if(d.isBuffer(t)){var n=0|c(t.length);return 0===(e=o(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function i(e){return e!=e}(t.length)?o(e,0):u(e,t);if("Buffer"===t.type&&U(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function r(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function s(e,t){if(r(t),e=o(e,t<0?0:0|c(t)),!d.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t){var n=t.length<0?0:0|c(t.length);e=o(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function c(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function h(e,t){if(d.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return D(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(i)return D(e).length;t=(""+t).toLowerCase(),i=!0}}function a(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function l(e,t,n,i,s){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(s)return-1;n=e.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof t&&(t=d.from(t,i)),d.isBuffer(t))return 0===t.length?-1:f(e,t,n,i,s);if("number"==typeof t)return t&=255,d.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):f(e,[t],n,i,s);throw new TypeError("val must be string, number or Buffer")}function f(e,t,n,i,s){function r(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}var a,o=1,u=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;u/=o=2,c/=2,n/=2}if(s){var h=-1;for(a=n;a<u;a++)if(r(e,a)===r(t,-1===h?0:a-h)){if(-1===h&&(h=a),a-h+1===c)return h*o}else-1!==h&&(a-=a-h),h=-1}else for(u<n+c&&(n=u-c),a=n;0<=a;a--){for(var d=!0,l=0;l<c;l++)if(r(e,a+l)!==r(t,l)){d=!1;break}if(d)return a}return-1}function _(e,t,n,i){n=Number(n)||0;var s=e.length-n;i?(i=Number(i),s<i&&(i=s)):i=s;var r=t.length;if(r%2!=0)throw new TypeError("Invalid hex string");r/2<i&&(i=r/2);for(var a=0;a<i;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[n+a]=o}return a}function p(e,t,n,i){return A(function s(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function g(e,t,n){n=Math.min(e.length,n);for(var i=[],s=t;s<n;){var r,a,o,u,c=e[s],h=null,d=239<c?4:223<c?3:191<c?2:1;if(s+d<=n)switch(d){case 1:c<128&&(h=c);break;case 2:128==(192&(r=e[s+1]))&&127<(u=(31&c)<<6|63&r)&&(h=u);break;case 3:r=e[s+1],a=e[s+2],128==(192&r)&&128==(192&a)&&2047<(u=(15&c)<<12|(63&r)<<6|63&a)&&(u<55296||57343<u)&&(h=u);break;case 4:r=e[s+1],a=e[s+2],o=e[s+3],128==(192&r)&&128==(192&a)&&128==(192&o)&&65535<(u=(15&c)<<18|(63&r)<<12|(63&a)<<6|63&o)&&u<1114112&&(h=u)}null===h?(h=65533,d=1):65535<h&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),s+=d}return function l(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=I));return n}(i)}function v(e,t,n){var i="";n=Math.min(e.length,n);for(var s=t;s<n;++s)i+=String.fromCharCode(127&e[s]);return i}function m(e,t,n){var i="";n=Math.min(e.length,n);for(var s=t;s<n;++s)i+=String.fromCharCode(e[s]);return i}function y(e,t,n){var i,s=e.length;(!t||t<0)&&(t=0),(!n||n<0||s<n)&&(n=s);for(var r="",a=t;a<n;++a)r+=(i=e[a])<16?"0"+i.toString(16):i.toString(16);return r}function w(e,t,n){for(var i=e.slice(t,n),s="",r=0;r<i.length;r+=2)s+=String.fromCharCode(i[r]+256*i[r+1]);return s}function b(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function S(e,t,n,i,s,r){if(!d.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(s<t||t<r)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function E(e,t,n,i){t<0&&(t=65535+t+1);for(var s=0,r=Math.min(e.length-n,2);s<r;++s)e[n+s]=(t&255<<8*(i?s:1-s))>>>8*(i?s:1-s)}function k(e,t,n,i){t<0&&(t=4294967295+t+1);for(var s=0,r=Math.min(e.length-n,4);s<r;++s)e[n+s]=t>>>8*(i?s:3-s)&255}function C(e,t,n,i,s,r){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,i,s){return s||C(e,0,n,4),P.write(e,t,n,i,23,4),n+4}function T(e,t,n,i,s){return s||C(e,0,n,8),P.write(e,t,n,i,52,8),n+8}function D(e,t){t=t||1/0;for(var n,i=e.length,s=null,r=[],a=0;a<i;++a){if(55295<(n=e.charCodeAt(a))&&n<57344){if(!s){if(56319<n){-1<(t-=3)&&r.push(239,191,189);continue}if(a+1===i){-1<(t-=3)&&r.push(239,191,189);continue}s=n;continue}if(n<56320){-1<(t-=3)&&r.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&-1<(t-=3)&&r.push(239,191,189);if(s=null,n<128){if((t-=1)<0)break;r.push(n)}else if(n<2048){if((t-=2)<0)break;r.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;r.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;r.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return r}function x(e,t){for(var n,i,s,r=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,s=n%256,r.push(s),r.push(i);return r}function F(e){return R.toByteArray(function n(e){if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(L,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,i){for(var s=0;s<i&&!(s+n>=t.length||s>=e.length);++s)t[s+n]=e[s];return s}var R=N("base64-js"),P=N("ieee754"),U=N("isarray");O.Buffer=d,O.SlowBuffer=function t(e){return+e!=e&&(e=0),d.alloc(+e)},O.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function B(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),O.kMaxLength=n(),d.poolSize=8192,d._augment=function(e){return e.__proto__=d.prototype,e},d.from=function(e,t,n){return i(null,e,t,n)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function(e,t,n){return function s(e,t,n,i){return r(t),t<=0?o(e,t):void 0!==n?"string"==typeof i?o(e,t).fill(n,i):o(e,t).fill(n):o(e,t)}(null,e,t,n)},d.allocUnsafe=function(e){return s(null,e)},d.allocUnsafeSlow=function(e){return s(null,e)},d.isBuffer=function(e){return!(null==e||!e._isBuffer)},d.compare=function(e,t){if(!d.isBuffer(e)||!d.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,s=0,r=Math.min(n,i);s<r;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0},d.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(e,t){if(!U(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return d.alloc(0);var n;if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;var i=d.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){var r=e[n];if(!d.isBuffer(r))throw new TypeError('"list" argument must be an Array of Buffers');r.copy(i,s),s+=r.length}return i},d.byteLength=h,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)a(this,t,t+1);return this},d.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)a(this,t,t+3),a(this,t+1,t+2);return this},d.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)a(this,t,t+7),a(this,t+1,t+6),a(this,t+2,t+5),a(this,t+3,t+4);return this},d.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?g(this,0,e):function o(e,t,n){var i,s,r,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return y(this,t,n);case"utf8":case"utf-8":return g(this,t,n);case"ascii":return v(this,t,n);case"latin1":case"binary":return m(this,t,n);case"base64":return i=this,r=n,0===(s=t)&&r===i.length?R.fromByteArray(i):R.fromByteArray(i.slice(s,r));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,t,n);default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}.apply(this,arguments)},d.prototype.equals=function(e){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===d.compare(this,e)},d.prototype.inspect=function(){var e="",t=O.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},d.prototype.compare=function(e,t,n,i,s){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===s&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(s<=i&&n<=t)return 0;if(s<=i)return-1;if(n<=t)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;for(var r=s-i,a=n-t,o=Math.min(r,a),u=this.slice(i,s),c=e.slice(t,n),h=0;h<o;++h)if(u[h]!==c[h]){r=u[h],a=c[h];break}return r<a?-1:a<r?1:0},d.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},d.prototype.indexOf=function(e,t,n){return l(this,e,t,n,!0)},d.prototype.lastIndexOf=function(e,t,n){return l(this,e,t,n,!1)},d.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var s,r,a,o,u,c,h,d,l,f=this.length-t;if((void 0===n||f<n)&&(n=f),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var g=!1;;)switch(i){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return d=t,l=n,A(D(e,(h=this).length-d),h,d,l);case"ascii":return p(this,e,t,n);case"latin1":case"binary":return p(this,e,t,n);case"base64":return o=this,u=t,c=n,A(F(e),o,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r=t,a=n,A(x(e,(s=this).length-r),s,r,a);default:if(g)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),g=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;d.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),d.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=d.prototype;else{var s=t-e;n=new d(s,void 0);for(var r=0;r<s;++r)n[r]=this[r+e]}return n},d.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||b(e,t,this.length);for(var i=this[e],s=1,r=0;++r<t&&(s*=256);)i+=this[e+r]*s;return i},d.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||b(e,t,this.length);for(var i=this[e+--t],s=1;0<t&&(s*=256);)i+=this[e+--t]*s;return i},d.prototype.readUInt8=function(e,t){return t||b(e,1,this.length),this[e]},d.prototype.readUInt16LE=function(e,t){return t||b(e,2,this.length),this[e]|this[e+1]<<8},d.prototype.readUInt16BE=function(e,t){return t||b(e,2,this.length),this[e]<<8|this[e+1]},d.prototype.readUInt32LE=function(e,t){return t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},d.prototype.readUInt32BE=function(e,t){return t||b(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},d.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||b(e,t,this.length);for(var i=this[e],s=1,r=0;++r<t&&(s*=256);)i+=this[e+r]*s;return(s*=128)<=i&&(i-=Math.pow(2,8*t)),i},d.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||b(e,t,this.length)
;for(var i=t,s=1,r=this[e+--i];0<i&&(s*=256);)r+=this[e+--i]*s;return(s*=128)<=r&&(r-=Math.pow(2,8*t)),r},d.prototype.readInt8=function(e,t){return t||b(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},d.prototype.readInt16LE=function(e,t){t||b(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt16BE=function(e,t){t||b(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt32LE=function(e,t){return t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},d.prototype.readInt32BE=function(e,t){return t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},d.prototype.readFloatLE=function(e,t){return t||b(e,4,this.length),P.read(this,e,!0,23,4)},d.prototype.readFloatBE=function(e,t){return t||b(e,4,this.length),P.read(this,e,!1,23,4)},d.prototype.readDoubleLE=function(e,t){return t||b(e,8,this.length),P.read(this,e,!0,52,8)},d.prototype.readDoubleBE=function(e,t){return t||b(e,8,this.length),P.read(this,e,!1,52,8)},d.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t|=0,n|=0,!i){var s=Math.pow(2,8*n)-1;S(this,e,t,n,s,0)}var r=1,a=0;for(this[t]=255&e;++a<n&&(r*=256);)this[t+a]=e/r&255;return t+n},d.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t|=0,n|=0,!i){var s=Math.pow(2,8*n)-1;S(this,e,t,n,s,0)}var r=n-1,a=1;for(this[t+r]=255&e;0<=--r&&(a*=256);)this[t+r]=e/a&255;return t+n},d.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,1,255,0),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},d.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):E(this,e,t,!0),t+2},d.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):E(this,e,t,!1),t+2},d.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):k(this,e,t,!0),t+4},d.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},d.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var s=Math.pow(2,8*n-1);S(this,e,t,n,s-1,-s)}var r=0,a=1,o=0;for(this[t]=255&e;++r<n&&(a*=256);)e<0&&0===o&&0!==this[t+r-1]&&(o=1),this[t+r]=(e/a>>0)-o&255;return t+n},d.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var s=Math.pow(2,8*n-1);S(this,e,t,n,s-1,-s)}var r=n-1,a=1,o=0;for(this[t+r]=255&e;0<=--r&&(a*=256);)e<0&&0===o&&0!==this[t+r+1]&&(o=1),this[t+r]=(e/a>>0)-o&255;return t+n},d.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,1,127,-128),d.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},d.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):E(this,e,t,!0),t+2},d.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):E(this,e,t,!1),t+2},d.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):k(this,e,t,!0),t+4},d.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||S(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),d.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},d.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},d.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},d.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},d.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},d.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),0<i&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var s,r=i-n;if(this===e&&n<t&&t<i)for(s=r-1;0<=s;--s)e[s+t]=this[s+n];else if(r<1e3||!d.TYPED_ARRAY_SUPPORT)for(s=0;s<r;++s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+r),t);return r},d.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var s=e.charCodeAt(0);s<256&&(e=s)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!d.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{var a=d.isBuffer(e)?e:D(new d(e,i).toString()),o=a.length;for(r=0;r<n-t;++r)this[r+t]=a[r%o]}return this};var L=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":30,ieee754:32,isarray:34}],30:[function(e,t,n){function c(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function u(e,t,n){for(var i,s=[],r=t;r<n;r+=3)i=(e[r]<<16)+(e[r+1]<<8)+e[r+2],s.push(h[(a=i)>>18&63]+h[a>>12&63]+h[a>>6&63]+h[63&a]);var a;return s.join("")}n.byteLength=function a(e){return 3*e.length/4-c(e)},n.toByteArray=function f(e){var t,n,i,s,r,a,o=e.length;r=c(e),a=new l(3*o/4-r),i=0<r?o-4:o;var u=0;for(n=t=0;t<i;t+=4,n+=3)s=d[e.charCodeAt(t)]<<18|d[e.charCodeAt(t+1)]<<12|d[e.charCodeAt(t+2)]<<6|d[e.charCodeAt(t+3)],a[u++]=s>>16&255,a[u++]=s>>8&255,a[u++]=255&s;return 2===r?(s=d[e.charCodeAt(t)]<<2|d[e.charCodeAt(t+1)]>>4,a[u++]=255&s):1===r&&(s=d[e.charCodeAt(t)]<<10|d[e.charCodeAt(t+1)]<<4|d[e.charCodeAt(t+2)]>>2,a[u++]=s>>8&255,a[u++]=255&s),a},n.fromByteArray=function g(e){for(var t,n=e.length,i=n%3,s="",r=[],a=0,o=n-i;a<o;a+=16383)r.push(u(e,a,o<a+16383?o:a+16383));return 1===i?(t=e[n-1],s+=h[t>>2],s+=h[t<<4&63],s+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],s+=h[t>>10],s+=h[t>>4&63],s+=h[t<<2&63],s+="="),r.push(s),r.join("")};for(var h=[],d=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,r=i.length;s<r;++s)h[s]=i[s],d[i.charCodeAt(s)]=s;d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},{}],31:[function(e,o,t){!function(e){function t(e){for(var t in n)e[t]=n[t];return e}function s(e,t){var n;if(arguments.length){if(t){if(n=c(this,e,!0)){if(!(n=n.filter(function i(e){return e!==t&&e.originalListener!==t})).length)return s.call(this,e);this[r][e]=n}}else if((n=this[r])&&(delete n[e],!Object.keys(n).length))return s.call(this)}else delete this[r];return this}function c(e,t,n){if(!n||e[r]){var i=e[r]||(e[r]={});return i[t]||(i[t]=[])}}"undefined"!=typeof o&&(o.exports=e);var r="listeners",n={on:function i(e,t){return c(this,e).push(t),this},once:function a(e,t){function n(){s.call(i,e,n),t.apply(this,arguments)}var i=this;return n.originalListener=t,c(i,e).push(n),i},off:s,emit:function h(e,t){function n(e){e.call(r)}function i(e){e.call(r,t)}function s(e){e.apply(r,u)}var r=this,a=c(r,e,!0);if(!a)return!1;var o=arguments.length;if(1===o)a.forEach(n);else if(2===o)a.forEach(i);else{var u=Array.prototype.slice.call(arguments,1);a.forEach(s)}return!!a.length}};t(e.prototype),e.mixin=t}(function n(){if(!(this instanceof n))return new n})},{}],32:[function(e,t,n){n.read=function(e,t,n,i,s){var r,a,o=8*s-i-1,u=(1<<o)-1,c=u>>1,h=-7,d=n?s-1:0,l=n?-1:1,f=e[t+d];for(d+=l,r=f&(1<<-h)-1,f>>=-h,h+=o;0<h;r=256*r+e[t+d],d+=l,h-=8);for(a=r&(1<<-h)-1,r>>=-h,h+=i;0<h;a=256*a+e[t+d],d+=l,h-=8);if(0===r)r=1-c;else{if(r===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),r-=c}return(f?-1:1)*a*Math.pow(2,r-i)},n.write=function(e,t,n,i,s,r){var a,o,u,c=8*r-s-1,h=(1<<c)-1,d=h>>1,l=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:r-1,g=i?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),2<=(t+=1<=a+d?l/u:l*Math.pow(2,1-d))*u&&(a++,u/=2),h<=a+d?(o=0,a=h):1<=a+d?(o=(t*u-1)*Math.pow(2,s),a+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,s),a=0));8<=s;e[n+f]=255&o,f+=g,o/=256,s-=8);for(a=a<<s|o,c+=s;0<c;e[n+f]=255&a,f+=g,a/=256,c-=8);e[n+f-g]|=128*_}},{}],33:[function(e,t,n){(function(s){!function(w){function e(e,t,u){function s(e,t,n,i){return this instanceof s?function a(e,t,n,i,s){if(U&&I&&(t instanceof I&&(t=new U(t)),i instanceof I&&(i=new U(i))),t||n||i||A){if(!k(t,n)){var r=A||Array;s=n,i=t,n=0,t=new r(8)}e.buffer=t,e.offset=n|=0,R!==("undefined"==typeof i?"undefined":de(i))&&("string"==typeof i?function h(e,t,n,i){var s=0,r=n.length,a=0,o=0;"-"===n[0]&&s++;for(var u=s;s<r;){var c=parseInt(n[s++],i);if(!(0<=c))break;o=o*i+c,a=a*i+Math.floor(o/B),o%=B}u&&(a=~a,o?o=B-o:a++),d(e,t+l,a),d(e,t+f,o)}(t,n,i,s||10):k(i,s)?C(t,n,i,s):"number"==typeof s?(d(t,n+l,i),d(t,n+f,s)):0<i?g(t,n,i):i<0?_(t,n,i):C(t,n,L,0))}else e.buffer=M(L,0)}(this,e,t,n,i):new s(e,t,n,i)}function n(){var e=this.buffer,t=this.offset,n=c(e,t+l),i=c(e,t+f);return u||(n|=0),n?n*B+i:i}function d(e,t,n){e[t+o]=255&n,n>>=8,e[t+a]=255&n,n>>=8,e[t+r]=255&n,n>>=8,e[t+i]=255&n}function c(e,t){return 16777216*e[t+i]+(e[t+r]<<16)+(e[t+a]<<8)+e[t+o]}var l=t?0:4,f=t?4:0,i=t?0:3,r=t?1:2,a=t?2:1,o=t?3:0,g=t?T:x,_=t?D:F,h=s.prototype,p="is"+e,v="_"+p;return h.buffer=void 0,h.offset=0,h[v]=!0,h.toNumber=n,h.toString=function m(e){var t=this.buffer,n=this.offset,i=c(t,n+l),s=c(t,n+f),r="",a=!u&&2147483648&i;for(a&&(i=~i,s=B-s),e=e||10;;){var o=i%e*B+s;if(i=Math.floor(i/e),s=Math.floor(o/e),r=(o%e).toString(e)+r,!i&&!s)break}return a&&(r="-"+r),r},h.toJSON=n,h.toArray=b,P&&(h.toBuffer=S),U&&(h.toArrayBuffer=E),s[p]=function y(e){return!(!e||!e[v])},w[e]=s}function b(e){var t=this.buffer,n=this.offset;return A=null,!1!==e&&0===n&&8===t.length&&i(t)?t:M(t,n)}function S(e){var t=this.buffer,n=this.offset;if(A=P,!1!==e&&0===n&&8===t.length&&s.isBuffer(t))return t;var i=new P(8);return C(i,0,t,n),i}function E(e){var t=this.buffer,n=this.offset,i=t.buffer;if(A=U,!1!==e&&0===n&&i instanceof I&&8===i.byteLength)return i;var s=new U(8);return C(s,0,t,n),s.buffer}function k(e,t){var n=e&&e.length;return t|=0,n&&t+8<=n&&"string"!=typeof e[t]}function C(e,t,n,i){t|=0,i|=0;for(var s=0;s<8;s++)e[t++]=255&n[i++]}function M(e,t){return Array.prototype.slice.call(e,t,t+8)}function T(e,t,n){for(var i=t+8;t<i;)e[--i]=255&n,n/=256}function D(e,t,n){var i=t+8;for(n++;t<i;)e[--i]=255&-n^255,n/=256}function x(e,t,n){for(var i=t+8;t<i;)e[t++]=255&n,n/=256}function F(e,t,n){var i=t+8;for(n++;t<i;)e[t++]=255&-n^255,n/=256}var A,R="undefined",P=R!==("undefined"==typeof s?"undefined":de(s))&&s,U=R!==("undefined"==typeof Uint8Array?"undefined":de(Uint8Array))&&Uint8Array,I=R!==("undefined"==typeof ArrayBuffer?"undefined":de(ArrayBuffer))&&ArrayBuffer,L=[0,0,0,0,0,0,0,0],i=Array.isArray||function t(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},B=4294967296;e("Uint64BE",!0,!0),e("Int64BE",!0,!1),e("Uint64LE",!1,!0),e("Int64LE",!1,!1)}("object"==("undefined"==typeof n?"undefined":de(n))&&"string"!=typeof n.nodeName?n:this||{})}).call(this,e("buffer").Buffer)},{buffer:29}],34:[function(e,t,n){var i={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},{}]},{},[1])(1)}(),function(e){("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=function h(r,a,o){function u(n,e){if(!a[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var s=a[n]={exports:{}};r[n][0].call(s.exports,function(e){var t=r[n][1][e];return u(t||e)},s,s.exports,h,r,a,o)}return a[n].exports}for(var c="function"==typeof require&&require,e=0;e<o.length;e++)u(o[e]);return u}({1:[function(e,t,n){var a=e("./zlib/deflate"),o=e("./utils/common"),u=e("./utils/strings"),s=e("./zlib/messages"),r=e("./zlib/zstream"),c=Object.prototype.toString,h=0,d=-1,l=0,f=8;function g(e){if(!(this instanceof g))return new g(e);this.options=o.assign({level:d,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var n=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==h)throw new Error(s[n]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?u.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=a.deflateSetDictionary(this.strm,i))!==h)throw new Error(s[n]);this._dict_set=!0}}function i(e,t){var n=new g(t);if(n.push(e,!0),n.err)throw n.msg||s[n.err];return n.result}g.prototype.push=function(e,t){var n,i,s=this.strm,r=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=u.string2buf(e):"[object ArrayBuffer]"===c.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(r),s.next_out=0,s.avail_out=r),1!==(n=a.deflate(s,i))&&n!==h)return this.onEnd(n),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(u.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==n);return 4===i?(n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===h):2!==i||(this.onEnd(h),!(s.avail_out=0))},g.prototype.onData=function(e){this.chunks.push(e)},g.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=g,n.deflate=i,n.deflateRaw=function _(e,t){return(t=t||{}).raw=!0,i(e,t)},n.gzip=function p(e,t){return(t=t||{}).gzip=!0,i(e,t)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(e,t,n){var l=e("./zlib/inflate"),f=e("./utils/common"),g=e("./utils/strings"),_=e("./zlib/constants"),i=e("./zlib/messages"),s=e("./zlib/zstream"),r=e("./zlib/gzheader"),p=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=l.inflateInit2(this.strm,t.windowBits);if(n!==_.Z_OK)throw new Error(i[n]);this.header=new r,l.inflateGetHeader(this.strm,this.header)}function o(e,t){var n=new a(t);if(n.push(e,!0),n.err)throw n.msg||i[n.err];return n.result}a.prototype.push=function(e,t){var n,i,s,r,a,o,u=this.strm,c=this.options.chunkSize,h=this.options.dictionary,d=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?_.Z_FINISH:_.Z_NO_FLUSH,"string"==typeof e?u.input=g.binstring2buf(e):"[object ArrayBuffer]"===p.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new f.Buf8(c),u.next_out=0,u.avail_out=c),(n=l.inflate(u,_.Z_NO_FLUSH))===_.Z_NEED_DICT&&h&&(o="string"==typeof h?g.string2buf(h):"[object ArrayBuffer]"===p.call(h)?new Uint8Array(h):h,n=l.inflateSetDictionary(this.strm,o)),n===_.Z_BUF_ERROR&&!0===d&&(n=_.Z_OK,d=!1),n!==_.Z_STREAM_END&&n!==_.Z_OK)return this.onEnd(n),!(this.ended=!0);u.next_out&&(0!==u.avail_out&&n!==_.Z_STREAM_END&&(0!==u.avail_in||i!==_.Z_FINISH&&i!==_.Z_SYNC_FLUSH)||("string"===this.options.to?(s=g.utf8border(u.output,u.next_out),r=u.next_out-s,a=g.buf2string(u.output,s),u.next_out=r,u.avail_out=c-r,r&&f.arraySet(u.output,u.output,s,r,0),this.onData(a)):this.onData(f.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(d=!0)}while((0<u.avail_in||0===u.avail_out)&&n!==_.Z_STREAM_END);return n===_.Z_STREAM_END&&(i=_.Z_FINISH),i===_.Z_FINISH?(n=l.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===_.Z_OK):i!==_.Z_SYNC_FLUSH||(this.onEnd(_.Z_OK),!(u.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===_.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=a,n.inflate=o,n.inflateRaw=function u(e,t){return(t=t||{}).raw=!0,o(e,t)},n.ungzip=o},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t,n,i=Array.prototype.slice.call(arguments,1);i.length;){var s=i.shift();if(s){if("object"!==("undefined"==typeof s?"undefined":de(s)))throw new TypeError(s+"must be non-object");for(var r in s)t=s,n=r,Object.prototype.hasOwnProperty.call(t,n)&&(e[r]=s[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),s);else for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){var t,n,i,s,r,a;for(t=i=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),t=s=0,n=e.length;t<n;t++)r=e[t],a.set(r,s),s+=r.length;return a}},r={arraySet:function(e,t,n,i,s){for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,s)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(i)},{}],4:[function(e,t,n){var u=e("./common"),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(a){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){r=!1}for(var c=new u.Buf8(256),i=0;i<256;i++)c[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function h(e,t){if(t<65537&&(e.subarray&&r||!e.subarray&&s))return String.fromCharCode.apply(null,u.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}c[254]=c[254]=1,n.string2buf=function(e){var t,n,i,s,r,a=e.length,o=0;for(s=0;s<a;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new u.Buf8(o),s=r=0;r<o;s++)55296==(64512&(n=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),t[r++]=n<128?n:(t[r++]=n<2048?192|n>>>6:(t[r++]=n<65536?224|n>>>12:(t[r++]=240|n>>>18,128|n>>>12&63),128|n>>>6&63),128|63&n);return t},n.buf2binstring=function(e){return h(e,e.length)},n.binstring2buf=function(e){for(var t=new u.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,s,r,a=t||e.length,o=new Array(2*a);for(n=i=0;n<a;)if((s=e[n++])<128)o[i++]=s;else if(4<(r=c[s]))o[i++]=65533,n+=r-1;else{for(s&=2===r?31:3===r?15:7;1<r&&n<a;)s=s<<6|63&e[n++],r--;o[i++]=1<r?65533:s<65536?s:(s-=65536,o[i++]=55296|s>>10&1023,56320|1023&s)}return h(o,i)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+c[e[n]]>t?n:t}},{"./common":3}],5:[function(e,t,n){t.exports=function o(e,t,n,i){for(var s=65535&e|0,r=e>>>16&65535|0,a=0;0!==n;){for(n-=a=2e3<n?2e3:n;s=s+t[i++]|0,r=r+s|0,--a;);s%=65521,r%=65521}return s|r<<16|0}},{}],6:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(e,t,n){var o=function s(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function u(e,t,n,i){var s=o,r=i+n;e^=-1;for(var a=i;a<r;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},{}],8:[function(e,t,n){var c,l=e("../utils/common"),h=e("./trees"),f=e("./adler32"),g=e("./crc32"),i=e("./messages"),d=0,_=4,p=0,v=-2,u=-1,m=4,s=2,y=8,w=9,r=286,a=30,o=19,b=2*r+1,S=15,E=3,k=258,C=k+E+1,M=42,T=113,D=1,x=2,F=3,A=4;function R(e,t){return e.msg=i[t],t}function P(e){return(e<<1)-(4<e?9:0)}function U(e){for(var t=e.length;0<=--t;)e[t]=0}function I(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(l.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function L(e,t){h._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,I(e.strm)}function B(e,t){e.pending_buf[e.pending++]=t}function N(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function O(e,t){var n,i,s=e.max_chain_length,r=e.strstart,a=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-C?e.strstart-(e.w_size-C):0,c=e.window,h=e.w_mask,d=e.prev,l=e.strstart+k,f=c[r+a-1],g=c[r+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(n=t)+a]===g&&c[n+a-1]===f&&c[n]===c[r]&&c[++n]===c[r+1]){r+=2,n++;do{}while(c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&c[++r]===c[++n]&&r<l);if(i=k-(l-r),r=l-k,a<i){if(e.match_start=t,o<=(a=i))break;f=c[r+a-1],g=c[r+a]}}}while((t=d[t&h])>u&&0!=--s);return a<=e.lookahead?a:e.lookahead}function W(e){var t,n,i,s,r,a,o,u,c,h,d=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-C)){for(l.arraySet(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,n=e.hash_size,t=n;i=e.head[--t],e.head[t]=d<=i?i-d:0,--n;);for(t=n=d;i=e.prev[--t],e.prev[t]=d<=i?i-d:0,--n;);s+=d}if(0===e.strm.avail_in)break;if(a=e.strm,o=e.window,u=e.strstart+e.lookahead,c=s,h=void 0,h=a.avail_in,c<h&&(h=c),n=0===h?0:(a.avail_in-=h,l.arraySet(o,a.input,a.next_in,h,u),1===a.state.wrap?a.adler=f(a.adler,o,h,u):2===a.state.wrap&&(a.adler=g(a.adler,o,h,u)),a.next_in+=h,a.total_in+=h,h),e.lookahead+=n,e.lookahead+e.insert>=E)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[r+E-1])&e.hash_mask,e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<E)););}while(e.lookahead<C&&0!==e.strm.avail_in)}function Q(e,t){for(var n,i;;){if(e.lookahead<C){if(W(e),e.lookahead<C&&t===d)return D;if(0===e.lookahead)break}if(n=0,e.lookahead>=E&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+E-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-C&&(e.match_length=O(e,n)),e.match_length>=E)if(i=h._tr_tally(e,e.strstart-e.match_start,e.match_length-E),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=E){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+E-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=h._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(L(e,!1),0===e.strm.avail_out))return D}return e.insert=e.strstart<E-1?e.strstart:E-1,t===_?(L(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(L(e,!1),0===e.strm.avail_out)?D:x}function H(e,t){for(var n,i,s;;){if(e.lookahead<C){if(W(e),e.lookahead<C&&t===d)return D;if(0===e.lookahead)break}if(n=0,e.lookahead>=E&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+E-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=E-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-C&&(e.match_length=O(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===E&&4096<e.strstart-e.match_start)&&(e.match_length=E-1)),e.prev_length>=E&&e.match_length<=e.prev_length){for(s=e.strstart+e.lookahead-E,i=h._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-E),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+E-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=E-1,e.strstart++,i&&(L(e,!1),0===e.strm.avail_out))return D}else if(e.match_available){if((i=h._tr_tally(e,0,e.window[e.strstart-1]))&&L(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return D}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=h._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<E-1?e.strstart:E-1,t===_?(L(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(L(e,!1),0===e.strm.avail_out)?D:x}function q(e,t){for(var n,i,s,r,a=e.window;;){if(e.lookahead<=k){if(W(e),e.lookahead<=k&&t===d)return D;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=E&&0<e.strstart&&(s=e.strstart-1,(i=a[s])===a[++s]&&i===a[++s]&&i===a[++s])){r=e.strstart+k;do{}while(i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&s<r);e.match_length=k-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=E?(n=h._tr_tally(e,1,e.match_length-E),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=h._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(L(e,!1),0===e.strm.avail_out))return D}return e.insert=0,t===_?(L(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(L(e,!1),0===e.strm.avail_out)?D:x}function z(e,t){for(var n;;){if(0===e.lookahead&&(W(e),0===e.lookahead)){if(t===d)return D;break}if(e.match_length=0,n=h._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(L(e,!1),0===e.strm.avail_out))return D}return e.insert=0,t===_?(L(e,!0),0===e.strm.avail_out?F:A):e.last_lit&&(L(e,!1),0===e.strm.avail_out)?D:x}function j(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}function V(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*b),this.dyn_dtree=new l.Buf16(2*(2*a+1)),this.bl_tree=new l.Buf16(2*(2*o+1)),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(S+1),this.heap=new l.Buf16(2*r+1),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*r+1),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=s,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?M:T,e.adler=2===t.wrap?0:1,t.last_flush=d,h._tr_init(t),p):R(e,v)}function K(e){var t=Y(e);return t===p&&function n(e){e.window_size=2*e.w_size,U(e.head),e.max_lazy_match=c[e.level].max_lazy,e.good_match=c[e.level].good_length,e.nice_match=c[e.level].nice_length,e.max_chain_length=c[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=E-1,e.match_available=0,e.ins_h=0}(e.state),t}function G(e,t,n,i,s,r){if(!e)return v;var a=1;if(t===u&&(t=6),i<0?(a=0,i=-i):15<i&&(a=2,i-=16),s<1||w<s||n!==y||i<8||15<i||t<0||9<t||r<0||m<r)return R(e,v);8===i&&(i=9);var o=new V;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+E-1)/E),o.window=new l.Buf8(2*o.w_size),o.head=new l.Buf16(o.hash_size),o.prev=new l.Buf16(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new l.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=r,o.method=n,K(e)}c=[new j(0,0,0,0,function X(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(W(e),0===e.lookahead&&t===d)return D;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,L(e,!1),0===e.strm.avail_out))return D;if(e.strstart-e.block_start>=e.w_size-C&&(L(e,!1),0===e.strm.avail_out))return D}return e.insert=0,t===_?(L(e,!0),0===e.strm.avail_out?F:A):(e.strstart>e.block_start&&(L(e,!1),e.strm.avail_out),D)}),new j(4,4,8,4,Q),new j(4,5,16,8,Q),new j(4,6,32,32,Q),new j(4,4,16,16,H),new j(8,16,32,32,H),new j(8,16,128,128,H),new j(8,32,128,256,H),new j(32,128,258,1024,H),new j(32,258,258,4096,H)],n.deflateInit=function Z(e,t){return G(e,t,y,15,8,0)},n.deflateInit2=G,n.deflateReset=K,n.deflateResetKeep=Y,n.deflateSetHeader=function J(e,t){return e&&e.state&&2===e.state.wrap?(e.state.gzhead=t,p):v},n.deflate=function $(e,t){var n,i,s,r;if(!e||!e.state||5<t||t<0)return e?R(e,v):v;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==_)return R(e,0===e.avail_out?-5:v);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===M)if(2===i.wrap)e.adler=0,B(i,31),B(i,139),B(i,8),i.gzhead?(B(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),B(i,255&i.gzhead.time),B(i,i.gzhead.time>>8&255),B(i,i.gzhead.time>>16&255),B(i,i.gzhead.time>>24&255),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(B(i,255&i.gzhead.extra.length),B(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=g(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(B(i,0),B(i,0),B(i,0),B(i,0),B(i,0),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,3),i.status=T);else{var a=y+(i.w_bits-8<<4)<<8,o=-1;o=2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3,a|=o<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=T,N(i,a),0!==i.strstart&&(N(i,e.adler>>>16),N(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=g(e.adler,i.pending_buf,i.pending-s,s)),I(e),s=i.pending,i.pending!==i.pending_buf_size));)B(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++
;i.gzhead.hcrc&&i.pending>s&&(e.adler=g(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=g(e.adler,i.pending_buf,i.pending-s,s)),I(e),s=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,B(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>s&&(e.adler=g(e.adler,i.pending_buf,i.pending-s,s)),0===r&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=g(e.adler,i.pending_buf,i.pending-s,s)),I(e),s=i.pending,i.pending===i.pending_buf_size)){r=1;break}r=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,B(i,r)}while(0!==r);i.gzhead.hcrc&&i.pending>s&&(e.adler=g(e.adler,i.pending_buf,i.pending-s,s)),0===r&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&I(e),i.pending+2<=i.pending_buf_size&&(B(i,255&e.adler),B(i,e.adler>>8&255),e.adler=0,i.status=T)):i.status=T),0!==i.pending){if(I(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&P(t)<=P(n)&&t!==_)return R(e,-5);if(666===i.status&&0!==e.avail_in)return R(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==d&&666!==i.status){var u=2===i.strategy?z(i,t):3===i.strategy?q(i,t):c[i.level].func(i,t);if(u!==F&&u!==A||(i.status=666),u===D||u===F)return 0===e.avail_out&&(i.last_flush=-1),p;if(u===x&&(1===t?h._tr_align(i):5!==t&&(h._tr_stored_block(i,0,0,!1),3===t&&(U(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),I(e),0===e.avail_out))return i.last_flush=-1,p}return t!==_?p:i.wrap<=0?1:(2===i.wrap?(B(i,255&e.adler),B(i,e.adler>>8&255),B(i,e.adler>>16&255),B(i,e.adler>>24&255),B(i,255&e.total_in),B(i,e.total_in>>8&255),B(i,e.total_in>>16&255),B(i,e.total_in>>24&255)):(N(i,e.adler>>>16),N(i,65535&e.adler)),I(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?p:1)},n.deflateEnd=function ee(e){var t;return e&&e.state?(t=e.state.status)===M||69===t||73===t||91===t||103===t||t===T||666===t?(e.state=null,t===T?R(e,-3):p):R(e,v):v},n.deflateSetDictionary=function te(e,t){var n,i,s,r,a,o,u,c,h=t.length;if(!e||!e.state)return v;if(n=e.state,2===(r=n.wrap)||1===r&&n.status!==M||n.lookahead)return v;for(1===r&&(e.adler=f(e.adler,t,h,0)),n.wrap=0,h>=n.w_size&&(0===r&&(U(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new l.Buf8(n.w_size),l.arraySet(c,t,h-n.w_size,n.w_size,0),t=c,h=n.w_size),a=e.avail_in,o=e.next_in,u=e.input,e.avail_in=h,e.next_in=0,e.input=t,W(n);n.lookahead>=E;){for(i=n.strstart,s=n.lookahead-(E-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+E-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=E-1,W(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=E-1,n.match_available=0,e.next_in=o,e.input=u,e.avail_in=a,n.wrap=r,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(e,t,n){t.exports=function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(e,t,n){t.exports=function(e,t){var n,i,s,r,a,o,u,c,h,d,l,f,g,_,p,v,m,y,w,b,S,E,k,C,M;n=e.state,i=e.next_in,C=e.input,s=i+(e.avail_in-5),r=e.next_out,M=e.output,a=r-(t-e.avail_out),o=r+(e.avail_out-257),u=n.dmax,c=n.wsize,h=n.whave,d=n.wnext,l=n.window,f=n.hold,g=n.bits,_=n.lencode,p=n.distcode,v=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{g<15&&(f+=C[i++]<<g,g+=8,f+=C[i++]<<g,g+=8),y=_[f&v];t:for(;;){if(f>>>=w=y>>>24,g-=w,0==(w=y>>>16&255))M[r++]=65535&y;else{if(!(16&w)){if(0==(64&w)){y=_[(65535&y)+(f&(1<<w)-1)];continue t}if(32&w){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}b=65535&y,(w&=15)&&(g<w&&(f+=C[i++]<<g,g+=8),b+=f&(1<<w)-1,f>>>=w,g-=w),g<15&&(f+=C[i++]<<g,g+=8,f+=C[i++]<<g,g+=8),y=p[f&m];n:for(;;){if(f>>>=w=y>>>24,g-=w,!(16&(w=y>>>16&255))){if(0==(64&w)){y=p[(65535&y)+(f&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&y,g<(w&=15)&&(f+=C[i++]<<g,(g+=8)<w&&(f+=C[i++]<<g,g+=8)),u<(S+=f&(1<<w)-1)){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=w,g-=w,(w=r-a)<S){if(h<(w=S-w)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=l,(E=0)===d){if(E+=c-w,w<b){for(b-=w;M[r++]=l[E++],--w;);E=r-S,k=M}}else if(d<w){if(E+=c+d-w,(w-=d)<b){for(b-=w;M[r++]=l[E++],--w;);if(E=0,d<b){for(b-=w=d;M[r++]=l[E++],--w;);E=r-S,k=M}}}else if(E+=d-w,w<b){for(b-=w;M[r++]=l[E++],--w;);E=r-S,k=M}for(;2<b;)M[r++]=k[E++],M[r++]=k[E++],M[r++]=k[E++],b-=3;b&&(M[r++]=k[E++],1<b&&(M[r++]=k[E++]))}else{for(E=r-S;M[r++]=M[E++],M[r++]=M[E++],M[r++]=M[E++],2<(b-=3););b&&(M[r++]=M[E++],1<b&&(M[r++]=M[E++]))}break}}break}}while(i<s&&r<o);i-=b=g>>3,f&=(1<<(g-=b<<3))-1,e.next_in=i,e.next_out=r,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=r<o?o-r+257:257-(r-o),n.hold=f,n.bits=g}},{}],11:[function(e,t,n){var x=e("../utils/common"),F=e("./adler32"),A=e("./crc32"),R=e("./inffast"),P=e("./inftrees"),U=1,I=2,L=0,B=-2,N=1,i=852,s=592;function O(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new x.Buf16(320),this.work=new x.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=N,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new x.Buf32(i),t.distcode=t.distdyn=new x.Buf32(s),t.sane=1,t.back=-1,L):B}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):B}function u(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?B:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,o(e))):B}function c(e,t){var n,i;return e?(i=new r,(e.state=i).window=null,(n=u(e,t))!==L&&(e.state=null),n):B}var h,d,l=!0;function W(e){if(l){var t;for(h=new x.Buf32(512),d=new x.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(P(U,e.lens,0,288,h,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;P(I,e.lens,0,32,d,0,e.work,{bits:5}),l=!1}e.lencode=h,e.lenbits=9,e.distcode=d,e.distbits=5}function Q(e,t,n,i){var s,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new x.Buf8(r.wsize)),i>=r.wsize?(x.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,i<s&&(s=i),x.arraySet(r.window,t,n-i,s,r.wnext),(i-=s)?(x.arraySet(r.window,t,n-i,i,0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0}n.inflateReset=o,n.inflateReset2=u,n.inflateResetKeep=a,n.inflateInit=function f(e){return c(e,15)},n.inflateInit2=c,n.inflate=function H(e,t){var n,i,s,r,a,o,u,c,h,d,l,f,g,_,p,v,m,y,w,b,S,E,k,C,M=0,T=new x.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;12===(n=e.state).mode&&(n.mode=13),a=e.next_out,s=e.output,u=e.avail_out,r=e.next_in,i=e.input,o=e.avail_in,c=n.hold,h=n.bits,d=o,l=u,E=L;e:for(;;)switch(n.mode){case N:if(0===n.wrap){n.mode=13;break}for(;h<16;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(2&n.wrap&&35615===c){n.check=0,T[0]=255&c,T[1]=c>>>8&255,n.check=A(n.check,T,2,0),h=c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&c)){e.msg="unknown compression method",n.mode=30;break}if(h-=4,S=8+(15&(c>>>=4)),0===n.wbits)n.wbits=S;else if(S>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<S,e.adler=n.check=1,n.mode=512&c?10:12,h=c=0;break;case 2:for(;h<16;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(n.flags=c,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=A(n.check,T,2,0)),h=c=0,n.mode=3;case 3:for(;h<32;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}n.head&&(n.head.time=c),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,n.check=A(n.check,T,4,0)),h=c=0,n.mode=4;case 4:for(;h<16;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=A(n.check,T,2,0)),h=c=0,n.mode=5;case 5:if(1024&n.flags){for(;h<16;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=A(n.check,T,2,0)),h=c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(f=n.length,o<f&&(f=o),f&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),x.arraySet(n.head.extra,i,r,f,S)),512&n.flags&&(n.check=A(n.check,i,f,r)),o-=f,r+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===o)break e;for(f=0;S=i[r+f++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S)),S&&f<o;);if(512&n.flags&&(n.check=A(n.check,i,f,r)),o-=f,r+=f,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===o)break e;for(f=0;S=i[r+f++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S)),S&&f<o;);if(512&n.flags&&(n.check=A(n.check,i,f,r)),o-=f,r+=f,S)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;h<16;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}h=c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;h<32;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}e.adler=n.check=O(c),h=c=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=u,e.next_in=r,e.avail_in=o,n.hold=c,n.bits=h,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){c>>>=7&h,h-=7&h,n.mode=27;break}for(;h<3;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}switch(n.last=1&c,h-=1,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(W(n),n.mode=20,6!==t)break;c>>>=2,h-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}c>>>=2,h-=2;break;case 14:for(c>>>=7&h,h-=7&h;h<32;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&c,h=c=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(f=n.length){if(o<f&&(f=o),u<f&&(f=u),0===f)break e;x.arraySet(s,i,r,f,a),o-=f,r+=f,u-=f,a+=f,n.length-=f;break}n.mode=12;break;case 17:for(;h<14;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(n.nlen=257+(31&c),c>>>=5,h-=5,n.ndist=1+(31&c),c>>>=5,h-=5,n.ncode=4+(15&c),c>>>=4,h-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;h<3;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}n.lens[D[n.have++]]=7&c,c>>>=3,h-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,k={bits:n.lenbits},E=P(0,n.lens,0,19,n.lencode,0,n.work,k),n.lenbits=k.bits,E){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;M=n.lencode[c&(1<<n.lenbits)-1],v=M>>>16&255,m=65535&M,!((p=M>>>24)<=h);){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(m<16)c>>>=p,h-=p,n.lens[n.have++]=m;else{if(16===m){for(C=p+2;h<C;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(c>>>=p,h-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}S=n.lens[n.have-1],f=3+(3&c),c>>>=2,h-=2}else if(17===m){for(C=p+3;h<C;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}h-=p,S=0,f=3+(7&(c>>>=p)),c>>>=3,h-=3}else{for(C=p+7;h<C;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}h-=p,S=0,f=11+(127&(c>>>=p)),c>>>=7,h-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;f--;)n.lens[n.have++]=S}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,k={bits:n.lenbits},E=P(U,n.lens,0,n.nlen,n.lencode,0,n.work,k),n.lenbits=k.bits,E){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,k={bits:n.distbits},E=P(I,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,k),n.distbits=k.bits,E){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=o&&258<=u){e.next_out=a,e.avail_out=u,e.next_in=r,e.avail_in=o,n.hold=c,n.bits=h,R(e,l),a=e.next_out,s=e.output,u=e.avail_out,r=e.next_in,i=e.input,o=e.avail_in,c=n.hold,h=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;M=n.lencode[c&(1<<n.lenbits)-1],v=M>>>16&255,m=65535&M,!((p=M>>>24)<=h);){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(v&&0==(240&v)){for(y=p,w=v,b=m;M=n.lencode[b+((c&(1<<y+w)-1)>>y)],v=M>>>16&255,m=65535&M,!(y+(p=M>>>24)<=h);){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}c>>>=y,h-=y,n.back+=y}if(c>>>=p,h-=p,n.back+=p,n.length=m,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=12;break}if(64&v){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(C=n.extra;h<C;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;M=n.distcode[c&(1<<n.distbits)-1],v=M>>>16&255,m=65535&M,!((p=M>>>24)<=h);){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(0==(240&v)){for(y=p,w=v,b=m;M=n.distcode[b+((c&(1<<y+w)-1)>>y)],v=M>>>16&255,m=65535&M,!(y+(p=M>>>24)<=h);){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}c>>>=y,h-=y,n.back+=y}if(c>>>=p,h-=p,n.back+=p,64&v){e.msg="invalid distance code",n.mode=30;break}n.offset=m,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(C=n.extra;h<C;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===u)break e;if(f=l-u,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}g=f>n.wnext?(f-=n.wnext,n.wsize-f):n.wnext-f,f>n.length&&(f=n.length),_=n.window}else _=s,g=a-n.offset,f=n.length;for(u<f&&(f=u),u-=f,n.length-=f;s[a++]=_[g++],--f;);0===n.length&&(n.mode=21);break;case 26:if(0===u)break e;s[a++]=n.length,u--,n.mode=21;break;case 27:if(n.wrap){for(;h<32;){if(0===o)break e;o--,c|=i[r++]<<h,h+=8}if(l-=u,e.total_out+=l,n.total+=l,l&&(e.adler=n.check=n.flags?A(n.check,s,l,a-l):F(n.check,s,l,a-l)),l=u,(n.flags?c:O(c))!==n.check){e.msg="incorrect data check",n.mode=30;break}h=c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;h<32;){if(0===o)break e;o--,c+=i[r++]<<h,h+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}h=c=0}n.mode=29;case 29:E=1;break e;case 30:E=-3;break e;case 31:return-4;case 32:default:return B}return e.next_out=a,e.avail_out=u,e.next_in=r,e.avail_in=o,n.hold=c,n.bits=h,(n.wsize||l!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&Q(e,e.output,e.next_out,l-e.avail_out)?(n.mode=31,-4):(d-=e.avail_in,l-=e.avail_out,e.total_in+=d,e.total_out+=l,n.total+=l,n.wrap&&l&&(e.adler=n.check=n.flags?A(n.check,s,l,e.next_out-l):F(n.check,s,l,e.next_out-l)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===l||4===t)&&E===L&&(E=-5),E)},n.inflateEnd=function g(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,L},n.inflateGetHeader=function _(e,t){var n;return e&&e.state&&0!=(2&(n=e.state).wrap)?((n.head=t).done=!1,L):B},n.inflateSetDictionary=function p(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?B:11===n.mode&&F(1,t,i,0)!==n.check?-3:Q(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,L):B},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(e,t,n){var U=e("../utils/common"),I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],N=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,i,s,r,a,o){var u,c,h,d,l,f,g,_,p,v=o.bits,m=0,y=0,w=0,b=0,S=0,E=0,k=0,C=0,M=0,T=0,D=null,x=0,F=new U.Buf16(16),A=new U.Buf16(16),R=null,P=0;for(m=0;m<=15;m++)F[m]=0;for(y=0;y<i;y++)F[t[n+y]]++;for(S=v,b=15;1<=b&&0===F[b];b--);if(b<S&&(S=b),0===b)return s[r++]=20971520,s[r++]=20971520,o.bits=1,0;for(w=1;w<b&&0===F[w];w++);for(S<w&&(S=w),m=C=1;m<=15;m++)if(C<<=1,(C-=F[m])<0)return-1;if(0<C&&(0===e||1!==b))return-1;for(A[1]=0,m=1;m<15;m++)A[m+1]=A[m]+F[m];for(y=0;y<i;y++)0!==t[n+y]&&(a[A[t[n+y]]++]=y);if(f=0===e?(D=R=a,19):1===e?(D=I,x-=257,R=L,P-=257,256):(D=B,R=N,-1),m=w,l=r,k=y=T=0,h=-1,d=(M=1<<(E=S))-1,1===e&&852<M||2===e&&592<M)return 1;for(;;){for(g=m-k,p=a[y]<f?(_=0,a[y]):a[y]>f?(_=R[P+a[y]],D[x+a[y]]):(_=96,0),u=1<<m-k,w=c=1<<E;s[l+(T>>k)+(c-=u)]=g<<24|_<<16|p|0,0!==c;);for(u=1<<m-1;T&u;)u>>=1;if(0!==u?(T&=u-1,T+=u):T=0,y++,0==--F[m]){if(m===b)break;m=t[n+a[y]]}if(S<m&&(T&d)!==h){for(0===k&&(k=S),l+=w,C=1<<(E=m-k);E+k<b&&!((C-=F[E+k])<=0);)E++,C<<=1;if(M+=1<<E,1===e&&852<M||2===e&&592<M)return 1;s[h=T&d]=S<<24|E<<16|l-r|0}}return 0!==T&&(s[l+T]=m-k<<24|64<<16|0),o.bits=S,0}},{"../utils/common":3}],13:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,n){var r=e("../utils/common"),i=0,s=1;function a(e){for(var t=e.length;0<=--t;)e[t]=0}var o=0,u=29,c=256,h=c+1+u,d=30,l=19,v=2*h+1,m=15,f=16,g=7,_=256,p=16,y=17,w=18,b=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],k=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=new Array(2*(h+2));a(C);var M=new Array(2*d);a(M);var T=new Array(512);a(T);var D=new Array(256);a(D);var x=new Array(u);a(x);var F,A,R,P=new Array(d);function U(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function I(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function L(e){return e<256?T[e]:T[256+(e>>>7)]}function B(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function N(e,t,n){e.bi_valid>f-n?(e.bi_buf|=t<<e.bi_valid&65535,B(e,e.bi_buf),e.bi_buf=t>>f-e.bi_valid,e.bi_valid+=n-f):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function O(e,t,n){N(e,n[2*t],n[2*t+1])}function W(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function Q(e){16===e.bi_valid?(B(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function H(e,t,n){var i,s,r=new Array(m+1),a=0;for(i=1;i<=m;i++)r[i]=a=a+n[i-1]<<1;for(s=0;s<=t;s++){var o=e[2*s+1];0!==o&&(e[2*s]=W(r[o]++,o))}}function q(){var e,t,n,i,s,r=new Array(m+1);for(i=n=0;i<u-1;i++)for(x[i]=n,e=0;e<1<<b[i];e++)D[n++]=i;for(D[n-1]=i,i=s=0;i<16;i++)for(P[i]=s,e=0;e<1<<S[i];e++)T[s++]=i;for(s>>=7;i<d;i++)for(P[i]=s<<7,e=0;e<1<<S[i]-7;e++)T[256+s++]=i;for(t=0;t<=m;t++)r[t]=0;for(e=0;e<=143;)C[2*e+1]=8,e++,r[8]++;for(;e<=255;)C[2*e+1]=9,e++,r[9]++;for(;e<=279;)C[2*e+1]=7,e++,r[7]++;for(;e<=287;)C[2*e+1]=8,e++,r[8]++;for(H(C,h+1,r),e=0;e<d;e++)M[2*e+1]=5,M[2*e]=W(e,5);F=new U(C,b,c+1,h,m),A=new U(M,S,0,d,m),R=new U(new Array(0),E,0,l,g)}function z(e){var t;for(t=0;t<h;t++)e.dyn_ltree[2*t]=0;for(t=0;t<d;t++)e.dyn_dtree[2*t]=0;for(t=0;t<l;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*_]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function j(e){8<e.bi_valid?B(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function V(e,t,n,i){var s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&i[t]<=i[n]}function Y(e,t,n){for(var i=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&V(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!V(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i}function K(e,t,n){var i,s,r,a,o=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0===i?O(e,s,t):(r=D[s],O(e,r+c+1,t),0!==(a=b[r])&&(s-=x[r],N(e,s,a)),r=L(--i),O(e,r,n),0!==(a=S[r])&&(i-=P[r],N(e,i,a))),o<e.last_lit;);O(e,_,t)}function G(e,t){var n,i,s,r=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=v,n=0;n<u;n++)0!==r[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):r[2*n+1]=0;for(;e.heap_len<2;)s=e.heap[++e.heap_len]=c<2?++c:0,r[2*s]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=a[2*s+1]);for(t.max_code=c,n=e.heap_len>>1;1<=n;n--)Y(e,r,n);for(s=u;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Y(e,r,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,r[2*s]=r[2*n]+r[2*i],e.depth[s]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,r[2*n+1]=r[2*i+1]=s,e.heap[1]=s++,Y(e,r,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function p(e,t){var n,i,s,r,a,o,u=t.dyn_tree,c=t.max_code,h=t.stat_desc.static_tree,d=t.stat_desc.has_stree,l=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,g=t.stat_desc.max_length,_=0;for(r=0;r<=m;r++)e.bl_count[r]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<v;n++)i=e.heap[n],r=u[2*u[2*i+1]+1]+1,g<r&&(r=g,_++),u[2*i+1]=r,c<i||(e.bl_count[r]++,a=0,f<=i&&(a=l[i-f]),o=u[2*i],e.opt_len+=o*(r+a),d&&(e.static_len+=o*(h[2*i+1]+a)));if(0!==_){do{for(r=g-1;0===e.bl_count[r];)r--;e.bl_count[r]--,e.bl_count[r+1]+=2,e.bl_count[g]--,_-=2}while(0<_);for(r=g;0!==r;r--)for(i=e.bl_count[r];0!==i;)s=e.heap[--n],c<s||(u[2*s+1]!==r&&(e.opt_len+=(r-u[2*s+1])*u[2*s],u[2*s+1]=r),i--)}}(e,t),H(r,c,e.bl_count)}function X(e,t,n){var i,s,r=-1,a=t[1],o=0,u=7,c=4;for(0===a&&(u=138,c=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=a,a=t[2*(i+1)+1],++o<u&&s===a||(o<c?e.bl_tree[2*s]+=o:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[2*p]++):o<=10?e.bl_tree[2*y]++:e.bl_tree[2*w]++,r=s,c=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4))}function Z(e,t,n){var i,s,r=-1,a=t[1],o=0,u=7,c=4;for(0===a&&(u=138,c=3),i=0;i<=n;i++)if(s=a,a=t[2*(i+1)+1],!(++o<u&&s===a)){if(o<c)for(;O(e,s,e.bl_tree),0!=--o;);else 0!==s?(s!==r&&(O(e,s,e.bl_tree),o--),O(e,p,e.bl_tree),N(e,o-3,2)):o<=10?(O(e,y,e.bl_tree),N(e,o-3,3)):(O(e,w,e.bl_tree),N(e,o-11,7));r=s,c=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4)}}function J(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),G(e,e.bl_desc),t=l-1;3<=t&&0===e.bl_tree[2*k[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function $(e,t,n,i){var s;for(N(e,t-257,5),N(e,n-1,5),N(e,i-4,4),s=0;s<i;s++)N(e,e.bl_tree[2*k[s]+1],3);Z(e,e.dyn_ltree,t-1),Z(e,e.dyn_dtree,n-1)}function ee(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return s;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return s;return i}a(P);var te=!1;function ne(e,t,n,i){N(e,(o<<1)+(i?1:0),3),function s(e,t,n,i){j(e),i&&(B(e,n),B(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}n._tr_init=function ie(e){te||(q(),te=!0),e.l_desc=new I(e.dyn_ltree,F),e.d_desc=new I(e.dyn_dtree,A),e.bl_desc=new I(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,z(e)},n._tr_stored_block=ne,n._tr_flush_block=function se(e,t,n,i){var s,r,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=ee(e)),G(e,e.l_desc),G(e,e.d_desc),a=J(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?ne(e,t,n,i):4===e.strategy||r===s?(N(e,2+(i?1:0),3),K(e,C,M)):(N(e,4+(i?1:0),3),$(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),K(e,e.dyn_ltree,e.dyn_dtree)),z(e),i&&j(e)},n._tr_tally=function re(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(D[n]+c+1)]++,e.dyn_dtree[2*L(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function ae(e){N(e,2,3),O(e,_,C),Q(e)}},{"../utils/common":3}],15:[function(e,t,n){t.exports=function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(e,t,n){var i=e("./lib/utils/common").assign,s=e("./lib/deflate"),r=e("./lib/inflate"),a=e("./lib/zlib/constants"),o={};i(o,s,r,a),t.exports=o},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}(),x=e,F=function(){function e(){le(this,e),this.onServerStateUpdated=new x.CDEvent,this.reset()}return he(e,[{key:"getSts",value:function(){return this._sts}},{key:"getStd",value:function(){return this._std}},{key:"getSid",value:function(){return this._sid}},{key:"getCsid",value:function(){return this._csid}},{key:"getPsid",value:function(){return this._psid}},{key:"getMuid",value:function(){return this._muid}},{key:"getContextName",value:function(){return this._contextName}},{key:"getRequestId",value:function(){return this._requestId}},{key:"getWupDispatchRate",value:function(){return this._wupDispatchRate}},{key:"setSts",value:function(e){this._sts=e}},{key:"setStd",value:function(e){this._std=e}},{key:"setSid",value:function(e){this._sid=e}},{key:"setCsid",value:function(e){this._csid=e}},{key:"setPsid",value:function(e){this._psid=e}},{key:"setMuid",value:function(e){this._muid=e}},{key:"setContextName",value:function(e){this._contextName=e}},{key:"setRequestId",value:function(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1];return this._requestId=e,t&&this._publish(),this._requestId}},{key:"setWupDispatchRate",value:function(e){e?this._wupDispatchRate=e:log.warn("Wup dispatch rate of "+e+" is invalid. Ignoring update")}},{key:"incrementRequestId",value:function(){return this._requestId++,this._publish(),this._requestId}},{key:"resetRequestId",value:function(){this._requestId=0}},{key:"reset",value:function(){this._sts=null,this._std=null,this._sid=null,this._csid=null,this._muid=null,this._contextName=null,this._requestId=0,this._wupDispatchRate=5e3}},{key:"_publish",value:function(){this.onServerStateUpdated.publish({requestId:this._requestId,sid:this._sid,sts:this._sts,std:this._std})}}]),e}(),x.WupServerSessionState=F,A=e,R=function(){function n(e,t){le(this,n),this._wupServerSessionState=e,this._messageBus=t}return he(n,[{key:"process",value:function(e){e.sts&&this._wupServerSessionState.setSts(e.sts),e.std&&this._wupServerSessionState.setStd(e.std),e.reset_session&&e.new_sid&&this._wupServerSessionState.setSid(e.new_sid),this._messageBus.publish(A.MessageBusEventType.ServerStateUpdatedEvent,{requestId:this._wupServerSessionState.getRequestId(),sid:this._wupServerSessionState.getSid(),sts:this._wupServerSessionState.getSts(),std:this._wupServerSessionState.getStd()}),e.reset_session&&(e.new_sid?this._messageBus.publish(A.MessageBusEventType.NewSessionStartedEvent,e.new_sid):log.warn("Received a reset session flag from the server without a new sid. Ignoring reset.")),e.nextWupInterval?e.nextWupInterval!==this._wupServerSessionState.getWupDispatchRate()&&(this._wupServerSessionState.setWupDispatchRate(e.nextWupInterval),this._messageBus.publish(A.MessageBusEventType.WupDispatchRateUpdatedEvent,this._wupServerSessionState.getWupDispatchRate())):log.warn("Received an invalid nextWupInterval value of "+e.nextWupInterval+". Ignoring value.")}}]),n}(),A.WupResponseProcessor=R,P=e,U=function(){function e(){le(this,e),this._messageStruct={ds:"js"}}return he(e,[{key:"getDataSource",value:function(){return this._messageStruct.ds}},{key:"getSid",value:function(){return this._messageStruct.cdsnum}},{key:"setSid",value:function(e){this._messageStruct.cdsnum=e}},{key:"getCsid",value:function(){return this._messageStruct.csid}},{key:"setCsid",value:function(e){this._messageStruct.csid=e}},{key:"getPsid",value:function(){return this._messageStruct.psid}},{key:"setPsid",value:function(e){this._messageStruct.psid=e}},{key:"getMuid",value:function(){return this._messageStruct.muid}},{key:"setMuid",value:function(e){this._messageStruct.muid=e}},{key:"getContextName",value:function(){return this._messageStruct.context_name}},{key:"setContextName",value:function(e){this._messageStruct.context_name=e}},{key:"getRequestId",value:function(){return this._messageStruct.requestId}},{key:"setRequestId",value:function(e){this._messageStruct.requestId=e}},{key:"getSts",value:function(){return this._messageStruct.sts}},{key:"setSts",value:function(e){this._messageStruct.sts=e}},{key:"getStd",value:function(){return this._messageStruct.std}},{key:"setStd",value:function(e){this._messageStruct.std=e}},{key:"getConfigurationName",value:function(){return this._messageStruct.c}},{key:"setConfigurationName",value:function(e){this._messageStruct.c=e}},{key:"getData",value:function(){return this._messageStruct.d}},{key:"setData",value:function(e){this._messageStruct.d=e}},{key:"getInternalMessage",value:function(){return this._messageStruct}}]),e}(),P.WupMessage=U,I=e,L=function(){function n(e,t){le(this,n),this._wupServerSessionState=e,this._dataPacker=t}return he(n,[{key:"build",value:function(e,t){var n=new I.WupMessage;return n.setSid(this._wupServerSessionState.getSid()),n.setCsid(this._wupServerSessionState.getCsid()),n.setPsid(this._wupServerSessionState.getPsid()),n.setMuid(this._wupServerSessionState.getMuid()),n.setContextName(this._wupServerSessionState.getContextName()),n.setRequestId(this._wupServerSessionState.getRequestId()),this._wupServerSessionState.getSts()&&this._wupServerSessionState.getStd()&&(n.setSts(this._wupServerSessionState.getSts()),n.setStd(this._wupServerSessionState.getStd())),"0"===e?n.setData([this._dataPacker.pack(t)]):n.setConfigurationName(e),n}}]),n}(),I.WupMessageBuilder=L,B=e,N=function(){function t(e){le(this,t),this._wupServerSessionState=e}return he(t,[{key:"build",value:function(e){return e.setSid(this._wupServerSessionState.getSid()),e.setSts(this._wupServerSessionState.getSts()),e.setStd(this._wupServerSessionState.getStd()),JSON.stringify(e.getInternalMessage())}}]),t}(),B.WupRequestBodyBuilder=N,O=e,W=function(){function s(e,t){var n=2<arguments.length&&arguments[2]!==undefined&&arguments[2],i=3<arguments.length&&arguments[3]!==undefined?arguments[3]:"";le(this,s),this._requestBodyBuilder=e,this.updateSettings(t),this._acceptNoResponse=n,this._messageDescriptor=i,this._dataQueue=new O.Queue,this._awaitingServerResponse=!1,this._currentMessageNumberOfSendFailures=0,this._currentSentItem=null,this._sendRetryTimeoutId=null,this._messageIdentifier=0}return he(s,[{key:"setServerUrl",value:function(e){this.wupUrl=e}},{key:"updateSettings",value:function(e){this._sendRetryRate=e.sendRetryRate,this._queueLoadThershold=e.queueLoadThreshold}},{key:"sendMessage",value:function(e,t,n,i,s,r){var a=this,o=function o(e){a._onMessageSendSuccess(e,s)},u=function u(e,t,n){a._onMessageSendFailure(e,t,n,r)};this._enqueueMessage(e,t,n,i,o,u)}},{key:"flush",value:function(){this._flushData()}},{key:"isReadyToSendData",value:function(){return!!this.wupUrl}},{
key:"_onMessageSendSuccess",value:function(e,t){this._awaitingServerResponse=!1,this._currentMessageNumberOfSendFailures=0,this._currentSentItem=null,t(e),this._processNextQueueItem()}},{key:"_onMessageSendFailure",value:function(e,t,n,i){if(!this._currentSentItem)return log.error("An unexpected error has occurred while handling a "+this._messageDescriptor+" message send failure. Could not find sent item value. Moving to next queued item"),void this._processNextQueueItem();log.warn("Failed sending "+this._messageDescriptor+" message #"+this._currentSentItem.identifier+". "+this._buildFailureLog(e,t,n)),this._awaitingServerResponse=!1,this._currentMessageNumberOfSendFailures++,this._currentMessageNumberOfSendFailures<this._currentSentItem.maxNumberOfSendAttempts?(log.info("Trying to send "+this._messageDescriptor+" message #"+this._currentSentItem.identifier+" again. Number of send failures is "+this._currentMessageNumberOfSendFailures),this._prepareMessageForSendRetry(this._currentSentItem.identifier,this._currentSentItem.messageToSend,this._currentSentItem.timeout,this._currentSentItem.maxNumberOfSendAttempts,this._currentSentItem.onSuccess,this._currentSentItem.onError)):(log.error("Discarding "+this._messageDescriptor+" message #"+this._currentSentItem.identifier+" after "+this._currentMessageNumberOfSendFailures+" failed send attempts."),this._currentMessageNumberOfSendFailures=0,this._currentSentItem=null,i&&i(e),this._processNextQueueItem())}},{key:"_enqueueMessage",value:function(e,t,n,i,s,r){this._dataQueue.enqueue({identifier:this._messageIdentifier++,messageToSend:e,onSuccess:s,onError:r,timeout:t,maxNumberOfSendAttempts:n}),this._clearRetryTimeout(),i&&this._flushData(),this._awaitingServerResponse||this._processNextQueueItem(i)}},{key:"_processNextQueueItem",value:function(){var e=0<arguments.length&&arguments[0]!==undefined&&arguments[0];if(this._dataQueue.hasItems()){var t=this._dataQueue.dequeue(),n=this._requestBodyBuilder.build(t.messageToSend);if(e&&navigator.sendBeacon)return log.debug("Data was sent by beacon"),void navigator.sendBeacon(this.wupUrl,n);this._awaitingServerResponse=!0,this._currentSentItem=t,O.WorkerUtils.getPostUrl(this.wupUrl,"POST",n,t.onSuccess,t.onError,this._acceptNoResponse,t.timeout),this._dataQueue.length()>this._queueLoadThershold&&log.warn("Data queue has "+this._dataQueue.length()+" items in queue. Might indicate slow\\unstable communication issues.")}}},{key:"_flushData",value:function(){for(;this._dataQueue.hasItems();)this._processNextQueueItem(!0)}},{key:"_prepareMessageForSendRetry",value:function(e,t,n,i,s,r){this._dataQueue.enqueueToHead({identifier:e,messageToSend:t,onSuccess:s,onError:r,timeout:n,maxNumberOfSendAttempts:i}),this._setRetryTimeout()}},{key:"_clearRetryTimeout",value:function(){this._sendRetryTimeoutId&&clearTimeout(this._sendRetryTimeoutId)}},{key:"_setRetryTimeout",value:function(){var e=this;this._clearRetryTimeout(),this._sendRetryTimeoutId=setTimeout(function(){e._processNextQueueItem()},this._sendRetryRate)}},{key:"_buildFailureLog",value:function(e,t,n){var i="";return e&&(i+="Response Text: "+e+"."),t&&(i+="Status: "+t+"."),n&&(i+="Status Text: "+n+"."),i}}]),s}(),O.ServerCommunicator=W,Q=e,H=function(){function a(e,t,n,i,s,r){le(this,a),this._serverCommunicator=e,this._wupMessageBuilder=t,this._wupServerSessionState=n,this._wupStatisticsService=i,this._wupResponseProcessor=s,this._configManager=r,this._CONFIG_WUP_TIMEOUT=12e3,this._MESSAGE_SEND_RETRIES=5,this._requestTimeout=this._configManager.get(Q.ConfigurationFields.wupMessageRequestTimeout)}return he(a,[{key:"requestConfigurations",value:function(e,t,n,i,s,r,a,o,u){var c=this,h=a&&a.requestId?this._wupServerSessionState.setRequestId(a.requestId+1):this._wupServerSessionState.setRequestId(0),d={static_fields:[]};d.static_fields.push(["requestId",h]),this._initSession(e,t,n,i,s,r,a,h);var l=this._wupMessageBuilder.build("js",d);log.info("Request config from server. Message timeout is "+this._CONFIG_WUP_TIMEOUT+" ms");var f=function f(e){c._onConfigurationRequestSucceeded(e,o,u)},g=function g(e){c._onConfigurationRequestFailed(e,u)};this._serverCommunicator.sendMessage(l,this._CONFIG_WUP_TIMEOUT,this._MESSAGE_SEND_RETRIES,!1,f,g)}},{key:"startNewSession",value:function(e,t,n,i,s,r){this._validateStartSessionRelatedParameters(e,i,r),this._wupServerSessionState.setRequestId(0),this._initSession(e,t,n,i,s,r,null,this._wupServerSessionState.getRequestId());var a=this._createStaticFieldsPart();this._sendMessage(a,!1)}},{key:"resumeSession",value:function(e,t,n,i,s,r,a){this._validateResumeSessionRelatedParameters(e,i,r);var o=a&&a.requestId?this._wupServerSessionState.setRequestId(a.requestId+1):this._wupServerSessionState.setRequestId(0);this._initSession(e,t,n,i,s,r,a,o);var u=this._createStaticFieldsPart();this._sendMessage(u,!1)}},{key:"sendData",value:function(e){var t=1<arguments.length&&arguments[1]!==undefined&&arguments[1];this._wupServerSessionState.getSts()&&this._wupServerSessionState.getStd()?this._sendMessage(e,t):log.error("Unable to send data. sts or std are undefined")}},{key:"setRequestTimeout",value:function(e){this._requestTimeout=e}},{key:"_initSession",value:function(e,t,n,i,s,r,a,o){log.info("Initializing session. wupUrl:"+r+", sid:"+e),this._serverCommunicator.setServerUrl(r),this._wupServerSessionState.setSid(e),this._wupServerSessionState.setCsid(t),this._wupServerSessionState.setPsid(n),this._wupServerSessionState.setMuid(i),this._wupServerSessionState.setContextName(s||""),this._wupServerSessionState.setRequestId(o,!1),a?(this._wupServerSessionState.setSts(a.sts),this._wupServerSessionState.setStd(a.std)):(log.info("Resetting server state of server communicator. Deleting sts and std"),this._wupServerSessionState.setSts(null),this._wupServerSessionState.setStd(null),this._wupStatisticsService.resetCounters())}},{key:"updateCsid",value:function(e){var t=this._wupServerSessionState.incrementRequestId()||0;this._wupServerSessionState.setCsid(e);var n={static_fields:[]};n.static_fields.push(["requestId",t],["contextId",this._wupServerSessionState.getContextName()],["sessionId",this._wupServerSessionState.getSid()],["customerSessionId",this._wupServerSessionState.getCsid()],["partnerSessionId",this._wupServerSessionState.getPsid()],["muid",this._wupServerSessionState.getMuid()]),this._sendMessage(n)}},{key:"updatePsid",value:function(e){var t=this._wupServerSessionState.incrementRequestId()||0;this._wupServerSessionState.setPsid(e);var n={static_fields:[]};n.static_fields.push(["requestId",t],["contextId",this._wupServerSessionState.getContextName()],["sessionId",this._wupServerSessionState.getSid()],["customerSessionId",this._wupServerSessionState.getCsid()],["partnerSessionId",this._wupServerSessionState.getPsid()],["muid",this._wupServerSessionState.getMuid()]),this._sendMessage(n)}},{key:"isReady",value:function(){return!!(this._serverCommunicator.isReadyToSendData()&&this._wupServerSessionState.getStd()&&this._wupServerSessionState.getSts())}},{key:"_validateStartSessionRelatedParameters",value:function(e,t,n){if(e)throw new Error("Invalid sid parameter "+e+". Unable to start new session");this._validateCommonSessionRelatedParameters(t,n)}},{key:"_validateResumeSessionRelatedParameters",value:function(e,t,n){if(!e)throw new Error("Invalid sid parameter "+e+". Unable to start new session");this._validateCommonSessionRelatedParameters(t,n)}},{key:"_validateCommonSessionRelatedParameters",value:function(e,t){if(!e)throw new Error("Invalid muid parameter "+e+". Unable to start new session");if(!t)throw new Error("Invalid serverAddress parameter "+t+". Unable to start new session")}},{key:"_createStaticFieldsPart",value:function(){var e={static_fields:[]};return e.static_fields.push(["requestId",this._wupServerSessionState.getRequestId()],["contextId",this._wupServerSessionState.getContextName()],["sessionId",this._wupServerSessionState.getSid()],["customerSessionId",this._wupServerSessionState.getCsid()],["partnerSessionId",this._wupServerSessionState.getPsid()],["muid",this._wupServerSessionState.getMuid()]),e}},{key:"_sendMessage",value:function(e){var t=1<arguments.length&&arguments[1]!==undefined&&arguments[1],n=this._wupMessageBuilder.build("0",e);this._serverCommunicator.sendMessage(n,this._requestTimeout,this._MESSAGE_SEND_RETRIES,t,this._onSendDataSuccess.bind(this),this._onSendDataFailure.bind(this))}},{key:"_onConfigurationRequestSucceeded",value:function(e,t,n){this._handleSuccessResponse(e,t,n)}},{key:"_onConfigurationRequestFailed",value:function(e,t){t(e)}},{key:"_onSendDataSuccess",value:function(e){this._handleSuccessResponse(e),this._wupStatisticsService.incrementSentWupCount()}},{key:"_onSendDataFailure",value:function(e){}},{key:"_handleSuccessResponse",value:function(e,t,n){try{var i=JSON.parse(e);this._wupResponseProcessor.process(i),t&&t(i)}catch(r){var s="Failed to parse message from server: "+r.message;log.error(s,r),n&&n(s)}}}]),a}(),Q.WupServerClient=H,q=e,z=function(){function e(){le(this,e)}return he(e,[{key:"setData",value:function(e){this._data=e}},{key:"getInternalMessage",value:function(){return this._data}}]),e}(),q.LogMessage=z,j=e,V=function(){function t(e){le(this,t),this._dataPacker=e}return he(t,[{key:"build",value:function(e){var t=new j.LogMessage;return t.setData(this._dataPacker.pack(e)),t}}]),t}(),j.LogMessageBuilder=V,Y=e,K=function(){function e(){le(this,e)}return he(e,[{key:"build",value:function(e){return e.getInternalMessage()}}]),e}(),Y.LogRequestBodyBuilder=K,G=e,X=function(){function i(e,t,n){le(this,i),this._serverCommunicator=e,this._logMessageBuilder=t,this._configManager=n,this._MESSAGE_SEND_RETRIES=5,this._requestTimeout=this._configManager.get(G.ConfigurationFields.logMessageRequestTimeout)}return he(i,[{key:"setServerUrl",value:function(e){this._serverCommunicator.setServerUrl(e)}},{key:"sendData",value:function(e){var t=1<arguments.length&&arguments[1]!==undefined&&arguments[1],n=this._logMessageBuilder.build(e);this._serverCommunicator.sendMessage(n,this._requestTimeout,this._MESSAGE_SEND_RETRIES,t,this._onSendDataSuccess.bind(this),this._onSendDataFailure.bind(this)),t&&this._serverCommunicator.flush()}},{key:"isReady",value:function(){return this._serverCommunicator.isReadyToSendData()}},{key:"setRequestTimeout",value:function(e){this._requestTimeout=e}},{key:"_onSendDataSuccess",value:function(e){}},{key:"_onSendDataFailure",value:function(e){log.warn("Failed sending log message. Error: "+e+".")}}]),i}(),G.LogServerClient=X,(Z=e).WorkerUtils={isUndefinedNull:function(e){return null===e||e===undefined||"undefined"==typeof e},getHash:function(e){for(var t=0,n=0,i=e.length;n<i;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t},generateUUID:function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},getPostUrl:function(e,t,n,i,s,r,a){var o=Z.HttpRequestFactory.create();o instanceof self.XMLHttpRequest?(o.open(t,e,!0),o.timeout=a||12e3,o.onload=function(){200===o.status||204===o.status&&r?i&&i(o.responseText):s&&s(o.responseText,o.status,o.statusText)},o.onerror=function(){s&&s(o.responseText,o.status,o.statusText)},o.ontimeout=function(){s&&s("timeout")},o.onabort=function(){s&&s("abort")},o.send(n)):(o.onload=function(){i&&o.responseText&&i(o.responseText)},o.onerror=function(){s&&s(o.responseText,o.status,o.statusText)},o.onprogress=function(){},o.ontimeout=function(){s&&s("timeout")},o.open(t,e,!0),o.timeout=a||12e3,setTimeout(function(){o.send(n)},0))}},J=e,$=function(){function e(){le(this,e),this._compressData=function(e){var t=msgpack.encode(e);return t=pako.deflateRaw(t,{to:"string"}),J.btoa(t)}}return he(e,[{key:"pack",value:function(e){return this._getCompressedData(e)}},{key:"_getCompressedData",value:function(e){return this._compressData(e)}}]),e}(),J.DataPacker=$,e.WorkerCommand={requestConfigurationsCommand:"requestConfigurationsCommand",startNewSessionCommand:"startNewSessionCommand",resumeSessionCommand:"resumeSessionCommand",changeContextCommand:"changeContextCommand",updateCsidCommand:"updateCsidCommand",updatePsidCommand:"updatePsidCommand",updateLogUrlCommand:"updateLogUrl",sendDataCommand:"sendDataCommand",sendLogCommand:"sendLogCommand"},e.WorkerEvent={NewSessionStartedEvent:"NewSessionStartedEvent",ServerStateUpdatedEvent:"ServerStateUpdatedEvent"},ee=e,te=function(){function o(e,t,n,i,s,r,a){le(this,o),this._mainCommunicator=e,this._wupServerClient=t,this._logServerClient=n,this._configManager=i,this._messageProcessor=s,this._logMessageProcessor=r,this._wupServerSessionState=a}return he(o,[{key:"start",value:function(){log.info("Starting Worker Service"),this._mainCommunicator.addMessageListener(ee.WorkerCommand.requestConfigurationsCommand,this._onRequestConfigurationsCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.startNewSessionCommand,this._onStartNewSessionCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.resumeSessionCommand,this._onResumeSessionCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.changeContextCommand,this._onChangeContextCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.updateCsidCommand,this._onUpdateCsidCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.updatePsidCommand,this._onUpdatePsidCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.updateLogUrlCommand,this._onUpdateLogUrlCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.sendDataCommand,this._onSendDataCommand.bind(this)),this._mainCommunicator.addMessageListener(ee.WorkerCommand.sendLogCommand,this._onSendLogCommand.bind(this))}},{key:"_onRequestConfigurationsCommand",value:function(e){log.info("Worker received a RequestConfigurationsCommand from main."),this._wupServerClient.requestConfigurations(e.cdsnum,e.csid,e.psid,e.muid,e.context_name,e.serverAddress,e.serverState,this._onInitSuccess.bind(this),this._onInitError.bind(this))}},{key:"_onStartNewSessionCommand",value:function(e){this._wupServerClient.startNewSession(e.cdsnum,e.csid,e.psid,e.muid,e.contextName,e.serverAddress)}},{key:"_onResumeSessionCommand",value:function(e){this._wupServerClient.resumeSession(e.cdsnum,e.csid,e.psid,e.muid,e.contextName,e.serverAddress,e.serverState)}},{key:"_onChangeContextCommand",value:function(e){log.info("Worker received a ChangeContextCommand from main."),this._wupServerSessionState.setContextName(e.contextName)}},{key:"_onUpdateCsidCommand",value:function(e){log.info("Worker received an UpdateCsidCommand from main. CSID: "+e.csid+"."),this._wupServerClient.updateCsid(e.csid)}},{key:"_onUpdatePsidCommand",value:function(e){log.info("Worker received an UpdatePsidCommand from main. PSID: "+e.psid+"."),this._wupServerClient.updatePsid(e.psid)}},{key:"_onUpdateLogUrlCommand",value:function(e){this._logServerClient.setServerUrl(e.logAddress)}},{key:"_onInitError",value:function(e){log.warn("Worker received an error response for Init request. Notifying main."),this._mainCommunicator.sendAsync("initCommFailed",e)}},{key:"_onInitSuccess",value:function(e){log.info("Worker received a successful response for Init request. Notifying main and updating worker configuration."),this._mainCommunicator.sendAsync("initCommSuccess",e),this._configManager.updateConfiguration(e)}},{key:"_onSendDataCommand",value:function(e){this._messageProcessor.process(e)}},{key:"_onSendLogCommand",value:function(e){this._logMessageProcessor.process(e)}}]),o}(),ee.WorkerService=te,ne=e,ie=function(){function u(e,t,n,i,s,r,a,o){le(this,u),this._messageBus=e,this._wupStatisticsService=t,this._wupDispatcher=n,this._logWupDispatcher=i,this._serverCommunicator=s,this._wupServerClient=r,this._logServerClient=a,this._logger=o,this._messageBus.subscribe(ne.MessageBusEventType.ConfigUpdatedEvent,this._handle.bind(this))}return he(u,[{key:"_handle",value:function(e){this._wupStatisticsService.updateSettings(e.get(ne.ConfigurationFields.wupStatisticsLogIntervalMs));var t=e.get(ne.ConfigurationFields.forceDynamicDataWupDispatchSettings)?ne.ConfigurationDefaultTemplates.defaultDynamicWupDispatchRateConfiguration:e.get(ne.ConfigurationFields.dataWupDispatchRateSettings);this._wupDispatcher.updateByConfig(t),this._logWupDispatcher.updateByConfig(e.get(ne.ConfigurationFields.logWupDispatchRateSettings)),this._serverCommunicator.updateSettings(e.get(ne.ConfigurationFields.serverCommunicationSettings)),this._logger.updateLogConfig(e),this._wupServerClient.setRequestTimeout(e.get(ne.ConfigurationFields.wupMessageRequestTimeout)||e.get(ne.ConfigurationFields.wupResponseTimeout)),this._logServerClient.setRequestTimeout(e.get(ne.ConfigurationFields.logMessageRequestTimeout))}}]),u}(),ne.WorkerConfigUpdatedEventHandler=ie,se=e,re=function(){function i(e,t,n){le(this,i),this._messageBus=e,this._logger=t,this._mainCommunicator=n,this._messageBus.subscribe(se.MessageBusEventType.NewSessionStartedEvent,this._handle.bind(this))}return he(i,[{key:"_handle",value:function(e){this._logger.info("Worker received a new session id "+e+" from server."),this._mainCommunicator.sendAsync(se.WorkerEvent.NewSessionStartedEvent,e)}}]),i}(),se.WorkerNewSessionStartedEventHandler=re,ae=e,oe=function(){function i(e,t,n){le(this,i),this._messageBus=e,this._logger=t,this._mainCommunicator=n,this._messageBus.subscribe(ae.MessageBusEventType.ServerStateUpdatedEvent,this._handle.bind(this))}return he(i,[{key:"_handle",value:function(e){this._logger.debug("Worker received an updated server state."),this._mainCommunicator.sendAsync(ae.WorkerEvent.ServerStateUpdatedEvent,e)}}]),i}(),ae.WorkerServerStateUpdatedEventHandler=oe,ue=e,ce=function(){function i(e,t,n){le(this,i),this._messageBus=e,this._dataWupDispatcher=t,this._logger=n,this._messageBus.subscribe(ue.MessageBusEventType.WupDispatchRateUpdatedEvent,this._handle.bind(this))}return he(i,[{key:"_handle",value:function(e){this._logger.info("Worker received a wup dispatch rate "+e+" from server."),this._dataWupDispatcher.scheduleNextDispatching()}}]),i}(),ue.WorkerWupDispatchRateUpdatedEventHandler=ce,function(r){function e(e){this._mainCommunicator=e,this._eventHandlers=[]}e.prototype.loadSystem=function(){var t=this;this._msgBus=new r.MessageBus(r.WorkerUtils),this._configMgr=new r.ConfigManager(this._msgBus),this._wupServerSessionState=new r.WupServerSessionState,this._logRequestBodyBuilder=new r.LogRequestBodyBuilder,this._logServerCommunicator=new r.ServerCommunicator(this._logRequestBodyBuilder,this._configMgr.get(r.ConfigurationFields.serverCommunicationSettings),!0,"log"),this._logMessageBuilder=new r.LogMessageBuilder(new r.DataPacker),this._logServerClient=new r.LogServerClient(this._logServerCommunicator,this._logMessageBuilder,this._configMgr),this._wupStatisticsService=new r.WupStatisticsService(this._configMgr.get(r.ConfigurationFields.wupStatisticsLogIntervalMs)),this._wupDispatchRateCalculatorFactory=new r.WupDispatchRateCalculatorFactory(this._wupStatisticsService,this._wupServerSessionState);var n=this._logWupDispatcher=new r.WupDispatcher(this._logServerClient,new r.LogAggregator,this._wupDispatchRateCalculatorFactory,this._configMgr.get(r.ConfigurationFields.logWupDispatchRateSettings)),e=new(function(){function e(){le(this,e)}return he(e,[{key:"log",value:function log(e,t){n.add({eventName:"log",data:{msg:e,url:"worker",level:t,sn:this.sn++}})}}]),e}());this._logMessageProcessor=new r.MessageProcessor(this._logWupDispatcher),e.sn=0;var i=new r.Logger(e);r.log.setLogger(i),this._wupMessageBuilder=new r.WupMessageBuilder(this._wupServerSessionState,new r.DataPacker),this._wupRequestBodyBuilder=new r.WupRequestBodyBuilder(this._wupServerSessionState),this._dataServerCommunicator=new r.ServerCommunicator(this._wupRequestBodyBuilder,this._configMgr.get(r.ConfigurationFields.serverCommunicationSettings),!1,"wup"),this._wupResponseProcessor=new r.WupResponseProcessor(this._wupServerSessionState,this._msgBus),this._wupServerClient=new r.WupServerClient(this._dataServerCommunicator,this._wupMessageBuilder,this._wupServerSessionState,this._wupStatisticsService,this._wupResponseProcessor,this._configMgr);var s=this._configMgr.get(r.ConfigurationFields.forceDynamicDataWupDispatchSettings)?r.ConfigurationDefaultTemplates.defaultDynamicWupDispatchRateConfiguration:this._configMgr.get(r.ConfigurationFields.dataWupDispatchRateSettings);this._wupDispatcher=new r.WupDispatcher(this._wupServerClient,new r.DataAggregator(this._wupServerSessionState),this._wupDispatchRateCalculatorFactory,s),this._messageProcessor=new r.MessageProcessor(this._wupDispatcher),this._eventHandlers.push(new r.WorkerConfigUpdatedEventHandler(this._msgBus,this._wupStatisticsService,this._wupDispatcher,this._logWupDispatcher,this._dataServerCommunicator,this._wupServerClient,this._logServerClient,i)),this._eventHandlers.push(new r.WorkerNewSessionStartedEventHandler(this._msgBus,i,this._mainCommunicator)),this._eventHandlers.push(new r.WorkerServerStateUpdatedEventHandler(this._msgBus,i,this._mainCommunicator)),this._eventHandlers.push(new r.WorkerWupDispatchRateUpdatedEventHandler(this._msgBus,this._wupDispatcher,i)),this._wupServerSessionState.onServerStateUpdated.subscribe(function(e){t._mainCommunicator.sendAsync(r.WorkerEvent.ServerStateUpdatedEvent,e)}),this._mainCommunicator.addMessageListener("stateUpdateFromStorage",function(e){e&&e.requestId&&e.sts&&(t._wupServerSessionState.setRequestId(e.requestId,!1),t._wupServerSessionState.setSts(e.sts),t._wupServerSessionState.setStd(e.std))}),this._workerService=new r.WorkerService(this._mainCommunicator,this._wupServerClient,this._logServerClient,this._configMgr,this._messageProcessor,this._logMessageProcessor,this._wupServerSessionState),this._workerService.start(),log.info("Loaded worker")},r.WorkerSysLoader=e}(e),function(n){function t(e){var t=new n.WorkerCommunicator;t.setMessagingPort(e),new n.WorkerSysLoader(t).loadSystem()}if(n.isUnsupportedMode)t(n.sysLoader.getUnsupportedMgr().getUnsPort());else{var e=Object.getOwnPropertyNames(self);e&&-1<e.indexOf("onconnect")?self.onconnect=function(e){t(new n.CDPort(e.ports[0]))}:t(new n.CDPort(self))}}(e)}fe.getServerWorkerCode=function(){return e.toString()},fe.executeServerWorkerCodeInMain=function(){e()}}(vn);var log=vn.log;vn.startSloth(null,null)};